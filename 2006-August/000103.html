<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Viperals-svncheckins] r184 - in cms/trunk: . admin includes	includes/auth includes/cache includes/db includes/display	includes/forums includes/forums/admin includes/forums/mcp	includes/templates/modules/forums	includes/templates/modules/forums/admin install javascript	modules/control_panel/modules modules/forums	modules/forums/admin modules/members_list
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/viperals-svncheckins/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r184%20-%20in%20cms/trunk%3A%20.%20admin%20includes%0A%09includes/auth%20includes/cache%20includes/db%20includes/display%0A%09includes/forums%20includes/forums/admin%20includes/forums/mcp%0A%09includes/templates/modules/forums%0A%09includes/templates/modules/forums/admin%20install%20javascript%0A%09modules/control_panel/modules%20modules/forums%0A%09modules/forums/admin%20modules/members_list&In-Reply-To=%3C200608161223.k7GCNTQK001157%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000102.html">
   <LINK REL="Next"  HREF="000104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Viperals-svncheckins] r184 - in cms/trunk: . admin includes	includes/auth includes/cache includes/db includes/display	includes/forums includes/forums/admin includes/forums/mcp	includes/templates/modules/forums	includes/templates/modules/forums/admin install javascript	modules/control_panel/modules modules/forums	modules/forums/admin modules/members_list</H1>
    <B>viperal at BerliOS</B> 
    <A HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r184%20-%20in%20cms/trunk%3A%20.%20admin%20includes%0A%09includes/auth%20includes/cache%20includes/db%20includes/display%0A%09includes/forums%20includes/forums/admin%20includes/forums/mcp%0A%09includes/templates/modules/forums%0A%09includes/templates/modules/forums/admin%20install%20javascript%0A%09modules/control_panel/modules%20modules/forums%0A%09modules/forums/admin%20modules/members_list&In-Reply-To=%3C200608161223.k7GCNTQK001157%40sheep.berlios.de%3E"
       TITLE="[Viperals-svncheckins] r184 - in cms/trunk: . admin includes	includes/auth includes/cache includes/db includes/display	includes/forums includes/forums/admin includes/forums/mcp	includes/templates/modules/forums	includes/templates/modules/forums/admin install javascript	modules/control_panel/modules modules/forums	modules/forums/admin modules/members_list">viperal at mail.berlios.de
       </A><BR>
    <I>Wed Aug 16 14:23:29 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000102.html">[Viperals-svncheckins] r183 - in cms/trunk: includes includes/db	includes/forums includes/forums/mcp	includes/templates/modules/forums modules/control_panel	modules/control_panel/modules modules/forums
</A></li>
        <LI>Next message: <A HREF="000104.html">[Viperals-svncheckins] r185 - in cms/trunk: . admin includes	includes/cache includes/display includes/forums	includes/forums/admin includes/templates/admin	includes/templates/admin/eaccelerator	includes/templates/modules/forums	includes/templates/modules/forums/admin install	modules/forums modules/forums/admin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103">[ date ]</a>
              <a href="thread.html#103">[ thread ]</a>
              <a href="subject.html#103">[ subject ]</a>
              <a href="author.html#103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: viperal
Date: 2006-08-16 14:22:53 +0200 (Wed, 16 Aug 2006)
New Revision: 184

Added:
   cms/trunk/includes/templates/modules/forums/admin/
   cms/trunk/includes/templates/modules/forums/admin/acp_main.html
Removed:
   cms/trunk/includes/display/menu.php
Modified:
   cms/trunk/admin/index.php
   cms/trunk/core.php
   cms/trunk/includes/auth/auth.php
   cms/trunk/includes/cache/cache_file.php
   cms/trunk/includes/db/mysql.php
   cms/trunk/includes/db/mysql3.php
   cms/trunk/includes/db/mysqli.php
   cms/trunk/includes/db/postgres.php
   cms/trunk/includes/db/sqlite.php
   cms/trunk/includes/db/sqlite_pdo.php
   cms/trunk/includes/forums/admin/main.php
   cms/trunk/includes/forums/auth.php
   cms/trunk/includes/forums/functions.php
   cms/trunk/includes/forums/functions_display.php
   cms/trunk/includes/forums/functions_posting.php
   cms/trunk/includes/forums/functions_upload.php
   cms/trunk/includes/forums/mcp/mcp_notes.php
   cms/trunk/includes/forums/mcp/mcp_post.php
   cms/trunk/includes/forums/mcp/mcp_topic.php
   cms/trunk/includes/forums/message_parser.php
   cms/trunk/includes/functions.php
   cms/trunk/includes/tables.php
   cms/trunk/install/build_data.php
   cms/trunk/install/build_tables.php
   cms/trunk/installer.php
   cms/trunk/javascript/editor.js
   cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php
   cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php
   cms/trunk/modules/control_panel/modules/ucp_register.php
   cms/trunk/modules/forums/admin/index.php
   cms/trunk/modules/forums/posting.php
   cms/trunk/modules/forums/viewtopic.php
   cms/trunk/modules/members_list/index.php
Log:


Modified: cms/trunk/admin/index.php
===================================================================
--- cms/trunk/admin/index.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/admin/index.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -28,7 +28,7 @@
 
 if (isset($_REQUEST['user_mode']) &amp;&amp; $_CLASS['core_auth']-&gt;admin_power('users') &amp;&amp; display_confirmation())
 {
-	require_once($site_file_root.'includes/functions_user.php');
+	require_once SITE_FILE_ROOT.'includes/functions_user.php';
 	$user_id = get_variable('id', 'REQUEST', false, 'integer');
 
 	if ($user_id)
@@ -50,7 +50,7 @@
 {
 	$cms_news = array();
 	
-	load_class($site_file_root.'includes/core_rss.php', 'core_rss');
+	load_class(SITE_FILE_ROOT.'includes/core_rss.php', 'core_rss');
 	
 	if ($_CLASS['core_rss']-&gt;get_rss('<A HREF="http://www.php.net/news.rss">http://www.php.net/news.rss</A>', 3))
 	{

Modified: cms/trunk/core.php
===================================================================
--- cms/trunk/core.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/core.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -39,6 +39,13 @@
 set_magic_quotes_runtime(0);
 error_reporting(E_ALL);
 
+if (function_exists('date_default_timezone_set'))
+{
+	error_reporting(E_ALL | E_STRICT);
+
+	@date_default_timezone_set('America/New_York');
+}
+
 /* Error reporting tyoes */
 define('ERROR_NONE', 0);
 define('ERROR_ONPAGE', 1);
@@ -98,7 +105,6 @@
 
 /* We're going ot use our own error handler */
 $_CLASS['core_handler']-&gt;start();
-
 /*
 	$_CLASS['core_handler']-&gt;stop();
 */

Modified: cms/trunk/includes/auth/auth.php
===================================================================
--- cms/trunk/includes/auth/auth.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/auth/auth.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -216,11 +216,11 @@
 			'USERNAME'				=&gt;	$user_name,
 			'PASSWORD'				=&gt;	$user_password,
 
-			'U_SEND_PASSWORD'	 	=&gt; ($_CORE_CONFIG['email']['email_enable']) ? generate_link('Control_Panel&amp;mode=sendpassword') : '',
-			'U_RESEND_ACTIVATION'   =&gt; ($_CORE_CONFIG['user']['activation'] != USER_ACTIVATION_NONE &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('Control_Panel&amp;mode=resend_act') : '',
-			'U_TERMS_USE'			=&gt; generate_link('Control_Panel&amp;mode=terms'), 
-			'U_PRIVACY'				=&gt; generate_link('Control_Panel&amp;mode=privacy'),
-			'U_REGISTER'			=&gt; generate_link('Control_Panel&amp;mode=register'),
+			'U_SEND_PASSWORD'	 	=&gt; ($_CORE_CONFIG['email']['email_enable']) ? generate_link('control_panel&amp;mode=sendpassword') : '',
+			'U_RESEND_ACTIVATION'   =&gt; ($_CORE_CONFIG['user']['activation'] != USER_ACTIVATION_NONE &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('control_panel&amp;mode=resend_act') : '',
+			'U_TERMS_USE'			=&gt; generate_link('control_panel&amp;mode=terms'), 
+			'U_PRIVACY'				=&gt; generate_link('control_panel&amp;mode=privacy'),
+			'U_REGISTER'			=&gt; generate_link('control_panel&amp;mode=register'),
 			'U_CONFIRM_IMAGE'		=&gt; $confirm_image,
 
 			'S_DISPLAY_FULL_LOGIN'  =&gt; ($login_array['full_login']),

Modified: cms/trunk/includes/cache/cache_file.php
===================================================================
--- cms/trunk/includes/cache/cache_file.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/cache/cache_file.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -114,6 +114,19 @@
 			$this-&gt;remove($name);
 		}
 	}
+
+	function destroy_all()
+	{
+		$handle = opendir($this-&gt;cache_dir);
+
+		while ($file = readdir($handle))
+		{
+			if (substr($file, 0, 6) == 'cache_')
+			{
+				unlink($this-&gt;cache_dir . $file);
+			} 
+		}
+	}
 }
 
 ?&gt;
\ No newline at end of file

Modified: cms/trunk/includes/db/mysql.php
===================================================================
--- cms/trunk/includes/db/mysql.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/db/mysql.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -162,7 +162,7 @@
 			return false; 
 		}
 
-		global $_CLASS, $site_file_root;
+		global $_CLASS;
 			
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = $query;
@@ -173,7 +173,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -202,8 +202,6 @@
 			return $this-&gt;query($query);
 		}
 
-		global $site_file_root;
-
 		$query .= ' LIMIT ' . (($offset) ? $offset . ', ' : '') . $total;
 
 		if (!$backtrace)
@@ -212,7 +210,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -570,8 +568,6 @@
 			break;
 
 			case 'stop':
-				global $site_file_root;
-
 				$end_time = explode(' ', microtime());
 				$end_time = $end_time[0] + $end_time[1];
 				$this-&gt;queries_time += $end_time - $start_time;

Modified: cms/trunk/includes/db/mysql3.php
===================================================================
--- cms/trunk/includes/db/mysql3.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/db/mysql3.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -108,7 +108,7 @@
 			return false; 
 		}
 
-		global $_CLASS, $site_file_root;
+		global $_CLASS;
 			
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = $query;
@@ -119,7 +119,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -153,8 +153,6 @@
 			return $this-&gt;query($query);
 		}
 
-		global $site_file_root;
-
 		$query .= ' LIMIT ' . (($offset) ? $offset . ', ' : '') . $total;
 
 		if (!$backtrace)
@@ -163,7 +161,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -421,8 +419,6 @@
 			break;
 
 			case 'stop':
-				global $site_file_root;
-
 				$end_time = explode(' ', microtime());
 				$end_time = $end_time[0] + $end_time[1];
 				$this-&gt;queries_time += $end_time - $start_time;

Modified: cms/trunk/includes/db/mysqli.php
===================================================================
--- cms/trunk/includes/db/mysqli.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/db/mysqli.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -164,7 +164,7 @@
 			return false; 
 		}
 
-		global $_CLASS, $site_file_root;
+		global $_CLASS;
 
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = $query;
@@ -175,7 +175,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -204,8 +204,6 @@
 			return $this-&gt;query($query);
 		}
 
-		global $site_file_root;
-
 		$query .= ' LIMIT ' . (($offset) ? $offset . ', ' : '') . $total;
 
 		if (!$backtrace)
@@ -214,7 +212,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -567,8 +565,6 @@
 			break;
 
 			case 'stop':
-				global $site_file_root;
-
 				$end_time = explode(' ', microtime());
 				$end_time = $end_time[0] + $end_time[1];
 				$this-&gt;queries_time += $end_time - $start_time;

Modified: cms/trunk/includes/db/postgres.php
===================================================================
--- cms/trunk/includes/db/postgres.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/db/postgres.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -174,7 +174,7 @@
 			return false; 
 		}
 
-		global $_CLASS, $site_file_root;
+		global $_CLASS;
 			
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = $query;
@@ -185,7 +185,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -219,8 +219,6 @@
 			return $this-&gt;query($query);
 		}
 
-		global $site_file_root;
-
 		$query .= ' LIMIT '. $total . (($offset) ? ' OFFSET '.$offset : '');
 
 		if (!$backtrace)
@@ -229,7 +227,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -244,6 +242,14 @@
 			return false;
 		}
 
+		$debug_backtrace = debug_backtrace();
+		$backtrace = array();
+		// remove the root directorys
+		$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
+		$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+
+		$backtrace['line'] = $debug_backtrace[0]['line'];
+
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = '';
 
@@ -252,7 +258,8 @@
 			case 'MULTI_INSERT':
 				foreach ($array as $array2)
 				{
-					pg_insert($this-&gt;link_identifier, $table, $array2);
+					//pg_insert($this-&gt;link_identifier, $table, $array2);
+					$this-&gt;query('INSERT INTO ' . $table . ' '. $this-&gt;sql_build_array('INSERT', $array2), $backtrace);
 				}
 			break;
 
@@ -260,7 +267,7 @@
 				//	return pg_insert($this-&gt;link_identifier, $table, $array);
 				// We can't use pg_insert if we need needed to get the insert_id
 				$this-&gt;last_query = 'INSERT INTO ' . $table . ' '. $this-&gt;sql_build_array('INSERT', $array);
-				$this-&gt;last_result = $this-&gt;query($this-&gt;last_query);
+				$this-&gt;last_result = $this-&gt;query($this-&gt;last_query, $backtrace);
 	
 				return $this-&gt;last_result;
 			break;
@@ -600,8 +607,6 @@
 			break;
 
 			case 'stop':
-				global $site_file_root;
-
 				$end_time = explode(' ', microtime());
 				$end_time = $end_time[0] + $end_time[1];
 				$this-&gt;queries_time += $end_time - $start_time;

Modified: cms/trunk/includes/db/sqlite.php
===================================================================
--- cms/trunk/includes/db/sqlite.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/db/sqlite.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -155,7 +155,7 @@
 			return false;
 		}
 
-		global $_CLASS, $site_file_root;
+		global $_CLASS;
 			
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = $query;
@@ -166,7 +166,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -201,8 +201,6 @@
 			return $this-&gt;query($query);
 		}
 
-		global $site_file_root;
-
 		$query .= ' LIMIT ' . (($offset) ? $offset . ', ' : '') . $total;
 
 		if (!$backtrace)
@@ -211,7 +209,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -479,8 +477,6 @@
 			break;
 
 			case 'stop':
-				global $site_file_root;
-
 				$end_time = explode(' ', microtime());
 				$end_time = $end_time[0] + $end_time[1];
 				$this-&gt;queries_time += $end_time - $start_time;

Modified: cms/trunk/includes/db/sqlite_pdo.php
===================================================================
--- cms/trunk/includes/db/sqlite_pdo.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/db/sqlite_pdo.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -143,7 +143,7 @@
 			return false; 
 		}
 
-		global $_CLASS, $site_file_root;
+		global $_CLASS;
 			
 		$this-&gt;num_queries++;
 		$this-&gt;last_query = $query;
@@ -154,7 +154,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -184,8 +184,6 @@
 			return $this-&gt;query($query);
 		}
 
-		global $site_file_root;
-
 		$query .= ' LIMIT ' . (($offset) ? $offset . ', ' : '') . $total;
 
 		if (!$backtrace)
@@ -194,7 +192,7 @@
 			$backtrace = array();
 			// remove the root directorys
 			$backtrace['file'] = str_replace('\\','/', $debug_backtrace[0]['file']);
-			$backtrace['file'] = str_replace($site_file_root, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
+			$backtrace['file'] = str_replace(SITE_FILE_ROOT, '', str_replace($_SERVER['DOCUMENT_ROOT'],'', $backtrace['file']));
 
 			$backtrace['line'] = $debug_backtrace[0]['line'];
 		}
@@ -398,8 +396,6 @@
 			break;
 
 			case 'stop':
-				global $site_file_root;
-
 				$end_time = explode(' ', microtime());
 				$end_time = $end_time[0] + $end_time[1];
 				$this-&gt;queries_time += $end_time - $start_time;

Deleted: cms/trunk/includes/display/menu.php
===================================================================
--- cms/trunk/includes/display/menu.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/display/menu.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -1,65 +0,0 @@
-&lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
-
-class menu
-{
-
-	var $menu = '&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;';
-	var $menuname = 'Menu';
-	var $options = '&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;var AdminM =[';
-
-	var $mainopen = false;
-	function main($image='null', $name, $link ,$t2='null',$t3=false)
-	{
-		if ($this-&gt;mainopen)
-		{
-			$this-&gt;options .= &quot;]\n&quot;;
-		}
-		$this-&gt;options .= &quot;[null,'$name','$link',null,'Home Page',\n&quot;;
-
-	}
-	
-	function sub($image='null', $name, $link ,$t2='null',$t3=false)
-	{
-
-		$this-&gt;options .= &quot;[null,'$name','$link',null,'Home Page'],\n&quot;;
-
-	}
-	
-	function menuarray($menu, $previous=false) {
-
-		foreach  ($menu as $name =&gt; $value)
-		{
-			if ($previous == $name)
-			{
-				$this-&gt;main($image='null', $name, $value ,$t2='null',$t3='null');
-			} else {
-			
-				if (is_array($value))
-				{
-					$this-&gt;menuarray($value, $name);
-				} else {
-					$this-&gt;sub($image='null', $name, $value ,$t2='null',$t3='null');
-				}
-			}
-		}
-		$this-&gt;options .= &quot;],\n&quot;;
-	}
-	
-	function menuclose() {
-			$this-&gt;options = substr($this-&gt;options, 0, -2). &quot;;\ncmDraw ('AdminMenu', AdminM, 'hbr', cmThemeOffice, 'ThemeOffice');
-&lt;/script&gt;\n&quot;; 
-	}
-}
-
-?&gt;
\ No newline at end of file

Modified: cms/trunk/includes/forums/admin/main.php
===================================================================
--- cms/trunk/includes/forums/admin/main.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/admin/main.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -1,283 +1,198 @@
-&lt;?php
-// -------------------------------------------------------------
-//
-// $Id: index.php,v 1.24 2004/05/26 18:55:25 acydburn Exp $
-//
-// FILENAME  : adm/index.php
-// STARTED   : Sat Feb 13, 2001
-// COPYRIGHT : &#169; 2003 phpBB Group
-// WWW       : <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
-// LICENCE   : GPL vs2.0 [ see /docs/COPYING ] 
-// 
-// -------------------------------------------------------------
-if (!defined('VIPERAL') || VIPERAL != 'Admin')
-{
-	die; 
-}
-
-// Do we have any admin permissions at all?
-if (!$_CLASS['auth']-&gt;acl_get('a_'))
-{
-	trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
-}
-
-// Define some vars
-$action = request_var('action', '');
-
-switch ($action)
-{
-	case 'stats':
-		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
-		{
-			trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
-		}
-
-		$sql = 'SELECT COUNT(post_id) AS stat 
-			FROM ' . FORUMS_POSTS_TABLE . '
-			WHERE post_approved = 1';
-		$result = $_CLASS['core_db']-&gt;query($sql);
-
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-		$_CLASS['core_db']-&gt;free_result($result);
-		set_config('num_posts', (int) $row['stat'], true);
-
-		$sql = 'SELECT COUNT(topic_id) AS stat
-			FROM ' . FORUMS_TOPICS_TABLE . '
-			WHERE topic_approved = 1';
-		$result = $_CLASS['core_db']-&gt;query($sql);
-
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-		$_CLASS['core_db']-&gt;free_result($result);
-		set_config('num_topics', (int) $row['stat'], true);
-
-		$sql = 'SELECT COUNT(attach_id) as stat
-			FROM ' . FORUMS_ATTACHMENTS_TABLE;
-		$result = $_CLASS['core_db']-&gt;query($sql);
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-	
-		set_config('num_files', (int) $row['stat'], true);
-		$_CLASS['core_db']-&gt;free_result($result);
-
-		$sql = 'SELECT SUM(filesize) as stat
-			FROM ' . FORUMS_ATTACHMENTS_TABLE;
-		$result = $_CLASS['core_db']-&gt;query($sql);
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-
-		set_config('upload_dir_size', (int) $row['stat'], true);
-		$_CLASS['core_db']-&gt;free_result($result);
-
-		add_log('admin', 'LOG_RESYNC_STATS');
-	break;
-		
-	case 'user':
-		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
-		{
-			trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
-		}
-
-		$post_count_ary = $_CLASS['auth']-&gt;acl_getf('f_postcount');
-
-		$forum_ary = array();
-		foreach ($post_count_ary as $forum_id =&gt; $allowed)
-		{
-			if ($allowed['f_postcount'])
-			{
-				$forum_ary[] = $forum_id;
-			}
-		}
-		
-		if (!sizeof($forum_ary))
-		{
-			$_CLASS['core_db']-&gt;query('UPDATE ' . USERS_TABLE . ' SET user_posts = 0');
-		}
-		else
-		{
-			$sql = 'SELECT COUNT(post_id) AS num_posts, poster_id
-				FROM ' . FORUMS_POSTS_TABLE . '
-				WHERE poster_id &lt;&gt; ' . ANONYMOUS . '
-					AND forum_id IN (' . implode(', ', $forum_ary) . ')
-				GROUP BY poster_id';
-			$result = $_CLASS['core_db']-&gt;query($sql);
-
-			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-			{
-				$_CLASS['core_db']-&gt;query('UPDATE ' . USERS_TABLE . &quot; SET user_posts = {$row['num_posts']} WHERE user_id = {$row['poster_id']}&quot;);
-			}
-			$_CLASS['core_db']-&gt;free_result($result);
-		}
-
-		add_log('admin', 'LOG_RESYNC_POSTCOUNTS');
-		break;
-}
-
-// Get forum statistics
-$total_posts = $config['num_posts'];
-$total_topics = $config['num_topics'];
-$total_users = $_CORE_CONFIG['user']['total_users'];
-$total_files = $config['num_files'];
-
-$start_date = $_CLASS['core_user']-&gt;format_date($config['board_start_date']);
-
-$boarddays = (gmtime() - $config['board_start_date']) / 86400;
-
-$posts_per_day = sprintf('%.2f', $total_posts / $boarddays);
-$topics_per_day = sprintf('%.2f', $total_topics / $boarddays);
-$users_per_day = sprintf('%.2f', $total_users / $boarddays);
-$files_per_day = sprintf('%.2f', $total_files / $boarddays);
-
-$upload_dir_size = ($config['upload_dir_size'] &gt;= 1048576) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['MB'], ($config['upload_dir_size'] / 1048576)) : (($config['upload_dir_size'] &gt;= 1024) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['KB'], ($config['upload_dir_size'] / 1024)) : sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['BYTES'], $config['upload_dir_size']));
-
-$avatar_dir_size = 0;
-
-if ($avatar_dir = @opendir($config['avatar_path']))
-{
-	while ($file = readdir($avatar_dir))
-	{
-		if ($file{0} != '.')
-		{
-			$avatar_dir_size += filesize($config['avatar_path'] . '/' . $file);
-		}
-	}
-	@closedir($avatar_dir);
-
-	// This bit of code translates the avatar directory size into human readable format
-	// Borrowed the code from the PHP.net annoted manual, origanally written by:
-	// Jesse (<A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">jesse at jess.on.ca</A>)
-	$avatar_dir_size = ($avatar_dir_size &gt;= 1048576) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['MB'], ($avatar_dir_size / 1048576)) : (($avatar_dir_size &gt;= 1024) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['KB'], ($avatar_dir_size / 1024)) : sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['BYTES'], $avatar_dir_size));
-}
-else
-{
-	// Couldn't open Avatar dir.
-	$avatar_dir_size = $_CLASS['core_user']-&gt;lang['NOT_AVAILABLE'];
-}
-
-if ($posts_per_day &gt; $total_posts)
-{
-	$posts_per_day = $total_posts;
-}
-
-if ($topics_per_day &gt; $total_topics)
-{
-	$topics_per_day = $total_topics;
-}
-
-if ($users_per_day &gt; $total_users)
-{
-	$users_per_day = $total_users;
-}
-
-if ($files_per_day &gt; $total_files)
-{
-	$files_per_day = $total_files;
-}
-
-// Remove
-$dbsize = $_CLASS['core_user']-&gt;lang['NOT_AVAILABLE'];
-
-adm_page_header($_CLASS['core_user']-&gt;lang['ADMIN_INDEX']);
-
-?&gt;
-
-&lt;script language=&quot;Javascript&quot; type=&quot;text/javascript&quot;&gt;
-&lt;!--
-	function marklist(status)
-	{
-		for (i = 0; i &lt; document.inactive.length; i++)
-		{
-			document.inactive.elements[i].checked = status;
-		}
-	}
-//--&gt;
-&lt;/script&gt;
-
-&lt;h1&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['WELCOME_PHPBB']; ?&gt;&lt;/h1&gt;
-
-&lt;p&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['ADMIN_INTRO']; ?&gt;&lt;/p&gt;
-
-&lt;h1&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['FORUM_STATS']; ?&gt;&lt;/h1&gt;
-
-&lt;form name=&quot;statistics&quot; method=&quot;post&quot; action=&quot;&lt;?php echo generate_link('forums', array('admin' =&gt; true)); ?&gt;&quot;&gt;&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; border=&quot;0&quot;&gt;
-	&lt;tr&gt;
-		&lt;th width=&quot;25%&quot; nowrap=&quot;nowrap&quot; height=&quot;25&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['STATISTIC']; ?&gt;&lt;/th&gt;
-		&lt;th width=&quot;25%&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['VALUE']; ?&gt;&lt;/th&gt;
-		&lt;th width=&quot;25%&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['STATISTIC']; ?&gt;&lt;/th&gt;
-		&lt;th width=&quot;25%&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['VALUE']; ?&gt;&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['NUMBER_POSTS']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $total_posts; ?&gt;&lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['POSTS_PER_DAY']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $posts_per_day; ?&gt;&lt;/b&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['NUMBER_TOPICS']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $total_topics; ?&gt;&lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['TOPICS_PER_DAY']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $topics_per_day; ?&gt;&lt;/b&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['NUMBER_USERS']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $total_users; ?&gt;&lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['USERS_PER_DAY']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $users_per_day; ?&gt;&lt;/b&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['NUMBER_FILES']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $total_files; ?&gt;&lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['FILES_PER_DAY']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $files_per_day; ?&gt;&lt;/b&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['BOARD_STARTED']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $start_date; ?&gt;&lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['AVATAR_DIR_SIZE']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $avatar_dir_size; ?&gt;&lt;/b&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['DATABASE_SIZE']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $dbsize; ?&gt;&lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['UPLOAD_DIR_SIZE']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;&lt;?php echo $upload_dir_size; ?&gt;&lt;/b&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;4&quot; align=&quot;right&quot;&gt;&lt;select name=&quot;action&quot;&gt;&lt;option value=&quot;online&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['RESET_ONLINE']; ?&gt;&lt;/option&gt;&lt;option value=&quot;date&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['RESET_DATE']; ?&gt;&lt;/option&gt;&lt;option value=&quot;stats&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['RESYNC_STATS']; ?&gt;&lt;/option&gt;&lt;option value=&quot;user&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['RESYNC_POSTCOUNTS']; ?&gt;&lt;/option&gt;
-		&lt;/select&gt; &lt;input class=&quot;btnlite&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;&lt;?php echo $_CLASS['core_user']-&gt;lang['SUBMIT']; ?&gt;&quot; /&gt;&nbsp;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;/table&gt;&lt;/form&gt;
-
-&lt;h1&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['ADMIN_LOG']; ?&gt;&lt;/h1&gt;
-
-&lt;p&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['ADMIN_LOG_INDEX_EXPLAIN']; ?&gt;&lt;/p&gt;
-
-&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; border=&quot;0&quot;&gt;
-	&lt;tr&gt;
-		&lt;th width=&quot;15%&quot; height=&quot;25&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['USERNAME']; ?&gt;&lt;/th&gt;
-		&lt;th width=&quot;15%&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['IP']; ?&gt;&lt;/th&gt;
-		&lt;th width=&quot;20%&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['TIME']; ?&gt;&lt;/th&gt;
-		&lt;th width=&quot;45%&quot; nowrap=&quot;nowrap&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;lang['ACTION']; ?&gt;&lt;/th&gt;
-	&lt;/tr&gt;
-&lt;?php
-
-	view_log('admin', $log_data, $log_count, 10);
-
-	$row_class = 'row2';
-	for($i = 0; $i &lt; sizeof($log_data); $i++)
-	{
-		$row_class = ($row_class == 'row1') ? 'row2' : 'row1';
-
-?&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;&lt;?php echo $row_class; ?&gt;&quot;&gt;&lt;?php echo $log_data[$i]['username']; ?&gt;&lt;/td&gt;
-		&lt;td class=&quot;&lt;?php echo $row_class; ?&gt;&quot; align=&quot;center&quot;&gt;&lt;?php echo $log_data[$i]['ip']; ?&gt;&lt;/td&gt;
-		&lt;td class=&quot;&lt;?php echo $row_class; ?&gt;&quot; align=&quot;center&quot;&gt;&lt;?php echo $_CLASS['core_user']-&gt;format_date($log_data[$i]['time']); ?&gt;&lt;/td&gt;
-		&lt;td class=&quot;&lt;?php echo $row_class; ?&gt;&quot;&gt;&lt;?php echo $log_data[$i]['action']; ?&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;?php
-
-	}
-	?&gt;&lt;/table&gt;
-	&lt;?php
-
-	adm_page_footer();
-
+&lt;?php
+// -------------------------------------------------------------
+//
+// $Id: index.php,v 1.24 2004/05/26 18:55:25 acydburn Exp $
+//
+// FILENAME  : adm/index.php
+// STARTED   : Sat Feb 13, 2001
+// COPYRIGHT : &#169; 2003 phpBB Group
+// WWW       : <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
+// LICENCE   : GPL vs2.0 [ see /docs/COPYING ] 
+// 
+// -------------------------------------------------------------
+if (!defined('VIPERAL') || VIPERAL != 'Admin')
+{
+	die; 
+}
+
+// Do we have any admin permissions at all?
+if (!$_CLASS['auth']-&gt;acl_get('a_'))
+{
+	trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
+}
+
+// Define some vars
+$action = request_var('action', '');
+
+switch ($action)
+{
+	case 'stats':
+		if (!$_CLASS['auth']-&gt;acl_get('a_board'))
+		{
+			trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
+		}
+
+		$sql = 'SELECT COUNT(post_id) AS stat 
+			FROM ' . FORUMS_POSTS_TABLE . '
+			WHERE post_approved = 1';
+		$result = $_CLASS['core_db']-&gt;query($sql);
+
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+		$_CLASS['core_db']-&gt;free_result($result);
+		set_config('num_posts', (int) $row['stat'], true);
+
+		$sql = 'SELECT COUNT(topic_id) AS stat
+			FROM ' . FORUMS_TOPICS_TABLE . '
+			WHERE topic_approved = 1';
+		$result = $_CLASS['core_db']-&gt;query($sql);
+
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+		$_CLASS['core_db']-&gt;free_result($result);
+		set_config('num_topics', (int) $row['stat'], true);
+
+		$sql = 'SELECT COUNT(attach_id) as stat
+			FROM ' . FORUMS_ATTACHMENTS_TABLE;
+		$result = $_CLASS['core_db']-&gt;query($sql);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+	
+		set_config('num_files', (int) $row['stat'], true);
+		$_CLASS['core_db']-&gt;free_result($result);
+
+		$sql = 'SELECT SUM(filesize) as stat
+			FROM ' . FORUMS_ATTACHMENTS_TABLE;
+		$result = $_CLASS['core_db']-&gt;query($sql);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+
+		set_config('upload_dir_size', (int) $row['stat'], true);
+		$_CLASS['core_db']-&gt;free_result($result);
+
+		add_log('admin', 'LOG_RESYNC_STATS');
+	break;
+		
+	case 'user':
+		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
+		{
+			trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
+		}
+
+		$sql = 'SELECT COUNT(post_id) AS num_posts, poster_id
+			FROM ' . FORUMS_POSTS_TABLE . '
+			WHERE post_postcount = 1
+			GROUP BY poster_id';
+		$result = $_CLASS['core_db']-&gt;query($sql);
+
+		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+		{
+			$_CLASS['core_db']-&gt;query('UPDATE ' . CORE_USERS_TABLE . &quot; SET user_posts = {$row['num_posts']} WHERE user_id = {$row['poster_id']}&quot;);
+		}
+		$_CLASS['core_db']-&gt;free_result($result);
+
+		add_log('admin', 'LOG_RESYNC_POSTCOUNTS');
+	break;
+}
+
+// Get forum statistics
+$total_posts = $config['num_posts'];
+$total_topics = $config['num_topics'];
+$total_users = $_CORE_CONFIG['user']['total_users'];
+$total_files = $config['num_files'];
+
+$start_date = $_CLASS['core_user']-&gt;format_date($config['board_start_date']);
+
+$boarddays = ($_CLASS['core_user']-&gt;time - $config['board_start_date']) / 86400;
+
+$posts_per_day = sprintf('%.2f', $total_posts / $boarddays);
+$topics_per_day = sprintf('%.2f', $total_topics / $boarddays);
+$users_per_day = sprintf('%.2f', $total_users / $boarddays);
+$files_per_day = sprintf('%.2f', $total_files / $boarddays);
+
+$upload_dir_size = ($config['upload_dir_size'] &gt;= 1048576) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['MB'], ($config['upload_dir_size'] / 1048576)) : (($config['upload_dir_size'] &gt;= 1024) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['KB'], ($config['upload_dir_size'] / 1024)) : sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['BYTES'], $config['upload_dir_size']));
+
+$avatar_dir_size = 0;
+
+if ($avatar_dir = @opendir($_CORE_CONFIG['global']['path_avatar_upload']))
+{
+	while (($file = readdir($avatar_dir)) !== false)
+	{
+		if ($file{0} != '.' &amp;&amp; $file != 'CVS' &amp;&amp; strpos($file, 'index.') === false)
+		{
+			$avatar_dir_size += filesize($_CORE_CONFIG['global']['path_avatar_upload'] . '/' . $file);
+		}
+	}
+	@closedir($avatar_dir);
+
+	// This bit of code translates the avatar directory size into human readable format
+	// Borrowed the code from the PHP.net annoted manual, origanally written by:
+	// Jesse (<A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">jesse at jess.on.ca</A>)
+	$avatar_dir_size = ($avatar_dir_size &gt;= 1048576) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['MB'], ($avatar_dir_size / 1048576)) : (($avatar_dir_size &gt;= 1024) ? sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['KB'], ($avatar_dir_size / 1024)) : sprintf('%.2f ' . $_CLASS['core_user']-&gt;lang['BYTES'], $avatar_dir_size));
+}
+else
+{
+	// Couldn't open Avatar dir.
+	$avatar_dir_size = $_CLASS['core_user']-&gt;lang['NOT_AVAILABLE'];
+}
+
+if ($posts_per_day &gt; $total_posts)
+{
+	$posts_per_day = $total_posts;
+}
+
+if ($topics_per_day &gt; $total_topics)
+{
+	$topics_per_day = $total_topics;
+}
+
+if ($users_per_day &gt; $total_users)
+{
+	$users_per_day = $total_users;
+}
+
+if ($files_per_day &gt; $total_files)
+{
+	$files_per_day = $total_files;
+}
+
+// Remove
+$dbsize = $_CLASS['core_user']-&gt;lang['NOT_AVAILABLE'];
+$s_action_options = build_select(array('online' =&gt; 'RESET_ONLINE', 'date' =&gt; 'RESET_DATE', 'stats' =&gt; 'RESYNC_STATS', 'user' =&gt; 'RESYNC_POSTCOUNTS'));
+
+$_CLASS['core_template']-&gt;assign_array(array(
+	'TOTAL_POSTS'		=&gt; $total_posts,
+	'POSTS_PER_DAY'		=&gt; $posts_per_day,
+	'TOTAL_TOPICS'		=&gt; $total_topics,
+	'TOPICS_PER_DAY'	=&gt; $topics_per_day,
+	'TOTAL_USERS'		=&gt; $total_users,
+	'USERS_PER_DAY'		=&gt; $users_per_day,
+	'TOTAL_FILES'		=&gt; $total_files,
+	'FILES_PER_DAY'		=&gt; $files_per_day,
+	'START_DATE'		=&gt; $start_date,
+	'AVATAR_DIR_SIZE'	=&gt; $avatar_dir_size,
+	'UPLOAD_DIR_SIZE'	=&gt; $upload_dir_size,
+
+	'U_ACTION'			=&gt; generate_link('forums', array('admin' =&gt; true)),
+	'U_ADMIN_LOG'		=&gt; generate_link('forums&amp;i=logs&amp;mode=admin', array('admin' =&gt; true)),
+
+	'S_ACTION_OPTIONS'	=&gt; $_CLASS['forums_auth']-&gt;acl_get('a_board') ? $s_action_options : '',
+));
+
+$log_data = array();
+$log_count = 0;
+
+if (!$_CLASS['forums_auth']-&gt;acl_get('a_viewlogs'))
+{
+	view_log('admin', $log_data, $log_count, 5);
+
+	foreach ($log_data as $row)
+	{
+		$_CLASS['core_template']-&gt;assign_vars_array('log', array(
+			'USERNAME'	=&gt; $row['username'],
+			'IP'		=&gt; $row['ip'],
+			'DATE'		=&gt; $_CLASS['core_user']-&gt;format_date($row['time']),
+			'ACTION'	=&gt; $row['action']
+		));
+	}
+}
+
+$_CLASS['core_display']-&gt;display($_CLASS['core_user']-&gt;lang['ADMIN_INDEX'], 'modules/forums/admin/acp_main.html');
+
 ?&gt;
\ No newline at end of file

Modified: cms/trunk/includes/forums/auth.php
===================================================================
--- cms/trunk/includes/forums/auth.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/auth.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -333,10 +333,10 @@
 		{
 			$userdata['user_permissions'] = $hold_str;
 
-			$sql = 'UPDATE ' . USERS_TABLE . &quot;
-				SET user_permissions = '&quot; . $_CLASS['core_db']-&gt;escape($userdata['user_permissions']) . &quot;',
-					user_perm_from = 0
-				WHERE user_id = &quot; . $userdata['user_id'];
+			$sql = 'UPDATE ' . CORE_USERS_TABLE . &quot;
+				SET user_permissions = '&quot; . $_CLASS['core_db']-&gt;escape($userdata['user_permissions']) . &quot;'
+				WHERE user_id = &quot; . $userdata['user_id'];//, user_perm_from = 0
+
 			$_CLASS['core_db']-&gt;query($sql);
 		}
 	}
@@ -495,17 +495,19 @@
 		}
 
 		// Sort by group_id since we want user setting to over right grp..  specific &gt; broad
-		$sql = 'SELECT ao.auth_option, a.user_id, a.group_id, a.forum_id, a.auth_setting
-					FROM ' . FORUMS_ACL_TABLE . ' a, ' . FORUMS_ACL_OPTIONS_TABLE . &quot; ao
-					WHERE a.auth_option_id = ao.auth_option_id 
+		$sql = 'SELECT ao.auth_option, a.auth_role_id, r.auth_setting as role_auth_setting, a.user_id, a.group_id, a.forum_id, a.auth_setting
+					FROM ' . FORUMS_ACL_OPTIONS_TABLE . ' ao, ' . FORUMS_ACL_TABLE . ' a
+					LEFT JOIN '.FORUMS_ACL_ROLES_DATA_TABLE.&quot; r ON a.auth_role_id = r.role_id
+					WHERE (ao.auth_option_id = a.auth_option_id OR ao.auth_option_id = r.auth_option_id)
 						$sql_user $sql_forum $sql_opts
-						ORDER BY a.group_id&quot;;
+						ORDER BY a.group_id, ao.auth_option&quot;;
 
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
-			if ($row['auth_setting'] != ACL_YES)
+			$auth_setting = ($row['auth_role_id']) ? $row['role_auth_setting'] : $row['auth_setting'];
+			if ($auth_setting != ACL_YES)
 			{
 				continue;
 			}
@@ -517,7 +519,23 @@
 				continue;
 			}
 
-			$hold_ary[$row['user_id']][$row['forum_id']][$row['auth_option']] = $row['auth_setting'];
+			$hold_ary[$row['user_id']][$row['forum_id']][$row['auth_option']] = $auth_setting;
+
+			/*	// Check for existence of ACL_YES if an option got set to ACL_NEVER
+				if ($setting == ACL_NEVER)
+				{
+					$flag = substr($row['auth_option'], 0, strpos($row['auth_option'], '_') + 1);
+
+					if (isset($hold_ary[$row['user_id']][$row['forum_id']][$flag]) &amp;&amp; $hold_ary[$row['user_id']][$row['forum_id']][$flag] == ACL_YES)
+					{
+						unset($hold_ary[$row['user_id']][$row['forum_id']][$flag]);
+
+						if (in_array(ACL_YES, $hold_ary[$row['user_id']][$row['forum_id']]))
+						{
+							$hold_ary[$row['user_id']][$row['forum_id']][$flag] = ACL_YES;
+						}
+					}
+				}*/
 		}
 		$_CLASS['core_db']-&gt;free_result($result);
 
@@ -525,7 +543,9 @@
 		{
 			if (empty($group_members))
 			{
-				$sql = 'SELECT user_group, user_id FROM ' . CORE_USERS_TABLE .' WHERE user_group IN ('.implode(', ', array_keys($group_id_array)).') AND user_status = '.STATUS_ACTIVE;
+				$sql = 'SELECT user_group, user_id FROM ' . CORE_USERS_TABLE .' 
+					WHERE user_group IN ('.implode(', ', array_keys($group_id_array)).')
+					AND user_status = '.STATUS_ACTIVE.&quot; $sql_user &quot;;
 				$result = $_CLASS['core_db']-&gt;query($sql);
 	
 				while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -546,7 +566,26 @@
 				{
 					foreach($rows as $row)
 					{
-						$hold_ary[$user_id][$row['forum_id']][$row['auth_option']] = $row['auth_setting'];
+						if (!isset($hold_ary[$user_id][$row['forum_id']][$row['auth_option']]) || (isset($hold_ary[$row['user_id']][$row['forum_id']][$row['auth_option']]) &amp;&amp; $hold_ary[$row['user_id']][$row['forum_id']][$row['auth_option']] != ACL_NEVER))
+						{
+							$hold_ary[$user_id][$row['forum_id']][$row['auth_option']] = ($row['auth_role_id']) ? $row['role_auth_setting'] : $row['auth_setting'];
+						}
+						/*	
+						// Check for existence of ACL_YES if an option got set to ACL_NEVER
+						if ($setting == ACL_NEVER)
+						{
+							$flag = substr($row['auth_option'], 0, strpos($row['auth_option'], '_') + 1);
+		
+							if (isset($hold_ary[$row['user_id']][$row['forum_id']][$flag]) &amp;&amp; $hold_ary[$row['user_id']][$row['forum_id']][$flag] == ACL_YES)
+							{
+								unset($hold_ary[$row['user_id']][$row['forum_id']][$flag]);
+		
+								if (in_array(ACL_YES, $hold_ary[$row['user_id']][$row['forum_id']]))
+								{
+									$hold_ary[$row['user_id']][$row['forum_id']][$flag] = ACL_YES;
+								}
+							}
+						}*/	
 					}
 				}
 			}

Modified: cms/trunk/includes/forums/functions.php
===================================================================
--- cms/trunk/includes/forums/functions.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/functions.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -1495,7 +1495,7 @@
 	switch ($mode)
 	{
 		case 'email':
-			return '[a-z0-9&amp;\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*?[a-z]+';
+			return '[a-z0-9&amp;\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*[a-z]+';
 		break;
 	}
 

Modified: cms/trunk/includes/forums/functions_display.php
===================================================================
--- cms/trunk/includes/forums/functions_display.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/functions_display.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -87,8 +87,6 @@
 			continue;
 		}
 
-
-
 		if ($row['forum_type'] == FORUM_CAT &amp;&amp; ($row['left_id'] + 1 == $row['right_id']))
 		{
 			// Non-postable forum with no subforums: don't display
@@ -554,7 +552,7 @@
 			}
 			
 			$data['lang_size'] = ($attachment['filesize'] &gt;= 1048576) ? round((round($attachment['filesize'] / 1048576 * 100) / 100), 2) .$_CLASS['core_user']-&gt;lang['MB'] : (($attachment['filesize'] &gt;= 1024) ? round((round($attachment['filesize'] / 1024 * 100) / 100), 2)  . $_CLASS['core_user']-&gt;lang['KB']: $attachment['filesize'] . $_CLASS['core_user']-&gt;lang['BYTES']);
-			$data['lang_views'] = (!$attachment['download_count']) ? $_CLASS['core_user']-&gt;lang['DOWNLOAD_NONE'] : (($attachment['download_count'] == 1) ? sprintf($_CLASS['core_user']-&gt;lang['DOWNLOAD_COUNT'], $attachment['download_count']) : sprintf($_CLASS['core_user']-&gt;lang['DOWNLOAD_COUNTS'], $attachment['download_count']));
+			$data['lang_views'] = (empty($attachment['download_count']) || !$attachment['download_count']) ? $_CLASS['core_user']-&gt;lang['DOWNLOAD_NONE'] : (($attachment['download_count'] == 1) ? sprintf($_CLASS['core_user']-&gt;lang['DOWNLOAD_COUNT'], $attachment['download_count']) : sprintf($_CLASS['core_user']-&gt;lang['DOWNLOAD_COUNTS'], $attachment['download_count']));
 	
 			$data['icon'] = (isset($extensions[$attachment['extension']]['upload_icon']) &amp;&amp; $extensions[$attachment['extension']]['upload_icon']) ? $config['upload_icons_path'] . '/' . trim($extensions[$attachment['extension']]['upload_icon']) : false;
 			$data['name'] = basename($attachment['real_filename']);

Modified: cms/trunk/includes/forums/functions_posting.php
===================================================================
--- cms/trunk/includes/forums/functions_posting.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/functions_posting.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -188,7 +188,7 @@
 	$filedata = array();
 	$filedata['error'] = array();
 
-	include_once(SITE_FILE_ROOT. 'includes/forums/functions_upload.php');
+	require_once SITE_FILE_ROOT. 'includes/forums/functions_upload.php';
 	$upload = new fileupload();
 	
 	if (!$local)
@@ -776,6 +776,9 @@
 {
 	global $_CLASS, $bbcode, $config;
 
+	$rowset = array();
+	$bbcode_bitfield = '';
+
 	// Go ahead and pull all data for this topic
 	$sql = 'SELECT u.username, u.user_id, p.post_id, p.post_username, p.post_subject, p.post_text, p.enable_smilies, p.bbcode_uid, p.bbcode_bitfield, p.post_time
 		FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . &quot; u
@@ -786,26 +789,23 @@
 		ORDER BY p.post_time DESC';
 	$result = $_CLASS['core_db']-&gt;query_limit($sql, $config['posts_per_page']);
 
-	if (!$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
-		$_CLASS['core_db']-&gt;free_result($result);
-		return false;
+		$rowset[] = $row;
+		$bbcode_bitfield = $bbcode_bitfield | base64_decode($row['bbcode_bitfield']);
 	}
+	$_CLASS['core_db']-&gt;free_result($result);
 
-	$bbcode_bitfield = '';
-	do
+	if (empty($rowset))
 	{
-		$rowset[] = $row;
-		 $bbcode_bitfield = $bbcode_bitfield | base64_decode($row['bbcode_bitfield']);
+		return false;
 	}
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result));
-	$_CLASS['core_db']-&gt;free_result($result);
 
 	// Instantiate BBCode class
-	if (!isset($bbcode) &amp;&amp; $bbcode_bitfield)
+	if (!isset($bbcode) &amp;&amp; $bbcode_bitfield !== '')
 	{
 		require_once SITE_FILE_ROOT.'includes/forums/bbcode.php';
-		$bbcode = new bbcode($bbcode_bitfield);
+		$bbcode = new bbcode(base64_encode($bbcode_bitfield));
 	}
 
 	foreach ($rowset as $i =&gt; $row)
@@ -985,7 +985,7 @@
 
 	$email_sig = str_replace('&lt;br /&gt;', &quot;\n&quot;, &quot;-- \n&quot; . $config['board_email_sig']);
 
-	require_once(SITE_FILE_ROOT.'includes/mailer.php');
+	require_once SITE_FILE_ROOT.'includes/mailer.php';
 
 	foreach ($processed as $template =&gt; $user_list)
 	{
@@ -1375,8 +1375,8 @@
 					'poll_start'		=&gt; ($poll['poll_start']) ? $poll['poll_start'] : $current_time,
 					'poll_max_options'	=&gt; $poll['poll_max_options'],
 					'poll_length'		=&gt; ($poll['poll_length'] * 86400),
-					'poll_vote_change'	=&gt; $poll['poll_vote_change'])
-				);
+					'poll_vote_change'	=&gt; $poll['poll_vote_change']
+				));
 			}
 
 			$sql_data[CORE_USERS_TABLE]['stat'][] = &quot;user_last_post_time = $current_time&quot; . (($_CLASS['forums_auth']-&gt;acl_get('f_postcount', $data['forum_id'])) ? ', user_posts = user_posts + 1' : '');
@@ -1561,7 +1561,8 @@
 					$sql_insert_ary[] = array(
 						'poll_option_id'	=&gt; (int) $i,
 						'topic_id'			=&gt; (int) $data['topic_id'],
-						'poll_option_text'	=&gt; (string) $poll['poll_options'][$i]
+						'poll_option_text'	=&gt; (string) $poll['poll_options'][$i],
+						'poll_option_total' =&gt; 0
 					);
 				}
 				else if ($poll['poll_options'][$i] != $cur_poll_options[$i])
@@ -1602,7 +1603,7 @@
 			{
 				// update entry in db if attachment already stored in db and filespace
 				$sql = 'UPDATE ' . FORUMS_ATTACHMENTS_TABLE . &quot;
-					SET attach_comment = '&quot; . $_CLASS['core_db']-&gt;escape($attach_row['attach_comment']) . &quot;'
+					SET comment = '&quot; . $_CLASS['core_db']-&gt;escape($attach_row['comment']) . &quot;'
 					WHERE attach_id = &quot; . (int) $attach_row['attach_id'];
 				$_CLASS['core_db']-&gt;query($sql);
 				
@@ -1617,14 +1618,14 @@
 				}
 
 				$attach_sql_array[] = array(
-					'post_msg_id'		=&gt; $data['post_id'],
-					'topic_id'			=&gt; $data['topic_id'],
+					'post_msg_id'		=&gt; (int) $data['post_id'],
+					'topic_id'			=&gt; (int) $data['topic_id'],
 					'in_message'		=&gt; 0,
-					'poster_id'			=&gt; $poster_id,
+					'poster_id'			=&gt; (int) $poster_id,
 					'physical_filename'	=&gt; basename($attach_row['physical_filename']),
 					'real_filename'		=&gt; basename($attach_row['real_filename']),
 					'download_count'	=&gt; 0,
-					'attach_comment'	=&gt; $attach_row['attach_comment'],
+					'comment'			=&gt; $attach_row['comment'],
 					'extension'			=&gt; $attach_row['extension'],
 					'mimetype'			=&gt; $attach_row['mimetype'],
 					'filesize'			=&gt; $attach_row['filesize'],
@@ -1637,12 +1638,12 @@
 			}
 		}
 
-		if (count($attach_sql_array))
+		if (!empty($attach_sql_array))
 		{
-			$_CLASS['core_db']-&gt;sql_query_build('MULTI_INSERT', $attach_sql_array, FORUMS_TOPICS_TABLE);
+			$_CLASS['core_db']-&gt;sql_query_build('MULTI_INSERT', $attach_sql_array, FORUMS_ATTACHMENTS_TABLE);
 			unset($attach_sql_array);
 		}
-	
+
 		if ($files_updated || $files_added)
 		{
 			$sql = 'UPDATE ' . FORUMS_POSTS_TABLE . '

Modified: cms/trunk/includes/forums/functions_upload.php
===================================================================
--- cms/trunk/includes/forums/functions_upload.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/functions_upload.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -1,663 +1,795 @@
-&lt;?php
-/** 
-*
-* @package phpBB3
-* @version $Id: functions_upload.php,v 1.5 2005/05/10 17:00:41 acydburn Exp $ 
-* @copyright (c) 2005 phpBB Group 
-* @license <A HREF="http://opensource.org/licenses/gpl-license.php">http://opensource.org/licenses/gpl-license.php</A> GNU Public License 
-*
-*/
-
-/**
-* @package phpBB3
-* Responsible for holding all file relevant informations, as well as doing file-specific operations.
-* The {@link fileupload fileupload class} can be used to upload several files, each of them being this object to operate further on.
-*/
-class filespec
-{
-	var $filename = '';
-	var $realname = '';
-	var $uploadname = '';
-	var $mimetype = '';
-	var $extension = '';
-	var $filesize = 0;
-	var $width = 0;
-	var $height = 0;
-
-	var $destination_file = '';
-	var $destination_path = '';
-
-	var $file_moved = false;
-	var $init_error = false;
-	var $local = false;
-
-	var $error = array();
-
-	var $upload = '';
-
-	/**
-	* File Class
-	*
-	* @access private
-	*
-	*/
-	function filespec($upload_ary, $upload_namespace)
-	{
-		if (!isset($upload_ary))
-		{
-			$this-&gt;init_error = true;
-			return;
-		}
-
-		$this-&gt;filename = $upload_ary['tmp_name'];
-		$this-&gt;filesize = $upload_ary['size'];
-		$this-&gt;realname = $this-&gt;uploadname = trim(htmlspecialchars(basename($upload_ary['name'])));
-		$this-&gt;mimetype = $upload_ary['type'];
-
-		// Opera adds the name to the mime type
-		$this-&gt;mimetype	= (strpos($this-&gt;mimetype, '; name') !== false) ? str_replace(strstr($this-&gt;mimetype, '; name'), '', $this-&gt;mimetype) : $this-&gt;mimetype;
-
-		if (!$this-&gt;mimetype)
-		{
-			$this-&gt;mimetype = 'application/octetstream';
-		}
-		
-		$this-&gt;extension = explode('.', strtolower($this-&gt;realname));
-		$this-&gt;extension = array_pop($this-&gt;extension);
-
-		// Try to get real filesize from temporary folder (not always working) ;)
-		$this-&gt;filesize = (@filesize($this-&gt;filename)) ? @filesize($this-&gt;filename) : $this-&gt;filesize;
-
-		$this-&gt;width = $this-&gt;height = 0;
-		$this-&gt;file_moved = false;
-
-		$this-&gt;local = (isset($upload_ary['local_mode'])) ? true : false;
-		$this-&gt;upload = $upload_namespace;
-	}
-
-	/**
-	* Cleans destination filename
-	* 
-	* @access public
-	* @param real|unique $mode real creates a realname, filtering some characters, lowering every character. Unique creates an unique filename
-	* @param string $prefix Prefix applied to filename
-	*/
-	function clean_filename($mode = 'unique', $prefix = '')
-	{
-		if ($this-&gt;init_error)
-		{
-			return;
-		}
-		
-		switch ($mode)
-		{
-			case 'real':
-				// Replace any chars which may cause us problems with _
-				$bad_chars = array(&quot;'&quot;, &quot;\\&quot;, ' ', '/', ':', '*', '?', '&quot;', '&lt;', '&gt;', '|');
-
-				$this-&gt;realname = rawurlencode(str_replace($bad_chars, '_', strtolower($this-&gt;realname)));
-				$this-&gt;realname = preg_replace(&quot;/%(\w{2})/&quot;, '_', $this-&gt;realname);
-
-				$this-&gt;realname = $prefix . $this-&gt;realname . '_.' . $this-&gt;extension;
-				break;
-
-			case 'unique':
-			default:
-				$this-&gt;realname = $prefix . md5(uniqid(mt_rand(), true)) . '.' . $this-&gt;extension;
-			break;
-		}
-	}
-
-	function get($property)
-	{
-		if ($this-&gt;init_error)
-		{
-			return;
-		}
-		
-		if (!isset($this-&gt;$property))
-		{
-			return false;
-		}
-		
-		return $this-&gt;$property;
-	}
-
-	function is_image()
-	{
-		return (strpos($this-&gt;mimetype, 'image/') !== false) ? true : false;
-	}
-
-	function is_uploaded()
-	{
-		if (!$this-&gt;local &amp;&amp; !is_uploaded_file($this-&gt;filename))
-		{
-			return false;
-		}
-
-		return (file_exists($this-&gt;filename)) ? true : false;
-	}
-
-	function remove()
-	{
-		if ($this-&gt;file_moved)
-		{
-			@unlink($this-&gt;destination_file);
-		}
-	}
-
-	/**
-	* Move file to destination folder
-	* 
-	* The phpbb_root_path variable will be applied to the destination path
-	*
-	* @access public
-	* @param string $destination_path Destination path, for example $config['avatar_path']
-	* @param octal $chmod Permission mask for chmodding the file after a successful move
-	*/
-	function move_file($destination, $chmod = 0666)
-	{
-		global $_CLASS;
-
-		if (sizeof($this-&gt;error))
-		{
-			return false;
-		}
-
-		// Adjust destination path (no trailing slash)
-		if ($destination{(sizeof($destination)-1)} == '/' || $destination{(sizeof($destination)-1)} == '\\')
-		{
-			$destination = substr($destination, 0, sizeof($destination)-2);
-		}
-		
-		$destination = str_replace(array('../', '..\\', './', '.\\'), '', $destination);
-		if ($destination &amp;&amp; ($destination{0} == '/' || $destination{0} == &quot;\\&quot;))
-		{
-			$destination = '';
-		}
-
-		$this-&gt;destination_path = $destination;
-
-		$upload_mode = (@ini_get('open_basedir') || @ini_get('safe_mode')) ? 'move' : 'copy';
-		$upload_mode = ($this-&gt;local) ? 'local' : $upload_mode;
-		$this-&gt;destination_file = $this-&gt;destination_path . '/' . basename($this-&gt;realname);
-
-		switch ($upload_mode)
-		{
-			case 'copy':
-				if (!@copy($this-&gt;filename, $this-&gt;destination_file)) 
-				{
-					if (!@move_uploaded_file($this-&gt;filename, $this-&gt;destination_file)) 
-					{
-						$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'GENERAL_UPLOAD_ERROR'], $this-&gt;destination_file);
-						return false;
-					}
-				}
-				else
-				{
-					@unlink($this-&gt;filename);
-				}
-				break;
-
-			case 'move':
-				if (!@move_uploaded_file($this-&gt;filename, $this-&gt;destination_file)) 
-				{ 
-					if (!@copy($this-&gt;filename, $this-&gt;destination_file)) 
-					{
-						$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'GENERAL_UPLOAD_ERROR'], $this-&gt;destination_file);
-						return false;
-					}
-					else
-					{
-						@unlink($this-&gt;filename);
-					}
-				} 
-				break;
-
-			case 'local':
-				if (!@copy($this-&gt;filename, $this-&gt;destination_file)) 
-				{
-					$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'GENERAL_UPLOAD_ERROR'], $this-&gt;destination_file);
-					return false;
-				}
-				@unlink($this-&gt;filename);
-				break;
-		}
-
-		@chmod($this-&gt;destination_file, $chmod);
-		
-		// Try to get real filesize from destination folder
-		$this-&gt;filesize = (@filesize($this-&gt;destination_file)) ? @filesize($this-&gt;destination_file) : $this-&gt;filesize;
-
-		if ($this-&gt;is_image())
-		{
-			list($this-&gt;width, $this-&gt;height) = @getimagesize($this-&gt;destination_file);
-		}
-
-		$this-&gt;file_moved = true;
-		$this-&gt;additional_checks();
-		unset($this-&gt;upload);
-	}
-
-	function additional_checks()
-	{
-		global $_CLASS;
-
-		if (!$this-&gt;file_moved)
-		{
-			return false;
-		}
-		
-		// Filesize is too big or it's 0 if it was larger than the maxsize in the upload form
-		if ($this-&gt;upload-&gt;max_filesize &amp;&amp; ($this-&gt;get('filesize') &gt; $this-&gt;upload-&gt;max_filesize || $this-&gt;filesize == 0))
-		{
-			$size_lang = ($this-&gt;upload-&gt;max_filesize &gt;= 1048576) ? $_CLASS['core_user']-&gt;lang['MB'] : (($this-&gt;upload-&gt;max_filesize &gt;= 1024) ? $_CLASS['core_user']-&gt;lang['KB'] : $_CLASS['core_user']-&gt;lang['BYTES'] );
-			$max_filesize = ($this-&gt;upload-&gt;max_filesize &gt;= 1048576) ? round($this-&gt;upload-&gt;max_filesize / 1048576 * 100) / 100 : (($this-&gt;upload-&gt;max_filesize &gt;= 1024) ? round($this-&gt;upload-&gt;max_filesize / 1024 * 100) / 100 : $this-&gt;upload-&gt;max_filesize);
-			
-			$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'WRONG_FILESIZE'], $max_filesize, $size_lang);
-			return;
-		}
-
-		if (!$this-&gt;upload-&gt;valid_dimensions($this))
-		{
-			$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'WRONG_SIZE'], $this-&gt;min_width, $this-&gt;min_height, $this-&gt;max_width, $this-&gt;max_height);
-		}
-	}
-}
-
-/**
-* @package phpBB3
-* Class for assigning error messages before a real filespec class can be assigned
-*/
-class fileerror extends filespec
-{
-	function fileerror($error_msg)
-	{
-		$this-&gt;error[] = $error_msg;
-	}
-}
-
-/**
-* @package phpBB3
-* File upload class
-*
-* Init class (all parameters optional and able to be set/overwritten seperatly) - scope is global and valid for all uploads
-*/
-class fileupload
-{
-	var $allowed_extensions = array();
-	var $max_filesize = 0;
-	var $min_width = 0;
-	var $min_height = 0;
-	var $max_width = 0;
-	var $max_height = 0;
-	var $error_prefix = '';
-
-	/**
-	*
-	* @param string $error_prefix Used error messages will get prefixed by this string
-	* @param array $allowed_extensions Array of allowed extensions, for example array('jpg', 'jpeg', 'gif', 'png')
-	* @param int $max_filesize Maximum filesize
-	* @param int $min_width Minimum image width (only checked for images)
-	* @param int $min_height Minimum image height (only checked for images)
-	* @param int $max_width Maximum image width (only checked for images)
-	* @param int $max_height Maximum image height (only checked for images)
-	*
-	*/
-	function fileupload($error_prefix = '', $allowed_extensions = false, $max_filesize = false, $min_width = false, $min_height = false, $max_width = false, $max_height = false)
-	{
-		$this-&gt;set_allowed_extensions($allowed_extensions);
-		$this-&gt;set_max_filesize($max_filesize);
-		$this-&gt;set_allowed_dimensions($min_width, $min_height, $max_width, $max_height);
-		$this-&gt;set_error_prefix($error_prefix);
-	}
-
-	// Reset vars
-	function reset_vars()
-	{
-		$this-&gt;max_filesize = 0;
-		$this-&gt;min_width = $this-&gt;min_height = $this-&gt;max_width = $this-&gt;max_height = 0;
-		$this-&gt;error_prefix = '';
-		$this-&gt;allowed_extensions = array();
-	}
-
-	// Set allowed extensions
-	function set_allowed_extensions($allowed_extensions)
-	{
-		if ($allowed_extensions !== false &amp;&amp; is_array($allowed_extensions))
-		{
-			$this-&gt;allowed_extensions = $allowed_extensions;
-		}
-	}
-
-	// Set allowed dimensions
-	function set_allowed_dimensions($min_width, $min_height, $max_width, $max_height)
-	{
-		$this-&gt;min_width = (int) $min_width;
-		$this-&gt;min_height = (int) $min_height;
-		$this-&gt;max_width = (int) $max_width;
-		$this-&gt;max_height = (int) $max_height;
-	}
-
-	// Set maximum allowed filesize
-	function set_max_filesize($max_filesize)
-	{
-		if ($max_filesize !== false &amp;&amp; (int) $max_filesize)
-		{
-			$this-&gt;max_filesize = (int) $max_filesize;
-		}
-	}
-
-	// Set error prefix
-	function set_error_prefix($error_prefix)
-	{
-		$this-&gt;error_prefix = $error_prefix;
-	}
-
-	/**
-	* Form upload method
-	*
-	* Upload file from users harddisk
-	*
-	* @access public
-	* @param string $form_name Form name assigned to the file input field (if it is an array, the key has to be specified)
-	* @return object $file Object &quot;filespec&quot; is returned, all further operations can be done with this object
-	*/
-	function form_upload($form_name)
-	{
-		global $_CLASS;
-
-		unset($_FILES[$form_name]['local_mode']);
-		$file = new filespec($_FILES[$form_name], $this);
-
-		if ($file-&gt;init_error)
-		{
-			$file-&gt;error[] = '';
-			return $file;
-		}
-			
-		// Error array filled?
-		if (isset($_FILES[$form_name]['error']))
-		{
-			$error = $this-&gt;assign_internal_error($_FILES[$form_name]['error']);
-
-			if ($error !== false)
-			{
-				$file-&gt;error[] = $error;
-				return $file;
-			}
-		}
-
-		// Check if empty file got uploaded (not catched by is_uploaded_file)
-		if (isset($_FILES[$form_name]['size']) &amp;&amp; $_FILES[$form_name]['size'] == 0)
-		{
-			$file-&gt;error[] = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'EMPTY_FILEUPLOAD'];
-			return $file;
-		}
-
-		// PHP Upload filesize exceeded
-		if ($file-&gt;get('filename') == 'none')
-		{
-			$file-&gt;error[] = (@ini_get('upload_max_filesize') == '') ? $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_NA'] : sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_OVERRUN'], @ini_get('upload_max_filesize'));
-			return $file;
-		}
-
-		// Not correctly uploaded
-		if (!$file-&gt;is_uploaded())
-		{
-			$file-&gt;error[] = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED'];
-			return $file;
-		}
-
-		$this-&gt;common_checks($file);
-
-		return $file;
-	}
-
-	// Move file from another location to phpBB
-	function local_upload($source_file, $filedata = false)
-	{
-		global $_CLASS;
-
-		$form_name = 'local';
-
-		$_FILES[$form_name]['local_mode'] = true;
-		$_FILES[$form_name]['tmp_name'] = $source_file;
-
-		if ($filedata === false)
-		{
-			$_FILES[$form_name]['name'] = basename($source_file);
-			$_FILES[$form_name]['size'] = 0;
-			$_FILES[$form_name]['type'] = '';
-		}
-		else
-		{
-			$_FILES[$form_name]['name'] = $filedata['realname'];
-			$_FILES[$form_name]['size'] = $filedata['size'];
-			$_FILES[$form_name]['type'] = $filedata['type'];
-		}		
-
-		$file = new filespec($_FILES[$form_name], $this);
-
-		if ($file-&gt;init_error)
-		{
-			$file-&gt;error[] = '';
-			return $file;
-		}
-			
-		if (isset($_FILES[$form_name]['error']))
-		{
-			$error = $this-&gt;assign_internal_error($_FILES[$form_name]['error']);
-
-			if ($error !== false)
-			{
-				$file-&gt;error[] = $error;
-				return $file;
-			}
-		}
-
-		// PHP Upload filesize exceeded
-		if ($file-&gt;get('filename') == 'none')
-		{
-			$file-&gt;error[] = (@ini_get('upload_max_filesize') == '') ? $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_NA'] : sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_OVERRUN'], @ini_get('upload_max_filesize'));
-			return $file;
-		}
-
-		// Not correctly uploaded
-		if (!$file-&gt;is_uploaded())
-		{
-			$file-&gt;error[] = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED'];
-			return $file;
-		}
-
-		$this-&gt;common_checks($file);
-
-		return $file;
-	}
-
-	/**
-	* Remote upload method
-	*
-	* Uploads file from given url
-	*
-	* @access public
-	* @param string $upload_url URL pointing to file to upload, for example <A HREF="http://www.foobar.com/example.gif">http://www.foobar.com/example.gif</A>
-	* @return object $file Object &quot;filespec&quot; is returned, all further operations can be done with this object
-	*/
-	function remote_upload($upload_url)
-	{
-		global $_CLASS;
-		
-		$upload_ary = array();
-		$upload_ary['local_mode'] = true;
-
-		if (!preg_match('#^(<A HREF="http://">http://</A>).*?\.(' . implode('|', $this-&gt;allowed_extensions) . ')$#i', $upload_url, $match))
-		{
-			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'URL_INVALID']);
-			return $file;
-		}
- 
-		if (empty($match[2]))
-		{
-			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'URL_INVALID']);
-			return $file;
-		}
-
-		$url = parse_url($upload_url);
-
-		$host = $url['host'];
-		$path = dirname($url['path']);
-		$port = (!empty($url['port'])) ? (int) $url['port'] : 80;
-			
-		$upload_ary['type'] = 'application/octet-stream';
-		$upload_ary['name'] = basename($url['path']) . '.' . array_pop(explode('.', $url['path']));
-		$filename = $url['path'];
-		$filesize = 0;
-
-		if (!($fsock = @fsockopen($host, $port, $errno, $errstr)))
-		{
-			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED']);
-			return $file;
-		}
-
-		fputs($fsock, 'GET /' . $filename . &quot; HTTP/1.1\r\n&quot;);
-		fputs($fsock, &quot;HOST: &quot; . $host . &quot;\r\n&quot;);
-		fputs($fsock, &quot;Connection: close\r\n\r\n&quot;);
-
-		$get_info = false;
-		$data = '';
-		while (!@feof($fsock))
-		{
-			if ($get_info)
-			{
-				$data .= @fread($fsock, 1024);
-			}
-			else
-			{
-				$line = @fgets($fsock, 1024);
-
-				if ($line == &quot;\r\n&quot;)
-				{
-					$get_info = true;
-				}
-				else
-				{
-					if (strpos($line, 'Content-Type: ') !== false)
-					{
-						$upload_ary['type'] = rtrim(str_replace('Content-Type: ', '', $line));
-					}
-				}
-			}
-		}
-		@fclose($fsock);
-
-		if (empty($data))
-		{
-			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'EMPTY_REMOTE_DATA']);
-			return $file;
-		}
-		unset($url_ary);
-
-		$tmp_path = (!@ini_get('safe_mode')) ? false : 'cache';
-		$filename = tempnam($tmp_path, uniqid(rand()) . '-');
-
-		if (!($fp = @fopen($filename, 'wb')))
-		{
-			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED']);
-			return $file;
-		}
-		$upload_ary['size'] = fwrite($fp, $data);
-		fclose($fp);
-		unset($data);
-
-		$upload_ary['tmp_name'] = $filename;
-
-		$file = new filespec($upload_ary, $this);
-		$this-&gt;common_checks($file);
-
-		return $file;
-	}
-
-	// Private::assign_internal_error
-	function assign_internal_error($errorcode)
-	{
-		global $_CLASS;
-
-		switch ($errorcode)
-		{
-			case 1:
-				$error = (@ini_get('upload_max_filesize') == '') ? $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_NA'] : sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_OVERRUN'], @ini_get('upload_max_filesize'));
-				break;
-			case 2:
-				$error = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'WRONG_FILESIZE'], $this-&gt;max_filesize);
-				break;			
-			case 3:
-				$error = 'The uploaded file was only partially uploaded';
-				break;
-			case 4:
-				$error = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED'];
-				break;
-			case 6:
-				$error = 'Temporary folder could not be found. Please check your PHP installation.';
-				break;
-			default:
-				$error = false;
-		}
-
-		return $error;
-	}
-	
-	// Private::common_checks
-	function common_checks(&amp;$file)
-	{
-		global $_CLASS;
-
-		// Filesize is too big or it's 0 if it was larger than the maxsize in the upload form
-		if ($this-&gt;max_filesize &amp;&amp; ($file-&gt;get('filesize') &gt; $this-&gt;max_filesize || $file-&gt;get('filesize') == 0))
-		{
-			$file-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'WRONG_FILESIZE'], $this-&gt;max_filesize);
-		}
-
-		// check Filename
-		if (preg_match(&quot;#[\\/:*?\&quot;&lt;&gt;|]#i&quot;, $file-&gt;get('realname')))
-		{ 
-			$file-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'INVALID_FILENAME'], $file-&gt;get('realname'));
-		}
-
-		// Invalid Extension
-		if (!$this-&gt;valid_extension($file))
-		{
-			$file-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'DISALLOWED_EXTENSION'], $file-&gt;get('extension'));
-		}
-	}
-
-	function valid_extension(&amp;$file)
-	{
-		return in_array($file-&gt;get('extension'), $this-&gt;allowed_extensions);
-	}
-
-	function valid_dimensions(&amp;$file)
-	{
-		if (!$this-&gt;max_width &amp;&amp; !$this-&gt;max_height &amp;&amp; !$this-&gt;min_width &amp;&amp; !$this-&gt;min_height)
-		{
-			return true;
-		}
-		
-		if (($file-&gt;get('width') &gt; $this-&gt;max_width &amp;&amp; $this-&gt;max_width) || 
-			($file-&gt;get('height') &gt; $this-&gt;max_height &amp;&amp; $this-&gt;max_height) || 
-			($file-&gt;get('width') &lt; $this-&gt;min_width &amp;&amp; $this-&gt;min_width) ||
-			($file-&gt;get('height') &lt; $this-&gt;min_height &amp;&amp; $this-&gt;min_height))
-		{
-			return false;
-		}
-
-		return true;
-	}
-
-	function is_valid($form_name)
-	{
-		return (isset($_FILES[$form_name]) &amp;&amp; $_FILES[$form_name]['name'] != 'none') ? true : false;
-	}
-}
-
+&lt;?php
+/** 
+*
+* @package phpBB3
+* @version $Id: functions_upload.php,v 1.17 2006/06/13 21:06:27 acydburn Exp $ 
+* @copyright (c) 2005 phpBB Group 
+* @license <A HREF="http://opensource.org/licenses/gpl-license.php">http://opensource.org/licenses/gpl-license.php</A> GNU Public License 
+*
+*/
+
+/**
+* Responsible for holding all file relevant informations, as well as doing file-specific operations.
+* The {@link fileupload fileupload class} can be used to upload several files, each of them being this object to operate further on.
+* @package phpBB3
+*/
+class filespec
+{
+	var $filename = '';
+	var $realname = '';
+	var $uploadname = '';
+	var $mimetype = '';
+	var $extension = '';
+	var $filesize = 0;
+	var $width = 0;
+	var $height = 0;
+	var $image_info = array();
+
+	var $destination_file = '';
+	var $destination_path = '';
+
+	var $file_moved = false;
+	var $init_error = false;
+	var $local = false;
+
+	var $error = array();
+
+	var $upload = '';
+
+	/**
+	* File Class
+	* @access: private
+	*/
+	function filespec($upload_ary, $upload_namespace)
+	{
+		if (!isset($upload_ary))
+		{
+			$this-&gt;init_error = true;
+			return;
+		}
+
+		$this-&gt;filename = $upload_ary['tmp_name'];
+		$this-&gt;filesize = $upload_ary['size'];
+		$this-&gt;realname = $this-&gt;uploadname = trim(htmlspecialchars(basename($upload_ary['name'])));
+		$this-&gt;mimetype = $upload_ary['type'];
+
+		// Opera adds the name to the mime type
+		$this-&gt;mimetype	= (strpos($this-&gt;mimetype, '; name') !== false) ? str_replace(strstr($this-&gt;mimetype, '; name'), '', $this-&gt;mimetype) : $this-&gt;mimetype;
+
+		if (!$this-&gt;mimetype)
+		{
+			$this-&gt;mimetype = 'application/octetstream';
+		}
+
+		$this-&gt;extension = strtolower($this-&gt;get_extension($this-&gt;realname));
+
+		// Try to get real filesize from temporary folder (not always working) ;)
+		$this-&gt;filesize = (@filesize($this-&gt;filename)) ? @filesize($this-&gt;filename) : $this-&gt;filesize;
+
+		$this-&gt;width = $this-&gt;height = 0;
+		$this-&gt;file_moved = false;
+
+		$this-&gt;local = (isset($upload_ary['local_mode'])) ? true : false;
+		$this-&gt;upload = $upload_namespace;
+	}
+
+	/**
+	* Cleans destination filename
+	* 
+	* @param real|unique $mode real creates a realname, filtering some characters, lowering every character. Unique creates an unique filename
+	* @param string $prefix Prefix applied to filename
+	* @access public
+	*/
+	function clean_filename($mode = 'unique', $prefix = '')
+	{
+		if ($this-&gt;init_error)
+		{
+			return;
+		}
+
+		switch ($mode)
+		{
+			case 'real':
+				// Remove every extension from filename (to not let the mime bug being exposed)
+				if (strpos($this-&gt;realname, '.') !== false)
+				{
+					$this-&gt;realname = substr($this-&gt;realname, 0, strpos($this-&gt;realname, '.'));
+				}
+
+				// Replace any chars which may cause us problems with _
+				$bad_chars = array(&quot;'&quot;, &quot;\\&quot;, ' ', '/', ':', '*', '?', '&quot;', '&lt;', '&gt;', '|');
+
+				$this-&gt;realname = rawurlencode(str_replace($bad_chars, '_', strtolower($this-&gt;realname)));
+				$this-&gt;realname = preg_replace(&quot;/%(\w{2})/&quot;, '_', $this-&gt;realname);
+
+				$this-&gt;realname = $prefix . $this-&gt;realname . '.' . $this-&gt;extension;
+			break;
+
+			case 'unique':
+			default:
+				$this-&gt;realname = $prefix . md5(uniqid(mt_rand(), true)) . '.' . $this-&gt;extension;
+			break;
+		}
+	}
+
+	/**
+	* Get property from file object
+	*/
+	function get($property)
+	{
+		if ($this-&gt;init_error || !isset($this-&gt;$property))
+		{
+			return false;
+		}
+
+		return $this-&gt;$property;
+	}
+
+	/**
+	* Check if file is an image (mimetype)
+	*
+	* @return true if it is an image, false if not
+	*/
+	function is_image()
+	{
+		return (strpos($this-&gt;mimetype, 'image/') !== false) ? true : false;
+	}
+
+	/**
+	* Check if the file got correctly uploaded
+	*
+	* @return true if it is a valid upload and the file exist, false if not
+	*/
+	function is_uploaded()
+	{
+		if (!$this-&gt;local &amp;&amp; !is_uploaded_file($this-&gt;filename))
+		{
+			return false;
+		}
+
+		return (file_exists($this-&gt;filename)) ? true : false;
+	}
+
+	/**
+	* Remove file
+	*/
+	function remove()
+	{
+		if ($this-&gt;file_moved)
+		{
+			@unlink($this-&gt;destination_file);
+		}
+	}
+
+	/**
+	* Get file extension
+	*/
+	function get_extension($filename)
+	{
+		if (strpos($filename, '.') === false)
+		{
+			return '';
+		}
+
+		$filename = explode('.', $filename);
+		return array_pop($filename);
+	}
+
+	/**
+	* Get mimetype. Utilize mime_content_type if the function exist.
+	*/
+	function get_mimetype($filename)
+	{
+		$mimetype = '';
+
+		if (function_exists('mime_content_type'))
+		{
+			$mimetype = mime_content_type($filename);
+		}
+
+		// Some browsers choke on a mimetype of application/octet-stream
+		if (!$mimetype || $mimetype == 'application/octet-stream')
+		{
+			$mimetype = 'application/octetstream';
+		}
+
+		return $mimetype;
+	}
+
+	/**
+	* Get filesize
+	*/
+	function get_filesize($filename)
+	{
+		return @filesize($filename);
+	}
+
+	/**
+	* Move file to destination folder
+	* The SITE_FILE_ROOT constant will be applied to the destination path
+	*
+	* @param string $destination_path Destination path, for example $config['avatar_path']
+	* @param octal $chmod Permission mask for chmodding the file after a successful move
+	* @access public
+	*/
+	function move_file($destination, $chmod = 0666)
+	{
+		global $_CLASS;
+
+		if (sizeof($this-&gt;error))
+		{
+			return false;
+		}
+
+		// Adjust destination path (no trailing slash)
+		if ($destination{(sizeof($destination)-1)} == '/' || $destination{(sizeof($destination)-1)} == '\\')
+		{
+			$destination = substr($destination, 0, sizeof($destination)-2);
+		}
+
+		$destination = str_replace(array('../', '..\\', './', '.\\'), '', $destination);
+		if ($destination &amp;&amp; ($destination{0} == '/' || $destination{0} == &quot;\\&quot;))
+		{
+			$destination = '';
+		}
+
+		$this-&gt;destination_path = SITE_FILE_ROOT.$destination;
+
+		$upload_mode = (@ini_get('open_basedir') || @ini_get('safe_mode')) ? 'move' : 'copy';
+		$upload_mode = ($this-&gt;local) ? 'local' : $upload_mode;
+		$this-&gt;destination_file = $this-&gt;destination_path . '/' . basename($this-&gt;realname);
+
+		switch ($upload_mode)
+		{
+			case 'copy':
+
+				if (!@copy($this-&gt;filename, $this-&gt;destination_file)) 
+				{
+					if (!@move_uploaded_file($this-&gt;filename, $this-&gt;destination_file)) 
+					{
+						$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'GENERAL_UPLOAD_ERROR'], $this-&gt;destination_file);
+						return false;
+					}
+				}
+				else
+				{
+					@unlink($this-&gt;filename);
+				}
+
+			break;
+
+			case 'move':
+
+				if (!@move_uploaded_file($this-&gt;filename, $this-&gt;destination_file)) 
+				{
+					if (!@copy($this-&gt;filename, $this-&gt;destination_file)) 
+					{
+						$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'GENERAL_UPLOAD_ERROR'], $this-&gt;destination_file);
+						return false;
+					}
+					else
+					{
+						@unlink($this-&gt;filename);
+					}
+				}
+
+			break;
+
+			case 'local':
+
+				if (!@copy($this-&gt;filename, $this-&gt;destination_file)) 
+				{
+					$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'GENERAL_UPLOAD_ERROR'], $this-&gt;destination_file);
+					return false;
+				}
+				@unlink($this-&gt;filename);
+
+			break;
+		}
+
+		@chmod($this-&gt;destination_file, $chmod);
+
+		// Try to get real filesize from destination folder
+		$this-&gt;filesize = (@filesize($this-&gt;destination_file)) ? @filesize($this-&gt;destination_file) : $this-&gt;filesize;
+
+		if ($this-&gt;is_image())
+		{
+			$this-&gt;width = $this-&gt;height = 0;
+
+			if (($this-&gt;image_info = @getimagesize($this-&gt;destination_file)) !== false)
+			{
+				$this-&gt;width = $this-&gt;image_info[0];
+				$this-&gt;height = $this-&gt;image_info[1];
+
+				if (!empty($this-&gt;image_info['mime']))
+				{
+					$this-&gt;mimetype = $this-&gt;image_info['mime'];
+				}
+			}
+		}
+
+		$this-&gt;file_moved = true;
+		$this-&gt;additional_checks();
+		unset($this-&gt;upload);
+
+		return true;
+	}
+
+	/**
+	* Performing additional checks
+	*/
+	function additional_checks()
+	{
+		global $_CLASS;
+
+		if (!$this-&gt;file_moved)
+		{
+			return false;
+		}
+
+		// Filesize is too big or it's 0 if it was larger than the maxsize in the upload form
+		if ($this-&gt;upload-&gt;max_filesize &amp;&amp; ($this-&gt;get('filesize') &gt; $this-&gt;upload-&gt;max_filesize || $this-&gt;filesize == 0))
+		{
+			$size_lang = ($this-&gt;upload-&gt;max_filesize &gt;= 1048576) ? $_CLASS['core_user']-&gt;lang['MB'] : (($this-&gt;upload-&gt;max_filesize &gt;= 1024) ? $_CLASS['core_user']-&gt;lang['KB'] : $_CLASS['core_user']-&gt;lang['BYTES'] );
+			$max_filesize = ($this-&gt;upload-&gt;max_filesize &gt;= 1048576) ? round($this-&gt;upload-&gt;max_filesize / 1048576 * 100) / 100 : (($this-&gt;upload-&gt;max_filesize &gt;= 1024) ? round($this-&gt;upload-&gt;max_filesize / 1024 * 100) / 100 : $this-&gt;upload-&gt;max_filesize);
+	
+			$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'WRONG_FILESIZE'], $max_filesize, $size_lang);
+
+			return false;
+		}
+
+		if (!$this-&gt;upload-&gt;valid_dimensions($this))
+		{
+			$this-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;upload-&gt;error_prefix . 'WRONG_SIZE'], $this-&gt;upload-&gt;min_width, $this-&gt;upload-&gt;min_height, $this-&gt;upload-&gt;max_width, $this-&gt;upload-&gt;max_height, $this-&gt;width, $this-&gt;height);
+
+			return false;
+		}
+
+		return true;
+	}
+}
+
+/**
+* Class for assigning error messages before a real filespec class can be assigned
+*
+* @package phpBB3
+*/
+class fileerror extends filespec
+{
+	function fileerror($error_msg)
+	{
+		$this-&gt;error[] = $error_msg;
+	}
+}
+
+/**
+* File upload class
+* Init class (all parameters optional and able to be set/overwritten seperatly) - scope is global and valid for all uploads
+*
+* @package phpBB3
+*/
+class fileupload
+{
+	var $allowed_extensions = array();
+	var $max_filesize = 0;
+	var $min_width = 0;
+	var $min_height = 0;
+	var $max_width = 0;
+	var $max_height = 0;
+	var $error_prefix = '';
+
+	/**
+	* Init file upload class.
+	*
+	* @param string $error_prefix Used error messages will get prefixed by this string
+	* @param array $allowed_extensions Array of allowed extensions, for example array('jpg', 'jpeg', 'gif', 'png')
+	* @param int $max_filesize Maximum filesize
+	* @param int $min_width Minimum image width (only checked for images)
+	* @param int $min_height Minimum image height (only checked for images)
+	* @param int $max_width Maximum image width (only checked for images)
+	* @param int $max_height Maximum image height (only checked for images)
+	*
+	*/
+	function fileupload($error_prefix = '', $allowed_extensions = false, $max_filesize = false, $min_width = false, $min_height = false, $max_width = false, $max_height = false)
+	{
+		$this-&gt;set_allowed_extensions($allowed_extensions);
+		$this-&gt;set_max_filesize($max_filesize);
+		$this-&gt;set_allowed_dimensions($min_width, $min_height, $max_width, $max_height);
+		$this-&gt;set_error_prefix($error_prefix);
+	}
+
+	/**
+	* Reset vars
+	*/
+	function reset_vars()
+	{
+		$this-&gt;max_filesize = 0;
+		$this-&gt;min_width = $this-&gt;min_height = $this-&gt;max_width = $this-&gt;max_height = 0;
+		$this-&gt;error_prefix = '';
+		$this-&gt;allowed_extensions = array();
+	}
+
+	/**
+	* Set allowed extensions
+	*/
+	function set_allowed_extensions($allowed_extensions)
+	{
+		if ($allowed_extensions !== false &amp;&amp; is_array($allowed_extensions))
+		{
+			$this-&gt;allowed_extensions = $allowed_extensions;
+		}
+	}
+
+	/**
+	* Set allowed dimensions
+	*/
+	function set_allowed_dimensions($min_width, $min_height, $max_width, $max_height)
+	{
+		$this-&gt;min_width = (int) $min_width;
+		$this-&gt;min_height = (int) $min_height;
+		$this-&gt;max_width = (int) $max_width;
+		$this-&gt;max_height = (int) $max_height;
+	}
+
+	/**
+	* Set maximum allowed filesize
+	*/
+	function set_max_filesize($max_filesize)
+	{
+		if ($max_filesize !== false &amp;&amp; (int) $max_filesize)
+		{
+			$this-&gt;max_filesize = (int) $max_filesize;
+		}
+	}
+
+	/**
+	* Set error prefix
+	*/
+	function set_error_prefix($error_prefix)
+	{
+		$this-&gt;error_prefix = $error_prefix;
+	}
+
+	/**
+	* Form upload method
+	* Upload file from users harddisk
+	*
+	* @param string $form_name Form name assigned to the file input field (if it is an array, the key has to be specified)
+	* @return object $file Object &quot;filespec&quot; is returned, all further operations can be done with this object
+	* @access public
+	*/
+	function form_upload($form_name)
+	{
+		global $_CLASS;
+
+		unset($_FILES[$form_name]['local_mode']);
+		$file = new filespec($_FILES[$form_name], $this);
+
+		if ($file-&gt;init_error)
+		{
+			$file-&gt;error[] = '';
+			return $file;
+		}
+
+		// Error array filled?
+		if (isset($_FILES[$form_name]['error']))
+		{
+			$error = $this-&gt;assign_internal_error($_FILES[$form_name]['error']);
+
+			if ($error !== false)
+			{
+				$file-&gt;error[] = $error;
+				return $file;
+			}
+		}
+
+		// Check if empty file got uploaded (not catched by is_uploaded_file)
+		if (isset($_FILES[$form_name]['size']) &amp;&amp; $_FILES[$form_name]['size'] == 0)
+		{
+			$file-&gt;error[] = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'EMPTY_FILEUPLOAD'];
+			return $file;
+		}
+
+		// PHP Upload filesize exceeded
+		if ($file-&gt;get('filename') == 'none')
+		{
+			$file-&gt;error[] = (@ini_get('upload_max_filesize') == '') ? $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_NA'] : sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_OVERRUN'], @ini_get('upload_max_filesize'));
+			return $file;
+		}
+
+		// Not correctly uploaded
+		if (!$file-&gt;is_uploaded())
+		{
+			$file-&gt;error[] = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED'];
+			return $file;
+		}
+
+		$this-&gt;common_checks($file);
+
+		return $file;
+	}
+
+	/**
+	* Move file from another location to phpBB
+	*/
+	function local_upload($source_file, $filedata = false)
+	{
+		global $_CLASS;
+
+		$form_name = 'local';
+
+		$_FILES[$form_name]['local_mode'] = true;
+		$_FILES[$form_name]['tmp_name'] = $source_file;
+
+		if ($filedata === false)
+		{
+			$_FILES[$form_name]['name'] = basename($source_file);
+			$_FILES[$form_name]['size'] = 0;
+			$_FILES[$form_name]['type'] = '';
+		}
+		else
+		{
+			$_FILES[$form_name]['name'] = $filedata['realname'];
+			$_FILES[$form_name]['size'] = $filedata['size'];
+			$_FILES[$form_name]['type'] = $filedata['type'];
+		}
+
+		$file = new filespec($_FILES[$form_name], $this);
+
+		if ($file-&gt;init_error)
+		{
+			$file-&gt;error[] = '';
+			return $file;
+		}
+
+		if (isset($_FILES[$form_name]['error']))
+		{
+			$error = $this-&gt;assign_internal_error($_FILES[$form_name]['error']);
+
+			if ($error !== false)
+			{
+				$file-&gt;error[] = $error;
+				return $file;
+			}
+		}
+
+		// PHP Upload filesize exceeded
+		if ($file-&gt;get('filename') == 'none')
+		{
+			$file-&gt;error[] = (@ini_get('upload_max_filesize') == '') ? $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_NA'] : sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_OVERRUN'], @ini_get('upload_max_filesize'));
+			return $file;
+		}
+
+		// Not correctly uploaded
+		if (!$file-&gt;is_uploaded())
+		{
+			$file-&gt;error[] = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED'];
+			return $file;
+		}
+
+		$this-&gt;common_checks($file);
+
+		return $file;
+	}
+
+	/**
+	* Remote upload method
+	* Uploads file from given url
+	*
+	* @param string $upload_url URL pointing to file to upload, for example <A HREF="http://www.foobar.com/example.gif">http://www.foobar.com/example.gif</A>
+	* @return object $file Object &quot;filespec&quot; is returned, all further operations can be done with this object
+	* @access public
+	*/
+	function remote_upload($upload_url)
+	{
+		global $_CLASS;
+
+		$upload_ary = array();
+		$upload_ary['local_mode'] = true;
+
+		if (!preg_match('#^(https?://).*?\.(' . implode('|', $this-&gt;allowed_extensions) . ')$#i', $upload_url, $match))
+		{
+			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'URL_INVALID']);
+			return $file;
+		}
+ 
+		if (empty($match[2]))
+		{
+			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'URL_INVALID']);
+			return $file;
+		}
+
+		$url = parse_url($upload_url);
+
+		$host = $url['host'];
+		$path = $url['path'];
+		$port = (!empty($url['port'])) ? (int) $url['port'] : 80;
+
+		$upload_ary['type'] = 'application/octet-stream';
+
+		$url['path'] = explode('.', $url['path']);
+		$ext = array_pop($url['path']);
+
+		$url['path'] = implode('', $url['path']);
+		$upload_ary['name'] = basename($url['path']) . (($ext) ? '.' . $ext : '');
+		$filename = $url['path'];
+		$filesize = 0;
+
+		if (!($fsock = @fsockopen($host, $port, $errno, $errstr)))
+		{
+			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED']);
+			return $file;
+		}
+
+		fputs($fsock, 'GET /' . $path . &quot; HTTP/1.1\r\n&quot;);
+		fputs($fsock, &quot;HOST: &quot; . $host . &quot;\r\n&quot;);
+		fputs($fsock, &quot;Connection: close\r\n\r\n&quot;);
+
+		$get_info = false;
+		$data = '';
+		while (!@feof($fsock))
+		{
+			if ($get_info)
+			{
+				$data .= @fread($fsock, 1024);
+			}
+			else
+			{
+				$line = @fgets($fsock, 1024);
+
+				if ($line == &quot;\r\n&quot;)
+				{
+					$get_info = true;
+				}
+				else
+				{
+					if (strpos($line, 'Content-Type: ') !== false)
+					{
+						$upload_ary['type'] = rtrim(str_replace('Content-Type: ', '', $line));
+					}
+					else if (strpos($line, '404 Not Found') !== false)
+					{
+						$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'URL_NOT_FOUND']);
+						return $file;
+					}
+				}
+			}
+		}
+		@fclose($fsock);
+
+		if (empty($data))
+		{
+			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'EMPTY_REMOTE_DATA']);
+			return $file;
+		}
+
+		$tmp_path = (!@ini_get('safe_mode')) ? false : SITE_FILE_ROOT . 'cache';
+		$filename = tempnam($tmp_path, uniqid(mt_rand(), true) . '-');
+
+		if (!($fp = @fopen($filename, 'wb')))
+		{
+			$file = new fileerror($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED']);
+			return $file;
+		}
+
+		$upload_ary['size'] = fwrite($fp, $data);
+		fclose($fp);
+		unset($data);
+
+		$upload_ary['tmp_name'] = $filename;
+
+		$file = new filespec($upload_ary, $this);
+		$this-&gt;common_checks($file);
+
+		return $file;
+	}
+
+	/**
+	* Assign internal error
+	* @access private
+	*/
+	function assign_internal_error($errorcode)
+	{
+		global $_CLASS;
+
+		switch ($errorcode)
+		{
+			case 1:
+				$error = (@ini_get('upload_max_filesize') == '') ? $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_NA'] : sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PHP_SIZE_OVERRUN'], @ini_get('upload_max_filesize'));
+			break;
+
+			case 2:
+				$size_lang = ($this-&gt;max_filesize &gt;= 1048576) ? $_CLASS['core_user']-&gt;lang['MB'] : (($this-&gt;max_filesize &gt;= 1024) ? $_CLASS['core_user']-&gt;lang['KB'] : $_CLASS['core_user']-&gt;lang['BYTES'] );
+				$max_filesize = ($this-&gt;max_filesize &gt;= 1048576) ? round($this-&gt;max_filesize / 1048576 * 100) / 100 : (($this-&gt;max_filesize &gt;= 1024) ? round($this-&gt;max_filesize / 1024 * 100) / 100 : $this-&gt;max_filesize);
+
+				$error = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'WRONG_FILESIZE'], $max_filesize, $size_lang);
+			break;
+
+			case 3:
+				$error = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'PARTIAL_UPLOAD'];
+			break;
+
+			case 4:
+				$error = $_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'NOT_UPLOADED'];
+			break;
+
+			case 6:
+				$error = 'Temporary folder could not be found. Please check your PHP installation.';
+			break;
+
+			default:
+				$error = false;
+			break;
+		}
+
+		return $error;
+	}
+
+	/**
+	* Perform common checks
+	*/
+	function common_checks(&amp;$file)
+	{
+		global $_CLASS;
+
+		// Filesize is too big or it's 0 if it was larger than the maxsize in the upload form
+		if ($this-&gt;max_filesize &amp;&amp; ($file-&gt;get('filesize') &gt; $this-&gt;max_filesize || $file-&gt;get('filesize') == 0))
+		{
+			$size_lang = ($this-&gt;max_filesize &gt;= 1048576) ? $_CLASS['core_user']-&gt;lang['MB'] : (($this-&gt;max_filesize &gt;= 1024) ? $_CLASS['core_user']-&gt;lang['KB'] : $_CLASS['core_user']-&gt;lang['BYTES'] );
+			$max_filesize = ($this-&gt;max_filesize &gt;= 1048576) ? round($this-&gt;max_filesize / 1048576 * 100) / 100 : (($this-&gt;max_filesize &gt;= 1024) ? round($this-&gt;max_filesize / 1024 * 100) / 100 : $this-&gt;max_filesize);
+
+			$file-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'WRONG_FILESIZE'], $max_filesize, $size_lang);
+		}
+
+		// check Filename
+		if (preg_match(&quot;#[\\/:*?\&quot;&lt;&gt;|]#i&quot;, $file-&gt;get('realname')))
+		{ 
+			$file-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'INVALID_FILENAME'], $file-&gt;get('realname'));
+		}
+
+		// Invalid Extension
+		if (!$this-&gt;valid_extension($file))
+		{
+			$file-&gt;error[] = sprintf($_CLASS['core_user']-&gt;lang[$this-&gt;error_prefix . 'DISALLOWED_EXTENSION'], $file-&gt;get('extension'));
+		}
+	}
+
+	/**
+	* Check for allowed extension
+	*/
+	function valid_extension(&amp;$file)
+	{
+		return (in_array($file-&gt;get('extension'), $this-&gt;allowed_extensions)) ? true : false;
+	}
+
+	/**
+	* Check for allowed dimension
+	*/
+	function valid_dimensions(&amp;$file)
+	{
+		if (!$this-&gt;max_width &amp;&amp; !$this-&gt;max_height &amp;&amp; !$this-&gt;min_width &amp;&amp; !$this-&gt;min_height)
+		{
+			return true;
+		}
+
+		if (($file-&gt;get('width') &gt; $this-&gt;max_width &amp;&amp; $this-&gt;max_width) || 
+			($file-&gt;get('height') &gt; $this-&gt;max_height &amp;&amp; $this-&gt;max_height) || 
+			($file-&gt;get('width') &lt; $this-&gt;min_width &amp;&amp; $this-&gt;min_width) ||
+			($file-&gt;get('height') &lt; $this-&gt;min_height &amp;&amp; $this-&gt;min_height))
+		{
+			return false;
+		}
+
+		return true;
+	}
+
+	/**
+	* Check if form upload is valid
+	*/
+	function is_valid($form_name)
+	{
+		return (isset($_FILES[$form_name]) &amp;&amp; $_FILES[$form_name]['name'] != 'none') ? true : false;
+	}
+}
+
 ?&gt;
\ No newline at end of file

Modified: cms/trunk/includes/forums/mcp/mcp_notes.php
===================================================================
--- cms/trunk/includes/forums/mcp/mcp_notes.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/mcp/mcp_notes.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -84,15 +84,9 @@
 	if (($deletemark || $deleteall) &amp;&amp; $_CLASS['forums_auth']-&gt;acl_get('a_clearlogs'))
 	{
 		$where_sql = '';
-		if ($deletemark &amp;&amp; $marked)
+		if ($deletemark &amp;&amp; !empty($marked))
 		{
-			/*$sql_in = array();
-			foreach ($marked as $mark)
-			{
-				$sql_in[] = $mark;
-			}*/
 			$where_sql = ' AND log_id IN (' . implode(', ', $marked) . ')';
-			/*unset($sql_in);*/
 		}
 
 		if ($where_sql || $deleteall)

Modified: cms/trunk/includes/forums/mcp/mcp_post.php
===================================================================
--- cms/trunk/includes/forums/mcp/mcp_post.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/mcp/mcp_post.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -147,7 +147,7 @@
 	'U_MCP_APPROVE'			=&gt; generate_link('forums&amp;file=mcp&amp;i=queue&amp;mode=approve_details&amp;p=' . $post_info['post_id']),
 	'U_MCP_REPORT'			=&gt; generate_link('forums&amp;file=mcp&amp;i=reports&amp;mode=report_details&amp;p=' . $post_info['post_id']),
 	'U_MCP_USER_NOTES'		=&gt; generate_link('forums&amp;file=mcp&amp;i=notes&amp;mode=user_notes&amp;u=' . $post_info['user_id']),
-	'U_MCP_WARN_USER'		=&gt; $_CLASS['forums_auth']-&gt;acl_get('m_warn') ? append_sid(&quot;{$phpbb_root_path}mcp.$phpEx&quot;, 'i=warn&amp;mode=warn_user&amp;u=' . $post_info['user_id']) : '',
+	'U_MCP_WARN_USER'		=&gt; $_CLASS['forums_auth']-&gt;acl_get('m_warn') ? generate_link('forums&amp;file=mcp&amp;i=warn&amp;mode=warn_user&amp;u=' . $post_info['user_id']) : '',
 	'U_VIEW_POST'			=&gt; generate_link('forums&amp;file=viewtopic&amp;p=' . $post_info['post_id'] . '#p' . $post_info['post_id']),
 	'U_VIEW_PROFILE'		=&gt; generate_link('members_list&amp;mode=viewprofile&amp;u=' . $post_info['user_id']),
 	'U_VIEW_TOPIC'			=&gt; generate_link('forums&amp;file=viewtopic&amp;t=' . $post_info['topic_id']),

Modified: cms/trunk/includes/forums/mcp/mcp_topic.php
===================================================================
--- cms/trunk/includes/forums/mcp/mcp_topic.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/mcp/mcp_topic.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -146,10 +146,10 @@
 }
 $_CLASS['core_db']-&gt;free_result($result);
 
-if ($bbcode_bitfield)
+if ($bbcode_bitfield !== '')
 {
 	require_once SITE_FILE_ROOT.'includes/forums/bbcode.php';
-	$bbcode = new bbcode($bbcode_bitfield);
+	$bbcode = new bbcode(base64_encode($bbcode_bitfield));
 }
 
 foreach ($rowset as $i =&gt; $row)

Modified: cms/trunk/includes/forums/message_parser.php
===================================================================
--- cms/trunk/includes/forums/message_parser.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/forums/message_parser.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -51,7 +51,6 @@
 		$this-&gt;bbcode_bitfield = '';
 		$bitfield = new bitfield();
 
-		$size = mb_strlen($this-&gt;message);
 		foreach ($this-&gt;bbcodes as $bbcode_name =&gt; $bbcode_data)
 		{
 			if (isset($bbcode_data['disabled']) &amp;&amp; $bbcode_data['disabled'])
@@ -66,22 +65,29 @@
 				}
 			}
 			else
-			{
-				foreach ($bbcode_data['regexp'] as $regexp =&gt; $replacement)
-				{
-					$this-&gt;message = preg_replace($regexp, $replacement, $this-&gt;message);
-				}
+			{
+				// TODO: Review this
+				$found = false;
+				foreach ($bbcode_data['regexp'] as $regexp =&gt; $replacement)
+				{
+					if (!$found)
+					{
+						$before = strlen($this-&gt;message);
+					}
+					$this-&gt;message = preg_replace($regexp, $replacement, $this-&gt;message);
+					if (!$found)
+					{
+						$after = strlen($this-&gt;message);
+						if ($before != $after)
+						{
+							// Because we add bbcode_uid to all tags, the message length
+							// will increase whenever a tag is found
+							$bitfield-&gt;set($bbcode_data['bbcode_id']);
+							$found = true;
+						}
+					}
+				}
 			}
-
-			// Because we add bbcode_uid to all tags, the message length
-			// will increase whenever a tag is found
-			$new_size = mb_strlen($this-&gt;message);
-
-			if ($size !== $new_size)
-			{
-				$bitfield-&gt;set($bbcode_data['bbcode_id']);
-				$size = $new_size;
-			}
 		}
 
 		$this-&gt;bbcode_bitfield = $bitfield-&gt;get_base64();
@@ -1281,7 +1287,7 @@
 	*/
 	function get_submitted_attachment_data($check_user_id = false)
 	{
-		global $_CLASS;
+		global $_CLASS, $config;
 
 		$this-&gt;filename_data['filecomment'] = request_var('filecomment', '', true);
 		$this-&gt;attachment_data = isset($_POST['attachment_data']) ? $_POST['attachment_data'] : array();
@@ -1295,7 +1301,7 @@
 		{
 			if ($var_ary['attach_id'])
 			{
-				$attach_ids[(int) $this-&gt;attachment_data[$pos]['attach_id']] = $pos;
+				$attach_ids[$this-&gt;attachment_data[$pos]['attach_id']] = $pos;
 			}
 			else
 			{
@@ -1308,12 +1314,12 @@
 		$this-&gt;attachment_data = array();
 
 		// Regenerate already posted attachments...
-		if (sizeof($attach_ids))
+		if (!empty($attach_ids))
 		{
 			// Get the data from the attachments
-			$sql = 'SELECT attach_id, physical_filename, real_filename, extension, mimetype, filesize, filetime, thumbnail
-				FROM ' . ATTACHMENTS_TABLE . '
-				WHERE attach_id IN (' . implode(', ', $attach_ids) . ')
+			$sql = 'SELECT attach_id, physical_filename, comment, real_filename, extension, mimetype, filesize, filetime, thumbnail
+				FROM ' . FORUMS_ATTACHMENTS_TABLE . '
+				WHERE attach_id IN (' . implode(', ', array_unique(array_map('intval', array_keys($attach_ids)))) . ')
 					AND poster_id = ' . $check_user_id;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1323,16 +1329,16 @@
 				{
 					$pos = $attach_ids[$row['attach_id']];
 					$this-&gt;attachment_data[$pos] = $row;
-					set_var($this-&gt;attachment_data[$pos]['attach_comment'], $_POST['attachment_data'][$pos]['attach_comment'], 'string', true);
+					set_var($this-&gt;attachment_data[$pos]['comment'], $_POST['attachment_data'][$pos]['comment'], 'string', true);
 
 					unset($attach_ids[$row['attach_id']]);
 				}
 			}
 			$_CLASS['core_db']-&gt;free_result($result);
 
-			if (sizeof($attach_ids))
+			if (!empty($attach_ids))
 			{
-				trigger_error($_CLASS['core_user']-&gt;lang['NO_ACCESS_ATTACHMENT'], E_USER_ERROR);
+				trigger_error('NO_ACCESS_ATTACHMENT', E_USER_ERROR);
 			}
 		}
 
@@ -1342,7 +1348,7 @@
 			require_once SITE_FILE_ROOT.'includes/forums/functions_upload.php';
 
 			$sql = 'SELECT attach_id
-				FROM ' . ATTACHMENTS_TABLE . &quot;
+				FROM ' . FORUMS_ATTACHMENTS_TABLE . &quot;
 				WHERE LOWER(physical_filename) IN ('&quot; . implode(&quot;' ,'&quot;, $_CLASS['core_db']-&gt;escape_array(array_map('strtolower', $filenames))) . &quot;')&quot;;
 			$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
 			$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
@@ -1350,7 +1356,7 @@
 
 			if ($row)
 			{
-				trigger_error($_CLASS['core_user']-&gt;lang['NO_ACCESS_ATTACHMENT'], E_USER_ERROR);
+				trigger_error('NO_ACCESS_ATTACHMENT', E_USER_ERROR);
 			}
 
 			foreach ($filenames as $pos =&gt; $physical_filename)
@@ -1363,7 +1369,7 @@
 					'thumbnail'			=&gt; (file_exists(SITE_FILE_ROOT . $config['upload_path'] . '/thumb_' . $physical_filename)) ? 1 : 0,
 				);
 
-				set_var($this-&gt;attachment_data[$pos]['attach_comment'], $_POST['attachment_data'][$pos]['attach_comment'], 'string', true);
+				set_var($this-&gt;attachment_data[$pos]['comment'], $_POST['attachment_data'][$pos]['comment'], 'string', true);
 				set_var($this-&gt;attachment_data[$pos]['real_filename'], $_POST['attachment_data'][$pos]['real_filename'], 'string', true);
 				set_var($this-&gt;attachment_data[$pos]['filetime'], $_POST['attachment_data'][$pos]['filetime'], 'int');
 
@@ -1393,7 +1399,7 @@
 		$this-&gt;message = $poll['poll_option_text'];
 
 
-		$poll['poll_option_text'] = $this-&gt;parse($poll['enable_bbcode'], $poll['enable_urls'], $poll['enable_smilies'], $poll['img_status'], false, false, false);
+		$poll['poll_option_text'] = $this-&gt;parse(false, $poll['enable_bbcode'], $poll['enable_urls'], $poll['enable_smilies'], $poll['img_status'], false, false, false);
 
 
 		$this-&gt;message = $tmp_message;
@@ -1403,9 +1409,8 @@
 		$this-&gt;message = $poll['poll_title'];
 
 
-		$poll['poll_title'] = $this-&gt;parse($poll['enable_bbcode'], $poll['enable_urls'], $poll['enable_smilies'], $poll['img_status'], false, false, false);
+		$poll['poll_title'] = $this-&gt;parse(false, $poll['enable_bbcode'], $poll['enable_urls'], $poll['enable_smilies'], $poll['img_status'], false, false, false);
 
-
 		$this-&gt;message = $tmp_message;
 
 		unset($tmp_message);

Modified: cms/trunk/includes/functions.php
===================================================================
--- cms/trunk/includes/functions.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/functions.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -45,7 +45,7 @@
 {
 	//Code Copyright 2004 phpBB Group - <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
 	return preg_match('#^[a-z0-9\.\-_\+]+?@(.*?\.)*?[a-z0-9\-_]+?\.[a-z]{2,4}$#i', $email);
-	//preg_match('#^.*?@(.*?\.)?[a-z0-9\-]+\.[a-z]{2,4}$#i', $email)
+	//preg_match('[a-z0-9&amp;\'\.\-_\+]+@[a-z0-9\-]+\.([a-z0-9\-]+\.)*[a-z]+', $email)
 }
 
 function check_bot_status($browser, $ip)
@@ -655,8 +655,8 @@
 		}
 
 /* I think reference is required below PHP 4.4 */
-		$_CLASS[$name] =&amp; new $class;
-		//$_CLASS[$name] = new $class;
+		//$_CLASS[$name] =&amp; new $class;
+		$_CLASS[$name] = new $class;
 	}
 }
 

Modified: cms/trunk/includes/tables.php
===================================================================
--- cms/trunk/includes/tables.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/tables.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -76,9 +76,9 @@
 define('PAGE_MODULE', 0);
 define('PAGE_TEMPLATE', 1);
 
-define('ACL_NO', 0);
-define('ACL_YES', 1);
-define('ACL_UNSET', -1);
+define('ACL_NEVER', 0);
+define('ACL_YES', 1);
+define('ACL_NO', -1);
 
 define('GROUP_HIDDEN', 0);
 define('GROUP_SYSTEM', 1);
@@ -161,6 +161,8 @@
 define('FORUMS_ACL_TABLE', $table_prefix.'forums_auth');
 define('FORUMS_ACL_OPTIONS_TABLE', $table_prefix.'forums_auth_options');
 define('FORUMS_ACL_PRESETS_TABLE', $table_prefix.'forums_auth_presets');
+define('FORUMS_ACL_ROLES_TABLE', $table_prefix.'forums_acl_roles');
+define('FORUMS_ACL_ROLES_DATA_TABLE', $table_prefix.'forums_acl_roles_data');
 
 define('FORUMS_ATTACHMENTS_TABLE', $table_prefix.'forums_attachments');
 define('FORUMS_BOOKMARKS_TABLE', $table_prefix.'forums_bookmarks');

Added: cms/trunk/includes/templates/modules/forums/admin/acp_main.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/admin/acp_main.html	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/includes/templates/modules/forums/admin/acp_main.html	2006-08-16 12:22:53 UTC (rev 184)
@@ -0,0 +1,100 @@
+&lt;!-- INCLUDE modules/forums/admin/overall_header.html --&gt;
+
+&lt;a name=&quot;maincontent&quot;&gt;&lt;/a&gt;&lt;h1&gt;{ $L_WELCOME_PHPBB }&lt;/h1&gt;
+
+&lt;p&gt;{ $L_ADMIN_INTRO }&lt;/p&gt;
+
+&lt;form id=&quot;stats&quot; method=&quot;post&quot; action=&quot;{ $U_ACTION }&quot;&gt;
+
+&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
+	&lt;caption&gt;{ $L_FORUM_STATS }&lt;/caption&gt;
+&lt;thead&gt;
+	&lt;tr&gt;
+		&lt;th&gt;{ $L_STATISTIC }&lt;/th&gt;
+		&lt;th&gt;{ $L_VALUE }&lt;/th&gt;
+		&lt;th&gt;{ $L_STATISTIC }&lt;/th&gt;
+		&lt;th&gt;{ $L_VALUE }&lt;/th&gt;
+	&lt;/tr&gt;
+&lt;/thead&gt;
+&lt;tbody&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_NUMBER_POSTS }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $TOTAL_POSTS }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_POSTS_PER_DAY }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $POSTS_PER_DAY }&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_NUMBER_TOPICS }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $TOTAL_TOPICS }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_TOPICS_PER_DAY }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $TOPICS_PER_DAY }&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_NUMBER_USERS }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $TOTAL_USERS }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_USERS_PER_DAY }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $USERS_PER_DAY }&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_NUMBER_FILES }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $TOTAL_FILES }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_FILES_PER_DAY }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $FILES_PER_DAY }&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_BOARD_STARTED }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $START_DATE }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_AVATAR_DIR_SIZE }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $AVATAR_DIR_SIZE }&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;{ $L_UPLOAD_DIR_SIZE }: &lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;b&gt;{ $UPLOAD_DIR_SIZE }&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;!-- IF { $S_ACTION_OPTIONS } --&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;4&quot; align=&quot;right&quot;&gt;
+	
+		&lt;select name=&quot;action&quot;&gt;{ $S_ACTION_OPTIONS }&lt;/select&gt;
+		&lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;
+	&lt;/tr&gt;
+&lt;!-- ENDIF --&gt;
+&lt;/tbody&gt;
+&lt;/table&gt;
+
+&lt;/form&gt;
+
+
+&lt;!-- IF !empty({ $log }) --&gt;
+	&lt;h2&gt;{ $L_ADMIN_LOG }&lt;/h2&gt;
+
+	&lt;p&gt;{ $L_ADMIN_LOG_INDEX_EXPLAIN }&lt;/p&gt;
+
+	&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
+	&lt;thead&gt;
+	&lt;tr&gt;
+		&lt;th&gt;{ $L_USERNAME }&lt;/th&gt;
+		&lt;th&gt;{ $L_IP }&lt;/th&gt;
+		&lt;th&gt;{ $L_TIME }&lt;/th&gt;
+		&lt;th&gt;{ $L_ACTION }&lt;/th&gt;
+	&lt;/tr&gt;
+	&lt;/thead&gt;
+	&lt;tbody&gt;
+	&lt;!-- LOOP $log --&gt;
+		&lt;!-- IF { $log:#LOOP_INDEX } % 2 --&gt;&lt;tr class=&quot;row1&quot;&gt;&lt;!-- ELSE --&gt;&lt;tr class=&quot;row2&quot;&gt;&lt;!-- ENDIF --&gt;
+
+			&lt;td class=&quot;row1&quot;&gt;{ $log:USERNAME }&lt;/td&gt;
+			&lt;td style=&quot;text-align: center;&quot;&gt;{ $log:IP }&lt;/td&gt;
+			&lt;td style=&quot;text-align: center;&quot;&gt;{ $log:DATE }&lt;/td&gt;
+			&lt;td class=&quot;row1&quot;&gt;{ $log:ACTION }&lt;/td&gt;
+		&lt;/tr&gt;
+	&lt;!-- ENDLOOP $log --&gt;
+	&lt;/tbody&gt;
+	&lt;/table&gt;
+
+	&lt;br /&gt;
+	&lt;div style=&quot;text-align: right;&quot;&gt;&lt;a href=&quot;{ $U_ADMIN_LOG}&quot;&gt;&raquo; { $L_VIEW_ADMIN_LOG }&lt;/a&gt;&lt;/div&gt;
+
+&lt;!-- ENDIF --&gt;
+
+&lt;!-- INCLUDE modules/forums/admin/overall_footer.html --&gt;
\ No newline at end of file

Modified: cms/trunk/install/build_data.php
===================================================================
--- cms/trunk/install/build_data.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/install/build_data.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -23,154 +23,154 @@
 
 $time = gmtime();
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_access (admin_section, user_id, admin_status) VALUES ('_all_', 2, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_AUTH_TABLE .&quot; (admin_section, user_id, admin_status) VALUES ('_all_', 2, 2)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'path_avatar_upload', 'images/avatars/upload', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'path_avatar_gallery', 'images/avatars/gallery', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'path_smilies', 'images/smilies', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'site_name', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_theme', 'viperal', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'path_avatar_upload', 'images/avatars/upload', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'path_avatar_gallery', 'images/avatars/gallery', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'path_smilies', 'images/smilies', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'site_name', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_theme', 'viperal', 'string', 1)&quot;);
 $content = $_CLASS['core_db']-&gt;escape('&lt;a href=&quot;feed.php?mod=articles&amp;feed=rss1&quot; title=&quot;RSS 1.0 / RDF Feed&quot;&gt;&lt;img alt=&quot;RSS 1.0 / RDF&quot; src=&quot;images/rss10_logo.gif&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;feed.php?mod=articles&amp;feed=rss2&quot; title=&quot;RSS 2.0 Feed&quot;&gt;&lt;img alt=&quot;RSS 2.0&quot; src=&quot;images/rss20_logo.gif&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;feed.php?mod=articles&amp;feed=rss&quot; title=&quot;RSS 0.91 Feed&quot;&gt;&lt;img alt=&quot;RSS 0.9&quot; src=&quot;images/rss090_logo.gif&quot; /&gt;&lt;/a&gt;');
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'foot1', '$content', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'foot2', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_lang', 'en', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_dst', '0', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'only_registered', '0', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_dateformat', 'D M d, Y g:i a', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_timezone', '-5', 'float', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'link_optimization', '0', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'index_page', 'contact', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'foot1', '$content', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'foot2', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_lang', 'en', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_dst', '0', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'only_registered', '0', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_dateformat', 'D M d, Y g:i a', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_timezone', '-5', 'float', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'link_optimization', '0', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'index_page', 'contact', 'string', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'active', '1', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'start', '', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'active', '1', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'start', '', 'int', 1)&quot;);
 $content = $_CLASS['core_db']-&gt;escape('&lt;p align=&quot;center&quot;&gt;&lt;b&gt;Sorry we are currently updating this site.&lt;br&gt;Please try again later&lt;/b&gt;&lt;/p&gt;');
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'text', '$content', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'text', '$content', 'string', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'allow_html_email', '1', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'email_enable', '1', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'email_function_name', 'mail', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp', 0, 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_host', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_port', '', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_username', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_password', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'site_email', '<A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">none at none.com</A>', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'allow_html_email', '1', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'email_enable', '1', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'email_function_name', 'mail', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp', 0, 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_host', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_port', '', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_username', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'smtp_password', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('email', 'site_email', '<A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">none at none.com</A>', 'string', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'allow_name_chars', '.*', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'enable_confirm', '1', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'coppa_enable', '1', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'coppa_fax', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'coppa_mail', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'min_name_chars', '5', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'max_reg_attempts', '10', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'max_name_chars', '50', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'min_pass_chars', '5', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'max_pass_chars', '25', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'allow_email_reuse', '0', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'allow_name_change', '0', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'newest_username', 'admin', 'string', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'newest_user_id', '2', 'int', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'activation', '0', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'total_users', '1', 'int', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'password_encoding', 'md5', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'allow_name_chars', '.*', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'enable_confirm', '1', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'coppa_enable', '1', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'coppa_fax', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'coppa_mail', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'min_name_chars', '5', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'max_reg_attempts', '10', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'max_name_chars', '50', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'min_pass_chars', '5', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'max_pass_chars', '25', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'allow_email_reuse', '0', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'allow_name_change', '0', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'newest_username', 'admin', 'string', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'newest_user_id', '2', 'int', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'activation', '0', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'total_users', '1', 'int', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('user', 'password_encoding', 'md5', 'string', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'path', '/', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'cookie_domain', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'cookie_name', 'viperal', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'cookie_path', '/', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'limit_load', '0', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'limit_sessions', '0', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'ip_check', '4', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'session_length', '3600', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'error_options', '0', 'int', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_secure', '0', 'bool', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_domain', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_path', '', 'string', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;config (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_port', '', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'path', '/', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'cookie_domain', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'cookie_name', 'viperal', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'cookie_path', '/', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'limit_load', '0', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'limit_sessions', '0', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'ip_check', '4', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'session_length', '3600', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'error_options', '0', 'int', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_secure', '0', 'bool', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_domain', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_path', '', 'string', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONFIG_TABLE  .&quot; (config_section, config_name, config_value, config_type, config_cache) VALUES ('server', 'site_port', '', 'int', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('GUESTS', 1, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('REGISTERED', 1, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('REGISTERED_COPPA', 1, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('ADMINISTRATORS', 1, 2, 'AA0000', 1, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('BOTS', 1, 2, '9E8DA7', 1, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot; (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('GUESTS', 1, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot; (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('REGISTERED', 1, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot; (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('REGISTERED_COPPA', 1, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot; (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('ADMINISTRATORS', 1, 2, 'AA0000', 1, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot; (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('BOTS', 1, 2, '9E8DA7', 1, '')&quot;);
 // To be seperated
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('SUPER_MODERATORS', 1, 2, '00AA00', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot; (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('SUPER_MODERATORS', 1, 2, '00AA00', 0, '')&quot;);
 
 
 //Admin
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (2, 2, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (4, 2, 10)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (6, 2, 10)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (2, 2, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (4, 2, 10)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (6, 2, 10)&quot;);
 // Anonymous
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (1, 1, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (1, 1, 2)&quot;);
 // Bots
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (5, 3, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (5, 4, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (5, 5, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (5, 6, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (5, 7, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;groups_members (group_id, user_id, member_status) VALUES (5, 8, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (5, 3, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (5, 4, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (5, 5, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (5, 6, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (5, 7, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_GROUPS_TABLE  .&quot;_members (group_id, user_id, member_status) VALUES (5, 8, 2)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;blocks (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Contol Panel', 3, 2, 1, 1, 'block-Control_Panel.php')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;blocks (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Modules', 0, 2, 1, 2, 'block-Modules.php')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;blocks (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('User', 0, 2, 1, 3, 'block-User.php')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;blocks (block_title, block_type, block_status, block_position, block_order, block_rss_url, block_rss_rate) VALUES ('php.net RSS Feed', 1, 2, 2, 1, '<A HREF="http://www.php.net/news.rss">http://www.php.net/news.rss</A>', 7200)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;blocks (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Theme Select', 0, 2, 2, 2, 'block-theme_select.php')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_BLOCKS_TABLE  .&quot; (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Contol Panel', 3, 2, 1, 1, 'block-Control_Panel.php')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_BLOCKS_TABLE  .&quot; (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Modules', 0, 2, 1, 2, 'block-Modules.php')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_BLOCKS_TABLE  .&quot; (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('User', 0, 2, 1, 3, 'block-User.php')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_BLOCKS_TABLE  .&quot; (block_title, block_type, block_status, block_position, block_order, block_rss_url, block_rss_rate) VALUES ('php.net RSS Feed', 1, 2, 2, 1, '<A HREF="http://www.php.net/news.rss">http://www.php.net/news.rss</A>', 7200)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_BLOCKS_TABLE  .&quot; (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Theme Select', 0, 2, 2, 2, 'block-theme_select.php')&quot;);
 
 $content = $_CLASS['core_db']-&gt;escape('&lt;div style=&quot;text-align:center&quot;&gt;Hello and welcome&lt;/div&gt;');
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;blocks (block_title, block_type, block_status, block_position, block_order, block_content) VALUES ('Welcome', 4, 2, 6, 4, '$content')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_BLOCKS_TABLE  .&quot; (block_title, block_type, block_status, block_position, block_order, block_content) VALUES ('Welcome', 4, 2, 6, 4, '$content')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('blocks', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('groups', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('system', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('messages', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('modules', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('pages', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('smiles', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('users', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('groups', 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;admin_modules (module_name, module_status, module_type) VALUES ('forums', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('blocks', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('groups', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('system', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('messages', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('modules', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('pages', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('smiles', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('users', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('groups', 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_ADMIN_MODULES_TABLE  .&quot; (module_name, module_status, module_type) VALUES ('forums', 2, 0)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('main', 2, 'front\r\nsubscribed\r\nbookmarks\r\ndrafts')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('pm', 2, 'view_messages\r\ncompose\r\nunread\r\ndrafts\r\noptions')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('profile', 2,'profile_info\r\nreg_details\r\nsignature\r\navatar')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('prefs', 2, 'personal\r\nview\r\npost')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('zebra', 2, 'friends\r\nfoes')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('attachments', 1, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('groups', 2, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;control_panel_modules (module_name, module_status, module_subs) VALUES ('calender', 2,'month_view\r\nday_view\r\nadd_event')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('main', 2, 'front\r\nsubscribed\r\nbookmarks\r\ndrafts')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('pm', 2, 'view_messages\r\ncompose\r\nunread\r\ndrafts\r\noptions')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('profile', 2,'profile_info\r\nreg_details\r\nsignature\r\navatar')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('prefs', 2, 'personal\r\nview\r\npost')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('zebra', 2, 'friends\r\nfoes')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('attachments', 1, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('groups', 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_CONTROL_PANEL_MODULES_TABLE  .&quot; (module_name, module_status, module_subs) VALUES ('calender', 2,'month_view\r\nday_view\r\nadd_event')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('articles', 0, 1, 102)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('contact', 0, 2, 102)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('calender', 0, 1, 98)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('control_panel', 0, 2, 98)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('forums', 0, 2, 98)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('members_list', 0, 2, 98)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;pages (page_name, page_type, page_status, page_blocks) VALUES ('quick_message', 0, 1, 102)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('articles', 0, 1, 102)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('contact', 0, 2, 102)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('calender', 0, 1, 98)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('control_panel', 0, 2, 98)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('forums', 0, 2, 98)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('members_list', 0, 2, 98)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_PAGES_TABLE  .&quot; (page_name, page_type, page_status, page_blocks) VALUES ('quick_message', 0, 1, 102)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':D', 'grin.png', 'Very Happy', 19, 19, 1, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':)', 'smile.png', 'Smile', 19, 19, 2, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':(', 'sad.png', 'Sad', 19, 19, 3, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':o', 'surprised.png', 'Surprised', 19, 19, 4, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':eek:', 'surprised.png', 'Surprised', 19, 19, 4, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES ('8O', 'eek.png', 'Shocked', 19, 19, 5, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':?', 'confused.png', 'Confused', 19, 19, 6, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES ('8)', 'cool.png', 'Cool', 19, 19, 7, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':lol:', 'laugh.png', 'Laughing', 19, 19, 8, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':x', 'mad.png', 'Mad', 19, 19, 9, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':P', 'icon_razz.gif', 'Razz', 19, 19, 10, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':oops:', 'embarrassed.png', 'Embarassed', 19, 19, 11, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':cry:', 'cry.png', 'Crying or Very sad', 19, 19, 12, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':evil:', 'evil.png', 'Evil or Very Mad', 19, 19, 13, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':twisted:', 'twisted.png', 'Twisted Evil', 19, 19, 14, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':roll:', 'rolleyes.png', 'Rolling Eyes', 19, 19, 19, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (';)', 'wink.png', 'Wink', 19, 19, 16, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':!:', 'exclaim.png', 'Exclamation', 19, 19, 17, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':?:', 'question.png', 'Question', 19, 19, 18, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':idea:', 'idea.png', 'Idea', 19, 19, 19, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':arrow:', 'arrow.png', 'Arrow', 19, 19, 20, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':|', 'neutral.png', 'Neutral', 19, 19, 21, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':mrgreen:', 'mrgreen.png', 'Mr. Green', 19, 19, 22, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':D', 'grin.png', 'Very Happy', 19, 19, 1, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':)', 'smile.png', 'Smile', 19, 19, 2, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':(', 'sad.png', 'Sad', 19, 19, 3, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':o', 'surprised.png', 'Surprised', 19, 19, 4, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':eek:', 'surprised.png', 'Surprised', 19, 19, 4, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES ('8O', 'eek.png', 'Shocked', 19, 19, 5, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':?', 'confused.png', 'Confused', 19, 19, 6, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES ('8)', 'cool.png', 'Cool', 19, 19, 7, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':lol:', 'laugh.png', 'Laughing', 19, 19, 8, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':x', 'mad.png', 'Mad', 19, 19, 9, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':P', 'icon_razz.gif', 'Razz', 19, 19, 10, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':oops:', 'embarrassed.png', 'Embarassed', 19, 19, 11, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':cry:', 'cry.png', 'Crying or Very sad', 19, 19, 12, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':evil:', 'evil.png', 'Evil or Very Mad', 19, 19, 13, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':twisted:', 'twisted.png', 'Twisted Evil', 19, 19, 14, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':roll:', 'rolleyes.png', 'Rolling Eyes', 19, 19, 19, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (';)', 'wink.png', 'Wink', 19, 19, 16, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':!:', 'exclaim.png', 'Exclamation', 19, 19, 17, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':?:', 'question.png', 'Question', 19, 19, 18, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':idea:', 'idea.png', 'Idea', 19, 19, 19, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':arrow:', 'arrow.png', 'Arrow', 19, 19, 20, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':|', 'neutral.png', 'Neutral', 19, 19, 21, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_SMILIES_TABLE  .&quot; (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':mrgreen:', 'mrgreen.png', 'Mr. Green', 19, 19, 22, 0)&quot;);
 
 $data = serialize(array(
 	'viewimg' =&gt; 1,
@@ -189,313 +189,441 @@
 
 $admin_data = $guest_data = $bot_data = $_CLASS['core_db']-&gt;escape($data);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (0, 2, 1, 'Anonymous', '', '', '', $time, '', 1, 0, 0, 0, 0, '$guest_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (1, 2, 4, 'admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '', $time, '', 'AA0000', 1, 1, 1, 1, 1, '$admin_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Googlebot', '', '', '', $time, '216.239.46.,64.68.8.,66.249.64.,66.249.71.', 'Googlebot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'MSN', '', '', '', $time, '65.54.188.', 'msnbot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Yahoo', '', '', '', $time, '66.196.90.1', 'Yahoo! Slurp', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Alexa', '', '', '', $time, '66.28.250.,209.237.238.', 'ia_archiver', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'NaverBot', '', '', '', $time, '222.122.194.,218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$user_prefix.&quot;users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Jetbot', '', '', '', $time, '64.71.144.', 'Jetbot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (0, 2, 1, 'Anonymous', '', '', '', $time, '', 1, 0, 0, 0, 0, '$guest_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (1, 2, 4, 'admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '', $time, '', 'AA0000', 1, 1, 1, 1, 1, '$admin_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Googlebot', '', '', '', $time, '216.239.46.,64.68.8.,66.249.64.,66.249.71.', 'Googlebot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'MSN', '', '', '', $time, '65.54.188.', 'msnbot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Yahoo', '', '', '', $time, '66.196.90.1', 'Yahoo! Slurp', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Alexa', '', '', '', $time, '66.28.250.,209.237.238.', 'ia_archiver', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'NaverBot', '', '', '', $time, '222.122.194.,218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. CORE_USERS_TABLE  .&quot; (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Jetbot', '', '', '', $time, '64.71.144.', 'Jetbot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)&quot;);
 
 // Forums
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_list', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_read', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_post', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_reply', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_quote', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_edit', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_user_lock', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_delete', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_bump', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_poll', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_vote', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_votechg', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_announce', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_sticky', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_attach', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_download', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_icons', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_html', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_bbcode', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_smilies', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_img', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_flash', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_sigs', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_search', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_email', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_rate', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_ignoreflood', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_postcount', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_moderate', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_report', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_subscribe', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_announce', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_bbcode', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_bump', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_delete', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_download', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_edit', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_email', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_flash', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_icons', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_ignoreflood', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_img', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_list', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_noapprove', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_print', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_poll', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_post', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_postcount', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_read', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_reply', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_report', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_search', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_sigs', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_smilies', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_sticky', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_subscribe', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_user_lock', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_vote', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local) VALUES ('f_votechg', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_edit', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_delete', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_move', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_lock', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_split', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_merge', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_approve', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_unrate', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_auth', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_ip', 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_info', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_approve', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_chgposter', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_delete', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_edit', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_info', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_lock', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_merge', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_move', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_report', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_split', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_local, is_global) VALUES ('m_warn', 1, 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sendemail', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_readpm', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sendpm', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sendim', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_hideonline', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_viewonline', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_viewprofile', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgavatar', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chggrp', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgemail', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgname', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgpasswd', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgcensors', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_search', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_savedrafts', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_download', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_attach', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sig', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_sendemail', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_readpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_sendpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_sendim', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_hideonline', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_viewonline', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_viewprofile', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_chgavatar', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_chggrp', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_chgemail', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_chgname', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_chgpasswd', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_chgcensors', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_search', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_savedrafts', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_download', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_sig', 1)&quot;);
 
 // START: This should be replaced by beta
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_server', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_defaults', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_board', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_cookies', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_clearlogs', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_words', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_icons', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_bbsmiley_code', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_attach', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_email', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_styles', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_user', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_useradd', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_userdel', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_ranks', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_ban', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_names', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_group', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_groupadd', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_groupdel', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_forum', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_forumadd', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_forumdel', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_prune', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_auth', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authmods', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authadmins', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authusers', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authgroups', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authdeps', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_backup', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_restore', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_search', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_events', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_cron', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_aauth', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_backup', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_bbcode', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_board', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_clearlogs', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_email', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_fauth', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_forum', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_forumadd', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_forumdel', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_icons', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_mauth', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_modules', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_names', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_profile', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_prune', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_ranks', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_reasons', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_roles', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_search', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_server', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_switchperm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_uauth', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_user', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_viewauth', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_viewlogs', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('a_words', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_attach', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_html', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_bbsmiley_code', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_smilies', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_download', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_report', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_edit', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_printpm', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_emailpm', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_forward', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_delete', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_img', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_flash', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_bbcode', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_smilies', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_download', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_edit', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_printpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_emailpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_forward', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_delete', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_img', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_OPTIONS_TABLE  .&quot; (auth_option, is_global) VALUES ('u_pm_flash', 1)&quot;);
 
-// ADMINISTRATOR group
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 0, auth_option_id, 1 FROM &quot;.$table_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'u_%'&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 0, auth_option_id, 1 FROM &quot;.$table_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'a_%'&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Standard Admin', 'ROLE_DESCRIPTION_ADMIN_STANDARD', 'a_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Forum Admin', 'ROLE_DESCRIPTION_ADMIN_FORUM', 'a_', 3)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('User and Groups Admin', 'ROLE_DESCRIPTION_ADMIN_USERGROUP', 'a_', 4)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Full Admin', 'ROLE_DESCRIPTION_ADMIN_FULL', 'a_', 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('All Features', 'ROLE_DESCRIPTION_USER_FULL', 'u_', 3)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Standard Features', 'ROLE_DESCRIPTION_USER_STANDARD', 'u_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Limited Features', 'ROLE_DESCRIPTION_USER_LIMITED', 'u_', 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('No Private Messages', 'ROLE_DESCRIPTION_USER_NOPM', 'u_', 4)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('No Avatar', 'ROLE_DESCRIPTION_USER_NOAVATAR', 'u_', 5)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Full Moderator', 'ROLE_DESCRIPTION_MOD_FULL', 'm_', 3)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Standard Moderator', 'ROLE_DESCRIPTION_MOD_STANDARD', 'm_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Simple Moderator', 'ROLE_DESCRIPTION_MOD_SIMPLE', 'm_', 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Queue Moderator', 'ROLE_DESCRIPTION_MOD_QUEUE', 'm_', 4)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Full Access', 'ROLE_DESCRIPTION_FORUM_FULL', 'f_', 6)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Standard Access', 'ROLE_DESCRIPTION_FORUM_STANDARD', 'f_', 4)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('No Access', 'ROLE_DESCRIPTION_FORUM_NOACCESS', 'f_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Read Only Access', 'ROLE_DESCRIPTION_FORUM_READONLY', 'f_', 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Limited Access', 'ROLE_DESCRIPTION_FORUM_LIMITED', 'f_', 3)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Bot Access', 'ROLE_DESCRIPTION_FORUM_BOT', 'f_', 8)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('On Moderation Queue', 'ROLE_DESCRIPTION_FORUM_ONQUEUE', 'f_', 7)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_TABLE . &quot; (role_name, role_description, role_type, role_order) VALUES ('Standard Access + Polls', 'ROLE_DESCRIPTION_FORUM_POLLS', 'f_', 5)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_attachments', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_bbcode', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_html', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_html_tags', 'b,i,u,pre', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_smilies', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_sig', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_topic_notify', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_forum_notify', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_avatar_local', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_avatar_remote', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_avatar_upload', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_nocensors', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_bookmarks', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_disable_msg', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_email_form', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_login_attempts', '3', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('min_ratings', '10', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('posts_per_page', '10', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('topics_per_page', '25', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('hot_threshold', '25', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_path', 'images/avatars/upload', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_gallery_path', 'images/avatars/gallery', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('smilies_path', 'images/smilies', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('icons_path', 'images/icons', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('upload_icons_path', 'images/upload_icons', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('ranks_path', 'images/ranks', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('email_enable', '1', 0)&quot;);// maybe keep
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_privmsg', '1', 0)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_online_time', '5', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_online', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_birthdays', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_moderators', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_jumpbox', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_search', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_search_upd', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_search_phr', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_db_lastread', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_onlinetrack', '1', 0)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('search_gc', '7200', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('queue_interval', '3', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('version', '2.1.2', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_post_chars', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_post_smilies', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_quote_depth', '3', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_sig_chars', '255', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_poll_options', '10', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('min_search_chars', '3', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_search_chars', '10', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('edit_time', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('display_last_edited', '1', 0)&quot;);
+
+//$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_email_sig', 'Thanks, The Management', 0)&quot;);
+//$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_email', '', 0)&quot;);
+//$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_contact', '', 0)&quot;);
 
-// SUPER MODERATOR group
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 6, 0, auth_option_id, 1 FROM &quot;.$table_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'm_%'&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_start_date', $time, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('flood_interval', '15', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('bump_interval', '10h', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('search_interval', '', 0)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_filesize', '6144', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_min_width', '20', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_min_height', '20', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_max_width', '90', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('avatar_max_height', '90', 0)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('lastread', '432000', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('display_order', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_filesize', '262144', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_filesize_pm', '262144', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('attachment_quota', '52428800', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_attachments', '3', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_attachments_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_pm_attach', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('upload_path', 'files', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_display_inlined', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('secure_downloads', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('secure_allow_deny', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('secure_allow_empty_referer', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_max_width', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_max_height', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_link_width', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_link_height', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_create_thumbnail', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_min_thumb_filesize', '12000', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('img_imagick', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('pm_max_boxes', '4', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('pm_max_msgs', '50', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_html_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_bbsmiley_code_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_smilies_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_download_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_report_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('load_online_guests', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_img_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('auth_flash_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('enable_pm_icons', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('pm_edit_time', '', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_mass_pm', '1', 0)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('record_online_users', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('record_online_date', '0', 1)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('num_posts', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('num_topics', '0', 1)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('num_files', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('upload_dir_size', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('search_last_gc', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('last_queue_run', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('full_folder_action', '2', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('bump_type', 'm', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_img', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('board_hide_emails', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_sig_bbsmiley_code', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_sig_flash', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_sig_html', '0', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_sig_img', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('allow_sig_smilies', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_CONFIG_TABLE  .&quot; (config_name, config_value, is_dynamic) VALUES ('max_post_urls', '0', 0)&quot;);
 
-# REGISTERED/REGISTERED COPPA groups - common forum rights
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 2, 0, auth_option_id, 1 FROM &quot;.$table_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chggrp', 'u_viewonline', 'u_chgname')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 3, 0, auth_option_id, 1 FROM &quot;.$table_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chgcensors', 'u_chggrp', 'u_viewonline', 'u_chgname')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSION_GROUPS_TABLE  .&quot; (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Images', 1, 1, 1, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSION_GROUPS_TABLE  .&quot; (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Archives', 0, 1, 1, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSION_GROUPS_TABLE  .&quot; (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Plain Text', 0, 0, 1, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSION_GROUPS_TABLE  .&quot; (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Documents', 0, 0, 1, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSION_GROUPS_TABLE  .&quot; (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Real Media', 3, 0, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSION_GROUPS_TABLE  .&quot; (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Windows Media', 2, 0, 1, '', 0, '')&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (1, 'gif')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (1, 'png')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (1, 'jpeg')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (1, 'jpg')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (1, 'tif')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (1, 'tga')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (2, 'gtar')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (2, 'gz')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (2, 'tar')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (2, 'zip')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (2, 'rar')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (2, 'ace')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (3, 'txt')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (3, 'c')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (3, 'h')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (3, 'cpp')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (3, 'hpp')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (3, 'diz')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'xls')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'doc')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'dot')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'pdf')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'ai')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'ps')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (4, 'ppt')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (5, 'rm')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (6, 'wma')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_EXTENSIONS_TABLE  .&quot; (group_id, extension) VALUES (6, 'wmv')&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/arrow_bold_rgt.gif', 19, 19, 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/redface_anim.gif', 19, 19, 9, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/mr_green.gif', 19, 19, 10, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/musical.gif', 19, 19, 4, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/asterix.gif', 19, 19, 2, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/square.gif', 19, 19, 3, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/alien_grn.gif', 19, 19, 5, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/idea.gif', 19, 19, 8, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/question.gif', 19, 19, 6, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ICONS_TABLE  .&quot; (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/exclaim.gif', 19, 19, 7, 1)&quot;);
+
+# -- Roles data
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_attachments', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_bbcode', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_html', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_html_tags', 'b,i,u,pre', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_smilies', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_topic_notify', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_forum_notify', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_avatar_local', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_avatar_remote', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_avatar_upload', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_nocensors', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_bookmarks', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_disable_msg', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_email_form', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_login_attempts', '3', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('min_ratings', '10', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('posts_per_page', '10', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('topics_per_page', '25', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('hot_threshold', '25', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_path', 'images/avatars/upload', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_gallery_path', 'images/avatars/gallery', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('smilies_path', 'images/smilies', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('icons_path', 'images/icons', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('upload_icons_path', 'images/upload_icons', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('ranks_path', 'images/ranks', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('email_enable', '1', 0)&quot;);// maybe keep
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_privmsg', '1', 0)&quot;);
+# Standard Admin (a_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 1, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'a_%' AND auth_option NOT IN ('a_switchperm', 'a_jabber', 'a_phpinfo', 'a_server', 'a_backup', 'a_styles', 'a_clearlogs', 'a_modules', 'a_language', 'a_email', 'a_bots', 'a_search', 'a_aauth', 'a_roles')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_online_time', '5', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_online', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_birthdays', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_moderators', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_jumpbox', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_search', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_search_upd', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_search_phr', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_db_lastread', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_onlinetrack', '1', 0)&quot;);
+# Forum admin (a_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 2, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'a_%' AND auth_option IN ('a_', 'a_authgroups', 'a_authusers', 'a_fauth', 'a_forum', 'a_forumadd', 'a_forumdel', 'a_mauth', 'a_prune', 'a_uauth', 'a_viewauth', 'a_viewlogs')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('search_gc', '7200', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('queue_interval', '3', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('version', '2.1.2', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_post_chars', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_post_smilies', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_quote_depth', '3', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_sig_chars', '255', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_poll_options', '10', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('min_search_chars', '3', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_search_chars', '10', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('edit_time', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('display_last_edited', '1', 0)&quot;);
+# User and Groups Admin (a_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 3, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'a_%' AND auth_option IN ('a_', 'a_authgroups', 'a_authusers', 'a_ban', 'a_group', 'a_groupadd', 'a_groupdel', 'a_ranks', 'a_uauth', 'a_user', 'a_viewauth', 'a_viewlogs')&quot;);
 
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_email_sig', 'Thanks, The Management', 0)&quot;);
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_email', '', 0)&quot;);
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_contact', '', 0)&quot;);
+# Full Admin (a_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 4, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'a_%'&quot;);
+
+# All Features (u_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 5, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%'&quot;);
+
+# Standard Features (u_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 6, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_viewonline', 'u_chggrp', 'u_chgname', 'u_ignoreflood', 'u_pm_flash', 'u_pm_forward')&quot;);
+
+# Limited Features (u_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 7, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_attach', 'u_viewonline', 'u_chggrp', 'u_chgname', 'u_ignoreflood', 'u_pm_attach', 'u_pm_emailpm', 'u_pm_flash', 'u_savedrafts', 'u_search', 'u_sendemail', 'u_sendim')&quot;);
+
+# No Private Messages (u_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 8, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%' AND auth_option IN ('u_', 'u_chgavatar', 'u_chgcensors', 'u_chgemail', 'u_chgpasswd', 'u_download', 'u_hideonline', 'u_sig', 'u_viewprofile')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 8, auth_option_id, 0 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%' AND auth_option IN ('u_readpm', 'u_sendpm', 'u_masspm')&quot;);
+
+# No Avatar (u_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 9, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_attach', 'u_chgavatar', 'u_viewonline', 'u_chggrp', 'u_chgname', 'u_ignoreflood', 'u_pm_attach', 'u_pm_emailpm', 'u_pm_flash', 'u_savedrafts', 'u_search', 'u_sendemail', 'u_sendim')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 9, auth_option_id, 0 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'u_%' AND auth_option IN ('u_chgavatar')&quot;);
+
+# Full Moderator (m_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 10, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'm_%'&quot;);
+
+# Standard Moderator (m_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 11, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'm_%' AND auth_option NOT IN ('m_approve', 'm_ban', 'm_chgposter', 'm_delete')&quot;);
+
+# Simple Moderator (m_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 12, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'm_%' AND auth_option IN ('m_', 'm_approve', 'm_delete', 'm_edit', 'm_info', 'm_report', 'm_warn')&quot;);
+
+# Queue Moderator (m_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 13, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'm_%' AND auth_option IN ('m_', 'm_approve', 'm_edit')&quot;);
+
+# Full Access (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 14, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%'&quot;);
+
+# Standard Access (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 15, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option NOT IN ('f_announce', 'f_delete', 'f_ignoreflood', 'f_poll', 'f_sticky', 'f_user_lock')&quot;);
+
+# No Access (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 16, auth_option_id, 0 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option = 'f_'&quot;);
+
+# Read Only Access (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 17, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option IN ('f_', 'f_download', 'f_list', 'f_read', 'f_search', 'f_subscribe')&quot;);
+
+# Limited Access (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 18, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option NOT IN ('f_announce', 'f_attach', 'f_bump', 'f_delete', 'f_flash', 'f_icons', 'f_ignoreflood', 'f_poll', 'f_sticky', 'f_user_lock', 'f_votechg')&quot;);
+
+# Bot Access (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 19, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option IN ('f_', 'f_download', 'f_list', 'f_read')&quot;);
+
+# On Moderation Queue (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 20, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option NOT IN ('f_announce', 'f_bump', 'f_delete', 'f_flash', 'f_icons', 'f_ignoreflood', 'f_poll', 'f_sticky', 'f_user_lock', 'f_votechg', 'f_noapprove')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 20, auth_option_id, 0 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option IN ('f_noapprove')&quot;);
+
+# Standard Access + Polls (f_)
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_ROLES_DATA_TABLE  .&quot; (role_id, auth_option_id, auth_setting) SELECT 21, auth_option_id, 1 FROM  &quot;. FORUMS_ACL_OPTIONS_TABLE  .&quot;  WHERE auth_option LIKE 'f_%' AND auth_option NOT IN ('f_announce', 'f_delete', 'f_ignoreflood', 'f_sticky', 'f_user_lock')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_start_date', $time, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('flood_interval', '15', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('bump_interval', '10h', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('search_interval', '', 0)&quot;);
+# -- Forums
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_FORUMS_TABLE .&quot; (forum_name, forum_desc, forum_status, left_id, right_id, parent_id, forum_type, forum_posts, forum_topics, forum_topics_real, forum_last_post_id, forum_last_poster_id, forum_last_poster_name, forum_last_post_time, forum_link, forum_password, forum_image, forum_rules, forum_rules_link, forum_rules_uid, forum_desc_uid, enable_icons) VALUES ('My first Category', '', &quot;.ITEM_UNLOCKED.&quot;,1, 4, 0, 0, 1, 1, 1, 1, 2, 'Admin', 972086460, '', '', '', '', '', '', '', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_filesize', '6144', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_min_width', '20', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_min_height', '20', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_max_width', '90', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('avatar_max_height', '90', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_FORUMS_TABLE .&quot; (forum_name, forum_desc, forum_status, left_id, right_id, parent_id, forum_type, forum_posts, forum_topics, forum_topics_real, forum_last_post_id, forum_last_poster_id, forum_last_poster_name, forum_last_post_time, forum_link, forum_password, forum_image, forum_rules, forum_rules_link, forum_rules_uid, forum_desc_uid, enable_icons) VALUES ('Test Forum 1', 'This is just a test forum.', &quot;.ITEM_UNLOCKED.&quot;, 2, 3, 1, 1, 1, 1, 1, 1, 2, 'Admin', 972086460, '', '', '', '', '', '', '', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('lastread', '432000', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('display_order', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_filesize', '262144', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_filesize_pm', '262144', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('attachment_quota', '52428800', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_attachments', '3', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_attachments_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_pm_attach', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('upload_path', 'files', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_display_inlined', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('secure_downloads', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('secure_allow_deny', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('secure_allow_empty_referer', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_max_width', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_max_height', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_link_width', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_link_height', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_create_thumbnail', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_min_thumb_filesize', '12000', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('img_imagick', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('pm_max_boxes', '4', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('pm_max_msgs', '50', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_html_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_bbsmiley_code_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_smilies_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_download_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_report_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('load_online_guests', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_img_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_flash_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('enable_pm_icons', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('pm_edit_time', '', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_mass_pm', '1', 0)&quot;);
+# Permissions
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('record_online_users', '0', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('record_online_date', '0', 1)&quot;);
+# Admin user - full user features
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (user_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (2, 0, 0, 5, 0)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('num_posts', '0', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('num_topics', '0', 1)&quot;);
+# ADMINISTRATOR Group - full user features
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (4, 0, 0, 5, 0)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('num_files', '0', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('upload_dir_size', '0', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('search_last_gc', '0', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('last_queue_run', '0', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('full_folder_action', '2', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('bump_type', 'm', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_img', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_hide_emails', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_bbsmiley_code', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_flash', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_html', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_img', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_smilies', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_post_urls', '0', 0)&quot;);
+# ADMINISTRATOR Group - standard admin
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (4, 0, 0, 1, 0)&quot;);
+
+# REGISTERED and REGISTERED_COPPA having standard user features
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (2, 0, 0, 6, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (3, 0, 0, 6, 0)&quot;);
+
+# GLOBAL_MODERATORS having full user features
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (6, 0, 0, 5, 0)&quot;);
+
+# GLOBAL_MODERATORS having full global moderator access
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (6, 0, 0, 10, 0)&quot;);
+
+# Giving all groups read only access to the first category
+# since administrators and moderators are already within the registered users group we do not need to set them here
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (1, 1, 0, 17, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (2, 1, 0, 17, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (3, 1, 0, 17, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (4, 1, 0, 17, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (5, 1, 0, 17, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (6, 1, 0, 17, 0)&quot;);
+
+# Giving access to the first forum
+
+# guests having read only access
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (1, 2, 0, 17, 0)&quot;);
+
+# registered and registered_coppa having standard access
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (2, 2, 0, 15, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (3, 2, 0, 15, 0)&quot;);
+
+# global moderators having standard access + polls
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (6, 2, 0, 21, 0)&quot;);
+
+# administrators having full forum and full moderator access
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (4, 2, 0, 14, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (4, 2, 0, 10, 0)&quot;);
+
+# Bots having bot access
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_ACL_TABLE  .&quot; (group_id, forum_id, auth_option_id, auth_role_id, auth_setting) VALUES (5, 2, 0, 19, 0)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extension_groups (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Images', 1, 1, 1, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extension_groups (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Archives', 0, 1, 1, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extension_groups (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Plain Text', 0, 0, 1, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extension_groups (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Documents', 0, 0, 1, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extension_groups (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Real Media', 3, 0, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extension_groups (group_name, cat_id, allow_group, download_mode, upload_icon, max_filesize, allowed_forums) VALUES ('Windows Media', 2, 0, 1, '', 0, '')&quot;);
+# -- Demo Topic
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_TOPICS_TABLE  .&quot; (topic_title, topic_poster, icon_id, topic_approved, topic_time, topic_views, topic_replies, topic_replies_real, forum_id, topic_status, topic_type, topic_first_post_id, topic_first_poster_name, topic_last_post_id, topic_last_poster_id, topic_last_poster_name, topic_last_post_time, topic_last_view_time) VALUES ('Welcome to phpBB 3', 2, 0, 1, 972086460, 0, 0, 0, 2, 0, 0, 1, 'Admin', 1, 2, 'Admin', 972086460, 972086460)&quot;);
+
+# -- Demo Post
+$_CLASS['core_db']-&gt;query('INSERT INTO '. FORUMS_POSTS_TABLE  .&quot; (topic_id, forum_id, poster_id, icon_id, post_approved, post_postcount, post_time, post_username, poster_ip, post_subject, post_text, post_checksum, bbcode_uid) VALUES (1, 2, 2, 1, 1, 1, 972086460, '', '', 'Welcome to phpBB 3', 'This is an example post in your phpBB 3.0 installation. You may delete this post, this topic and even this forum if you like since everything seems to be working!', '5dd683b17f641daf84c040bfefc58ce9', '')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (1, 'gif')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (1, 'png')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (1, 'jpeg')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (1, 'jpg')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (1, 'tif')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (1, 'tga')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (2, 'gtar')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (2, 'gz')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (2, 'tar')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (2, 'zip')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (2, 'rar')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (2, 'ace')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (3, 'txt')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (3, 'c')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (3, 'h')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (3, 'cpp')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (3, 'hpp')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (3, 'diz')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'xls')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'doc')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'dot')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'pdf')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'ai')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'ps')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (4, 'ppt')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (5, 'rm')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (6, 'wma')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_extensions (group_id, extension) VALUES (6, 'wmv')&quot;);
-
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/arrow_bold_rgt.gif', 19, 19, 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/redface_anim.gif', 19, 19, 9, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/mr_green.gif', 19, 19, 10, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/musical.gif', 19, 19, 4, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/asterix.gif', 19, 19, 2, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('misc/square.gif', 19, 19, 3, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/alien_grn.gif', 19, 19, 5, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/idea.gif', 19, 19, 8, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/question.gif', 19, 19, 6, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$table_prefix.&quot;forums_icons (icons_url, icons_width, icons_height, icons_order, display_on_posting) VALUES ('smilies/exclaim.gif', 19, 19, 7, 1)&quot;);
-
 ?&gt;
\ No newline at end of file

Modified: cms/trunk/install/build_tables.php
===================================================================
--- cms/trunk/install/build_tables.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/install/build_tables.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -32,7 +32,7 @@
 	Admin Auth Table
 */
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'admin_access');
+$_CLASS['core_db']-&gt;table_create('start', CORE_ADMIN_AUTH_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_char('admin_section', 100);
 
@@ -50,7 +50,7 @@
 /*
 	Blocks Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'blocks');
+$_CLASS['core_db']-&gt;table_create('start', CORE_BLOCKS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('block_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('block_title', 100);
@@ -76,7 +76,7 @@
 /*
 	Config Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'config');
+$_CLASS['core_db']-&gt;table_create('start', CORE_CONFIG_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_char('config_section', 20);
 $_CLASS['core_db']-&gt;add_table_field_char('config_name', 20);
@@ -94,7 +94,7 @@
 	Groups Table
 */
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'groups');
+$_CLASS['core_db']-&gt;table_create('start', CORE_GROUPS_TABLE);
 
 // this section needs updating, with null fields
 $_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
@@ -126,7 +126,7 @@
 /*
 	Groups Members Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'groups_members');
+$_CLASS['core_db']-&gt;table_create('start', CORE_GROUPS_MEMBERS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
@@ -141,7 +141,7 @@
 /*
 	Modules Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'admin_modules');
+$_CLASS['core_db']-&gt;table_create('start', CORE_ADMIN_MODULES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('module_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('module_name', 100);
@@ -157,7 +157,7 @@
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'control_panel_modules');
+$_CLASS['core_db']-&gt;table_create('start', CORE_CONTROL_PANEL_MODULES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('module_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('module_name', 100);
@@ -174,7 +174,7 @@
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'pages');
+$_CLASS['core_db']-&gt;table_create('start', CORE_PAGES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('page_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('page_name', 100);
@@ -194,7 +194,7 @@
 /*
 	Sessions Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'sessions');
+$_CLASS['core_db']-&gt;table_create('start', CORE_SESSIONS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_char('session_id', 40);
 $_CLASS['core_db']-&gt;add_table_field_int('session_user_id', array('max' =&gt; 16000000));
@@ -222,7 +222,7 @@
 /*
 	Sessions Auto login Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'sessions_auto_login');
+$_CLASS['core_db']-&gt;table_create('start', CORE_SESSIONS_AUTOLOGIN_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_char('auto_login_browser', 255);
@@ -236,7 +236,7 @@
 /*
 	Smiles Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'smilies');
+$_CLASS['core_db']-&gt;table_create('start', CORE_SMILIES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('smiley_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 
@@ -259,7 +259,7 @@
 `user_unread_privmsg` tinyint(4) unsigned NOT NULL default '0',
 */
 
-$_CLASS['core_db']-&gt;table_create('start', $user_prefix.'users');
+$_CLASS['core_db']-&gt;table_create('start', CORE_USERS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('username', 80);
@@ -303,7 +303,7 @@
 $_CLASS['core_db']-&gt;add_table_field_char('user_msnm', 255, true);
 $_CLASS['core_db']-&gt;add_table_field_char('user_jabber', 255, true);
 $_CLASS['core_db']-&gt;add_table_field_char('user_website', 255, true);
-$_CLASS['core_db']-&gt;add_table_field_char('user_interests', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_text('user_interests', 8000, true);
 $_CLASS['core_db']-&gt;add_table_field_char('user_occ', 255, true);
 
 // look at these
@@ -357,7 +357,7 @@
 /*
 	Attachments Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_attachments');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ATTACHMENTS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('attach_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('post_msg_id', array('max' =&gt; 16000000));
@@ -379,17 +379,20 @@
 $_CLASS['core_db']-&gt;add_table_index('post_msg_id');
 $_CLASS['core_db']-&gt;add_table_index('topic_id');
 $_CLASS['core_db']-&gt;add_table_index('poster_id');
+$_CLASS['core_db']-&gt;add_table_index('filetime');
+$_CLASS['core_db']-&gt;add_table_index('filesize');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
 	Forums Auth Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_auth');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ACL_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('auth_role_id', array('max' =&gt; 16000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('auth_option_id', array('max' =&gt; 2000));
 $_CLASS['core_db']-&gt;add_table_field_int('auth_setting', array('max' =&gt; 1));
 
@@ -402,7 +405,7 @@
 /*
 	Forums Auth Options Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_auth_options');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ACL_OPTIONS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('auth_option_id', array('max' =&gt; 2000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('auth_option', 20);
@@ -418,7 +421,7 @@
 /*
 	Forums Auth Presets Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_auth_presets');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ACL_PRESETS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('preset_id', array('max' =&gt; 16000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('preset_user_id', array('max' =&gt; 16000000));
@@ -433,25 +436,55 @@
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
+	Forums Auth Roles Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ACL_ROLES_TABLE);
+
+$_CLASS['core_db']-&gt;add_table_field_int('role_id', array('max' =&gt; 16000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('role_name', 255);
+$_CLASS['core_db']-&gt;add_table_field_text('role_description', 8000);
+$_CLASS['core_db']-&gt;add_table_field_char('role_type', 10);
+$_CLASS['core_db']-&gt;add_table_field_int('role_order', array('max' =&gt; 1600));
+
+$_CLASS['core_db']-&gt;add_table_index('role_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('role_type');
+$_CLASS['core_db']-&gt;add_table_index('role_order');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+	Forums Auth Roles Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ACL_ROLES_DATA_TABLE);
+
+$_CLASS['core_db']-&gt;add_table_field_int('role_id', array('max' =&gt; 16000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('auth_option_id', array('max' =&gt; 2000));
+$_CLASS['core_db']-&gt;add_table_field_int('auth_setting', array('max' =&gt; 1));
+
+$_CLASS['core_db']-&gt;add_table_index(array('role_id', 'auth_option_id'), 'primary');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
 	Forums Bookmarks Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_bookmarks');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_BOOKMARKS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('order_id', array('max' =&gt; 16000000));
 
-$_CLASS['core_db']-&gt;add_table_index('topic_id');
-$_CLASS['core_db']-&gt;add_table_index('user_id');
+$_CLASS['core_db']-&gt;add_table_index('order_id');
+$_CLASS['core_db']-&gt;add_table_index(array('topic_id', 'user_id'));
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
 	Forums Config Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_config');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_CONFIG_TABLE);
 
-$_CLASS['core_db']-&gt;add_table_field_char('config_name', 100);
+$_CLASS['core_db']-&gt;add_table_field_char('config_name', 255);
 $_CLASS['core_db']-&gt;add_table_field_char('config_value', 255);
 $_CLASS['core_db']-&gt;add_table_field_int('is_dynamic', array('max' =&gt; 1));
 
@@ -477,7 +510,7 @@
 /*
 	Forums Drafts Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_drafts');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_DRAFTS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('draft_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
@@ -485,10 +518,11 @@
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000));
 field_unix_time('save_time');
 $_CLASS['core_db']-&gt;add_table_field_char('draft_subject', 50);
-$_CLASS['core_db']-&gt;add_table_field_text('draft_message',  16000000);
+$_CLASS['core_db']-&gt;add_table_field_text('draft_message',  10000000);
 
 $_CLASS['core_db']-&gt;add_table_index('draft_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('user_id');
+$_CLASS['core_db']-&gt;add_table_index('topic_id');
 $_CLASS['core_db']-&gt;add_table_index('save_time');
 
 $_CLASS['core_db']-&gt;table_create('commit');
@@ -496,7 +530,7 @@
 /*
 	Forums Extensions Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_extensions');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_EXTENSIONS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('extension_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000));
@@ -509,7 +543,7 @@
 /*
 	Forums Extension Groups Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_extension_groups');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_EXTENSION_GROUPS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('group_name', 20);
@@ -528,7 +562,7 @@
 /*
 	Forums Forums Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_forums');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_FORUMS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('parent_id', array('max' =&gt; 16000));
@@ -537,15 +571,19 @@
 $_CLASS['core_db']-&gt;add_table_field_text('forum_parents', 20000);
 $_CLASS['core_db']-&gt;add_table_field_char('forum_name', 150);
 $_CLASS['core_db']-&gt;add_table_field_text('forum_desc', 20000);
-$_CLASS['core_db']-&gt;add_table_field_text('forum_rules', 20000, true);
-$_CLASS['core_db']-&gt;add_table_field_char('forum_rules_link', 200, true);
-$_CLASS['core_db']-&gt;add_table_field_char('forum_rules_flags', 50, true);
-$_CLASS['core_db']-&gt;add_table_field_int('forum_rules_bbcode_bitfield', array('max' =&gt; 16000000, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_char('forum_rules_bbcode_uid', 5, true);
-$_CLASS['core_db']-&gt;add_table_field_char('forum_link', 200, true);
+$_CLASS['core_db']-&gt;add_table_field_char('forum_desc_bitfield', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_int('forum_desc_options', array('max' =&gt; 16000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('forum_desc_uid', 5, true);
+$_CLASS['core_db']-&gt;add_table_field_char('forum_link', 255, true);
 $_CLASS['core_db']-&gt;add_table_field_char('forum_password', 40, true);
 $_CLASS['core_db']-&gt;add_table_field_char('forum_password_encoding', 10, true);
 $_CLASS['core_db']-&gt;add_table_field_char('forum_image', 200, true);
+$_CLASS['core_db']-&gt;add_table_field_text('forum_rules', 20000, true);
+$_CLASS['core_db']-&gt;add_table_field_char('forum_rules_link', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('forum_rules_bitfield', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('forum_rules_uid', 5, true);
+$_CLASS['core_db']-&gt;add_table_field_int('forum_rules_options', array('max' =&gt; 16000, 'null' =&gt; true));
+
 $_CLASS['core_db']-&gt;add_table_field_int('forum_topics_per_page', array('max' =&gt; 200, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_type', array('max' =&gt; 10));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_status', array('max' =&gt; 10));
@@ -556,64 +594,65 @@
 $_CLASS['core_db']-&gt;add_table_field_int('forum_last_poster_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 field_unix_time('forum_last_post_time', true);
 $_CLASS['core_db']-&gt;add_table_field_char('forum_last_poster_name', 50, true);
-$_CLASS['core_db']-&gt;add_table_field_int('forum_flags', array('max' =&gt; 200));
-$_CLASS['core_db']-&gt;add_table_field_int('display_on_index', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('enable_indexing', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('enable_icons', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('forum_flags', array('max' =&gt; 200, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('display_on_index', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_indexing', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_icons', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_prune', array('max' =&gt; 10, 'null' =&gt; true));
 field_unix_time('prune_next', true);
+$_CLASS['core_db']-&gt;add_table_field_int('prune_days', array('max' =&gt; 200, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('prune_viewed', array('max' =&gt; 200, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('prune_freq', array('max' =&gt; 200, 'null' =&gt; true));
 
-//////
-
-$_CLASS['core_db']-&gt;add_table_field_int('enable_prune', array('max' =&gt; 10));
-$_CLASS['core_db']-&gt;add_table_field_int('prune_days', array('max' =&gt; 200));
-$_CLASS['core_db']-&gt;add_table_field_int('prune_viewed', array('max' =&gt; 200));
-$_CLASS['core_db']-&gt;add_table_field_int('prune_freq', array('max' =&gt; 200));
-//////
-
 $_CLASS['core_db']-&gt;add_table_index('forum_id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('left_id');
-$_CLASS['core_db']-&gt;add_table_index('right_id');
+$_CLASS['core_db']-&gt;add_table_index(array('left_id', 'right_id'));
+$_CLASS['core_db']-&gt;add_table_index('forum_last_post_id');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
 	Forums POsts Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_posts');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_POSTS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('post_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000));
-$_CLASS['core_db']-&gt;add_table_field_int('right_id', array('max' =&gt; 16000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200));
 $_CLASS['core_db']-&gt;add_table_field_int('poster_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_char('poster_ip', 20);
 field_unix_time('post_time');
-$_CLASS['core_db']-&gt;add_table_field_char('poster_ip', 20);
+$_CLASS['core_db']-&gt;add_table_field_int('post_approved', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('post_reported', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_bbcode', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_html', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_smilies', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_sig', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_magic_url', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('post_attachment', array('max' =&gt; 1, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('post_username', 50);
-$_CLASS['core_db']-&gt;add_table_field_int('enable_bbcode', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('enable_html', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('enable_smilies', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('enable_sig', array('max' =&gt; 1));
-field_unix_time('post_edit_time', true);
-$_CLASS['core_db']-&gt;add_table_field_int('post_edit_count', array('max' =&gt; 20000, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_int('post_attachment', array('max' =&gt; 1, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('post_subject', 50);
 $_CLASS['core_db']-&gt;add_table_field_text('post_text', 10000000);
-$_CLASS['core_db']-&gt;add_table_field_char('bbcode_uid', 10);
-$_CLASS['core_db']-&gt;add_table_field_int('bbcode_bitfield', array('max' =&gt; 16000000));
-$_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200));
-$_CLASS['core_db']-&gt;add_table_field_int('enable_magic_url', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('post_approved', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_char('post_edit_reason', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('post_checksum', 32);
+
+$_CLASS['core_db']-&gt;add_table_field_char('bbcode_bitfield', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('bbcode_uid', 5, true);
+$_CLASS['core_db']-&gt;add_table_field_int('enable_magic_url', array('max' =&gt; 1, 'null' =&gt; true));
+
+$_CLASS['core_db']-&gt;add_table_field_int('post_postcount', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_text('post_edit_reason', 3000, true);
+field_unix_time('post_edit_time', true);
 $_CLASS['core_db']-&gt;add_table_field_int('post_edit_user', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('post_edit_count', array('max' =&gt; 20000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('post_edit_locked', array('max' =&gt; 1, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_int('post_reported', array('max' =&gt; 1, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_char('post_checksum', 32);
 
 $_CLASS['core_db']-&gt;add_table_index('post_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('forum_id');
 $_CLASS['core_db']-&gt;add_table_index('topic_id');
 $_CLASS['core_db']-&gt;add_table_index('poster_id');
+$_CLASS['core_db']-&gt;add_table_index('poster_ip');
 $_CLASS['core_db']-&gt;add_table_index('post_approved');
+$_CLASS['core_db']-&gt;add_table_index('post_postcount');
 $_CLASS['core_db']-&gt;add_table_index('post_time');
 
 $_CLASS['core_db']-&gt;table_create('commit');
@@ -621,40 +660,35 @@
 /*
 	Forums Topics Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_topics');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_TOPICS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_attachment', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_approved', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_reported', array('max' =&gt; 1, 'null' =&gt; true)); 
+
 $_CLASS['core_db']-&gt;add_table_field_char('topic_title', 50);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_poster', array('max' =&gt; 16000000));
 field_unix_time('topic_time');
+field_unix_time('topic_time_limit', true);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_views', array('max' =&gt; 16000000));
-$_CLASS['core_db']-&gt;add_table_field_int('topic_replies', array('max' =&gt; 16000000));  
+$_CLASS['core_db']-&gt;add_table_field_int('topic_replies', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_replies_real', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_status', array('max' =&gt; 1));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_type', array('max' =&gt; 1));
-
-// we should set this on topic creation
-$_CLASS['core_db']-&gt;add_table_field_int('topic_last_post_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_first_post_id', array('max' =&gt; 16000000, 'null' =&gt; true));
-
-$_CLASS['core_db']-&gt;add_table_field_int('topic_moved_id', array('max' =&gt; 16000000));
-$_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200));
-
-$_CLASS['core_db']-&gt;add_table_field_int('topic_attachment', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('topic_approved', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('topic_reported', array('max' =&gt; 1, 'null' =&gt; true)); 
-field_unix_time('topic_time_limit', true);
-$_CLASS['core_db']-&gt;add_table_field_int('topic_replies_real', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_char('topic_first_poster_name', 50);
+$_CLASS['core_db']-&gt;add_table_field_int('topic_last_post_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_last_poster_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('topic_last_poster_name', 50, true);
 field_unix_time('topic_last_post_time', true);
 field_unix_time('topic_last_view_time', true);
-
+$_CLASS['core_db']-&gt;add_table_field_int('topic_moved_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_bumped', array('max' =&gt; 1, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_bumper', array('max' =&gt; 16000000, 'null' =&gt; true));
-  
-$_CLASS['core_db']-&gt;add_table_field_char('poll_title', 100, true);
+$_CLASS['core_db']-&gt;add_table_field_text('poll_title', 1000, true);
 field_unix_time('poll_start', true);
 field_unix_time('poll_length', true); 
 $_CLASS['core_db']-&gt;add_table_field_int('poll_max_options', array('max' =&gt; 200, 'null' =&gt; true));
@@ -663,6 +697,7 @@
 
 $_CLASS['core_db']-&gt;add_table_index('topic_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('forum_id');
+$_CLASS['core_db']-&gt;add_table_index('topic_type');
 $_CLASS['core_db']-&gt;add_table_index('topic_moved_id');
 $_CLASS['core_db']-&gt;add_table_index('topic_status');
 $_CLASS['core_db']-&gt;add_table_index('topic_type');
@@ -672,7 +707,7 @@
 /*
 	Forums Extensions Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_tracking');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_TRACK_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000));
@@ -688,7 +723,7 @@
 /*
 	Forums Icons Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_icons');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_ICONS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('icons_id', array('max' =&gt; 2000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('icons_url', 50);
@@ -698,6 +733,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('display_on_posting', array('max' =&gt; 1));
 
 $_CLASS['core_db']-&gt;add_table_index('icons_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('display_on_posting');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
@@ -705,7 +741,7 @@
 	Forums Forums Watch Table
 */
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_watch');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_WATCH_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000));
@@ -722,7 +758,7 @@
 /*
 	Forums Modules Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_modules');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_MODULES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('module_id', array('max' =&gt; 2000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('module_type', 3);
@@ -742,7 +778,7 @@
 /*
 	Forums Moderator Cache Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_moderator_cache');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_MODERATOR_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000, 'null' =&gt; true));
@@ -756,16 +792,14 @@
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
-// Look into Forum polls by alpha 3 //
-
 /*
 	Forums Poll Results Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_poll_results');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_POLL_OPTIONS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('poll_option_id', array('max' =&gt; 2000));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000));
-$_CLASS['core_db']-&gt;add_table_field_char('poll_option_text', 255);
+$_CLASS['core_db']-&gt;add_table_field_text('poll_option_text', 8000);
 $_CLASS['core_db']-&gt;add_table_field_int('poll_option_total', array('max' =&gt; 16000000));
 
 $_CLASS['core_db']-&gt;add_table_index('poll_option_id');
@@ -776,7 +810,7 @@
 /*
 	Forums Poll Voters Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_poll_voters');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_POLL_VOTES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('poll_option_id', array('max' =&gt; 2000));
@@ -789,26 +823,26 @@
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
-// Look into Forum polls by alpha 3 //
-
 /*
-	Forums Poll Voters Table
+	Forums Ranks Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_ranks');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_RANKS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('rank_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('rank_title', 50);
 $_CLASS['core_db']-&gt;add_table_field_int('rank_min', array('min' =&gt; -1, 'max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('rank_special', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_char('rank_image', 100);
+$_CLASS['core_db']-&gt;add_table_field_char('rank_image', 255);
 
 $_CLASS['core_db']-&gt;add_table_index('rank_id', 'primary');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
+
 /*
 	Forums Words Table
 */
+/*
 $_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_search_wordlist');
 
 $_CLASS['core_db']-&gt;add_table_field_int('word_id', array('max' =&gt; 3000000000, 'auto_increment' =&gt; true));
@@ -819,10 +853,11 @@
 $_CLASS['core_db']-&gt;add_table_index('word_text');
 
 $_CLASS['core_db']-&gt;table_create('commit');
-
+*/
 /*
 	Forums search_wordmatch Table
 */
+/*
 $_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_search_wordmatch');
 
 $_CLASS['core_db']-&gt;add_table_field_int('post_id', array('max' =&gt; 16000000));
@@ -832,11 +867,11 @@
 $_CLASS['core_db']-&gt;add_table_index('word_id');
 
 $_CLASS['core_db']-&gt;table_create('commit');
-
+*/
 /*
 	Forums Words Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'censor');
+$_CLASS['core_db']-&gt;table_create('start', CORE_CENSOR_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('word_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('word_match', 100);
@@ -849,7 +884,7 @@
 /*
 	Forums Zebra Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_zebra');
+$_CLASS['core_db']-&gt;table_create('start', ZEBRA_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('zebra_id', array('max' =&gt; 16000000));
@@ -866,7 +901,7 @@
 /*
 	Forums Log Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_log');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_LOG_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('log_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('log_type', array('max' =&gt; 200));
@@ -890,7 +925,7 @@
 
 /*
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_privmsgs');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_PRIVMSGS_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('msg_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('root_level', array('max' =&gt; 16000000));
@@ -898,25 +933,23 @@
 $_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('author_ip', 40);
 field_unix_time('message_time');
-$_CLASS['core_db']-&gt;add_table_field_int('message_reported', array('max' =&gt; 1, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('enable_bbcode', array('max' =&gt; 1));
 $_CLASS['core_db']-&gt;add_table_field_int('enable_html', array('max' =&gt; 1));
 $_CLASS['core_db']-&gt;add_table_field_int('enable_smilies', array('max' =&gt; 1));
 $_CLASS['core_db']-&gt;add_table_field_int('enable_magic_url', array('max' =&gt; 1));
 $_CLASS['core_db']-&gt;add_table_field_int('enable_sig', array('max' =&gt; 1));
 
-$_CLASS['core_db']-&gt;add_table_field_char('message_subject', 60);
+$_CLASS['core_db']-&gt;add_table_field_char('message_subject', 255);
 $_CLASS['core_db']-&gt;add_table_field_text('message_text', 10000000);
-$_CLASS['core_db']-&gt;add_table_field_char('message_edit_reason', 100, true);
+$_CLASS['core_db']-&gt;add_table_field_text('message_edit_reason', 3000, true);
 $_CLASS['core_db']-&gt;add_table_field_int('message_edit_user', array('max' =&gt; 16000000, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_char('message_checksum', 11);
 $_CLASS['core_db']-&gt;add_table_field_int('message_attachment', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('bbcode_bitfield', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_char('bbcode_bitfield', 255);
 $_CLASS['core_db']-&gt;add_table_field_char('bbcode_uid', 5);
 field_unix_time('message_edit_time', true);
 $_CLASS['core_db']-&gt;add_table_field_int('message_edit_count', array('max' =&gt; 200, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_text('to_address', 1000000);
-$_CLASS['core_db']-&gt;add_table_field_text('bcc_address', 1000000);
+$_CLASS['core_db']-&gt;add_table_field_text('to_address', 8000);
+$_CLASS['core_db']-&gt;add_table_field_text('bcc_address', 8000);
 
 $_CLASS['core_db']-&gt;add_table_index('msg_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('author_ip');
@@ -929,11 +962,11 @@
 /*
 	Forums Log Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_privmsgs_folder');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_PRIVMSGS_FOLDER_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('folder_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
-$_CLASS['core_db']-&gt;add_table_field_char('folder_name', 40);
+$_CLASS['core_db']-&gt;add_table_field_char('folder_name', 255);
 $_CLASS['core_db']-&gt;add_table_field_int('pm_count', array('max' =&gt; 16000000));
 
 $_CLASS['core_db']-&gt;add_table_index('folder_id', 'primary');
@@ -944,7 +977,7 @@
 /*
 	Forums Log Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_privmsgs_rules');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_PRIVMSGS_RULES_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('rule_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
@@ -957,33 +990,35 @@
 $_CLASS['core_db']-&gt;add_table_field_text('rule_folder_id', 16000000);
 
 $_CLASS['core_db']-&gt;add_table_index('rule_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('user_id');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
 	Forums Log Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_privmsgs_to');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_PRIVMSGS_TO_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('msg_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('author_id', array('max' =&gt; 16000000));
-$_CLASS['core_db']-&gt;add_table_field_int('deleted', array('max' =&gt; 1, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_int('msg_new', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('unread', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('replied', array('max' =&gt; 1, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_int('marked', array('max' =&gt; 1, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_int('forwarded', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('pm_deleted', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('pm_new', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('pm_unread', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('pm_replied', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('pm_marked', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('pm_forwarded', array('max' =&gt; 1, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('folder_id', array('min' =&gt; -10, 'max' =&gt; 16000000));
 
 $_CLASS['core_db']-&gt;add_table_index('msg_id');
+$_CLASS['core_db']-&gt;add_table_index('author_id');
 $_CLASS['core_db']-&gt;add_table_index(array('user_id', 'folder_id'));
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_sitelist');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_SITELIST_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('site_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('site_ip', 40);
@@ -995,7 +1030,7 @@
 $_CLASS['core_db']-&gt;table_create('commit');
 
 
-$_CLASS['core_db']-&gt;table_create('start', $table_prefix.'forums_search_results');
+$_CLASS['core_db']-&gt;table_create('start', FORUMS_SEARCH_TABLE);
 
 $_CLASS['core_db']-&gt;add_table_field_int('search_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_char('session_id', 40);

Modified: cms/trunk/installer.php
===================================================================
--- cms/trunk/installer.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/installer.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -172,6 +172,7 @@
 		require_once SITE_FILE_ROOT.'includes/cache/cache_' . $acm_type . '.php';
 
 		load_class(false, 'core_cache', 'cache_'.$acm_type);
+		$_CLASS['core_cache']-&gt;destroy_all();
 
 		set_core_config('global', 'site_name', $site_name, false);
 		set_core_config('server', 'site_domain', $site_domain, false);

Modified: cms/trunk/javascript/editor.js
===================================================================
--- cms/trunk/javascript/editor.js	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/javascript/editor.js	2006-08-16 12:22:53 UTC (rev 184)
@@ -1,353 +1,509 @@
-// bbCode control by subBlue design [ www.subBlue.com ]
-// Includes unixsafe colour palette selector by SHS`
-
-// Startup variables
-var imageTag = false;
-var theSelection = false;
-
-// Check for Browser &amp; Platform for PC &amp; IE specific bits
-// More details from: <A HREF="http://www.mozilla.org/docs/web-developer/sniffer/browser_type.html">http://www.mozilla.org/docs/web-developer/sniffer/browser_type.html</A>
-var clientPC = navigator.userAgent.toLowerCase(); // Get client info
-var clientVer = parseInt(navigator.appVersion); // Get browser version
-
-var is_ie = ((clientPC.indexOf(&quot;msie&quot;) != -1) &amp;&amp; (clientPC.indexOf(&quot;opera&quot;) == -1));
-var is_nav = ((clientPC.indexOf('mozilla')!=-1) &amp;&amp; (clientPC.indexOf('spoofer')==-1)
-                &amp;&amp; (clientPC.indexOf('compatible') == -1) &amp;&amp; (clientPC.indexOf('opera')==-1)
-                &amp;&amp; (clientPC.indexOf('webtv')==-1) &amp;&amp; (clientPC.indexOf('hotjava')==-1));
-
-var is_win = ((clientPC.indexOf(&quot;win&quot;)!=-1) || (clientPC.indexOf(&quot;16bit&quot;) != -1));
-var is_mac = (clientPC.indexOf(&quot;mac&quot;)!=-1);
-
-// Shows the help messages in the helpline window
-function helpline(help) {
-	document.forms[form_name].helpbox.value = eval(help + &quot;_help&quot;);
-}
-
-// Replacement for arrayname.length property
-function getarraysize(thearray) {
-	for (i = 0; i &lt; thearray.length; i++) {
-		if ((thearray[i] == &quot;undefined&quot;) || (thearray[i] == &quot;&quot;) || (thearray[i] == null))
-			return i;
-		}
-	return thearray.length;
-}
-
-// Replacement for arrayname.push(value) not implemented in IE until version 5.5
-// Appends element to the array
-function arraypush(thearray,value) {
-	thearray[ getarraysize(thearray) ] = value;
-}
-
-// Replacement for arrayname.pop() not implemented in IE until version 5.5
-// Removes and returns the last element of an array
-function arraypop(thearray) {
-	thearraysize = getarraysize(thearray);
-	retval = thearray[thearraysize - 1];
-	delete thearray[thearraysize - 1];
-	return retval;
-}
-
-function smiley(text) {
-	text = ' ' + text + ' ';
-	if (document.forms[form_name].elements[text_name].createTextRange &amp;&amp; document.forms[form_name].elements[text_name].caretPos) {
-		var caretPos = document.forms[form_name].elements[text_name].caretPos;
-
-		caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? caretPos.text + text + ' ' : caretPos.text + text;
-		document.forms[form_name].elements[text_name].focus();
-	} else {
-		var selStart = document.forms[form_name].elements[text_name].selectionStart;
-		var selEnd = document.forms[form_name].elements[text_name].selectionEnd;
-
-		mozWrap(document.forms[form_name].elements[text_name], text, '')
-		document.forms[form_name].elements[text_name].focus();
-		document.forms[form_name].elements[text_name].selectionStart = selStart + text.length;
-		document.forms[form_name].elements[text_name].selectionEnd = selEnd + text.length;
-	}
-}
-
-function bbfontstyle(bbopen, bbclose) {
-	if ((clientVer &gt;= 4) &amp;&amp; is_ie &amp;&amp; is_win) {
-		theSelection = document.selection.createRange().text;
-		if (!theSelection) {
-			insert_text(bbopen + bbclose);
-			document.forms[form_name].elements[text_name].focus();
-			return;
-		}
-		document.selection.createRange().text = bbopen + theSelection + bbclose;
-		document.forms[form_name].elements[text_name].focus();
-		return;
-	} else {
-		insert_text(bbopen + bbclose);
-		document.forms[form_name].elements[text_name].focus();
-		return;
-	}
-	storeCaret(document.forms[form_name].elements[text_name]);
-}
-
-function insert_text(text) {
-	if (document.forms[form_name].elements[text_name].createTextRange &amp;&amp; document.forms[form_name].elements[text_name].caretPos) {
-		var caretPos = document.forms[form_name].elements[text_name].caretPos;
-		caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? caretPos.text + text + ' ' : caretPos.text + text;
-	} else {
-		var selStart = document.forms[form_name].elements[text_name].selectionStart;
-		var selEnd = document.forms[form_name].elements[text_name].selectionEnd;
-
-		mozWrap(document.forms[form_name].elements[text_name], text, '')
-		document.forms[form_name].elements[text_name].selectionStart = selStart + text.length;
-		document.forms[form_name].elements[text_name].selectionEnd = selEnd + text.length;
-	}
-}
-
-function attach_inline() {
-	insert_text('[attachment=' + document.forms[form_name].elements['attachments'].value + ']' + document.forms[form_name].elements['attachments'].options[document.forms[form_name].elements['attachments'].selectedIndex].text + '[/attachment]');
-	document.forms[form_name].elements[text_name].focus();
-}
-
-function addquote(post_id, username)
-{
-	var message_name = 'message_' + post_id;
-	var theSelection = '';
-
-	var divarea = document.getElementById(message_name);
-
-	// Get text selection - not only the post content :(
-	if (window.getSelection)
-	{
-		theSelection = window.getSelection().toString();
-	}
-	else if (document.getSelection)
-	{
-		theSelection = document.getSelection();
-	}
-	else if (document.selection)
-	{
-		theSelection = document.selection.createRange().text;
-	}
-
-	if (!theSelection)
-	{
-		if (document.all)
-		{
-			theSelection = divarea.innerText;
-		}
-		else if (divarea.textContent)
-		{
-			theSelection = divarea.textContent;
-		}
-		else if (divarea.firstChild.nodeValue)
-		{
-			theSelection = divarea.firstChild.nodeValue;
-		}
-	}
-	
-	if (theSelection)
-	{
-		insert_text('[quote=&quot;' + username + '&quot;]' + theSelection + '[/quote]');
-	}
-
-	return;
-}
-
-function bbstyle(bbnumber) {
-
-	donotinsert = false;
-	theSelection = false;
-	bblast = 0;
-	document.forms[form_name].elements[text_name].focus();
-
-	if (bbnumber == -1) { // Close all open tags &amp; default button names
-		while (bbcode[0]) {
-			butnumber = arraypop(bbcode) - 1;
-			document.forms[form_name].elements[text_name].value += bbtags[butnumber + 1];
-			buttext = eval('document.forms[form_name].addbbcode' + butnumber + '.value');
-			if (buttext != &quot;[*]&quot;)
-			{
-				eval('document.forms[form_name].addbbcode' + butnumber + '.value =&quot;' + buttext.substr(0,(buttext.length - 1)) + '&quot;');
-			}
-		}
-		document.forms[form_name].addbbcode10.value = &quot;List&quot;;
-		bbtags[10] = &quot;[list]&quot;;
-		document.forms[form_name].addbbcode12.value = &quot;List=&quot;;
-		bbtags[12] = &quot;[list=]&quot;;
-		imageTag = false; // All tags are closed including image tags :D
-		document.forms[form_name].elements[text_name].focus();
-		return;
-	}
-
-	if ((clientVer &gt;= 4) &amp;&amp; is_ie &amp;&amp; is_win)
-	{
-		theSelection = document.selection.createRange().text; // Get text selection
-		if (theSelection) {
-			// Add tags around selection
-			document.selection.createRange().text = bbtags[bbnumber] + theSelection + bbtags[bbnumber+1];
-			document.forms[form_name].elements[text_name].focus();
-			theSelection = '';
-			return;
-		}
-	}
-	else if (document.forms[form_name].elements[text_name].selectionEnd &amp;&amp; (document.forms[form_name].elements[text_name].selectionEnd - document.forms[form_name].elements[text_name].selectionStart &gt; 0))
-	{
-		mozWrap(document.forms[form_name].elements[text_name], bbtags[bbnumber], bbtags[bbnumber+1]);
-		document.forms[form_name].elements[text_name].focus();
-		theSelection = '';
-		return;
-	}
-
-	// Find last occurance of an open tag the same as the one just clicked
-	for (i = 0; i &lt; bbcode.length; i++) {
-		if (bbcode[i] == bbnumber+1) {
-			bblast = i;
-			donotinsert = true;
-		}
-	}
-
-	if ((bbnumber == 10) &amp;&amp; (bbtags[10] != &quot;[*]&quot;))
-	{
-		if (donotinsert)
-		{
-			document.forms[form_name].addbbcode12.value = &quot;List=&quot;;
-			tmp_help = o_help;
-			o_help = e_help;
-			e_help = tmp_help;
-			bbtags[12] = &quot;[list=]&quot;;
-		}
-		else
-		{
-			document.forms[form_name].addbbcode12.value = &quot;[*]&quot;;
-			tmp_help = o_help;
-			o_help = e_help;
-			e_help = tmp_help;
-			bbtags[12] = &quot;[*]&quot;;
-		}
-	}
-
-	if ((bbnumber == 12) &amp;&amp; (bbtags[12] != &quot;[*]&quot;))
-	{
-		if (donotinsert)
-		{
-			document.forms[form_name].addbbcode10.value = &quot;List&quot;;
-			tmp_help = l_help;
-			l_help = e_help;
-			e_help = tmp_help;
-			bbtags[10] = &quot;[list]&quot;;
-		}
-		else
-		{
-			document.forms[form_name].addbbcode10.value = &quot;[*]&quot;;
-			tmp_help = l_help;
-			l_help = e_help;
-			e_help = tmp_help;
-			bbtags[10] = &quot;[*]&quot;;
-		}
-	}
-
-	if (donotinsert) {		// Close all open tags up to the one just clicked &amp; default button names
-		while (bbcode[bblast]) {
-				butnumber = arraypop(bbcode) - 1;
-				if (bbtags[butnumber] != &quot;[*]&quot;)
-				{
-					insert_text(bbtags[butnumber + 1]);
-				}
-				else
-				{
-					insert_text(bbtags[butnumber]);
-				}
-				buttext = eval('document.forms[form_name].addbbcode' + butnumber + '.value');
-				if (bbtags[butnumber] != &quot;[*]&quot;)
-				{
-					eval('document.forms[form_name].addbbcode' + butnumber + '.value =&quot;' + buttext.substr(0,(buttext.length - 1)) + '&quot;');
-				}
-				imageTag = false;
-			}
-			document.forms[form_name].elements[text_name].focus();
-			return;
-	} else { // Open tags
-
-		if (imageTag &amp;&amp; (bbnumber != 14)) {		// Close image tag before adding another
-			insert_text(bbtags[15]);
-
-			lastValue = arraypop(bbcode) - 1;	// Remove the close image tag from the list
-			document.forms[form_name].addbbcode14.value = &quot;Img&quot;;	// Return button back to normal state
-			imageTag = false;
-		}
-
-		// Open tag
-		insert_text(bbtags[bbnumber]);
-
-		if ((bbnumber == 14) &amp;&amp; (imageTag == false)) imageTag = 1; // Check to stop additional tags after an unclosed image tag
-		if (bbtags[bbnumber] != &quot;[*]&quot;)
-		{
-			arraypush(bbcode,bbnumber+1);
-			eval('document.forms[form_name].addbbcode'+bbnumber+'.value += &quot;*&quot;');
-		}
-		document.forms[form_name].elements[text_name].focus();
-		return;
-	}
-
-	storeCaret(document.forms[form_name].elements[text_name]);
-}
-
-// From <A HREF="http://www.massless.org/mozedit/">http://www.massless.org/mozedit/</A>
-function mozWrap(txtarea, open, close)
-{
-	var selLength = txtarea.textLength;
-	var selStart = txtarea.selectionStart;
-	var selEnd = txtarea.selectionEnd;
-	if (selEnd == 1 || selEnd == 2) 
-		selEnd = selLength;
-
-	var s1 = (txtarea.value).substring(0,selStart);
-	var s2 = (txtarea.value).substring(selStart, selEnd)
-	var s3 = (txtarea.value).substring(selEnd, selLength);
-	txtarea.value = s1 + open + s2 + close + s3;
-	return;
-}
-
-// Insert at Claret position. Code from
-// <A HREF="http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130">http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130</A>
-function storeCaret(textEl) {
-	if (textEl.createTextRange) { textEl.caretPos = document.selection.createRange().duplicate(); }
-}
-
-function colorPalette(dir, width, height)
-{
-	var r = 0, g = 0, b = 0;
-	var numberList = new Array(6);
-	numberList[0] = &quot;00&quot;;
-	numberList[1] = &quot;40&quot;;
-	numberList[2] = &quot;80&quot;;
-	numberList[3] = &quot;BF&quot;;
-	numberList[4] = &quot;FF&quot;;
-	document.writeln('&lt;table cellspacing=&quot;1&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;');
-	for(r = 0; r &lt; 5; r++)
-	{
-		if (dir == 'h')
-		{
-			document.writeln('&lt;tr&gt;');
-		}
-		for(g = 0; g &lt; 5; g++)
-		{
-			if (dir == 'v')
-			{
-				document.writeln('&lt;tr&gt;');
-			}
-			for(b = 0; b &lt; 5; b++)
-			{
-				color = String(numberList[r]) + String(numberList[g]) + String(numberList[b]);
-				document.write('&lt;td bgcolor=&quot;#' + color + '&quot;&gt;');
-				document.write('&lt;a href=&quot;javascript:bbfontstyle(\'[color=#' + color + ']\', \'[/color]\');&quot; onmouseover=&quot;helpline(\'s\');&quot;&gt;&lt;img src=&quot;images/spacer.gif&quot; width=&quot;' + width + '&quot; height=&quot;' + height + '&quot; border=&quot;0&quot; alt=&quot;#' + color + '&quot; title=&quot;#' + color + '&quot; /&gt;&lt;/a&gt;');
-				document.writeln('&lt;/td&gt;');
-			}
-			if (dir == 'v')
-			{
-				document.writeln('&lt;/tr&gt;');
-			}
-		}
-		if (dir == 'h')
-		{
-			document.writeln('&lt;/tr&gt;');
-		}
-	}
-	document.writeln('&lt;/table&gt;');
-}
-
+/**
+* bbCode control by subBlue design [ www.subBlue.com ]
+* Includes unixsafe colour palette selector by SHS`
+*/
+
+// Startup variables
+var imageTag = false;
+var theSelection = false;
+
+// Check for Browser &amp; Platform for PC &amp; IE specific bits
+// More details from: <A HREF="http://www.mozilla.org/docs/web-developer/sniffer/browser_type.html">http://www.mozilla.org/docs/web-developer/sniffer/browser_type.html</A>
+var clientPC = navigator.userAgent.toLowerCase(); // Get client info
+var clientVer = parseInt(navigator.appVersion); // Get browser version
+
+var is_ie = ((clientPC.indexOf('msie') != -1) &amp;&amp; (clientPC.indexOf('opera') == -1));
+var is_nav = ((clientPC.indexOf('mozilla') != -1) &amp;&amp; (clientPC.indexOf('spoofer') == -1) &amp;&amp; (clientPC.indexOf('compatible') == -1) &amp;&amp; (clientPC.indexOf('opera') == -1) &amp;&amp; (clientPC.indexOf('webtv') == -1) &amp;&amp; (clientPC.indexOf('hotjava') == -1));
+
+var is_win = ((clientPC.indexOf('win') != -1) || (clientPC.indexOf('16bit') != -1));
+var is_mac = (clientPC.indexOf('mac') != -1);
+
+/**
+* Shows the help messages in the helpline window
+*/
+function helpline(help)
+{
+	document.forms[form_name].helpbox.value = eval(help + '_help');
+}
+
+/**
+* Replacement for arrayname.length property
+*/
+function getarraysize(thearray)
+{
+	for (i = 0; i &lt; thearray.length; i++)
+	{
+		if (thearray[i] == 'undefined' || thearray[i] == '' || thearray[i] == null)
+		{
+			return i;
+		}
+	}
+
+	return thearray.length;
+}
+
+/**
+* Replacement for arrayname.push(value) not implemented in IE until version 5.5
+* Appends element to the array
+*/
+function arraypush(thearray,value)
+{
+	thearray[getarraysize(thearray)] = value;
+}
+
+/**
+* Replacement for arrayname.pop() not implemented in IE until version 5.5
+* Removes and returns the last element of an array
+*/
+function arraypop(thearray)
+{
+	thearraysize = getarraysize(thearray);
+	retval = thearray[thearraysize - 1];
+	delete thearray[thearraysize - 1];
+
+	return retval;
+}
+
+/**
+* Insert emoticon
+*/
+function smiley(text) 
+{
+	text = ' ' + text + ' ';
+
+	if (document.forms[form_name].elements[text_name].createTextRange &amp;&amp; document.forms[form_name].elements[text_name].caretPos)
+	{
+		var caretPos = document.forms[form_name].elements[text_name].caretPos;
+
+		caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? caretPos.text + text + ' ' : caretPos.text + text;
+		document.forms[form_name].elements[text_name].focus();
+	}
+	else
+	{
+		var selStart = document.forms[form_name].elements[text_name].selectionStart;
+		var selEnd = document.forms[form_name].elements[text_name].selectionEnd;
+
+		mozWrap(document.forms[form_name].elements[text_name], text, '')
+		document.forms[form_name].elements[text_name].focus();
+		document.forms[form_name].elements[text_name].selectionStart = selStart + text.length;
+		document.forms[form_name].elements[text_name].selectionEnd = selEnd + text.length;
+	}
+}
+
+/**
+* Apply bbcodes
+*/
+function bbfontstyle(bbopen, bbclose)
+{
+	theSelection = false;
+	document.forms[form_name].elements[text_name].focus();
+
+	if ((clientVer &gt;= 4) &amp;&amp; is_ie &amp;&amp; is_win)
+	{
+		// Get text selection
+		theSelection = document.selection.createRange().text;
+
+		if (theSelection)
+		{
+			// Add tags around selection
+			document.selection.createRange().text = bbopen + theSelection + bbclose;
+			document.forms[form_name].elements[text_name].focus();
+			theSelection = '';
+			return;
+		}
+	}
+	else if (document.forms[form_name].elements[text_name].selectionEnd &amp;&amp; (document.forms[form_name].elements[text_name].selectionEnd - document.forms[form_name].elements[text_name].selectionStart &gt; 0))
+	{
+		mozWrap(document.forms[form_name].elements[text_name], bbopen, bbclose);
+		document.forms[form_name].elements[text_name].focus();
+		theSelection = '';
+		return;
+	}
+
+	// Close image tag before adding
+	if (imageTag)
+	{
+		insert_text(bbtags[15]);
+
+		// Remove the close image tag from the list
+		lastValue = arraypop(bbcode) - 1;
+
+		// Return button back to normal state
+		document.forms[form_name].addbbcode14.value = 'Img';
+		imageTag = false;
+	}
+
+	// Open tag
+	insert_text(bbopen + bbclose);
+
+	document.forms[form_name].elements[text_name].focus();
+
+	storeCaret(document.forms[form_name].elements[text_name]);
+	return;
+}
+
+/**
+* Insert text at position
+*/
+function insert_text(text)
+{
+	if (document.forms[form_name].elements[text_name].createTextRange &amp;&amp; !isNaN(document.forms[form_name].elements[text_name].caretPos))
+	{
+		var caretPos = document.forms[form_name].elements[text_name].caretPos;
+		caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? caretPos.text + text + ' ' : caretPos.text + text;
+	}
+	else if (!isNaN(document.forms[form_name].elements[text_name].selectionStart))
+	{
+		var selStart = document.forms[form_name].elements[text_name].selectionStart;
+		var selEnd = document.forms[form_name].elements[text_name].selectionEnd;
+
+		mozWrap(document.forms[form_name].elements[text_name], text, '')
+		document.forms[form_name].elements[text_name].selectionStart = selStart + text.length;
+		document.forms[form_name].elements[text_name].selectionEnd = selEnd + text.length;
+	}
+	else
+	{
+		document.forms[form_name].elements[text_name].value = document.forms[form_name].elements[text_name].value + text;
+	}
+}
+
+/**
+* Add inline attachment at position
+*/
+function attach_inline()
+{
+	insert_text('[attachment=' + document.forms[form_name].elements['attachments'].value + ']' + document.forms[form_name].elements['attachments'].options[document.forms[form_name].elements['attachments'].selectedIndex].text + '[/attachment]');
+	document.forms[form_name].elements[text_name].focus();
+}
+
+/**
+* Add quote text to message
+*/
+function addquote(post_id, username)
+{
+	var message_name = 'message_' + post_id;
+	var theSelection = '';
+	var divarea = false;
+
+	if (document.all)
+	{
+		eval('divarea = document.all.' + message_name + ';');
+	}
+	else
+	{
+		eval(&quot;divarea = document.getElementById('&quot; + message_name + &quot;');&quot;);
+	}
+
+	// Get text selection - not only the post content :(
+	if (window.getSelection)
+	{
+		theSelection = window.getSelection().toString();
+	}
+	else if (document.getSelection)
+	{
+		theSelection = document.getSelection();
+	}
+	else if (document.selection)
+	{
+		theSelection = document.selection.createRange().text;
+	}
+
+	if (theSelection == '')
+	{
+		if (divarea.innerHTML)
+		{
+			theSelection = divarea.innerHTML.replace(/&lt;br&gt;/ig, '\n');
+			theSelection = theSelection.replace(/&lt;br\/&gt;/ig, '\n');
+		}
+		else if (document.all)
+		{
+			theSelection = divarea.innerText;
+		}
+		else if (divarea.textContent)
+		{
+			theSelection = divarea.textContent;
+		}
+		else if (divarea.firstChild.nodeValue)
+		{
+			theSelection = divarea.firstChild.nodeValue;
+		}
+	}
+
+	if (theSelection)
+	{
+		insert_text('[quote=&quot;' + username + '&quot;]' + theSelection + '[/quote]');
+	}
+
+	return;
+}
+
+/**
+* bbstyle
+*/
+function bbstyle(bbnumber)
+{
+	donotinsert = false;
+	theSelection = false;
+	bblast = 0;
+	document.forms[form_name].elements[text_name].focus();
+
+	// Close all open tags &amp; default button names
+	if (bbnumber == -1)
+	{
+		while (bbcode[0])
+		{
+			butnumber = arraypop(bbcode) - 1;
+			document.forms[form_name].elements[text_name].value += bbtags[butnumber + 1];
+			buttext = eval('document.forms[form_name].addbbcode' + butnumber + '.value');
+		
+			if (buttext != '[*]')
+			{
+				eval('document.forms[form_name].addbbcode' + butnumber + '.value =&quot;' + buttext.substr(0,(buttext.length - 1)) + '&quot;');
+			}
+		}
+
+		document.forms[form_name].addbbcode10.value = 'List';
+		bbtags[10] = '[list]';
+
+		document.forms[form_name].addbbcode12.value = 'List=';
+		bbtags[12] = '[list=]';
+		
+		// All tags are closed including image tags :D
+		imageTag = false;
+		document.forms[form_name].elements[text_name].focus();
+
+		return;
+	}
+
+	// [*] doesn't have an end tag
+	noEndTag = (bbtags[bbnumber] == '[*]')
+
+	if ((clientVer &gt;= 4) &amp;&amp; is_ie &amp;&amp; is_win)
+	{
+		// Get text selection
+		theSelection = document.selection.createRange().text;
+
+		if (theSelection) 
+		{
+			// Add tags around selection
+			document.selection.createRange().text = bbtags[bbnumber] + theSelection + ((!noEndTag) ? bbtags[bbnumber+1] : '');
+			document.forms[form_name].elements[text_name].focus();
+			theSelection = '';
+			return;
+		}
+	}
+	else if (document.forms[form_name].elements[text_name].selectionEnd &amp;&amp; (document.forms[form_name].elements[text_name].selectionEnd - document.forms[form_name].elements[text_name].selectionStart &gt; 0))
+	{
+		mozWrap(document.forms[form_name].elements[text_name], bbtags[bbnumber], ((!noEndTag) ? bbtags[bbnumber+1] : ''));
+		document.forms[form_name].elements[text_name].focus();
+		theSelection = '';
+		return;
+	}
+
+	// Find last occurance of an open tag the same as the one just clicked
+	for (i = 0; i &lt; bbcode.length; i++)
+	{
+		if (bbcode[i] == bbnumber+1)
+		{
+			bblast = i;
+			donotinsert = true;
+		}
+	}
+
+	if (bbnumber == 10 &amp;&amp; bbtags[10] != '[*]')
+	{
+		if (donotinsert)
+		{
+			document.forms[form_name].addbbcode12.value = 'List=';
+			tmp_help = o_help;
+			o_help = e_help;
+			e_help = tmp_help;
+			bbtags[12] = '[list=]';
+		}
+		else
+		{
+			document.forms[form_name].addbbcode12.value = '[*]';
+			tmp_help = o_help;
+			o_help = e_help;
+			e_help = tmp_help;
+			bbtags[12] = '[*]';
+		}
+	}
+
+	if (bbnumber == 12 &amp;&amp; bbtags[12] != '[*]')
+	{
+		if (donotinsert)
+		{
+			document.forms[form_name].addbbcode10.value = 'List';
+			tmp_help = l_help;
+			l_help = e_help;
+			e_help = tmp_help;
+			bbtags[10] = '[list]';
+		}
+		else
+		{
+			document.forms[form_name].addbbcode10.value = '[*]';
+			tmp_help = l_help;
+			l_help = e_help;
+			e_help = tmp_help;
+			bbtags[10] = '[*]';
+		}
+	}
+
+	// Close all open tags up to the one just clicked &amp; default button names
+	if (donotinsert)
+	{
+		while (bbcode[bblast])
+		{
+			butnumber = arraypop(bbcode) - 1;
+
+			if (bbtags[butnumber] != '[*]')
+			{
+				insert_text(bbtags[butnumber + 1]);
+			}
+			else
+			{
+				insert_text(bbtags[butnumber]);
+			}
+
+			buttext = eval('document.forms[form_name].addbbcode' + butnumber + '.value');
+
+			if (bbtags[butnumber] != '[*]')
+			{
+				eval('document.forms[form_name].addbbcode' + butnumber + '.value =&quot;' + buttext.substr(0,(buttext.length - 1)) + '&quot;');
+			}
+			imageTag = false;
+		}
+		document.forms[form_name].elements[text_name].focus();
+		return;
+	}
+	else
+	{
+		// Open tags
+
+		// Close image tag before adding another
+		if (imageTag &amp;&amp; (bbnumber != 14))
+		{
+			insert_text(bbtags[15]);
+
+			// Remove the close image tag from the list
+			lastValue = arraypop(bbcode) - 1;
+
+			// Return button back to normal state
+			document.forms[form_name].addbbcode14.value = 'Img';
+			imageTag = false;
+		}
+
+		// Open tag
+		insert_text(bbtags[bbnumber]);
+
+		// Check to stop additional tags after an unclosed image tag
+		if (bbnumber == 14 &amp;&amp; imageTag == false)
+		{
+			imageTag = 1; 
+		}
+
+		if (bbtags[bbnumber] != '[*]')
+		{
+			arraypush(bbcode, bbnumber + 1);
+			eval('document.forms[form_name].addbbcode'+bbnumber+'.value += &quot;*&quot;');
+		}
+
+		document.forms[form_name].elements[text_name].focus();
+		return;
+	}
+
+	storeCaret(document.forms[form_name].elements[text_name]);
+}
+
+/**
+* From <A HREF="http://www.massless.org/mozedit/">http://www.massless.org/mozedit/</A>
+*/
+function mozWrap(txtarea, open, close)
+{
+	var selLength = txtarea.textLength;
+	var selStart = txtarea.selectionStart;
+	var selEnd = txtarea.selectionEnd;
+	var scrollTop = txtarea.scrollTop;
+
+	if (selEnd == 1 || selEnd == 2) 
+	{
+		selEnd = selLength;
+	}
+
+	var s1 = (txtarea.value).substring(0,selStart);
+	var s2 = (txtarea.value).substring(selStart, selEnd)
+	var s3 = (txtarea.value).substring(selEnd, selLength);
+
+	txtarea.value = s1 + open + s2 + close + s3;
+	txtarea.selectionStart = selEnd + open.length + close.length;
+	txtarea.selectionEnd = txtarea.selectionStart;
+	txtarea.focus();
+	txtarea.scrollTop = scrollTop;
+
+	return;
+}
+
+/**
+* Insert at Claret position. Code from
+* <A HREF="http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130">http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130</A>
+*/
+function storeCaret(textEl)
+{
+	if (textEl.createTextRange)
+	{
+		textEl.caretPos = document.selection.createRange().duplicate();
+	}
+}
+
+/**
+* Color pallette
+*/
+function colorPalette(dir, width, height)
+{
+	var r = 0, g = 0, b = 0;
+	var numberList = new Array(6);
+
+	numberList[0] = '00';
+	numberList[1] = '40';
+	numberList[2] = '80';
+	numberList[3] = 'BF';
+	numberList[4] = 'FF';
+
+	document.writeln('&lt;table cellspacing=&quot;1&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;');
+
+	for (r = 0; r &lt; 5; r++)
+	{
+		if (dir == 'h')
+		{
+			document.writeln('&lt;tr&gt;');
+		}
+
+		for (g = 0; g &lt; 5; g++)
+		{
+			if (dir == 'v')
+			{
+				document.writeln('&lt;tr&gt;');
+			}
+			
+			for (b = 0; b &lt; 5; b++)
+			{
+				color = String(numberList[r]) + String(numberList[g]) + String(numberList[b]);
+				document.write('&lt;td bgcolor=&quot;#' + color + '&quot;&gt;');
+				document.write('&lt;a href=&quot;javascript:bbfontstyle(\'[color=#' + color + ']\', \'[/color]\');&quot; onmouseover=&quot;helpline(\'s\');&quot;&gt;&lt;img src=&quot;images/spacer.gif&quot; width=&quot;' + width + '&quot; height=&quot;' + height + '&quot; border=&quot;0&quot; alt=&quot;#' + color + '&quot; title=&quot;#' + color + '&quot; /&gt;&lt;/a&gt;');
+				document.writeln('&lt;/td&gt;');
+			}
+
+			if (dir == 'v')
+			{
+				document.writeln('&lt;/tr&gt;');
+			}
+		}
+
+		if (dir == 'h')
+		{
+			document.writeln('&lt;/tr&gt;');
+		}
+	}
+	document.writeln('&lt;/table&gt;');
+}
\ No newline at end of file

Modified: cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -334,7 +334,7 @@
 		$sql_start = $start;
 	}
 
-	$sql = 'SELECT t.*, p.author_id, p.root_level, p.message_time, p.message_subject, p.icon_id, p.message_reported, p.to_address, p.message_attachment, p.bcc_address, u.username 
+	$sql = 'SELECT t.*, p.author_id, p.root_level, p.message_time, p.message_subject, p.icon_id, p.to_address, p.message_attachment, p.bcc_address, u.username 
 		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . CORE_USERS_TABLE . &quot; u
 		WHERE t.user_id = $user_id
 			AND p.author_id = u.user_id

Modified: cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -305,10 +305,10 @@
 	}
 	
 	// Instantiate BBCode class
-	if ((empty($bbcode) || $bbcode === false) &amp;&amp; $bbcode_bitfield)
+	if ((empty($bbcode) || $bbcode === false) &amp;&amp; $bbcode_bitfield !== '')
 	{
 		require_once SITE_FILE_ROOT.'includes/forums/bbcode.php';
-		$bbcode = new bbcode($bbcode_bitfield);
+		$bbcode = new bbcode(base64_encode($bbcode_bitfield));
 	}
 
 	$title = censor_text($title);

Modified: cms/trunk/modules/control_panel/modules/ucp_register.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_register.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/control_panel/modules/ucp_register.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -34,7 +34,7 @@
 	trigger_error('UCP_REGISTER_DISABLE');
 }
 
-$_CLASS['core_template']-&gt;assign('S_UCP_ACTION', generate_link('Control_Panel&amp;mode=register'));
+$_CLASS['core_template']-&gt;assign('S_UCP_ACTION', generate_link('control_panel&amp;mode=register'));
 
 $error = $data = array();
 $hidden_fields = '';
@@ -51,12 +51,12 @@
 			'L_COPPA_NO'		=&gt; sprintf($_CLASS['core_user']-&gt;lang['UCP_COPPA_BEFORE'], $coppa_birthday),
 			'L_COPPA_YES'		=&gt; sprintf($_CLASS['core_user']-&gt;lang['UCP_COPPA_ON_AFTER'], $coppa_birthday),
 
-			'U_COPPA_NO'		=&gt; generate_link('Control_Panel&amp;mode=register&amp;coppa=0'), 
-			'U_COPPA_YES'		=&gt; generate_link('Control_Panel&amp;mode=register&amp;coppa=1'), 
+			'U_COPPA_NO'		=&gt; generate_link('control_panel&amp;mode=register&amp;coppa=0'), 
+			'U_COPPA_YES'		=&gt; generate_link('control_panel&amp;mode=register&amp;coppa=1'), 
 
 			'S_SHOW_COPPA'		=&gt; true, 
 			'S_HIDDEN_FIELDS'	=&gt; $hidden_fields,
-			'S_REGISTER_ACTION'	=&gt; generate_link('Control_Panel&amp;mode=register'))
+			'S_REGISTER_ACTION'	=&gt; generate_link('control_panel&amp;mode=register'))
 		);
 	}
 	else
@@ -66,11 +66,11 @@
 		$_CLASS['core_template']-&gt;assign_array(array(
 			'S_SHOW_COPPA'		=&gt; false,
 			'S_HIDDEN_FIELDS'	=&gt; $hidden_fields,
-			'S_REGISTER_ACTION'	=&gt; generate_link('Control_Panel&amp;mode=register')
+			'S_REGISTER_ACTION'	=&gt; generate_link('control_panel&amp;mode=register')
 		));
 	}
 
-	$_CLASS['core_display']-&gt;display($_CLASS['core_user']-&gt;lang['REGISTER'], 'modules/Control_Panel/ucp_agreement.html');
+	$_CLASS['core_display']-&gt;display($_CLASS['core_user']-&gt;lang['REGISTER'], 'modules/control_panel/ucp_agreement.html');
 }
 
 if ($submit)
@@ -298,9 +298,9 @@
 
 	'S_COPPA'			=&gt; $coppa, 
 	'S_HIDDEN_FIELDS'	=&gt; $hidden_fields,
-	'S_UCP_ACTION'		=&gt; generate_link(&quot;Control_Panel&amp;mode=register&quot;))
+	'S_UCP_ACTION'		=&gt; generate_link(&quot;control_panel&amp;mode=register&quot;))
 );
 
-$_CLASS['core_display']-&gt;display($_CLASS['core_user']-&gt;lang['REGISTER'], 'modules/Control_Panel/ucp_register.html');
+$_CLASS['core_display']-&gt;display($_CLASS['core_user']-&gt;lang['REGISTER'], 'modules/control_panel/ucp_register.html');
 
 ?&gt;
\ No newline at end of file

Modified: cms/trunk/modules/forums/admin/index.php
===================================================================
--- cms/trunk/modules/forums/admin/index.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/forums/admin/index.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -37,6 +37,8 @@
 	die; 
 }
 
+global $_CLASS, $_CORE_CONFIG;
+
 // Some often used variables
 $safe_mode	= (@ini_get('safe_mode') || @strtolower(ini_get('safe_mode')) == 'on') ? true : false;
 $file_uploads = (@ini_get('file_uploads') || strtolower(@ini_get('file_uploads')) == 'on') ? true : false;
@@ -55,7 +57,7 @@
 require_once(SITE_FILE_ROOT.'includes/forums/functions.php');
 require_once(SITE_FILE_ROOT.'includes/forums/functions_admin.php');
 
-$_CLASS['core_user']-&gt;add_lang('admin', 'Forums');
+$_CLASS['core_user']-&gt;add_lang('admin', 'forums');
 //$_CLASS['core_user']-&gt;add_img(false, 'Forums');
 $_CLASS['auth']-&gt;acl($_CLASS['core_user']-&gt;data);
 
@@ -73,128 +75,90 @@
 
 // -----------------------------
 // Functions
-function adm_page_header($sub_title, $meta = '', $table_html = true)
+function adm_page_header($page_title)
 {
-	global $config, $db, $_CLASS;
+	global $config, $_CLASS;
 
-	$_CLASS['core_display']-&gt;display_header();
-	echo $_CLASS['core_display']-&gt;theme-&gt;table_open;
+	$_CLASS['core_template']-&gt;assign_array(array(
+		'PAGE_TITLE'			=&gt; $page_title,
+		'USERNAME'				=&gt; $_CLASS['core_user']-&gt;data['username'],
 
-	if ($table_html)
-	{
+		//'U_ADM_INDEX'			=&gt; append_sid(&quot;{$phpbb_admin_path}index.$phpEx&quot;),
+		//'U_INDEX'				=&gt; append_sid(&quot;index.$phpEx&quot;),
 
-?&gt;
-&lt;a name=&quot;top&quot;&gt;&lt;/a&gt;
+		'T_IMAGES_PATH'			=&gt; &quot;images/&quot;,
+		'T_SMILIES_PATH'		=&gt; &quot;{$config['smilies_path']}/&quot;,
+		'T_AVATAR_PATH'			=&gt; &quot;{$config['avatar_path']}/&quot;,
+		'T_AVATAR_GALLERY_PATH'	=&gt; &quot;{$config['avatar_gallery_path']}/&quot;,
+		'T_ICONS_PATH'			=&gt; &quot;{$config['icons_path']}/&quot;,
+		'T_RANKS_PATH'			=&gt; &quot;{$config['ranks_path']}/&quot;,
+		'T_UPLOAD_PATH'			=&gt; &quot;{$config['upload_path']}/&quot;,
 
-&lt;table width=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; align=&quot;center&quot;&gt;
-	&lt;tr&gt;
-		&lt;td&gt;
-
-&lt;?php
-
-	}
-
+		'ICON_MOVE_UP'		=&gt; '&lt;img src=&quot;images/icon_up.gif&quot; alt=&quot;' . $_CLASS['core_user']-&gt;lang['MOVE_UP'] . '&quot; title=&quot;' . $_CLASS['core_user']-&gt;lang['MOVE_UP'] . '&quot; /&gt;',
+		'ICON_MOVE_DOWN'	=&gt; '&lt;img src=&quot;images/icon_down.gif&quot; alt=&quot;' . $_CLASS['core_user']-&gt;lang['MOVE_DOWN'] . '&quot; title=&quot;' . $_CLASS['core_user']-&gt;lang['MOVE_DOWN'] . '&quot; /&gt;',
+		'ICON_EDIT'			=&gt; '&lt;img src=&quot;images/icon_edit.gif&quot; alt=&quot;' . $_CLASS['core_user']-&gt;lang['EDIT'] . '&quot; title=&quot;' . $_CLASS['core_user']-&gt;lang['EDIT'] . '&quot; /&gt;',
+		'ICON_DELETE'		=&gt; '&lt;img src=&quot;images/icon_delete.gif&quot; alt=&quot;' . $_CLASS['core_user']-&gt;lang['DELETE'] . '&quot; title=&quot;' . $_CLASS['core_user']-&gt;lang['DELETE'] . '&quot; /&gt;',
+		'ICON_SYNC'			=&gt; '&lt;img src=&quot;images/icon_sync.gif&quot; alt=&quot;' . $_CLASS['core_user']-&gt;lang['RESYNC'] . '&quot; title=&quot;' . $_CLASS['core_user']-&gt;lang['RESYNC'] . '&quot; /&gt;',
+	));
 }
 
 function adm_page_footer($copyright_html = true)
 {
-	global $cache, $config, $_CLASS;
+	garbage_collection();
+}
 
-?&gt;
+/**
+* Generate back link for acp pages
+*/
+function adm_back_link($u_action)
+{
+	global $user;
+	return '&lt;br /&gt;&lt;br /&gt;&lt;a href=&quot;' . $u_action . '&quot;&gt;&laquo; ' . $_CLASS['core_user']-&gt;lang['BACK_TO_PREV'] . '&lt;/a&gt;';
+}
 
-		&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;/table&gt;
-&lt;?php
+/**
+* Build select field options in acp pages
+*/
+function build_select($option_ary, $option_default = false)
+{
+	global $_CLASS;
 
-	if ($copyright_html)
+	$html = '';
+	foreach ($option_ary as $value =&gt; $title)
 	{
-
-?&gt;
-
-&lt;div class=&quot;copyright&quot; align=&quot;center&quot;&gt;Powered by phpBB &lt;?php echo $config['version']; ?&gt; &copy; 2002 &lt;a href=&quot;<A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>&quot; target=&quot;_phpbb&quot;&gt;phpBB Group&lt;/a&gt;&lt;/div&gt;
-
-&lt;br clear=&quot;all&quot; /&gt;
-&lt;?php
+		$selected = ($option_default !== false &amp;&amp; $value == $option_default) ? ' selected=&quot;selected&quot;' : '';
+		$html .= '&lt;option value=&quot;' . $value . '&quot;' . $selected . '&gt;' . $_CLASS['core_user']-&gt;get_lang($title) . '&lt;/option&gt;';
 	}
 
-	echo $_CLASS['core_display']-&gt;theme-&gt;table_close;
-	$_CLASS['core_display']-&gt;display_footer();
+	return $html;
 }
 
-function adm_page_confirm($title, $message)
+/**
+* Build radio fields in acp pages
+*/
+function h_radio($name, &amp;$input_ary, $input_default = false, $id = false, $key = false)
 {
 	global $_CLASS;
 
-	// Grab data from GET and POST arrays ... note this is _not_
-	// validated! Everything is typed as string to ensure no
-	// funny business on displayed hidden field data. Validation
-	// will be carried out by whatever processes this form.
-	$var_ary = array_merge($_GET, $_POST);
-
-	$s_hidden_fields = '';
-	foreach ($var_ary as $key =&gt; $var)
+	$html = '';
+	$id_assigned = false;
+	foreach ($input_ary as $value =&gt; $title)
 	{
-		if (empty($var))
-		{
-			continue;
-		}
-
-		if (is_array($var))
-		{
-			foreach ($var as $k =&gt; $v)
-			{
-				if (is_array($v))
-				{
-					foreach ($v as $_k =&gt; $_v)
-					{
-						set_var($var[$k][$_k], $_v, 'string');
-						$s_hidden_fields .= &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;${key}[$k][$_k]\&quot; value=\&quot;&quot; . addslashes($_v) . '&quot; /&gt;';
-					}
-				}
-				else
-				{
-					set_var($var[$k], $v, 'string');
-					$s_hidden_fields .= &quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;${key}[$k]\&quot; value=\&quot;&quot; . addslashes($v) . '&quot; /&gt;';
-				}
-			}
-		}
-		else
-		{
-			set_var($var, $var, 'string');
-			$s_hidden_fields .= '&lt;input type=&quot;hidden&quot; name=&quot;' . $key . '&quot; value=&quot;' . addslashes($var) . '&quot; /&gt;';
-		}
-		unset($var_ary[$key]);
+		$selected = ($input_default !== false &amp;&amp; $value == $input_default) ? ' checked=&quot;checked&quot;' : '';
+		$html .= ($html) ? ' &nbsp; ' : '';
+		$html .= '&lt;input type=&quot;radio&quot; name=&quot;' . $name . '&quot;' . (($id &amp;&amp; !$id_assigned) ? ' id=&quot;' . $id . '&quot;' : '') . ' value=&quot;' . $value . '&quot;' . $selected . (($key) ? ' accesskey=&quot;' . $key . '&quot;' : '') . ' class=&quot;radio&quot; /&gt; ' . $_CLASS['core_user']-&gt;lang[$title];
+		$id_assigned = true;
 	}
 
-?&gt;
-
-&lt;br /&gt;&lt;br /&gt;
-
-&lt;form name=&quot;confirm&quot; method=&quot;post&quot; action=&quot;&lt;?php echo $_SERVER['REQUEST_URI']; ?&gt;&quot;&gt;
-&lt;table class=&quot;tablebg&quot; width=&quot;80%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot; align=&quot;center&quot;&gt;
-	&lt;tr&gt;
-		&lt;th&gt;&lt;?php echo $title; ?&gt;&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;?php echo $message; ?&gt;&lt;br /&gt;&lt;br /&gt;&lt;input class=&quot;btnlite&quot; type=&quot;submit&quot; name=&quot;confirm&quot; value=&quot;&lt;?php echo $_CLASS['core_user']-&gt;lang['YES']; ?&gt;&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;cancel&quot; value=&quot;&lt;?php echo $_CLASS['core_user']-&gt;lang['NO']; ?&gt;&quot; /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;/table&gt;
-
-&lt;?php echo $s_hidden_fields; ?&gt;
-&lt;/form&gt;
-
-&lt;br /&gt;
-
-&lt;?php
-
-	adm_page_footer();
-
+	return $html;
 }
 
-function build_cfg_template($tpl_type, $config_key, $options = '')
+/**
+* Build configuration template for acp configuration pages
+*/
+function build_cfg_template($tpl_type, $key, &amp;$new, $config_key, $vars)
 {
-	global $new, $_CLASS;
+	global $_CLASS;
 
 	$tpl = '';
 	$name = 'config[' . $config_key . ']';
@@ -206,22 +170,22 @@
 			$size = (int) $tpl_type[1];
 			$maxlength = (int) $tpl_type[2];
 
-			$tpl = '&lt;input class=&quot;post&quot; type=&quot;' . $tpl_type[0] . '&quot;' . (($size) ? ' size=&quot;' . $size . '&quot;' : '') . ' maxlength=&quot;' . (($maxlength) ? $maxlength : 255) . '&quot; name=&quot;' . $name . '&quot; value=&quot;' . $new[$config_key] . '&quot; /&gt;';
-			break;
+			$tpl = '&lt;input id=&quot;' . $key . '&quot; type=&quot;' . $tpl_type[0] . '&quot;' . (($size) ? ' size=&quot;' . $size . '&quot;' : '') . ' maxlength=&quot;' . (($maxlength) ? $maxlength : 255) . '&quot; name=&quot;' . $name . '&quot; value=&quot;' . $new[$config_key] . '&quot; /&gt;';
+		break;
 
 		case 'dimension':
 			$size = (int) $tpl_type[1];
 			$maxlength = (int) $tpl_type[2];
 
-			$tpl = '&lt;input class=&quot;post&quot; type=&quot;text&quot;' . (($size) ? ' size=&quot;' . $size . '&quot;' : '') . ' maxlength=&quot;' . (($maxlength) ? $maxlength : 255) . '&quot; name=&quot;config[' . $config_key . '_height]&quot; value=&quot;' . $new[$config_key . '_height'] . '&quot; /&gt; x &lt;input class=&quot;post&quot; type=&quot;text&quot;' . (($size) ? ' size=&quot;' . $size . '&quot;' : '') . ' maxlength=&quot;' . (($maxlength) ? $maxlength : 255) . '&quot; name=&quot;config[' . $config_key . '_width]&quot; value=&quot;' . $new[$config_key . '_width'] . '&quot; /&gt;';
-			break;
+			$tpl = '&lt;input id=&quot;' . $key . '&quot; type=&quot;text&quot;' . (($size) ? ' size=&quot;' . $size . '&quot;' : '') . ' maxlength=&quot;' . (($maxlength) ? $maxlength : 255) . '&quot; name=&quot;config[' . $config_key . '_height]&quot; value=&quot;' . $new[$config_key . '_height'] . '&quot; /&gt; x &lt;input type=&quot;text&quot;' . (($size) ? ' size=&quot;' . $size . '&quot;' : '') . ' maxlength=&quot;' . (($maxlength) ? $maxlength : 255) . '&quot; name=&quot;config[' . $config_key . '_width]&quot; value=&quot;' . $new[$config_key . '_width'] . '&quot; /&gt;';
+		break;
 
 		case 'textarea':
 			$rows = (int) $tpl_type[1];
 			$cols = (int) $tpl_type[2];
 
-			$tpl = '&lt;textarea name=&quot;' . $name . '&quot; rows=&quot;' . $rows . '&quot; cols=&quot;' . $cols . '&quot;&gt;' . $new[$config_key] . '&lt;/textarea&gt;';
-			break;
+			$tpl = '&lt;textarea id=&quot;' . $key . '&quot; name=&quot;' . $name . '&quot; rows=&quot;' . $rows . '&quot; cols=&quot;' . $cols . '&quot;&gt;' . $new[$config_key] . '&lt;/textarea&gt;';
+		break;
 
 		case 'radio':
 			$key_yes	= ($new[$config_key]) ? ' checked=&quot;checked&quot;' : '';
@@ -230,25 +194,76 @@
 			$tpl_type_cond = explode('_', $tpl_type[1]);
 			$type_no = ($tpl_type_cond[0] == 'disabled' || $tpl_type_cond[0] == 'enabled') ? false : true;
 
-			$tpl_no = '&lt;input type=&quot;radio&quot; name=&quot;' . $name . '&quot; value=&quot;0&quot;' . $key_no . ' /&gt;' . (($type_no) ? $_CLASS['core_user']-&gt;lang['NO'] : $_CLASS['core_user']-&gt;lang['DISABLED']);
-			$tpl_yes = '&lt;input type=&quot;radio&quot; name=&quot;' . $name . '&quot; value=&quot;1&quot;' . $key_yes . ' /&gt;' . (($type_no) ? $_CLASS['core_user']-&gt;lang['YES'] : $_CLASS['core_user']-&gt;lang['ENABLED']);
+			$tpl_no = '&lt;input type=&quot;radio&quot; name=&quot;' . $name . '&quot; value=&quot;0&quot;' . $key_no . ' class=&quot;radio&quot; /&gt;&nbsp;' . (($type_no) ? $_CLASS['core_user']-&gt;lang['NO'] : $_CLASS['core_user']-&gt;lang['DISABLED']);
+			$tpl_yes = '&lt;input type=&quot;radio&quot; id=&quot;' . $key . '&quot; name=&quot;' . $name . '&quot; value=&quot;1&quot;' . $key_yes . ' class=&quot;radio&quot; /&gt;&nbsp;' . (($type_no) ? $_CLASS['core_user']-&gt;lang['YES'] : $_CLASS['core_user']-&gt;lang['ENABLED']);
 
 			$tpl = ($tpl_type_cond[0] == 'yes' || $tpl_type_cond[0] == 'enabled') ? $tpl_yes . '&nbsp;&nbsp;' . $tpl_no : $tpl_no . '&nbsp;&nbsp;' . $tpl_yes;
-			break;
+		break;
 
 		case 'select':
-			eval('$s_options = ' . str_replace('{VALUE}', $new[$config_key], $options) . ';');
-			$tpl = '&lt;select name=&quot;' . $name . '&quot;&gt;' . $s_options . '&lt;/select&gt;';
-			break;
-
 		case 'custom':
-			eval('$tpl = ' . str_replace('{VALUE}', $new[$config_key], $options) . ';');
-			break;
+			
+			$return = '';
 
+			if (isset($vars['method']))
+			{
+				$call = array($module-&gt;module, $vars['method']);
+			}
+			else if (isset($vars['function']))
+			{
+				$call = $vars['function'];
+			}
+			else
+			{
+				break;
+			}
+
+			if (isset($vars['params']))
+			{
+				$args = array();
+				foreach ($vars['params'] as $value)
+				{
+					switch ($value)
+					{
+						case '{CONFIG_VALUE}':
+							$value = $new[$config_key];
+						break;
+
+						case '{KEY}':
+							$value = $key;
+						break;
+					}
+
+					$args[] = $value;
+				}
+			}
+			else
+			{
+				$args = array($new[$config_key], $key);
+			}
+			
+			$return = call_user_func_array($call, $args);
+
+			if ($tpl_type[0] == 'select')
+			{
+				$tpl = '&lt;select id=&quot;' . $key . '&quot; name=&quot;' . $name . '&quot;&gt;' . $return . '&lt;/select&gt;';
+			}
+			else
+			{
+				$tpl = $return;
+			}
+
+		break;
+
 		default:
-			break;
+		break;
 	}
 
+	if (isset($vars['append']))
+	{
+		$tpl .= $vars['append'];
+	}
+
 	return $tpl;
 }
 

Modified: cms/trunk/modules/forums/posting.php
===================================================================
--- cms/trunk/modules/forums/posting.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/forums/posting.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -151,7 +151,7 @@
 		trigger_error('USER_CANNOT_READ');
 	}
 
-	login_box('', $_CLASS['core_user']-&gt;get_lang('LOGIN_EXPLAIN_POST'));
+	login_box(array('explain' =&gt; $_CLASS['core_user']-&gt;get_lang('LOGIN_EXPLAIN_POST')));
 }
 
 if ($post_data['forum_password'])
@@ -162,7 +162,6 @@
 	));
 }
 
-
 // Permission to do the action asked?
 $is_authed = false;
 
@@ -212,7 +211,7 @@
 		trigger_error('USER_CANNOT_' . strtoupper(($mode == 'quote') ? 'reply' : $mode));
 	}
 
-	login_box('', $_CLASS['core_user']-&gt;get_lang('LOGIN_EXPLAIN_' . strtoupper($mode)));
+	login_box(array('explain' =&gt; $_CLASS['core_user']-&gt;get_lang('LOGIN_EXPLAIN_' . strtoupper($mode))));
 }
 unset($is_authed);
 
@@ -356,7 +355,7 @@
 
 if ($post_data['post_attachment'] &amp;&amp; !$submit &amp;&amp; !$refresh &amp;&amp; !$preview &amp;&amp; $mode == 'edit')
 {
-	$sql = 'SELECT attach_id, physical_filename, attach_comment, real_filename, extension, mimetype, filesize, filetime, thumbnail
+	$sql = 'SELECT attach_id, physical_filename, comment, real_filename, extension, mimetype, filesize, filetime, thumbnail
 		FROM ' . FORUMS_ATTACHMENTS_TABLE . &quot;
 		WHERE post_msg_id = $post_id
 			AND in_message = 0
@@ -647,7 +646,7 @@
 	$topic_lock			= isset($_POST['lock_topic']);
 	$post_lock			= isset($_POST['lock_post']);
 	$poll_delete		= isset($_POST['poll_delete']);
-	
+
 	// Faster than crc32
 	if ($submit)
 	{
@@ -660,7 +659,7 @@
 	}
 
 	// Delete Poll
-	if ($poll_delete &amp;&amp; $mode == 'edit' &amp;&amp; count($post_data['poll_options']) &amp;&amp; 
+	if ($poll_delete &amp;&amp; $mode === 'edit' &amp;&amp; count($post_data['poll_options']) &amp;&amp; 
 		((!$post_data['poll_last_vote'] &amp;&amp; $post_data['poster_id'] == $_CLASS['core_user']-&gt;data['user_id'] &amp;&amp; $_CLASS['forums_auth']-&gt;acl_get('f_delete', $forum_id)) || $_CLASS['forums_auth']-&gt;acl_get('m_delete', $forum_id)))
 	{
 		switch ($_CLASS['core_db']-&gt;db_layer)
@@ -712,7 +711,7 @@
 	// If replying/quoting and last post id has changed
 	// give user option to continue submit or return to post
 	// notify and show user the post made between his request and the final submit
-	if (($mode == 'reply' || $mode == 'quote') &amp;&amp; $post_data['topic_cur_post_id'] &amp;&amp; $post_data['topic_cur_post_id'] != $post_data['topic_last_post_id'])
+	if (($mode === 'reply' || $mode === 'quote') &amp;&amp; $post_data['topic_cur_post_id'] &amp;&amp; $post_data['topic_cur_post_id'] != $post_data['topic_last_post_id'])
 	{
 		if (topic_review($topic_id, $forum_id, 'post_review', $post_data['topic_cur_post_id']))
 		{
@@ -741,7 +740,7 @@
 		$message_parser-&gt;bbcode_bitfield = $post_data['bbcode_bitfield'];
 	}
 
-	if ($mode != 'edit' &amp;&amp; !$preview &amp;&amp; !$refresh &amp;&amp; $config['flood_interval'] &amp;&amp; !$_CLASS['forums_auth']-&gt;acl_get('f_ignoreflood', $forum_id))
+	if ($mode !== 'edit' &amp;&amp; !$preview &amp;&amp; !$refresh &amp;&amp; $config['flood_interval'] &amp;&amp; !$_CLASS['forums_auth']-&gt;acl_get('f_ignoreflood', $forum_id))
 	{
 		// Flood check
 		$last_post_time = 0;
@@ -771,7 +770,7 @@
 	}
 
 	// Validate username
-	if (($post_data['username'] &amp;&amp; !$_CLASS['core_user']-&gt;is_user) || ($mode == 'edit' &amp;&amp; $post_data['post_username']))
+	if (($post_data['username'] &amp;&amp; !$_CLASS['core_user']-&gt;is_user) || ($mode === 'edit' &amp;&amp; $post_data['post_username']))
 	{
 		require_once SITE_FILE_ROOT.'includes/functions_user.php';
 		$result = validate_username($post_data['username']);
@@ -781,7 +780,7 @@
 			$error[] = $_CLASS['core_user']-&gt;get_lang($result);
 		}
 	}
-	
+
 /*
  ADD
 	if ($config['enable_post_confirm'] &amp;&amp; !$_CLASS['core_user']-&gt;is_user &amp;&amp; in_array($mode, array('quote', 'post', 'reply')))
@@ -806,15 +805,15 @@
 */
 
 	// Parse subject
-	if (!$post_data['post_subject'] &amp;&amp; ($mode == 'post' || ($mode == 'edit' &amp;&amp; $post_data['topic_first_post_id'] == $post_id)))
+	if (!$post_data['post_subject'] &amp;&amp; ($mode === 'post' || ($mode === 'edit' &amp;&amp; $post_data['topic_first_post_id'] == $post_id)))
 	{
 		$error[] = $_CLASS['core_user']-&gt;get_lang('EMPTY_SUBJECT');
 	}
 
-	$post_data['poll_last_vote'] = (isset($post_data['poll_last_vote'])) ? $post_data['poll_last_vote'] : 0;
+	$post_data['poll_last_vote'] = isset($post_data['poll_last_vote']) ? $post_data['poll_last_vote'] : 0;
 
 	if ($post_data['poll_option_text'] &amp;&amp; 
-		($mode == 'post' || ($mode == 'edit' &amp;&amp; $post_id == $post_data['topic_first_post_id'] &amp;&amp; (!$post_data['poll_last_vote'] || $_CLASS['forums_auth']-&gt;acl_get('m_edit', $forum_id))))
+		($mode === 'post' || ($mode === 'edit' &amp;&amp; $post_id == $post_data['topic_first_post_id'] &amp;&amp; (!$post_data['poll_last_vote'] || $_CLASS['forums_auth']-&gt;acl_get('m_edit', $forum_id))))
 			&amp;&amp; $_CLASS['forums_auth']-&gt;acl_get('f_poll', $forum_id))
 	{
 		$poll = array(

Modified: cms/trunk/modules/forums/viewtopic.php
===================================================================
--- cms/trunk/modules/forums/viewtopic.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/forums/viewtopic.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -260,6 +260,8 @@
 	$topic_data['topic_time_limit'] = 0;
 }
 
+require_once SITE_FILE_ROOT.'includes/forums/functions_display.php';
+
 $_CLASS['core_user']-&gt;user_setup();
 $_CLASS['core_user']-&gt;add_lang('viewtopic');
 $_CLASS['core_user']-&gt;add_img();
@@ -420,7 +422,7 @@
 		
 	if ($update &amp;&amp; $s_can_vote)
 	{
-		if (empty($voted_id) || !empty($voted_id) &gt; $poll_max_options)
+		if (empty($voted_id) || !empty($voted_id) &gt; $topic_data['poll_max_options'])
 		{
 			$_CLASS['core_display']-&gt;meta_refresh(5, generate_link(&quot;forums&amp;file=viewtopic&amp;t=$topic_id&quot;));
 
@@ -429,6 +431,8 @@
 			trigger_error($message);
 		}
 
+		$sql_ary = array();
+
 		foreach ($voted_id as $option)
 		{
 			if (in_array($option, $cur_voted_id))
@@ -436,7 +440,7 @@
 				continue;
 			}
 
-			$sql = 'UPDATE ' . POLL_OPTIONS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_POLL_OPTIONS_TABLE . '
 				SET poll_option_total = poll_option_total + 1
 				WHERE poll_option_id = ' . (int) $option . '
 					AND topic_id = ' . (int) $topic_id;
@@ -444,18 +448,23 @@
 
 			if ($_CLASS['core_user']-&gt;is_user)
 			{
-				$sql_ary = array(
+				$sql_ary[] = array(
 					'topic_id'			=&gt; (int) $topic_id,
 					'poll_option_id'	=&gt; (int) $option,
 					'vote_user_id'		=&gt; (int) $_CLASS['core_user']-&gt;data['user_id'],
 					'vote_user_ip'		=&gt; (string) $_CLASS['core_user']-&gt;ip,
 				);
-
-				$sql = 'INSERT INTO  ' . POLL_VOTES_TABLE . ' ' . $db-&gt;sql_build_array('INSERT', $sql_ary);
+
 				$_CLASS['core_db']-&gt;query($sql);
 			}
 		}
 
+		if (!empty($sql_ary))
+		{
+			$_CLASS['core_db']-&gt;sql_query_build('MULTI_INSERT', $sql_ary, FORUMS_POLL_VOTES_TABLE);
+			unset($sql_ary);
+		}
+
 		foreach ($cur_voted_id as $option)
 		{
 			if (!in_array($option, $voted_id))

Modified: cms/trunk/modules/members_list/index.php
===================================================================
--- cms/trunk/modules/members_list/index.php	2006-08-13 02:53:31 UTC (rev 183)
+++ cms/trunk/modules/members_list/index.php	2006-08-16 12:22:53 UTC (rev 184)
@@ -96,7 +96,7 @@
 		$sql = 'SELECT u.user_id, u.username, u.user_colour, u.user_rank, u.user_posts, g.group_id, g.group_name, g.group_colour, g.group_type, ug.user_id as ug_user_id
 			FROM ' . CORE_USERS_TABLE . ' u, ' . CORE_GROUPS_TABLE . ' g
 			LEFT JOIN ' . CORE_GROUPS_MEMBERS_TABLE . ' ug ON (ug.group_id = g.group_id AND ug.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . ')
-			WHERE u.user_id IN (' . implode(', ', $modorators) . ')
+			WHERE u.user_id IN (' . implode(', ', array_unique($modorators)) . ')
 				AND u.user_group = g.group_id
 			ORDER BY g.group_name ASC, u.username ASC';
 
@@ -132,7 +132,7 @@
 			}
 
 			$rank_title = $rank_img = '';
-			get_user_rank($row['user_rank'], $row['user_posts'], $rank_title, $rank_img);
+			get_user_rank($row['user_rank'], $row['user_posts'], $rank_title, $rank_img, $rank_img_src);
 
 			$_CLASS['core_template']-&gt;assign_vars_array('moderators', array(
 				'USER_ID'		=&gt; $row['user_id'],
@@ -144,6 +144,7 @@
 				'GROUP_COLOR'	=&gt; $row['group_colour'],
 
 				'RANK_IMG'		=&gt; $rank_img,
+				'RANK_IMG_SRC'	=&gt; $rank_img_src,
 
 				'U_GROUP'		=&gt; $u_group,
 				'U_VIEWPROFILE'	=&gt; generate_link('members_list&amp;mode=viewprofile&amp;u='.$row['user_id']),
@@ -173,19 +174,12 @@
 		$presence_img = '';
 		switch ($action)
 		{
-			case 'icq':
-				$lang = 'ICQ';
-				$sql_field = 'user_icq';
-				$s_select = 'S_SEND_ICQ';
-				$s_action = '<A HREF="http://wwp.icq.com/scripts/WWPMsg.dll">http://wwp.icq.com/scripts/WWPMsg.dll</A>';
-				break;
-
 			case 'aim':
 				$lang = 'AIM';
 				$sql_field = 'user_aim';
 				$s_select = 'S_SEND_AIM';
 				$s_action = '';
-				break;
+			break;
 
 			case 'msnm':
 				$lang = 'MSNM';
@@ -199,35 +193,37 @@
 				$sql_field = 'user_jabber';
 				$s_select = (@extension_loaded('xml')) ? 'S_SEND_JABBER' : 'S_NO_SEND_JABBER';
 				$s_action = generate_link(&quot;members_list&amp;mode=contact&amp;action=$action&amp;u=$user_id&quot;);
-				break;
+			break;
 
 			default:
 				trigger_error('NO_USER_DATA');
 				die;
-				break;
+			break;
 		}
 
 		// Grab relevant data
 		$sql = &quot;SELECT user_id, username, user_email, user_lang, $sql_field
-			FROM &quot; . USERS_TABLE . &quot;
+			FROM &quot; . CORE_USERS_TABLE . &quot;
 			WHERE user_id = $user_id
 				AND user_type = &quot; . USER_NORMAL .' AND user_status = ' . STATUS_ACTIVE;
 		$result = $_CLASS['core_db']-&gt;query($sql);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 
-		if (!($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result)))
+		if (!$row)
 		{
 			trigger_error('NO_USER_DATA');
 		}
-		$_CLASS['core_db']-&gt;free_result($result);
+		
 
 		// Post data grab actions
 		switch ($action)
 		{
 			case 'icq':
 				$presence_img = '&lt;img src=&quot;<A HREF="http://web.icq.com/whitepages/online?icq=">http://web.icq.com/whitepages/online?icq=</A>' . $row[$sql_field] . '&amp;img=5&quot; width=&quot;18&quot; height=&quot;18&quot; border=&quot;0&quot; alt=&quot;&quot; /&gt;';
-				break;
+			break;
 
-			case 'jabber':
+		/*	case 'jabber':
 				if ($submit &amp;&amp; @extension_loaded('xml'))
 				{
 					// Add class loader
@@ -257,7 +253,7 @@
 
 					$s_select = 'S_SENT_JABBER';
 				}
-				break;
+				break;*/
 		}
 
 		$_CLASS['core_template']-&gt;assign_array(array(
@@ -280,21 +276,29 @@
 	case 'viewprofile':
 	
 		$user_id = get_variable('u', 'REQUEST', ANONYMOUS, 'int');
+		$username = get_variable('username', 'REQUEST');
 
 		// Display a profile
-		if ($user_id === ANONYMOUS)
+		if ($user_id === ANONYMOUS &amp;&amp; !$username)
 		{
 			trigger_error('NO_USER');
 		}
 
-		// We left join on the session table to see if the user is currently online
-		$sql = 'SELECT username, user_id, user_type, user_status, user_group, user_colour, user_permissions, user_sig,
-			user_sig_bbcode_uid, user_sig_bbcode_bitfield, user_allow_viewemail, user_posts, user_reg_date, user_rank,
-			user_from, user_occ, user_interests, user_website, user_email, user_icq, user_aim, user_yim, user_msnm,
-			user_jabber, user_avatar, user_avatar_width, user_avatar_height, user_avatar_type, user_last_visit
-			FROM ' . CORE_USERS_TABLE . &quot;
-			WHERE user_id = $user_id
-				AND user_type = &quot; . USER_NORMAL;
+		// Get user...
+		if ($username)
+		{
+			$sql = 'SELECT *
+				FROM ' . CORE_USERS_TABLE . &quot;
+				WHERE LOWER(username) = '&quot; . $_CLASS['core_db']-&gt;escape(strtolower($username)) . &quot;'
+					AND user_type IN (&quot; . USER_NORMAL . ')';
+		}
+		else
+		{
+			$sql = 'SELECT *
+				FROM ' . CORE_USERS_TABLE . &quot;
+				WHERE user_id = $user_id
+					AND user_type IN (&quot; . USER_NORMAL . ')';
+		}
 
 		$result = $_CLASS['core_db']-&gt;query($sql);
 		$member = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
@@ -302,8 +306,6 @@
 
 		if (!$member || (!$_CLASS['core_auth']-&gt;admin_power('users') &amp;&amp; $member['user_status'] != STATUS_ACTIVE))
 		{
-			$_CLASS['core_db']-&gt;free_result($result);
-
 			trigger_error(($member) ? 'USER_INACTIVE' : 'NO_USER');
 		}
 		


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000102.html">[Viperals-svncheckins] r183 - in cms/trunk: includes includes/db	includes/forums includes/forums/mcp	includes/templates/modules/forums modules/control_panel	modules/control_panel/modules modules/forums
</A></li>
	<LI>Next message: <A HREF="000104.html">[Viperals-svncheckins] r185 - in cms/trunk: . admin includes	includes/cache includes/display includes/forums	includes/forums/admin includes/templates/admin	includes/templates/admin/eaccelerator	includes/templates/modules/forums	includes/templates/modules/forums/admin install	modules/forums modules/forums/admin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103">[ date ]</a>
              <a href="thread.html#103">[ thread ]</a>
              <a href="subject.html#103">[ subject ]</a>
              <a href="author.html#103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">More information about the Viperals-svncheckins
mailing list</a><br>
</body></html>
