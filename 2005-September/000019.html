<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Viperals-svncheckins] r96 - in trunk: . admin admin/functions blocks images includes includes/auth includes/cache includes/db includes/forums includes/forums/admin includes/forums/mcp includes/templates includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/system includes/templates/admin/users includes/templates/modules/Contact includes/templates/modules/Contact/email includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Forums/images includes/templates/modules/Forums/images/en includes/templates/modules/Forums/images/karma includes/templates/modules/Members_List includes/templates/rss install javascript language/en modules/Control_Panel modules/Control_Panel/ucp modules/Forums modules/Members_List themes themes/viperal themes_admin/viperal_admin themes_admin/viperal_admin/style themes_admin/viperal_admin/style/images themes_admin/viperal_admin/template
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/viperals-svncheckins/2005-September/index.html" >
   <LINK REL="made" HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r96%20-%20in%20trunk%3A%20.%20admin%20admin/functions%20blocks%20images%20includes%20includes/auth%20includes/cache%20includes/db%20includes/forums%20includes/forums/admin%20includes/forums/mcp%20includes/templates%20includes/templates/admin/blocks%20includes/templates/admin/messages%20includes/templates/admin/system%20includes/templates/admin/users%20includes/templates/modules/Contact%20includes/templates/modules/Contact/email%20includes/templates/modules/Control_Panel%20includes/templates/modules/Forums%20includes/templates/modules/Forums/images%20includes/templates/modules/Forums/images/en%20includes/templates/modules/Forums/images/karma%20includes/templates/modules/Members_List%20includes/templates/rss%20install%20javascript%20language/en%20modules/Control_Panel%20modules/Control_Panel/ucp%20modules/Forums%20modules/Members_List%20themes%20themes/viperal%20themes_admin/viperal_admin%20themes_admin/viperal_admin/style%20themes_admin/viperal_admin/style/images%20themes_admin/viperal_admin/template&In-Reply-To=%3C200509030142.j831gLDR016085%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Viperals-svncheckins] r96 - in trunk: . admin admin/functions blocks images includes includes/auth includes/cache includes/db includes/forums includes/forums/admin includes/forums/mcp includes/templates includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/system includes/templates/admin/users includes/templates/modules/Contact includes/templates/modules/Contact/email includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Forums/images includes/templates/modules/Forums/images/en includes/templates/modules/Forums/images/karma includes/templates/modules/Members_List includes/templates/rss install javascript language/en modules/Control_Panel modules/Control_Panel/ucp modules/Forums modules/Members_List themes themes/viperal themes_admin/viperal_admin themes_admin/viperal_admin/style themes_admin/viperal_admin/style/images themes_admin/viperal_admin/template</H1>
    <B>Ryan Marshall at BerliOS</B> 
    <A HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r96%20-%20in%20trunk%3A%20.%20admin%20admin/functions%20blocks%20images%20includes%20includes/auth%20includes/cache%20includes/db%20includes/forums%20includes/forums/admin%20includes/forums/mcp%20includes/templates%20includes/templates/admin/blocks%20includes/templates/admin/messages%20includes/templates/admin/system%20includes/templates/admin/users%20includes/templates/modules/Contact%20includes/templates/modules/Contact/email%20includes/templates/modules/Control_Panel%20includes/templates/modules/Forums%20includes/templates/modules/Forums/images%20includes/templates/modules/Forums/images/en%20includes/templates/modules/Forums/images/karma%20includes/templates/modules/Members_List%20includes/templates/rss%20install%20javascript%20language/en%20modules/Control_Panel%20modules/Control_Panel/ucp%20modules/Forums%20modules/Members_List%20themes%20themes/viperal%20themes_admin/viperal_admin%20themes_admin/viperal_admin/style%20themes_admin/viperal_admin/style/images%20themes_admin/viperal_admin/template&In-Reply-To=%3C200509030142.j831gLDR016085%40sheep.berlios.de%3E"
       TITLE="[Viperals-svncheckins] r96 - in trunk: . admin admin/functions blocks images includes includes/auth includes/cache includes/db includes/forums includes/forums/admin includes/forums/mcp includes/templates includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/system includes/templates/admin/users includes/templates/modules/Contact includes/templates/modules/Contact/email includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Forums/images includes/templates/modules/Forums/images/en includes/templates/modules/Forums/images/karma includes/templates/modules/Members_List includes/templates/rss install javascript language/en modules/Control_Panel modules/Control_Panel/ucp modules/Forums modules/Members_List themes themes/viperal themes_admin/viperal_admin themes_admin/viperal_admin/style themes_admin/viperal_admin/style/images themes_admin/viperal_admin/template">viperal at berlios.de
       </A><BR>
    <I>Sat Sep  3 03:42:21 CEST 2005</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000020.html">[Viperals-svncheckins] r97 - in trunk: admin admin/functions includes includes/templates/admin/modules modules/Quick_Message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19">[ date ]</a>
              <a href="thread.html#19">[ thread ]</a>
              <a href="subject.html#19">[ subject ]</a>
              <a href="author.html#19">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: viperal
Date: 2005-09-03 03:42:07 +0200 (Sat, 03 Sep 2005)
New Revision: 96

Added:
   trunk/blocks/block-Modules.php
   trunk/includes/forums/admin/admin_ban.php
   trunk/includes/templates/admin/users/setting.html
   trunk/includes/templates/rss/atom.html
   trunk/themes_admin/viperal_admin/style/
   trunk/themes_admin/viperal_admin/style/images/
   trunk/themes_admin/viperal_admin/style/images/Thumbs.db
   trunk/themes_admin/viperal_admin/style/images/background.gif
   trunk/themes_admin/viperal_admin/style/images/bg.gif
   trunk/themes_admin/viperal_admin/style/images/cellpic.gif
   trunk/themes_admin/viperal_admin/style/images/cellpic1.gif
   trunk/themes_admin/viperal_admin/style/images/cellpic2.jpg
   trunk/themes_admin/viperal_admin/style/images/cellpic3.gif
   trunk/themes_admin/viperal_admin/style/images/created_by.jpg
   trunk/themes_admin/viperal_admin/style/images/curve.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_faq.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_groups.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_login.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_members.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_message.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_profile.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_register.gif
   trunk/themes_admin/viperal_admin/style/images/icon_mini_search.gif
   trunk/themes_admin/viperal_admin/style/images/index.htm
   trunk/themes_admin/viperal_admin/style/images/logo-christmas.jpg
   trunk/themes_admin/viperal_admin/style/images/no_avatar.gif
   trunk/themes_admin/viperal_admin/style/images/sitelogo.jpg
   trunk/themes_admin/viperal_admin/style/images/spacer.gif
   trunk/themes_admin/viperal_admin/style/images/whosonline.gif
   trunk/themes_admin/viperal_admin/style/style.css
Removed:
   trunk/blocks/block-Moderator_Panel.php
   trunk/blocks/block-latest-forums.php
   trunk/includes/templates/modules/Forums/images/icons/
   trunk/includes/templates/modules/Forums/images/karma/icons/
   trunk/themes/login_body_full.css
Modified:
   trunk/admin.php
   trunk/admin/blocks.php
   trunk/admin/functions/block_functions.php
   trunk/admin/menu.php
   trunk/admin/system.php
   trunk/admin/users.php
   trunk/blocks/block-User.php
   trunk/config.php
   trunk/core.php
   trunk/debug.php
   trunk/feed.php
   trunk/images/Thumbs.db
   trunk/includes/auth/auth.php
   trunk/includes/cache/cache_file.php
   trunk/includes/core_rss.php
   trunk/includes/db/mysql.php
   trunk/includes/db/mysqli.php
   trunk/includes/db/postgres.php
   trunk/includes/db/sqlite.php
   trunk/includes/forums/admin/admin_board.php
   trunk/includes/forums/admin/admin_permissions.php
   trunk/includes/forums/bbcode.php
   trunk/includes/forums/functions.php
   trunk/includes/forums/functions_display.php
   trunk/includes/forums/functions_posting.php
   trunk/includes/forums/functions_privmsgs.php
   trunk/includes/forums/mcp/mcp_topic.php
   trunk/includes/functions.php
   trunk/includes/functions_user.php
   trunk/includes/tables.php
   trunk/includes/templates/admin/blocks/edit.html
   trunk/includes/templates/admin/messages/edit.html
   trunk/includes/templates/admin/system/index.html
   trunk/includes/templates/admin/users/header.html
   trunk/includes/templates/confirmation.html
   trunk/includes/templates/modules/Contact/email/index.html
   trunk/includes/templates/modules/Contact/index.html
   trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html
   trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html
   trunk/includes/templates/modules/Control_Panel/ucp_register.html
   trunk/includes/templates/modules/Control_Panel/ucp_sideblock.html
   trunk/includes/templates/modules/Forums/images/Thumbs.db
   trunk/includes/templates/modules/Forums/images/en/Thumbs.db
   trunk/includes/templates/modules/Forums/images/karma/Thumbs.db
   trunk/includes/templates/modules/Forums/overall_footer.html
   trunk/includes/templates/modules/Forums/overall_header.html
   trunk/includes/templates/modules/Members_List/memberlist_footer.html
   trunk/includes/templates/rss/rdf.html
   trunk/includes/templates/rss/rss2.html
   trunk/includes/templates/rss/rss91.html
   trunk/includes/user.php
   trunk/index.php
   trunk/install/build_data.php
   trunk/install/build_tables.php
   trunk/javascript/menu.js
   trunk/language/en/common.php
   trunk/language/en/error.php
   trunk/modules/Control_Panel/index.php
   trunk/modules/Control_Panel/ucp/ucp_main.php
   trunk/modules/Control_Panel/ucp/ucp_pm.php
   trunk/modules/Control_Panel/ucp/ucp_pm_compose.php
   trunk/modules/Control_Panel/ucp/ucp_pm_viewmessage.php
   trunk/modules/Control_Panel/ucp/ucp_prefs.php
   trunk/modules/Forums/posting.php
   trunk/modules/Forums/viewforum.php
   trunk/modules/Forums/viewtopic.php
   trunk/modules/Members_List/index.php
   trunk/themes/viperal/index.php
   trunk/themes_admin/viperal_admin/template/header.html
Log:


Modified: trunk/admin/blocks.php
===================================================================
--- trunk/admin/blocks.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/admin/blocks.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -504,17 +504,13 @@
 {
 	global $site_file_root, $_CLASS;
 
-	$block_list = array();
-	$default = ($default) ? $default : $_CLASS['core_display']-&gt;theme;
-
-	$block_list = '';
 	$block_list_array = array();
 
 	$handle = opendir($site_file_root.'blocks');
 
 	while ($file = readdir($handle))
 	{
-		if(substr($file, 0, 6) == 'block-')
+		if (substr($file, 0, 6) == 'block-')
 		{
 			$block_list_array[$file] = ereg_replace('_',' ',substr($file,6,-4));
 		} 
@@ -522,6 +518,8 @@
 
 	closedir($handle);
 
+	$block_list = '';
+
 	foreach ($block_list_array as $value =&gt; $name)
 	{
 		if ($value == $default)

Modified: trunk/admin/functions/block_functions.php
===================================================================
--- trunk/admin/functions/block_functions.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/admin/functions/block_functions.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -46,15 +46,16 @@
 	{
 		if (is_null($auth))
 		{
-			$block['block_auth'] = $auth = '';
+			$block['block_auth'] = '';
+			$auth = 'null';
 		}
 		else
 		{
 			$block['block_auth'] = $auth;
-			$auth = $_CLASS['core_db']-&gt;escape(serialize($auth));
+			$auth = &quot;'&quot;.$_CLASS['core_db']-&gt;escape(serialize($auth)).&quot;'&quot;;
 		}
 
-		$_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . &quot; SET block_auth = '$auth' WHERE block_id = $id&quot;);
+		$_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . &quot; SET block_auth = $auth WHERE block_id = $id&quot;);
 		$_CLASS['core_cache']-&gt;destroy('blocks');
 	}
 	

Modified: trunk/admin/menu.php
===================================================================
--- trunk/admin/menu.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/admin/menu.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -58,6 +58,7 @@
 
 $menu['users'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('USERS'), 'link' =&gt; generate_link('users', array('admin' =&gt; true)));
 $menu['users'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MANAGE'), 'link' =&gt; generate_link('users', array('admin' =&gt; true)));
+$menu['users'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('SETTING'), 'link' =&gt; generate_link('users&amp;mode=setting', array('admin' =&gt; true)));
 $menu['users'][] = '';
 $menu['users'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('VIEW_DISABLED'), 'link' =&gt; generate_link('users&amp;mode=disabled', array('admin' =&gt; true)));
 $menu['users'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('VIEW_UNACTIVATED'), 'link' =&gt; generate_link('users&amp;mode=unactivated', array('admin' =&gt; true)));

Modified: trunk/admin/system.php
===================================================================
--- trunk/admin/system.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/admin/system.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -21,6 +21,9 @@
 $Id$
 */
 
+
+// Need to redo this, do all check before the saving
+
 if (VIPERAL !== 'Admin') 
 {
 	die;
@@ -89,9 +92,10 @@
 			'link_optimization' =&gt; array('post_name' =&gt; 'link_optimization'),
 			'site_name'			=&gt; array('post_name' =&gt; 'site_name'),
 			'site_url'			=&gt; array('post_name' =&gt; 'site_url'),
-			'start_date'		=&gt; array('post_name' =&gt; 'start_date')
-			)
-		);
+			'start_date'		=&gt; array('post_name' =&gt; 'start_date'),
+			'foot1'				=&gt; array('post_name' =&gt; 'foot1'),
+			'foot2'				=&gt; array('post_name' =&gt; 'foot2'),
+		));
 		admin_save($data);
 	}
 
@@ -101,8 +105,9 @@
 		'A_OPTION'		=&gt; 'site',
 		'ACTION'		=&gt; generate_link('system', array('admin' =&gt; true)),
 		
-		'DEFAULT_THEME' 	=&gt; $_CORE_CONFIG['global']['default_theme'],
 		'LINK_OPTIMIZATION' =&gt; $_CORE_CONFIG['global']['link_optimization'],
+
+		'SELECT_THEME' 		=&gt; select_theme($_CORE_CONFIG['global']['default_theme']),
 		'SITE_NAME'			=&gt; $_CORE_CONFIG['global']['site_name'],
 		'SITE_URL'			=&gt; $_CORE_CONFIG['global']['site_url'],
 		'START_DATE'		=&gt; $_CORE_CONFIG['global']['start_date'],
@@ -110,25 +115,7 @@
 		'FOOTER_FIRST' 		=&gt; $_CORE_CONFIG['global']['foot1'],
 		'FOOTER_SECOND' 	=&gt; $_CORE_CONFIG['global']['foot2'],
 		
-		));
-	
-	$handle = opendir('themes');
-	
-	while ($file = readdir($handle))
-	{
-		if ($file{0} !== '.')
-		{
-			if (file_exists(&quot;themes/$file/index.php&quot;))
-			{
-				$_CLASS['core_template']-&gt;assign_vars_array('site_theme', array(
-					'FILE'	=&gt; $file,
-					'NAME'  =&gt; $file,
-				));
-			}
-		} 
-	}
-	
-	closedir($handle);
+	));
 
 	$_CLASS['core_template']-&gt;display('admin/system/index.html');
 }
@@ -153,11 +140,11 @@
 				'cookie_domain' =&gt; array('post_name' =&gt; 'cookie_domain'),
 				'cookie_name' 	=&gt; array('post_name' =&gt; 'cookie_name'),
 				'cookie_path' 	=&gt; array('post_name' =&gt; 'cookie_path'),
-				'cookie_secure'	=&gt; array('post_name' =&gt; 'cookie_secure'),
 				'error_options'	=&gt; array('post_name' =&gt; 'error_options'),
 				'site_domain'	=&gt; array('post_name' =&gt; 'site_domain'),
 				'site_port' 	=&gt; array('post_name' =&gt; 'site_port'),
 				'site_path' 	=&gt; array('post_name' =&gt; 'site_path'),
+				'site_secure'	=&gt; array('post_name' =&gt; 'site_secure'),
 				'ip_check' 		=&gt; array('post_name' =&gt; 'ip_check'),
 				'limit_load' 	=&gt; array('post_name' =&gt; 'limit_load'),
 				'limit_sessions'	=&gt; array('post_name' =&gt; 'limit_sessions'),
@@ -176,7 +163,6 @@
 		'COOKIE_DOMAIN' =&gt; $_CORE_CONFIG['server']['cookie_domain'],
 		'COOKIE_NAME' 	=&gt; $_CORE_CONFIG['server']['cookie_name'],
 		'COOKIE_PATH' 	=&gt; $_CORE_CONFIG['server']['cookie_path'],
-		'COOKIE_SECURE' =&gt; $_CORE_CONFIG['server']['cookie_secure'],
 		'ERROR'			=&gt; $_CORE_CONFIG['server']['error_options'],
 		'MAINTENANCE' 		=&gt; $_CORE_CONFIG['maintenance']['active'],
 		'MAINTENANCE_MSG' 	=&gt; $_CORE_CONFIG['maintenance']['text'],
@@ -185,84 +171,14 @@
 		'SITE_DOMAIN'		=&gt; $_CORE_CONFIG['server']['site_domain'],
 		'SITE_PATH'			=&gt; $_CORE_CONFIG['server']['site_path'],
 		'SITE_PORT'			=&gt; $_CORE_CONFIG['server']['site_port'],
+		'SITE_SECURE'		=&gt; $_CORE_CONFIG['server']['site_secure'],
 		'LIMIT_LOAD'		=&gt; $_CORE_CONFIG['server']['limit_load'],
 		'LIMIT_SESSIONS'	=&gt; $_CORE_CONFIG['server']['limit_sessions'],
 		'SESSION_LENGTH'	=&gt; $_CORE_CONFIG['server']['session_length'],
 		
-		));
+	));
 
 	$_CLASS['core_template']-&gt;display('admin/system/index.html');
 }
 
-function admin_users($save)
-{
-	if ($save)
-	{
-		$data = array('user' =&gt; array(
-			'require_activation'=&gt; array('post_name' =&gt; 'require_activation'),
-			'coppa_enable'		=&gt; array('post_name' =&gt; 'coppa_enable'),
-			'coppa_fax'			=&gt; array('post_name' =&gt; 'coppa_fax'),
-			'coppa_mail'		=&gt; array('post_name' =&gt; 'coppa_mail'),
-			'enable_confirm'	=&gt; array('post_name' =&gt; 'enable_confirm'),
-			'max_reg_attempts'	=&gt; array('post_name' =&gt; 'max_reg_attempts'),
-			'min_name_chars'	=&gt; array('post_name' =&gt; 'min_name_chars'),
-			'max_name_chars'	=&gt; array('post_name' =&gt; 'max_name_chars'),
-			'min_pass_chars'	=&gt; array('post_name' =&gt; 'min_pass_chars'),
-			'max_pass_chars'	=&gt; array('post_name' =&gt; 'max_pass_chars'),
-			'chg_passforce'		=&gt; array('post_name' =&gt; 'chg_passforce'),
-			'allow_namechange'	=&gt; array('post_name' =&gt; 'allow_namechange'),
-			'max_reg_attempts'	=&gt; array('post_name' =&gt; 'max_reg_attempts'),
-			'allow_name_chars'	=&gt; array('post_name' =&gt; 'allow_name_chars'),
-			'allow_emailreuse'	=&gt; array('post_name' =&gt; 'allow_emailreuse'),
-			)
-		);
-		admin_save($data);
-	}
-
-	global $_CLASS, $_CORE_CONFIG;
-
-    $_CLASS['core_template']-&gt;assign_array(array(
-		'A_OPTION' =&gt; 'users',
-		'ACTION' =&gt; generate_link('system&amp;mode=users', array('admin' =&gt; true)),
-		'L_EDITOR_OPTION' =&gt; $_CLASS['core_user']-&gt;lang['EDITOR_OPTION'],
-		
-		'ACTIVATION_OPTION' =&gt; $_CORE_CONFIG['user']['require_activation'],
-		'COPPA_ENABLE'		=&gt; $_CORE_CONFIG['user']['coppa_enable'],
-		'COPPA_FAX'			=&gt; $_CORE_CONFIG['user']['coppa_fax'],
-		'COPPA_MAIL'		=&gt; $_CORE_CONFIG['user']['coppa_mail'],
-		'CONFIRM_ENABLE'	=&gt; $_CORE_CONFIG['user']['enable_confirm'],
-		'MAX_REG_ATTEMPTS'	=&gt; $_CORE_CONFIG['user']['max_reg_attempts'],
-		'MIN_NAME_CHARS'	=&gt; $_CORE_CONFIG['user']['min_name_chars'],
-		'MAX_NAME_CHARS'	=&gt; $_CORE_CONFIG['user']['max_name_chars'],
-		'MIN_PASS_CHARS'	=&gt; $_CORE_CONFIG['user']['min_pass_chars'],
-		'MAX_PASS_CHARS'	=&gt; $_CORE_CONFIG['user']['max_pass_chars'],
-		'CHG_PASSFORCE'		=&gt; $_CORE_CONFIG['user']['chg_passforce'],
-		'ALLOW_NAMECHANGE'	=&gt; $_CORE_CONFIG['user']['allow_namechange'],
-		'ALLOW_NAME_CHARS'	=&gt; $_CORE_CONFIG['user']['allow_name_chars'],
-		//'PASS_COMPLEX'  =&gt; $_CORE_CONFIG['user']['pass_complex'],
-		//'ALLOW_NAMECHANGE'  =&gt; $_CORE_CONFIG['user']['pass_complex'],
-		'ALLOW_EMAILREUSE'	=&gt; $_CORE_CONFIG['user']['allow_emailreuse'],
-
-		'A_ACC_OPTION'	=&gt; array(
-			array(
-				'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_NONE'],
-				'OPTION' =&gt; USER_ACTIVATION_NONE,
-			),
-			array(
-				'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_USER'],
-				'OPTION' =&gt; USER_ACTIVATION_SELF,
-			),
-			array(
-				'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_ADMIN'],
-				'OPTION' =&gt; USER_ACTIVATION_ADMIN,
-			),
-			array(
-				'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_DISABLE'],
-				'OPTION' =&gt; USER_ACTIVATION_DISABLE,
-			))
-		));
-
-		$_CLASS['core_template']-&gt;display('admin/system/index.html');
-}
-
 ?&gt;
\ No newline at end of file

Modified: trunk/admin/users.php
===================================================================
--- trunk/admin/users.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/admin/users.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -41,7 +41,8 @@
 	'COUNT_USERS'	=&gt; $count_users,
 	'LINK_ADD_USER'	=&gt; generate_link('users&amp;mode=add_user', array('admin' =&gt; true)),
 	'LINK_EDIT_USER'=&gt; generate_link('users&amp;mode=edit_user', array('admin' =&gt; true)),
-	
+	'LINK_SETTINGS'	=&gt; generate_link('users&amp;mode=setting', array('admin' =&gt; true)),
+
 	'LINK_USER_INDEX'		=&gt; generate_link('users', array('admin' =&gt; true)),
 	'LINK_VIEW_BOTS'		=&gt; generate_link('users&amp;mode=bots', array('admin' =&gt; true)),
 	'LINK_VIEW_DISABLED'	=&gt; generate_link('users&amp;mode=disabled', array('admin' =&gt; true)),
@@ -54,6 +55,76 @@
 {
 	switch ($_REQUEST['mode'])
 	{
+		case 'setting':
+			if (isset($_POST['submit']))
+			{
+				$activation_array = array(USER_ACTIVATION_NONE, USER_ACTIVATION_SELF, USER_ACTIVATION_ADMIN, USER_ACTIVATION_DISABLE);
+				$activation = get_variable('activation', 'POST', USER_ACTIVATION_NONE, 'int');
+
+				$data['activation'] = in_array($activation, $activation_array) ? $activation : USER_ACTIVATION_NONE;
+		 		$data['coppa_enable'] = get_variable('coppa_enable', 'POST') ? 1 : 0;
+		 		$data['coppa_fax'] = get_variable('coppa_fax', 'POST');
+		 		$data['coppa_mail'] = get_variable('coppa_mail', 'POST');
+		 		$data['enable_confirm'] = get_variable('enable_confirm', 'POST') ? 1 : 0;
+		 		$data['max_reg_attempts'] = get_variable('coppa_fax', 'POST', 0, 'INT');
+		 		$data['min_name_chars'] = get_variable('min_name_chars', 'POST', 0, 'INT');
+		 		$data['max_name_chars'] = get_variable('max_name_chars', 'POST', 0, 'INT');
+		 		$data['min_pass_chars'] = get_variable('min_pass_chars', 'POST', 0, 'INT');
+		 		$data['max_pass_chars'] = get_variable('max_pass_chars', 'POST', 0, 'INT');
+
+				foreach ($data as $name =&gt; $setting)
+				{
+					if ($setting != $_CORE_CONFIG['user'][$name])
+					{
+						set_core_config('user', $name, $setting, false);
+					}
+				}
+			}
+
+			$_CLASS['core_template']-&gt;assign_array(array(
+				'S_ACTION' =&gt; generate_link('users&amp;mode=setting', array('admin' =&gt; true)),
+		
+				'ACTIVATION_OPTION' =&gt; $_CORE_CONFIG['user']['activation'],
+				'COPPA_ENABLE'		=&gt; $_CORE_CONFIG['user']['coppa_enable'],
+				'COPPA_FAX'			=&gt; $_CORE_CONFIG['user']['coppa_fax'],
+				'COPPA_MAIL'		=&gt; $_CORE_CONFIG['user']['coppa_mail'],
+				'CONFIRM_ENABLE'	=&gt; $_CORE_CONFIG['user']['enable_confirm'],
+				'MAX_REG_ATTEMPTS'	=&gt; $_CORE_CONFIG['user']['max_reg_attempts'],
+				'MIN_NAME_CHARS'	=&gt; $_CORE_CONFIG['user']['min_name_chars'],
+				'MAX_NAME_CHARS'	=&gt; $_CORE_CONFIG['user']['max_name_chars'],
+				'MIN_PASS_CHARS'	=&gt; $_CORE_CONFIG['user']['min_pass_chars'],
+				'MAX_PASS_CHARS'	=&gt; $_CORE_CONFIG['user']['max_pass_chars'],
+				//'CHG_PASSFORCE'		=&gt; $_CORE_CONFIG['user']['chg_passforce'],
+				//'ALLOW_NAMECHANGE'	=&gt; $_CORE_CONFIG['user']['allow_namechange'],
+				'ALLOW_NAME_CHARS'	=&gt; $_CORE_CONFIG['user']['allow_name_chars'],
+				
+				//'PASS_COMPLEX'  =&gt; $_CORE_CONFIG['user']['pass_complex'],
+				//'ALLOW_NAMECHANGE'  =&gt; $_CORE_CONFIG['user']['pass_complex'],
+				//'ALLOW_EMAILREUSE'	=&gt; $_CORE_CONFIG['user']['allow_emailreuse'],
+
+				'A_ACC_OPTION'	=&gt; array(
+					array(
+						'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_NONE'],
+						'OPTION' =&gt; USER_ACTIVATION_NONE,
+					),
+					array(
+						'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_USER'],
+						'OPTION' =&gt; USER_ACTIVATION_SELF,
+					),
+					array(
+						'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_ADMIN'],
+						'OPTION' =&gt; USER_ACTIVATION_ADMIN,
+					),
+					array(
+						'LANG' =&gt; $_CLASS['core_user']-&gt;lang['ACC_DISABLE'],
+						'OPTION' =&gt; USER_ACTIVATION_DISABLE,
+					)
+				)
+			));
+	
+			$_CLASS['core_display']-&gt;display(false, 'admin/users/setting.html');
+		break;
+
 		case 'add_user':
 			if (isset($_POST['submit']))
 			{
@@ -61,12 +132,13 @@
 	
 				$error = array();
 	
-				$username	= get_variable('username', 'POST', false);
-				$password	= get_variable('password', 'POST', false);
-				$email		= get_variable('email', 'POST', false);
-				$tz			= get_variable('tz', 'POST', false);
+				$username	= get_variable('username', 'POST');
+				$password	= get_variable('password', 'POST');
+				$email		= get_variable('email', 'POST');
+				$tz			= get_variable('tz', 'POST');
+				$coppa		= get_variable('coppa', 'POST');
+
 				$error		= array();
-
 				//when we add this make sure to confirm that it's one of the installed langs
 				$lang		= $_CORE_CONFIG['global']['default_lang'];
 	
@@ -132,7 +204,7 @@
 					
 					set_core_config('user', 'newest_user_id', $row['user_id'], false);
 					set_core_config('user', 'newest_username', $row['username'], false);
-					set_core_config('user', 'num_users', $_CORE_CONFIG['user']['num_users'] + 1, false);
+					set_core_config('user', 'total_users', $_CORE_CONFIG['user']['total_users'] + 1, false);
 				}
 			}
 

Modified: trunk/admin.php
===================================================================
--- trunk/admin.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/admin.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -25,8 +25,8 @@
 
 $_CLASS['core_user']-&gt;add_lang('admin/common.php');
 
-$_CORE_MODULE['title'] = $_CLASS['core_user']-&gt;lang['ADMIN'];
-$_CORE_MODULE['sides'] = BLOCK_ALL;
+$_CORE_MODULE['module_title'] = $_CLASS['core_user']-&gt;lang['ADMIN'];
+$_CORE_MODULE['module_sides'] = BLOCK_ALL;
 $_CLASS['core_blocks']-&gt;blocks_loaded = true;
 
 if (!$_CLASS['core_user']-&gt;is_user)
@@ -54,25 +54,29 @@
 
 if ($mod)
 {
-	$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.CORE_MODULES_TABLE.&quot; WHERE name='&quot;.$_CLASS['core_db']-&gt;escape($mod).&quot;'&quot;);
+	$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.CORE_MODULES_TABLE.&quot; WHERE module_name='&quot;.$_CLASS['core_db']-&gt;escape($mod).&quot;'&quot;);
 	$_CORE_MODULE = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 	$_CLASS['core_db']-&gt;free_result($result);
+	
+// remove this -- just for testing
+	$_CORE_MODULE['module_name'] = $mod;
+	$_CORE_MODULE['module_title'] = $mod;
 }
 
 if (!$mod || !$_CORE_MODULE)
 {
-	$_CORE_MODULE = array('title' =&gt; '', 'name' =&gt; '');
+	$_CORE_MODULE = array('module_title' =&gt; '', 'module_name' =&gt; '');
 	$file_path = $site_file_root.'admin/index.php';
 }
 else
 {
-	if (file_exists($site_file_root.'admin/'.$_CORE_MODULE['name'].'.php'))
+	if (file_exists($site_file_root.'admin/'.$_CORE_MODULE['module_name'].'.php'))
 	{
-		$file_path = $site_file_root.'admin/'.$_CORE_MODULE['name'].'.php';
+		$file_path = $site_file_root.'admin/'.$_CORE_MODULE['module_name'].'.php';
 	}
 	else
 	{
-		$file_path = (file_exists($site_file_root.'modules/'.$_CORE_MODULE['name'].'/admin/index.php')) ? $site_file_root.'modules/'.$_CORE_MODULE['name'].'/admin/index.php' : false;
+		$file_path = (file_exists($site_file_root.'modules/'.$_CORE_MODULE['module_name'].'/admin/index.php')) ? $site_file_root.'modules/'.$_CORE_MODULE['module_name'].'/admin/index.php' : false;
 	}
 }
 
@@ -81,16 +85,16 @@
 	trigger_error('NO_ADMIN_MODULE', E_USER_ERROR);
 }
 
-if ($_CORE_MODULE['name'])
+if ($_CORE_MODULE['module_name'])
 {
-	if (!$_CLASS['core_auth']-&gt;admin_power($_CORE_MODULE['name']))
+	if (!$_CLASS['core_auth']-&gt;admin_power($_CORE_MODULE['module_name']))
 	{
 		trigger_error('NOT_AUTH', E_USER_ERROR);
 	}
 }
 
-$_CORE_MODULE['title'] = $_CLASS['core_user']-&gt;lang['ADMIN'].' &gt; '.$_CORE_MODULE['title'];
-$_CORE_MODULE['sides'] = BLOCK_ALL;
+$_CORE_MODULE['module_title'] = $_CLASS['core_user']-&gt;lang['ADMIN'].' &gt; '.$_CORE_MODULE['module_title'];
+$_CORE_MODULE['module_sides'] = BLOCK_ALL;
 	
 require($site_file_root.'admin/menu.php');
 

Deleted: trunk/blocks/block-Moderator_Panel.php
===================================================================
--- trunk/blocks/block-Moderator_Panel.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/blocks/block-Moderator_Panel.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,123 +0,0 @@
-&lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
-
-if (!defined('VIPERAL')) {
-    Header('Location: ../');
-    die();
-}
-
-global $_CLASS;
-
-if (!isset($_CLASS['core_template']-&gt;_tpl_vars['mcp_section']))
-{
-	return;
-}
-
-$this-&gt;content .= '&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
-				&lt;tr&gt;
-					&lt;th&gt;'.$_CLASS['core_template']-&gt;_tpl_vars['L_OPTIONS'].'
-&lt;/th&gt;
-				&lt;/tr&gt;';
-unset($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']);
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['name'] = 'mcp_sectionloop';
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['loop'] = is_array($_loop=$_CLASS['core_template']-&gt;_tpl_vars['mcp_section']) ? count($_loop) : max(0, (int)$_loop); unset($_loop);
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['show'] = true;
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['max'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['loop'];
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['step'] = 1;
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['start'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['step'] &gt; 0 ? 0 : $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['loop']-1;
-if ($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['show']) {
-    $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['total'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['loop'];
-    if ($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['total'] == 0)
-        $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['show'] = false;
-} else
-    $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['total'] = 0;
-if ($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['show']):
-
-            for ($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['start'], $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['iteration'] = 1;
-                 $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['iteration'] &lt;= $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['total'];
-                 $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index'] += $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['step'], $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['iteration']++):
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['rownum'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['iteration'];
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index_prev'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index'] - $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['step'];
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index_next'] = $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index'] + $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['step'];
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['first']      = ($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['iteration'] == 1);
-$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['last']       = ($_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['iteration'] == $_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['total']);
-
-$this-&gt;content .= '&lt;tr&gt;';
-					if ($_CLASS['core_template']-&gt;_tpl_vars['mcp_section'][$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index']]['S_SELECTED']):
-					$this-&gt;content .= '&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;nav&quot;&gt;'.$_CLASS['core_template']-&gt;_tpl_vars['mcp_section'][$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index']]['L_TITLE'].'
-&lt;/b&gt;
-
-						&lt;ul class=&quot;nav&quot; style=&quot;margin: 0px; padding: 0px; list-style-type: none; line-height: 175%;&quot;&gt;';
-
-						unset($_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']);
-$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['name'] = 'mcp_subsectionloop';
-$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['loop'] = is_array($_loop=$_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection']) ? count($_loop) : max(0, (int)$_loop); unset($_loop);
-$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['show'] = true;
-$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['max'] = $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['loop'];
-$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['step'] = 1;
-$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['start'] = $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['step'] &gt; 0 ? 0 : $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['loop']-1;
-if ($_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['show']) {
-    $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['total'] = $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['loop'];
-    if ($_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['total'] == 0)
-        $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['show'] = false;
-} else
-    $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['total'] = 0;
-if ($_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['show']):
-
-            for ($_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index'] = $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['start'], $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['iteration'] = 1;
-                 $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['iteration'] &lt;= $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['total'];
-                 $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index'] += $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['step'], $_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['iteration']++):
-
-$this-&gt;content .= '&lt;li&gt;&#187;';
-	
-if ($_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['S_SELECTED'])
-{
-	 $this-&gt;content .= '&lt;b&gt;'.$_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['L_TITLE'];
-	 
-	 if ($_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['ADD_ITEM'])
-	 {
-		$this-&gt;content .= ' ('. $_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['ADD_ITEM'].')';
-	}
-
-	$this-&gt;content .= '&lt;/b&gt;';
-}
-else
-{
-	$this-&gt;content .= '&lt;a href=&quot;'.$_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['U_TITLE'].'&quot;&gt;'.$_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['L_TITLE'];
-
-	if ($_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['ADD_ITEM'])
-	{
-		$this-&gt;content .= ' ('. $_CLASS['core_template']-&gt;_tpl_vars['mcp_subsection'][$_CLASS['core_template']-&gt;_sections['mcp_subsectionloop']['index']]['ADD_ITEM'].')'; 
-	}
-
-	$this-&gt;content .= '&lt;/a&gt;';
-}
-
-
-$this-&gt;content .= '&lt;/li&gt;';
-							
-						endfor; endif;
-						$this-&gt;content .= '&lt;/ul&gt;';
-
-					else:
-					$this-&gt;content .= '&lt;td class=&quot;row2&quot; nowrap=&quot;nowrap&quot; onmouseover=&quot;this.className=\'row1\'&quot; onmouseout=&quot;this.className=\'row2\'&quot; onclick=&quot;location.href=\''.$_CLASS['core_template']-&gt;_tpl_vars['mcp_section'][$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index']]['U_TITLE'].'
-\'&quot;&gt;&lt;a class=&quot;nav&quot; href=&quot;'.$_CLASS['core_template']-&gt;_tpl_vars['mcp_section'][$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index']]['U_TITLE'].'
-&quot;&gt;'. $_CLASS['core_template']-&gt;_tpl_vars['mcp_section'][$_CLASS['core_template']-&gt;_sections['mcp_sectionloop']['index']]['L_TITLE'].'
-&lt;/a&gt;';
-					endif;
-					$this-&gt;content .= '&lt;/td&gt;
-				&lt;/tr&gt;';
-				endfor; endif;
-			$this-&gt;content .= '&lt;/table&gt;';
-
-?&gt;
\ No newline at end of file

Added: trunk/blocks/block-Modules.php
===================================================================
--- trunk/blocks/block-Modules.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/blocks/block-Modules.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,55 @@
+&lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
+// This is temp
+if (!defined('VIPERAL'))
+{
+    die;
+}
+
+global $_CLASS, $_CORE_MODULE;
+
+$this-&gt;content .= '&lt;div id=&quot;nav&quot;&gt;&lt;ul style=&quot;margin: 0px; padding: 0px; list-style-type: none; line-height: 150%;&quot;&gt;';
+$this-&gt;content .= '&lt;li&gt;&lt;a href=&quot;'.generate_link().'&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;';
+
+$result = $_CLASS['core_db']-&gt;query('SELECT module_name, module_title, module_auth FROM '.CORE_MODULES_TABLE.' WHERE module_type = '.MODULE_NORMAL.' AND module_status = ' . STATUS_ACTIVE . ' ORDER BY module_name ASC');
+
+while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+{
+// Add Auth here
+	$row['module_title'] = ($row['module_title']) ? $_CLASS['core_user']-&gt;get_lang($row['module_title']) : $_CLASS['core_user']-&gt;get_lang($row['module_name']);
+	
+	if ($row['module_name'] == $_CORE_MODULE['module_name'] &amp;&amp; !$_CLASS['core_display']-&gt;homepage)
+	{
+		$this-&gt;content .= '&lt;li&gt;&lt;b class=&quot;active&quot;&gt;'.$row['module_title'].'&lt;/b&gt;&lt;/li&gt;';
+	}
+	else
+	{
+		$this-&gt;content .= '&lt;li&gt;&lt;a href=&quot;'.generate_link($row['module_name']).'&quot;&gt; '.$row['module_title'].'&lt;/a&gt;&lt;/li&gt;';
+	}
+}
+
+$this-&gt;content .= '&lt;/ul&gt;&lt;/div&gt;';
+$_CLASS['core_db']-&gt;free_result($result);
+
+?&gt;
\ No newline at end of file

Modified: trunk/blocks/block-User.php
===================================================================
--- trunk/blocks/block-User.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/blocks/block-User.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,15 +1,25 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
 
 if (!defined('VIPERAL'))
 {

Deleted: trunk/blocks/block-latest-forums.php
===================================================================
--- trunk/blocks/block-latest-forums.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/blocks/block-latest-forums.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,65 +0,0 @@
-&lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
-
-if (!defined('VIPERAL')) {
-    Header('Location: ../');
-    die();
-}
-
-global $_CLASS, $phpEx;
-
-$Latest_Active_Topics = 12;
-
-$result = $_CLASS['core_db']-&gt;sql_query('SELECT 
-forum_id, topic_last_post_id ,topic_title, 
-topic_last_poster_name, topic_last_poster_id, topic_last_post_time
-FROM '.TOPICS_TABLE.' WHERE topic_moved_id=0 AND topic_approved=1 ORDER BY topic_last_post_time DESC 
-LIMIT 0, '.$Latest_Active_Topics);
-
-if (!$row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
-{
-	$_CLASS['core_db']-&gt;sql_freeresult($result);
-	return;
-}
-
-$counter = 0;
-$num = 1;
-$this-&gt;content = '&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellpadding=&quot;4&quot;&gt;&lt;tr&gt;';
-
-do {
-	
-    if ($counter == 3)
-    {
-        $this-&gt;content .= '&lt;/tr&gt;&lt;tr&gt;';
-        $counter = 0;
-	}
-	
-	$row['topic_title'] = (strlen($row['topic_title']) &lt;  25) ? $row['topic_title'] : substr($row['topic_title'], 0, 25) . '...';
-
-    $this-&gt;content .= '&lt;td width=&quot;33%&quot;&gt;'
-    .'&lt;span style=&quot;font-size: 140%; font-weight: bold;&quot; &gt;'.$num.'&lt;/span&gt;&nbsp;'
-    .'&lt;a style=&quot;font-weight: bold;&quot; href=&quot;'.getlink('Forums&amp;file=viewtopic&amp;f='.$row['forum_id'].'&amp;p='.$row['topic_last_post_id'].'#'.$row['topic_last_post_id'])
-    .'&quot; &gt;'.$row['topic_title'].'&lt;/a&gt;&lt;br /&gt;'
-    .'&lt;i&gt;Last post by &lt;a href=&quot;'.getlink('Members_List&amp;mode=viewprofile&amp;u='.$row['topic_last_poster_id']).'&quot;&gt;'. $row['topic_last_poster_name'] .'&lt;/a&gt;'
-    .'&lt;br/&gt; on '.$_CLASS['core_user']-&gt;format_date($row['topic_last_post_time']).'&lt;/i&gt;&lt;br /&gt;&lt;br /&gt;&lt;/td&gt;';
-	
-    $counter ++;
-    $num ++;
-}
-while($row = $_CLASS['core_db']-&gt;sql_fetchrow($result));
-
-$_CLASS['core_db']-&gt;sql_freeresult($result);
-
-$this-&gt;content .= '&lt;/tr&gt;&lt;/table&gt;';
-
-?&gt;
\ No newline at end of file

Modified: trunk/config.php
===================================================================
--- trunk/config.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/config.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,101 @@
+&lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
+// TEMP
+
+// do not modify!
+if (!defined('VIPERAL'))
+{
+    die;
+}
+
+//echo getenv('DOCUMENT_ROOT'); die;
+/*
+If (getenv('DOCUMENT_ROOT') != 'C:/Program Files/Apache Group/Apache2/htdocs')
+{
+    die('Your site shouldn\'t access this file');
+}
+*/
+
+$prefix = 'test_';
+$user_prefix = 'test_';
+
+/*
+$site_db['type']		= 'mysql';
+$site_db['server']		= '';
+$site_db['port']		= '';
+$site_db['database']	= 'cms';
+$site_db['username']	= 'root';
+$site_db['password']	= '';
+$site_db['persistent']	= false;
+*/
+
+
+$site_db['type']		= 'postgres';
+$site_db['server']		= '';
+$site_db['port']		= '';
+$site_db['database']	= 'cms';
+$site_db['username']	= 'postgres';
+$site_db['password']	= 'viper83';
+$site_db['persistent']	= false;
+
+
+/*
+$site_db['type']	= 'sqlite';
+$site_db['file']	= 'C:\Program Files\Apache Group\Apache2\tester';
+$site_db['persistent']	= false;
+*/
+
+/*
+$site_db['type']	= 'sqlite_pdo';
+$site_db['file']	= 'C:\Program Files\Apache Group\Apache2\tester_pdo';
+$site_db['persistent']	= false;
+
+*/
+
+/*
+NOT WORKING
+
+$site_db['type']		= 'mssql';
+$site_db['server']		= '';
+$site_db['port']		= '';
+$site_db['database']	= 'tester';
+$site_db['username']	= '';
+$site_db['password']	= '';
+$site_db['persistent']	= false;
+*/
+
+//$acm_type = 'eaccelerator';
+$acm_type = 'file';
+
+if (!defined('INDEX_PAGE'))
+{
+	define('INDEX_PAGE', 'index.php');
+}
+
+if (!defined('ADMIN_PAGE'))
+{
+	define('ADMIN_PAGE', 'admin.php');
+}
+
+?&gt;
\ No newline at end of file

Modified: trunk/core.php
===================================================================
--- trunk/core.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/core.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,25 +1,40 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright 2004 - 2005										//
-//  By Ryan Marshall ( Viperal )								//
-//																//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 if (!defined('VIPERAL'))
 {
     die;
 }
 
+error_reporting(E_ALL);
+//error_reporting(0);
+
+if (!extension_loaded('mbstring'))
+{
+	require_once($site_file_root.'includes/compatiblity/mbstring.php');
+}
+
 set_magic_quotes_runtime(0);
-error_reporting(E_ALL);
 mb_internal_encoding('UTF-8');
 //mb_http_output('UTF-8');
 
@@ -36,20 +51,17 @@
 
 $starttime = explode(' ', microtime());
 $starttime = $starttime[1] + $starttime[0];
+$base_memory_usage = get_memory_usage();
 
-// Move to index files
-$base_memory_usage = function_exists('memory_get_usage') ? memory_get_usage() : 0;
+require_once($site_file_root.'includes/functions.php');
+require_once($site_file_root.'config.php');
+require_once($site_file_root.'includes/tables.php');
+require_once($site_file_root.'includes/handler.php');
+require_once($site_file_root.'includes/db/'.$site_db['type'].'.php');
+require_once($site_file_root.'includes/display/template.php');
+require_once($site_file_root.'includes/cache/cache.php');
+require_once($site_file_root.'includes/cache/cache_' . $acm_type . '.php');
 
-require($site_file_root.'includes/functions.php');
-require($site_file_root.'config.php');
-require($site_file_root.'includes/tables.php');
-require($site_file_root.'includes/handler.php');
-require($site_file_root.'includes/mailer.php');
-require($site_file_root.'includes/db/'.$site_db['type'].'.php');
-require($site_file_root.'includes/display/template.php');
-require($site_file_root.'includes/cache/cache.php');
-require($site_file_root.'includes/cache/cache_' . $acm_type . '.php');
-
 // Load basic classes
 load_class(false, 'core_error_handler');
 load_class(false, 'core_cache', 'cache_'.$acm_type);
@@ -69,6 +81,21 @@
 $_CLASS['core_db']-&gt;connect($site_db);
 unset($sitedb);
 
+/*
+$_CLASS['core_db']-&gt;transaction();
+require($site_file_root.'install/build_tables.php');
+$_CLASS['core_db']-&gt;transaction('commit');
+die;
+*/
+
+
+/*
+$_CLASS['core_db']-&gt;transaction();
+require($site_file_root.'install/build_data.php');
+$_CLASS['core_db']-&gt;transaction('commit');
+die;
+*/
+
 $_CLASS['core_db']-&gt;return_on_error = true;
 
 // Error messages just incase we can't get our configs
@@ -77,7 +104,7 @@
 
 if (is_null($_CORE_CONFIG = $_CLASS['core_cache']-&gt;get('core_config')))
 {
-	$_CORE_CONFIG = array();
+	$_CORE_CONFIG = $cache = array();
 
 	$sql = 'SELECT * FROM '.CORE_CONFIG_TABLE;
 		
@@ -88,12 +115,30 @@
 	
 	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
-		$_CORE_CONFIG[$row['section']][$row['name']] = $row['value'];
+		if ($row['config_cache'])
+		{
+			$cache[$row['config_section']][$row['config_name']] = $row['config_value'];
+		}
+		$_CORE_CONFIG[$row['config_section']][$row['config_name']] = $row['config_value'];
 	}
 	$_CLASS['core_db']-&gt;free_result($result);
 
-	$_CLASS['core_cache']-&gt;put('core_config', $_CORE_CONFIG);
+	$_CLASS['core_cache']-&gt;put('core_config', $cache);
+	unset($cache);
 }
+else
+{
+	$sql = 'SELECT * FROM ' . CORE_CONFIG_TABLE . ' WHERE config_cache = 0';
+		
+	if ($result = $_CLASS['core_db']-&gt;query($sql))
+	{
+		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+		{
+			$_CORE_CONFIG[$row['config_section']][$row['config_name']] = $row['config_value'];
+		}
+		$_CLASS['core_db']-&gt;free_result($result);
+	}
+}
 
 unset($config_error);
 
@@ -137,13 +182,58 @@
 }
 else
 {
-	$_CORE_CONFIG['global']['error'] = ERROR_NONE;
+	$_CORE_CONFIG['server']['error_options'] = ERROR_NONE;
 	$_CLASS['core_error_handler']-&gt;report = ERROR_NONE;
 }
 
+/*
+$_CORE_CONFIG['server']['error_options'] = ERROR_DEBUGGER;	
+//$_CORE_CONFIG['server']['error_options'] = ERROR_ONPAGE;	
+$_CLASS['core_error_handler']-&gt;report = $_CORE_CONFIG['server']['error_options'];
+*/
+
 if ($_SERVER['REQUEST_METHOD'] == 'POST' &amp;&amp; $_CLASS['core_user']-&gt;new_session)
 {
 	// error here
 }
 
+$install_prefix = 'test_';
+$time = gmtime();
+
+if (!function_exists('field_unix_time'))
+{
+	function field_unix_time($name, $null = false)
+	{
+		global $_CLASS;
+	
+		$_CLASS['core_db']-&gt;add_table_field_int($name, array('max' =&gt; 200000000, 'null' =&gt; $null));
+	}
+}
+
+function get_memory_usage()
+{
+	if (function_exists('memory_get_usage'))
+	{
+		return memory_get_usage();
+	}
+
+/*
+	This pisses me off, seeing that screen pop up all the time :-(
+	Enable it if you want, Will be disabled by default
+
+	if (PHP_OS == 'WINNT')
+	{
+		exec('tasklist /fi &quot;PID eq ' . getmypid() . '&quot; /fo LIST', $output); 
+		//Mem Usage: 24,064 K
+		if (!empty($output[5]))
+		{
+			$usage = (int) str_replace(',', '', substr($output[5], strpos($output[5], ':' ) + 1));
+			// hopefully it always returns the value in KBs
+			return $usage * 1000;
+		}
+	}
+*/
+	return 0;
+}
+
 ?&gt;
\ No newline at end of file

Modified: trunk/debug.php
===================================================================
--- trunk/debug.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/debug.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -22,7 +22,7 @@
 
 if (!$_CLASS['core_user']-&gt;is_admin)
 {
-	//die('this is admin only :-) need better language :-(');
+	die('this is admin only :-) need better language :-(');
 }
 
 $_CLASS['core_error_handler']-&gt;stop();

Modified: trunk/feed.php
===================================================================
--- trunk/feed.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/feed.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -15,44 +15,46 @@
 define('VIPERAL', 'FEED');
 
 //echo str_replace('\\','/', dirname(getenv('SCRIPT_FILENAME'))).'/'; die;
-$site_file_root = 'C:/apachefriends/xampp/cms/';
+$site_file_root = '';
 
 require($site_file_root.'core.php');
 
-error_reporting(0);
+//error_reporting(0);
 header('Content-Type: text/xml');
 
-$result = $_CLASS['core_db']-&gt;sql_query('SELECT id, title, time, intro, poster_name FROM '.$prefix.'_news ORDER BY id DESC LIMIT 10');
+$result = $_CLASS['core_db']-&gt;query('SELECT news_id, news_title, news_time, news_intro, poster_name FROM '.$prefix.'news ORDER BY news_id DESC LIMIT 10');
 
 $last_post_time = 0;
 	
-while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 {
-	if ($row['time'] &gt; $last_post_time)
+	if ($row['news_time'] &gt; $last_post_time)
 	{
-		$last_post_time = $row['time'];
+		$last_post_time = $row['news_time'];
 	}
 	
 	$_CLASS['core_template']-&gt;assign_vars_array('items', array(
-		'TITLE' 		=&gt; htmlspecialchars($row['title'], ENT_QUOTES),
-		'LINK' 			=&gt; generate_link('News&amp;mode=view&amp;id='.$row['id'], array('full' =&gt; true)),
-		'DESCRIPTION' 	=&gt; htmlspecialchars(strip_tags($row['intro']), ENT_QUOTES),
-		'TIME'			=&gt; gmdate('M d Y H:i:s', $row['time']) .' GMT',
-		'AUTHOR'		=&gt; $row['poster_name']
+		'TITLE' 			=&gt; htmlspecialchars($row['news_title'], ENT_QUOTES),
+		'LINK' 				=&gt; generate_link('News&amp;mode=view&amp;id='.$row['news_id'], array('full' =&gt; true, 'sid' =&gt; false)),
+		'DESCRIPTION' 		=&gt; htmlspecialchars(strip_tags($row['news_intro']), ENT_QUOTES),
+		'DESCRIPTION_HTML' 	=&gt; htmlspecialchars($row['news_intro'], ENT_QUOTES),
+		'TIME'				=&gt; date('M d Y H:i:s', $row['news_time']) .' GMT',
+		'AUTHOR'			=&gt; $row['poster_name']
 	));
 }
+$_CLASS['core_db']-&gt;free_result($result);
 
-$_CLASS['core_db']-&gt;sql_freeresult($result);
+$last_modified = date('M d Y H:i:s', $last_post_time) .' GMT';
 
-$_CLASS['core_template']-&gt;assign(array(
-		'SITE_NAME' 	=&gt; $_CORE_CONFIG['global']['site_name'],
-		'SITE_URL' 		=&gt; $_CORE_CONFIG['global']['site_url'],
-		'SLOGAN' 		=&gt; $_CORE_CONFIG['global']['slogan'],
-		'LANG'			=&gt; 'en-us',
-		'LAST_MODIFIED'	=&gt; gmdate('M d Y H:i:s', $last_post_time) .' GMT',
-		'TIME'			=&gt; gmdate('M d Y H:i:s', time()) .' GMT'
-	));
+$_CLASS['core_template']-&gt;assign_array(array(
+	'SITE_NAME' 	=&gt; $_CORE_CONFIG['global']['site_name'],
+	'SITE_URL' 		=&gt; $_CORE_CONFIG['global']['site_url'],
+	'LANG'			=&gt; 'en-us',
+	'LAST_MODIFIED'	=&gt; $last_modified ,
+	'TIME'			=&gt; gmdate('M d Y H:i:s') .' GMT'
+));
 
+//header('Last-Modified: '.$last_modified);
 
 $feed = get_variable('feed', 'GET', false);
 
@@ -60,23 +62,26 @@
 {
 	case 'rdf':
 	case 'rss1':
+		$_CLASS['core_template']-&gt;display('rss/rdf.html');
+	break;
 
-	$_CLASS['core_template']-&gt;display('rss/rdf.html');
-	break;
-	
 	case 'rss2':
-	$_CLASS['core_template']-&gt;display('rss/rss2.html');
+		$_CLASS['core_template']-&gt;display('rss/rss2.html');
 	break;
-	
+
 	case 'rss':
-	$_CLASS['core_template']-&gt;display('rss/rss91.html');
+		$_CLASS['core_template']-&gt;display('rss/rss91.html');
 	break;
-		
+
+	case 'atom':
+		$_CLASS['core_template']-&gt;display('rss/atom.html');
+	break;
+
 	default:
-	$_CLASS['core_template']-&gt;display('rss/rss91.html');
+		$_CLASS['core_template']-&gt;display('rss/rss91.html');
+	break;
 }
 
 script_close();
-die;
 
 ?&gt;
\ No newline at end of file

Modified: trunk/images/Thumbs.db
===================================================================
(Binary files differ)

Modified: trunk/includes/auth/auth.php
===================================================================
--- trunk/includes/auth/auth.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/auth/auth.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -23,17 +23,17 @@
 {
 	var $_user_id;
 	var $_group_ids = array();
-	var $_group_default_id;
+	var $_user_group;
 
 	var $_got_data = false;
 	var $_admin_permission = array();
 
-	function core_auth($user_id = false, $group_id = false)
+	function core_auth($user_id = false, $user_group = false)
 	{
 		global $_CLASS;
 
 		$this-&gt;_user_id = ($user_id) ? $user_id : $_CLASS['core_user']-&gt;data['user_id'];
-		$this-&gt;_group_default_id = ($group_id) ? $group_id : $_CLASS['core_user']-&gt;data['group_id'];
+		$this-&gt;_user_group = ($user_group) ? $user_group : $_CLASS['core_user']-&gt;data['user_group'];
 	}
 
 	function user_auth($user_name, $user_password)
@@ -80,8 +80,8 @@
 
 // should this be extended for defualt groups only, and all in group ?
 		$sql = 'SELECT * FROM ' . ADMIN_AUTH_TABLE .&quot; 
-					WHERE member_user_id = {$this-&gt;_user_id}
-					OR member_group_id = {$this-&gt;_group_default_id} ORDER BY member_user_id&quot;;
+					WHERE user_id = {$this-&gt;_user_id}
+					OR group_id = {$this-&gt;_user_group} ORDER BY user_id&quot;;
 
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -98,7 +98,7 @@
 
 				if (trim($row['admin_options']) &amp;&amp; is_array($row['admin_options'] = @unserialize($row['admin_options'])))
 				{
-					$this-&gt;_admin_permission[$row['section']] = $row['options'];
+					$this-&gt;_admin_permission[$row['admin_section']] += $row['options'];
 				}
 			}
 		}
@@ -118,7 +118,7 @@
 
 		if (!isset($this-&gt;_admin_permission[$section]))
 		{
-			return isset($this-&gt;_admin_permission['/all/']) ?  true : false;
+			return isset($this-&gt;_admin_permission['_all_']) ?  true : false;
 		}
 
 		if ($option)
@@ -162,7 +162,7 @@
 			if (!$error &amp;&amp; $_CORE_CONFIG['user']['enable_confirm'])
 			{
 				$code = $_CLASS['core_user']-&gt;session_data_get('confirmation_code');
-				$confirm_code = get_variable('confirm_code', 'POST');
+				$confirm_code = get_variable('confirm_code', 'POST', false);
 	
 				if (!$code || !$confirm_code || $code !== $confirm_code)
 				{
@@ -200,7 +200,7 @@
 		if ($_CORE_CONFIG['user']['enable_confirm'])
 		{
 			$confirm_image = '&lt;img src=&quot;'.generate_link('system&amp;mode=confirmation_image').'&quot; alt=&quot;&quot; title=&quot;&quot; /&gt;';
-			$_CLASS['core_user']-&gt;session_data_set('confirmation_code', strtoupper(generate_string(6)));
+			$_CLASS['core_user']-&gt;session_data_set('confirmation_code', generate_string(6));
 		}
 		else
 		{
@@ -212,7 +212,7 @@
 			'LOGIN_EXPLAIN'			=&gt; $_CLASS['core_user']-&gt;get_lang($login_array['explain']), 
 
 			'U_SEND_PASSWORD'	 	=&gt; ($_CORE_CONFIG['email']['email_enable']) ? generate_link('Control_Panel&amp;mode=sendpassword') : '',
-			'U_RESEND_ACTIVATION'   =&gt; ($_CORE_CONFIG['user']['require_activation'] != USER_ACTIVATION_NONE &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('Control_Panel&amp;mode=resend_act') : '',
+			'U_RESEND_ACTIVATION'   =&gt; ($_CORE_CONFIG['user']['activation'] != USER_ACTIVATION_NONE &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('Control_Panel&amp;mode=resend_act') : '',
 			'U_TERMS_USE'			=&gt; generate_link('Control_Panel&amp;mode=terms'), 
 			'U_PRIVACY'				=&gt; generate_link('Control_Panel&amp;mode=privacy'),
 			'U_REGISTER'			=&gt; generate_link('Control_Panel&amp;mode=register'),
@@ -260,7 +260,7 @@
 			// need to sort/seperate this so that Only Default goups are first
 			foreach ($options_array['groups'][1] as $id =&gt; $group_options)
 			{
-				if ($id == $this-&gt;_group_default_id)
+				if ($id == $this-&gt;_user_group)
 				{
 					return (isset($group_options[$option]) ? $group_options[$option] : false);
 				}
@@ -385,8 +385,7 @@
 							unset($auth_options['users'][$key]);
 						}
 					}
-
-					//print_r($auth_options);
+					
 				break;
 			
 				case 'set':
@@ -396,13 +395,9 @@
 
 			$return = null;
 
-			foreach ($auth_options as $test)
+			if (!empty($auth_options['users'])|| !empty($auth_options['groups'][0])	|| !empty($auth_options['groups'][1]))
 			{
-				if (!empty($test))
-				{
-					$return =&amp; $auth_options;
-					break;
-				}
+				$return =&amp; $auth_options;
 			}
 		}
 

Modified: trunk/includes/cache/cache_file.php
===================================================================
--- trunk/includes/cache/cache_file.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/cache/cache_file.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -70,8 +70,13 @@
 		$this-&gt;expires[$name] = $expires;
 	}
 	
-	function gc()
+	function gc($time = false)
 	{
+		if (!$time)
+		{
+			$time = gmtime();
+		}
+
 		$dir = opendir($this-&gt;cache_dir);
 
 		while ($file = readdir($dir))
@@ -87,13 +92,16 @@
 					$unset = true;
 				}
 				
-				if (time() &gt; $this-&gt;expires[$name])
+				if ($time &gt; $this-&gt;expires[$name])
 				{
 					unlink($this-&gt;cache_dir . $file);
 					$this-&gt;remove($name);
 				}
 
-				($unset) ? $this-&gt;remove($name) : '';
+				if ($unset)
+				{
+					$this-&gt;remove($name);
+				}
 			}
 		}
 

Modified: trunk/includes/core_rss.php
===================================================================
--- trunk/includes/core_rss.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/core_rss.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -17,7 +17,10 @@
 ||  of the GNU General Public License version 2					||
 ||																||
 ||**************************************************************||
+
+$Id$
 */
+
 // Add channel support, rss_data[channel][item][item_branch]
 // nested items
 // maybe make this more xml specfic with another rss function?
@@ -30,6 +33,7 @@
 	var $item_tags = array('title', 'link', 'description', 'author');
 	var $channel_tags = array('title', 'link', 'description', 'author');
 	var $send_cookie = false;
+	var $channel_open = false;
 
 	var $error = '';
 	var $item = 0;
@@ -134,7 +138,6 @@
 		if (mb_strpos($data, '200') === false)
 		{
 			//echo $data;
-
 			if (mb_strpos($data, '301') === true || mb_strpos($data, '301') === true)
 			{
 				while (!empty($data))
@@ -239,31 +242,32 @@
 			return;
 		}
 
-		$element = strtolower($element);
-
 		if (mb_strpos($element, ':'))
 		{
 			list($element) = explode(':', $element, 2);
 		}
 
+		$element = strtolower($element);
+
 		if (!$this-&gt;feed_type)
 		{
 			switch($element)
 			{
 				Case 'rdf':
 					$this-&gt;feed_type = 'rss';
-					break;
+				break;
 				
 				Case 'rss':
 					$this-&gt;feed_type = 'rss';
-					break;
+				break;
 				
 				Case 'feed':
 					$this-&gt;feed_type = 'atom';
-					break;
+				break;
 
 				default:
 					$this-&gt;feed_type = 'generic';
+				break;
 			}
 
 			$attrs = array_change_key_case($attrs, CASE_LOWER);
@@ -274,16 +278,22 @@
 			return;
 		}
 
-		if ($element == 'item' || $element == 'entry')
+		if ($element === 'item' || $element === 'entry')
 		{
 			$this-&gt;item_open = true;
 			return;
 		}
-		elseif ($element == 'channel' || $element == 'feed')
+		elseif ($element === 'channel' || $element === 'feed')
 		{
 			$this-&gt;channel_open = true;
 			return;
 		}
+		
+		if ($element == 'link' &amp;&amp; $this-&gt;feed_type == 'atom' &amp;&amp; in_array($element, $this-&gt;item_tags))
+		{
+			$this-&gt;rss_data[$this-&gt;item][$element] = $attrs['HREF'];
+			return;
+		}
 
 		if ($this-&gt;item_open)
 		{
@@ -291,7 +301,6 @@
 			{
 				$this-&gt;title_type = $element;
 			}
-			return;
 		}
 		else
 		{

Modified: trunk/includes/db/mysql.php
===================================================================
--- trunk/includes/db/mysql.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/db/mysql.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -62,14 +62,6 @@
 
 				//mysql_query('SET character_set_results = NULL', $this-&gt;link_identifier);
 
-				/*
-				$result = mysql_query(&quot;show variables like 'col%'&quot;,$this-&gt;link_identifier);
-				while ($value = mysql_fetch_assoc($result))
-				{
-					print_r($value);
-					echo '&lt;br&gt;';
-				}
-				*/
 				return $this-&gt;link_identifier;
 			}
 
@@ -201,11 +193,6 @@
 		return $this-&gt;last_result;
 	}
 
-	function sql_query($query = false)
-	{
-		return mysql_query($query, $this-&gt;link_identifier);
-	}
-
 	function query_limit($query = false, $total = false, $offset = 0, $backtrace = false) 
 	{
 		if (!$query || !$total || !$this-&gt;link_identifier) 
@@ -232,6 +219,11 @@
 		return $this-&gt;query($query, $backtrace);
 	}
 
+	function sql_query($query = false)
+	{
+		return mysql_query($query, $this-&gt;link_identifier);
+	}
+
 	/*
 		Boy do I like this but it phpBB's, may have to do something similar
 	*/
@@ -364,18 +356,21 @@
 
 	function escape($text)
 	{
-		if (function_exists('mysql_real_escape_string') &amp;&amp; $this-&gt;link_identifier)
-		{
-			return mysql_real_escape_string($text, $this-&gt;link_identifier);
+		if (!$this-&gt;link_identifier)
+		{ 
+			return false; 
 		}
-		else
-		{
-			return mysql_escape_string($text);
-		}
+
+		return mysql_real_escape_string($text, $this-&gt;link_identifier);
 	}
 
 	function escape_array($value)
 	{
+		if (!$this-&gt;link_identifier)
+		{ 
+			return false; 
+		}
+
 		return preg_replace('#(.*?)#e', &quot;\$this-&gt;escape('\\1')&quot;, $value);
 	}
 		
@@ -660,4 +655,12 @@
 	}
 }
 
+if (!function_exists('mysql_real_escape_string'))
+{
+	function mysql_real_escape_string($text, $null)
+	{
+		return mysql_escape_string($text);
+	}
+}
+
 ?&gt;
\ No newline at end of file

Modified: trunk/includes/db/mysqli.php
===================================================================
--- trunk/includes/db/mysqli.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/db/mysqli.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -23,7 +23,7 @@
 
 class db_mysqli
 {
-	var $link_identifier;
+	var $link_identifier = false;
 	var $db_layer = 'mysqli';
 
 	var $last_result;
@@ -37,9 +37,9 @@
 	var $query_details = array();
 	var $open_queries = array();
 
-	var $indexs = array();
-	var $fields = array();
-	var $table_name = false;
+	var $_indexs = array();
+	var $_fields = array();
+	var $_table_name = false;
 
 	function connect($db)
 	{		
@@ -183,7 +183,7 @@
 		{
 			$this-&gt;_error($query, $backtrace);
 		}
-		elseif (strpos($query, 'SELECT') !== false)
+		elseif (strpos($query, 'SELECT') === false)
 		{
 			$this-&gt;open_queries[(string) $this-&gt;last_result] = $this-&gt;last_result;
 		}
@@ -232,13 +232,13 @@
 			return false;
 		}
 
-		$fields = $values = array();
+		$_fields = $values = array();
 
 		if ($query == 'INSERT')
 		{
 			foreach ($array as $key =&gt; $value)
 			{
-				$fields[] = $key;
+				$_fields[] = $key;
 
 				if (is_numeric($value))
 				{
@@ -258,7 +258,7 @@
 				}
 			}
 
-			return ' (' . implode(', ', $fields) . ') VALUES (' . implode(', ', $values) . ')';
+			return ' (' . implode(', ', $_fields) . ') VALUES (' . implode(', ', $values) . ')';
 		}
 		elseif ($query == 'UPDATE' || $query == 'SELECT')
 		{
@@ -371,6 +371,11 @@
 
 	function escape_array($value)
 	{
+		if (!$this-&gt;link_identifier)
+		{ 
+			return false; 
+		}
+
 		return preg_replace('#(.*?)#e', &quot;\$this-&gt;escape('\\1')&quot;, $value);
 	}
 
@@ -516,13 +521,13 @@
 					return;
 				}
 
-				$fields = implode(&quot;, \n&quot;, $this-&gt;_fields);
-				if ($indexs = implode(&quot;, \n&quot;, $this-&gt;_indexs))
+				$_fields = implode(&quot;, \n&quot;, $this-&gt;_fields);
+				if ($_indexs = implode(&quot;, \n&quot;, $this-&gt;_indexs))
 				{
-					$fields .= &quot;, \n&quot;;
+					$_fields .= &quot;, \n&quot;;
 				}
 
-				$table = 'CREATE TABLE '.$this-&gt;_table_name.&quot; ( \n&quot; .$fields. $indexs .&quot; \n ) ENGINE=InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;&quot;;
+				$table = 'CREATE TABLE '.$this-&gt;_table_name.&quot; ( \n&quot; .$_fields. $_indexs .&quot; \n ) ENGINE=InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci;&quot;;
 				// Let users choose transaction safe InnoDB or MyISAM
 				// ENGINE=MyISAM
 				if ($option == 'return')
@@ -598,7 +603,7 @@
 		}
 	}
 
-	function add_table_field_text($name, $characters = 60000, $null = false)
+	function add_table_field_text($name, $characters, $null = false)
 	{
 		if ($characters &lt;= 255)
 		{
@@ -627,18 +632,14 @@
 	function add_table_field_char($name, $characters, $null = false, $default = null, $padded = false)
 	{
 		$this-&gt;_fields[$name] = ($padded) ? &quot;`$name` CHAR($characters)&quot; :  &quot;`$name` VARCHAR($characters)&quot;;
-		$this-&gt;_fields[$name] .= $null ? &quot; NULL&quot; : &quot; NOT NULL&quot;;
+		$this-&gt;_fields[$name] .= ($null) ? &quot; NULL&quot; : &quot; NOT NULL&quot;;
 		$this-&gt;_fields[$name] .= is_null($default) ? '' : &quot;DEFAULT '$default'&quot;;
 	}
 
 	function add_table_index($field, $type  = 'index', $index_name = false)
 	{
-		$index_name = ($index_name) ? $index_name : $field;
+		$index_name = $index_name ? $index_name : $field;
 		
-		/*if (empty($this-&gt;_fields[$field]))
-		{
-			return;
-		}*/
 		$field = is_array($field) ? implode('` , `', $field) : $field;
 
 		switch ($type)

Modified: trunk/includes/db/postgres.php
===================================================================
--- trunk/includes/db/postgres.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/db/postgres.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -552,7 +552,7 @@
 
 				if (!$this-&gt;sql_query($table))
 				{
-				echo $table.'&lt;br/&gt;';
+					echo $table.'&lt;br/&gt;';
 				}
 
 			case 'cancel':
@@ -579,9 +579,9 @@
 			// INTEGER -- INT4 ( +auto_increment =&gt; SERIAL4 ) ( -2,147,483,648 to 2,147,483,647 )
 			$this-&gt;_fields[$name] =   ($setting['auto_increment']) ? &quot;$name SERIAL&quot; : &quot;$name INTEGER&quot;;
 		}
-		elseif ($setting['min'] &gt;= 9223372036854775808 &amp;&amp; $setting['max'] &lt;= 9223372036854775807)
+		elseif ($setting['min'] &gt;= -9223372036854775808 &amp;&amp; $setting['max'] &lt;= 9223372036854775807)
 		{
-			// BIGINT -- INT8 ( +auto_increment =&gt; SERIAL8 ) ( 9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 )
+			// BIGINT -- INT8 ( +auto_increment =&gt; SERIAL8 ) ( -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807 )
 			$this-&gt;_fields[$name] =  ($setting['auto_increment']) ? &quot;$name BIGSERIAL&quot; : &quot;$name BIGINT&quot;;
 		}
 
@@ -610,7 +610,11 @@
 
 	function add_table_index($field, $type  = 'index', $index_name = false)
 	{
-		$index_name = $this-&gt;_table_name.'_'.(($index_name) ? $index_name : $field) ;
+		$index_name = ($index_name) ? $index_name : $field;
+
+		$index_name = is_array($index_name) ? implode('_', $index_name) : $index_name;
+		$index_name = $this-&gt;_table_name . '_' . $index_name;
+
 		$field = is_array($field) ? implode(', ', $field) : $field;
 
 		switch ($type)

Modified: trunk/includes/db/sqlite.php
===================================================================
--- trunk/includes/db/sqlite.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/db/sqlite.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -523,13 +523,20 @@
 
 				// Have to create the table first then do the indexs
 				// I guess it's ....
-				$this-&gt;sql_query($table);
-
+				if (!$this-&gt;sql_query($table))
+				{
+					echo $table.'&lt;br/&gt;';
+				}
+				
 				foreach ($this-&gt;_indexs as $query)
 				{
-					$this-&gt;sql_query($query);
+					if (!$this-&gt;sql_query($query))
+					{
+						echo $query.'&lt;br/&gt;';
+					}
 				}
 
+
 			case 'cancel':
 				$this-&gt;_table_name = false;
 				$this-&gt;_fields = $this-&gt;_indexs = array();
@@ -537,59 +544,68 @@
 		}
 	}
 
-	function add_table_field_int($name, $number_min, $number_max = false, $default = null, $auto_increment = false)
+	function add_table_field_int($name, $setting_sent)
 	{
-		$length = max(strlen($number_min), strlen($number_max));
+		$setting = array('default' =&gt; null, 'auto_increment' =&gt; false, 'null' =&gt; false);
+		$setting = array_merge($setting, $setting_sent);
 
 		$this-&gt;_fields[$name] =  $name .' INTEGER';
 
-		if ($auto_increment)
+		if ($setting['auto_increment'])
 		{
 			$this-&gt;_fields[$name] .= ' AUTOINCREMENT';
 		}
 		else
 		{
-			$this-&gt;_fields[$name] .= (is_null($default)) ? &quot; NULL&quot; : &quot; NOT NULL DEFAULT '&quot;.(int) $default.&quot;'&quot;;
+			$this-&gt;_fields[$name] .= ($setting['null']) ? &quot; NULL&quot; : &quot; NOT NULL&quot;;
+			$this-&gt;_fields[$name] .= is_null($setting['default']) ? '' : &quot; DEFAULT '&quot;.(int) $setting['default'].&quot;'&quot;;
 		}
 	}
 
-	function add_table_field_text($name, $characters = 60000, $null = true)
+	function add_table_field_text($name, $characters, $null = true)
 	{
-		$this-&gt;_fields[$name] =  $name.' TEXT';
-		$this-&gt;_fields[$name] .= ($null) ? &quot; NULL&quot; : &quot; NOT NULL&quot;;
+		$this-&gt;_fields[$name] =  &quot;$name TEXT&quot;.(($null) ? &quot; NULL&quot; : &quot; NOT NULL&quot;);
 	}
 
-	function add_table_field_char($name, $characters, $default = null, $padded = false)
+	function add_table_field_char($name, $characters, $null = false, $default = null, $padded = false)
 	{
-
 		$this-&gt;_fields[$name] =  $name.' TEXT';
-		$this-&gt;_fields[$name] .= (is_null($default)) ? &quot; NULL&quot; : &quot; NOT NULL DEFAULT '$default'&quot;;
+		$this-&gt;_fields[$name] .= ($null) ? &quot; NULL&quot; : &quot; NOT NULL&quot;;
+		$this-&gt;_fields[$name] .= is_null($default) ? '' : &quot;DEFAULT '$default'&quot;;
 	}
 
 	function add_table_index($field, $type  = 'index', $index_name = false)
 	{
-		if (empty($this-&gt;_fields[$field]))
-		{
-			return;
-		}
+		$index_name = ($index_name) ? $index_name : $field;
 
-		$index_name = $this-&gt;_table_name.'_'.(($index_name) ? $index_name : $field) ;
+		$index_name = is_array($index_name) ? implode('_', $index_name) : $index_name;
+		$index_name = $this-&gt;_table_name . '_' . $index_name;
 
 		switch ($type)
 		{
 			case 'index':
-			case 'unique'://CREATE INDEX group_id ON test_admins ( group_id ) ; 
-				$this-&gt;_indexs[$index_name] = (($type == 'UNIQUE') ? 'CREATE UNIQUE' : 'CREATE') . &quot; INDEX $index_name ON {$this-&gt;_table_name} ( $field );&quot;;
+			case 'unique':
+				$field = is_array($field) ? implode(', ', $field) : $field;
+				$this-&gt;_indexs[$index_name] = (($type == 'UNIQUE') ? 'CREATE UNIQUE' : 'CREATE') . &quot; INDEX $index_name ON {$this-&gt;_table_name} ($field);&quot;;
 			break;
 
 			case 'primary':
-				if ($pos = stripos($this-&gt;_fields[$field], ' AUTOINCREMENT'))
+// need to check if sqlite even supports 2 pkeys
+				if (is_array($field))
 				{
+					// maybe make this regular indexes
+					return;
+				}
+
+				/*
+				if ($pos = strpos($this-&gt;_fields[$field], ' AUTOINCREMENT'))
+				{
 					$this-&gt;_fields[$field] = substr($this-&gt;_fields[$field], 0, $pos);
 					$this-&gt;_fields[$field] .= ' PRIMARY KEY AUTOINCREMENT'; // AUTOINCREMENT isn't needed
 
 					break;
 				}
+				*/
 
 				$this-&gt;_fields[$field] .= ' PRIMARY KEY';
 			break;

Added: trunk/includes/forums/admin/admin_ban.php
===================================================================
--- trunk/includes/forums/admin/admin_ban.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/admin/admin_ban.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,289 @@
+&lt;?php
+// -------------------------------------------------------------
+//
+// $Id: admin_ban.php,v 1.11 2004/08/01 21:01:23 psotfx Exp $
+//
+// FILENAME  : admin_ban.php
+// STARTED   : Tue Jul 31, 2001
+// COPYRIGHT : &#169; 2001,2003 phpBB Group
+// WWW       : <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
+// LICENCE   : GPL vs2.0 [ see /docs/COPYING ]
+//
+// -------------------------------------------------------------
+
+// Do we have ban permissions?
+if (!$auth-&gt;acl_get('a_ban'))
+{
+	trigger_error($user-&gt;lang['NO_ADMIN']);
+}
+
+include('includes/forums/functions_user.'.$phpEx);
+
+// Mode setting
+$mode		= request_var('mode', '');
+$bansubmit	= (isset($_POST['bansubmit'])) ? true : false;
+$unbansubmit= (isset($_POST['unbansubmit'])) ? true : false;
+
+// Set some vars
+$current_time = time();
+
+// Start program
+if ($bansubmit)
+{
+	// Grab the list of entries
+	$ban			= request_var('ban', '');
+	$ban_len		= request_var('banlength', 0);
+	$ban_len_other	= request_var('banlengthother', '');
+	$ban_exclude	= request_var('banexclude', 0);
+	$ban_reason		= request_var('banreason', '');
+
+	user_ban($mode, $ban, $ban_len, $ban_len_other, $ban_exclude, $ban_reason);
+
+	trigger_error($user-&gt;lang['BAN_UPDATE_SUCESSFUL']);
+}
+else if ($unbansubmit)
+{
+	$ban = request_var('unban', '');
+
+	user_unban($mode, $ban);
+
+	trigger_error($user-&gt;lang['BAN_UPDATE_SUCESSFUL']);
+}
+
+//
+// Output relevant entry page
+//
+
+
+//
+// Ban length options
+//
+$ban_end_text = array(0 =&gt; $user-&gt;lang['PERMANENT'], 30 =&gt; $user-&gt;lang['30_MINS'], 60 =&gt; $user-&gt;lang['1_HOUR'], 360 =&gt; $user-&gt;lang['6_HOURS'], 1440 =&gt; $user-&gt;lang['1_DAY'], 10080 =&gt; $user-&gt;lang['7_DAYS'], 20160 =&gt; $user-&gt;lang['2_WEEKS'], 40320 =&gt; $user-&gt;lang['1_MONTH'], -1 =&gt; $user-&gt;lang['OTHER'] . ' -&gt; ');
+
+$ban_end_options = '';
+foreach ($ban_end_text as $length =&gt; $text)
+{
+	$ban_end_options .= '&lt;option value=&quot;' . $length . '&quot;&gt;' . $text . '&lt;/option&gt;';
+}
+
+// Title
+switch ($mode)
+{
+	case 'user':
+		$l_title = $user-&gt;lang['BAN_USERS'];
+		break;
+	case 'email':
+		$l_title = $user-&gt;lang['BAN_EMAILS'];
+		break;
+	case 'ip':
+		$l_title = $user-&gt;lang['BAN_IPS'];
+		break;
+}
+
+// Output page
+adm_page_header($l_title);
+
+?&gt;
+
+&lt;p&gt;&lt;?php echo $user-&gt;lang['BAN_EXPLAIN']; ?&gt;&lt;/p&gt;
+
+&lt;?php
+
+switch ($mode)
+{
+	case 'user':
+
+		$field = 'username';
+		$l_ban_title = $user-&gt;lang['BAN_USERS'];
+		$l_ban_explain = $user-&gt;lang['BAN_USERNAME_EXPLAIN'];
+		$l_ban_exclude_explain = $user-&gt;lang['BAN_USER_EXCLUDE_EXPLAIN'];
+		$l_unban_title = $user-&gt;lang['UNBAN_USERNAME'];
+		$l_unban_explain = $user-&gt;lang['UNBAN_USERNAME_EXPLAIN'];
+		$l_ban_cell = $user-&gt;lang['USERNAME'] . ': &lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;[ &lt;a href=&quot;' . getlink('Members_List'.$SID.'&amp;mode=searchuser&amp;form=banning&amp;field=ban').'&quot; onclick=&quot;window.open(\''.getlink('Members_List'.$SID.'&amp;mode=searchuser&amp;form=banning&amp;field=ban').&quot;', '_phpbbsearch', 'HEIGHT=500,resizable=yes,scrollbars=yes,WIDTH=740');return false;\&quot;&gt;&quot; . $user-&gt;lang['FIND_USERNAME'] .'&lt;/a&gt; ]&lt;/span&gt;';
+		$l_no_ban_cell = $user-&gt;lang['NO_BANNED_USERS'];
+
+		$sql = 'SELECT b.*, u.user_id, u.username
+			FROM ' . BANLIST_TABLE . ' b, ' . USERS_TABLE . ' u
+			WHERE (b.ban_end &gt;= ' . time() . '
+					OR b.ban_end = 0)
+				AND u.user_id = b.ban_userid
+				AND b.ban_userid &lt;&gt; 0
+				AND u.user_id &lt;&gt; ' . ANONYMOUS . '
+			ORDER BY u.user_id ASC';
+		break;
+
+	case 'ip':
+
+		$field = 'ban_ip';
+		$l_ban_title = $user-&gt;lang['BAN_IPS'];
+		$l_ban_explain = $user-&gt;lang['BAN_IP_EXPLAIN'];
+		$l_ban_exclude_explain = $user-&gt;lang['BAN_IP_EXCLUDE_EXPLAIN'];
+		$l_unban_title = $user-&gt;lang['UNBAN_IP'];
+		$l_unban_explain = $user-&gt;lang['UNBAN_IP_EXPLAIN'];
+		$l_ban_cell = $user-&gt;lang['IP_HOSTNAME'] . ':';
+		$l_no_ban_cell = $user-&gt;lang['NO_BANNED_IP'];
+
+		$sql = 'SELECT *
+			FROM ' . BANLIST_TABLE . '
+			WHERE (ban_end &gt;= ' . time() . &quot;
+					OR ban_end = 0)
+				AND ban_ip &lt;&gt; ''&quot;;
+		break;
+
+	case 'email':
+
+		$field = 'ban_email';
+		$l_ban_title = $user-&gt;lang['BAN_EMAILS'];
+		$l_ban_explain = $user-&gt;lang['BAN_EMAIL_EXPLAIN'];
+		$l_ban_exclude_explain = $user-&gt;lang['BAN_EMAIL_EXCLUDE_EXPLAIN'];
+		$l_unban_title = $user-&gt;lang['UNBAN_EMAIL'];
+		$l_unban_explain = $user-&gt;lang['UNBAN_EMAIL_EXPLAIN'];
+		$l_ban_cell = $user-&gt;lang['EMAIL_ADDRESS'] . ':';
+		$l_no_ban_cell = $user-&gt;lang['NO_BANNED_EMAIL'];
+
+		$sql = 'SELECT *
+			FROM ' . BANLIST_TABLE . '
+			WHERE (ban_end &gt;= ' . time() . &quot;
+					OR ban_end = 0)
+				AND ban_email &lt;&gt; ''&quot;;
+		break;
+}
+$result = $db-&gt;sql_query($sql);
+
+$banned_options = '';
+$ban_length = $ban_reasons = array();
+if ($row = $db-&gt;sql_fetchrow($result))
+{
+	do
+	{
+
+		$banned_options .=  '&lt;option' . (($row['ban_exclude']) ? ' class=&quot;sep&quot;' : '') . ' value=&quot;' . $row['ban_id'] . '&quot;&gt;' . $row[$field] . '&lt;/option&gt;';
+
+		$time_length = (!empty($row['ban_end'])) ? ($row['ban_end'] - $row['ban_start']) / 60 : 0;
+		$ban_length[$row['ban_id']] = (!empty($ban_end_text[$time_length])) ? $ban_end_text[$time_length] : $user-&gt;lang['OTHER'] . ' -&gt; ' . gmdate('Y-m-d', $row['ban_end']);
+
+		$ban_reasons[$row['ban_id']] = addslashes($row['ban_reason']);
+	}
+	while ($row = $db-&gt;sql_fetchrow($result));
+}
+$db-&gt;sql_freeresult($result);
+
+?&gt;
+
+&lt;h1&gt;&lt;?php echo $l_ban_title; ?&gt;&lt;/h1&gt;
+
+&lt;p&gt;&lt;?php echo $l_ban_explain; ?&gt;&lt;/p&gt;
+
+&lt;script language=&quot;Javascript&quot; type=&quot;text/javascript&quot;&gt;
+&lt;!--
+
+var ban_length = new Array();
+&lt;?php
+
+	if (sizeof($ban_length))
+	{
+		foreach ($ban_length as $ban_id =&gt; $length)
+		{
+			echo &quot;ban_length['$ban_id'] = \&quot;$length\&quot;;\n&quot;;
+		}
+	}
+
+?&gt;
+
+var ban_reason = new Array();
+&lt;?php
+
+	if (sizeof($ban_reasons))
+	{
+		foreach ($ban_reasons as $ban_id =&gt; $reason)
+		{
+			echo &quot;ban_reason['$ban_id'] = \&quot;$reason\&quot;;\n&quot;;
+		}
+	}
+?&gt;
+
+function display_details(option)
+{
+	document.forms[0].unbanreason.value = ban_reason[option];
+	document.forms[0].unbanlength.value = ban_length[option];
+}
+
+//--&gt;
+&lt;/script&gt;
+
+&lt;form name=&quot;banning&quot; method=&quot;post&quot; action=&quot;&lt;?php echo &quot;admin_ban.$phpEx$SID&amp;mode=$mode&quot;; ?&gt;&quot;&gt;&lt;table class=&quot;bg&quot; width=&quot;80%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot; align=&quot;center&quot;&gt;
+	&lt;tr&gt;
+		&lt;th colspan=&quot;2&quot;&gt;&lt;?php echo $l_ban_title; ?&gt;&lt;/th&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $l_ban_cell; ?&gt;&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;textarea cols=&quot;40&quot; rows=&quot;3&quot; name=&quot;ban&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_LENGTH']; ?&gt;:&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;banlength&quot;&gt;&lt;?php echo $ban_end_options; ?&gt;&lt;/select&gt;&nbsp; &lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;banlengthother&quot; maxlength=&quot;10&quot; size=&quot;10&quot; /&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_EXCLUDE']; ?&gt;: &lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;&lt;?php echo $l_ban_exclude_explain;;?&gt;&lt;/span&gt;&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;banexclude&quot; value=&quot;1&quot; /&gt; &lt;?php echo $user-&gt;lang['YES']; ?&gt; &nbsp; &lt;input type=&quot;radio&quot; name=&quot;banexclude&quot; value=&quot;0&quot; checked=&quot;checked&quot; /&gt; &lt;?php echo $user-&gt;lang['NO']; ?&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_REASON']; ?&gt;:&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;banreason&quot; maxlength=&quot;255&quot; size=&quot;40&quot; /&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;bansubmit&quot; value=&quot;&lt;?php echo $user-&gt;lang['SUBMIT']; ?&gt;&quot; class=&quot;btnmain&quot; /&gt;&nbsp; &lt;input type=&quot;reset&quot; value=&quot;&lt;?php echo $user-&gt;lang['RESET']; ?&gt;&quot; class=&quot;btnlite&quot; /&gt;&nbsp;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;
+
+&lt;h1&gt;&lt;?php echo $l_unban_title; ?&gt;&lt;/h1&gt;
+
+&lt;p&gt;&lt;?php echo $l_unban_explain; ?&gt;&lt;/p&gt;
+
+&lt;table class=&quot;bg&quot; width=&quot;80%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot; align=&quot;center&quot;&gt;
+	&lt;tr&gt;
+		&lt;th colspan=&quot;2&quot;&gt;&lt;?php echo $l_unban_title; ?&gt;&lt;/th&gt;
+	&lt;/tr&gt;
+&lt;?php
+
+	if ($banned_options)
+	{
+
+?&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $l_ban_cell; ?&gt;: &lt;br /&gt;&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt; &lt;select name=&quot;unban[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot; onchange=&quot;display_details(this.options[this.selectedIndex].value)&quot;&gt;&lt;?php echo $banned_options; ?&gt;&lt;/select&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_REASON']; ?&gt;:&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;row1&quot; style=&quot;border:0px&quot; type=&quot;text&quot; name=&quot;unbanreason&quot; size=&quot;40&quot; /&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_LENGTH']; ?&gt;:&lt;/td&gt;
+		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;row1&quot; style=&quot;border:0px&quot; type=&quot;text&quot; name=&quot;unbanlength&quot; size=&quot;40&quot; /&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;unbansubmit&quot; value=&quot;&lt;?php echo $user-&gt;lang['SUBMIT']; ?&gt;&quot; class=&quot;btnmain&quot; /&gt;&nbsp; &lt;input type=&quot;reset&quot; value=&quot;&lt;?php echo $user-&gt;lang['RESET']; ?&gt;&quot; class=&quot;btnlite&quot; /&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;?php
+
+	}
+	else
+	{
+
+?&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row2&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;?php echo $l_no_ban_cell;  ?&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;?php
+
+	}
+
+?&gt;
+&lt;/table&gt;&lt;/form&gt;
+
+&lt;?php
+
+adm_page_footer();
+
+?&gt;
\ No newline at end of file

Modified: trunk/includes/forums/admin/admin_board.php
===================================================================
--- trunk/includes/forums/admin/admin_board.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/admin/admin_board.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -74,7 +74,6 @@
 			'max_search_chars'	=&gt; array('lang' =&gt; 'MAX_SEARCH_CHARS',	'type' =&gt; 'text:3:3', 'explain' =&gt; true),
 			'load_search_upd'	=&gt; array('lang' =&gt; 'YES_SEARCH_UPDATE',	'type' =&gt; 'radio:yes_no', 'explain' =&gt; true),
 //			'load_search_phr'	=&gt; array('lang' =&gt; 'YES_SEARCH_PHRASE',	'type' =&gt; 'radio:yes_no', 'explain' =&gt; true),
-			'load_tplcompile'	=&gt; array('lang' =&gt; 'RECOMPILE_TEMPLATES', 'type' =&gt; 'radio:yes_no', 'explain' =&gt; true)
 		)
 	),
 	'default' =&gt; array(

Modified: trunk/includes/forums/admin/admin_permissions.php
===================================================================
--- trunk/includes/forums/admin/admin_permissions.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/admin/admin_permissions.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -538,7 +538,7 @@
 			AND a.auth_option_id = o.auth_option_id
 			AND a.forum_id IN ($sql_forum_id)
 			AND u.user_id = a.user_id
-		ORDER BY u.username, u.user_regdate ASC&quot;;
+		ORDER BY u.username, u.user_reg_date ASC&quot;;
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
 	$users = '';

Modified: trunk/includes/forums/bbcode.php
===================================================================
--- trunk/includes/forums/bbcode.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/bbcode.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -127,13 +127,11 @@
 	
 	function decode_php($text)
 	{
-		global $phpversion;
-
 		$text = trim($text);
 
 		$remove_tags = false;
 
-		$text = strtr($text, array_flip(get_html_translation_table(HTML_ENTITIES)));
+		//$text = strtr($text, array_flip(get_html_translation_table(HTML_ENTITIES)));
 
 		$str_from = array('&lt;', '&gt;', '&#39;');
 		$str_to = array('&lt;', '&gt;', '\'');
@@ -147,7 +145,7 @@
 		}
 
 
-		if ($phpversion &lt; 420)
+		if (version_compare(PHP_VERSION, '4.2.0', '&lt;'))
 		{
 			ob_start();
 			highlight_string($text);

Modified: trunk/includes/forums/functions.php
===================================================================
--- trunk/includes/forums/functions.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/functions.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -500,7 +500,8 @@
 }
 
 // Topic and forum watching common code
-function watch_topic_forum($mode, $user_id, $match_id, $notify_status = 'unset', $start = 0)
+//do we need user_id ?
+function watch_topic_forum($mode, $user_id, $forum_id, $topic_id, $notify_status = 'unset', $start = 0)
 {
 	global $_CLASS, $config, $_CORE_CONFIG;
 
@@ -509,8 +510,16 @@
 		return array('link' =&gt; '', 'title' =&gt; '', 'watching' =&gt; false);
 	}
 
-	$where_sql = ($mode == 'forum') ? 'forum_id' : 'topic_id';
-	$u_url = ($mode == 'forum') ? 'f' : 't';
+	if ($mode == 'forum')
+	{
+		$where = &quot;user_id = $user_id AND forum_id = $forum_id AND topic_id = 0&quot;;
+		$url = 'f='.$forum_id;
+	}
+	else
+	{
+		$where = &quot;user_id = $user_id AND forum_id = $forum_id AND topic_id IN ($topic_id, 0)&quot;;
+		$url = 't='.$topic_id;
+	}
 
 	$is_watching = false;
 
@@ -519,8 +528,8 @@
 		// Is user watching this thread?
 		$sql = 'SELECT notify_status
 			FROM '.FORUMS_WATCH_TABLE.&quot;
-			WHERE $where_sql = $match_id
-				AND user_id = $user_id&quot;;
+			 WHERE $where&quot;;
+
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		$notify_status = ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result)) ? $row['notify_status'] : null;
@@ -535,28 +544,29 @@
 			{
 				$is_watching = true;
 
-				/*
+				// Remove all topics that are being watched, we watching the whole forum dude
 				if ($mode == 'forum')
 				{
 					$sql = 'DELETE FROM ' . FORUMS_WATCH_TABLE . &quot;
-						WHERE topic_id = $match_id
+						WHERE forum_id = $forum_id
 							AND user_id = $user_id&quot;;
 				
 					$_CLASS['core_db']-&gt;query($sql);
 				}
-				*/
 
 				$sql_array = array(
 					'user_id' =&gt; (int) $user_id,
-					$where_sql =&gt; (int) $match_id,
-					'notify_status' =&gt; 0
+					'forum_id' =&gt; $forum_id,
+					'topic_id' =&gt; $topic_id,
+					'notify_status' =&gt; 0,
+					'notify_type' =&gt; 0
 				);
 
 				$_CLASS['core_db']-&gt;query('INSERT INTO ' . FORUMS_WATCH_TABLE . ' '.$_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql_array));
 			}
 
-			//$_CLASS['core_display']-&gt;meta_refresh(3, generate_link(&quot;Forums&amp;file=view$mode&amp;$u_url=$match_id&amp;start=$start&quot;));
-			//$message = $_CLASS['core_user']-&gt;lang['ARE_WATCHING_' . strtoupper($mode)] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_' . strtoupper($mode)], '&lt;a href=&quot;' . generate_link(&quot;Forums&amp;file=view$mode&amp;&quot; . $u_url . &quot;=$match_id&amp;start=$start&quot;) . '&quot;&gt;', '&lt;/a&gt;');
+			//$_CLASS['core_display']-&gt;meta_refresh(3, generate_link(&quot;Forums&amp;file=view$mode&amp;$url&amp;start=$start&quot;));
+			//$message = $_CLASS['core_user']-&gt;lang['ARE_WATCHING_' . strtoupper($mode)] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_' . strtoupper($mode)], '&lt;a href=&quot;' . generate_link(&quot;Forums&amp;file=view$mode&amp;$url&amp;start=$start&quot;) . '&quot;&gt;', '&lt;/a&gt;');
 			//trigger_error($message);
 		}
 	}
@@ -568,15 +578,23 @@
 			{
 				$is_watching = false;
 
+				if ($mode == 'forum')
+				{
+					$where_delete = &quot;forum_id = $forum_id AND topic_id = 0&quot;;
+				}
+				else
+				{
+					$where_delete = &quot;forum_id = $forum_id AND topic_id = $topic_id&quot;;
+				}
+
 				$sql = 'DELETE FROM ' . FORUMS_WATCH_TABLE . &quot;
-					WHERE $where_sql = $match_id
-						AND user_id = $user_id&quot;;
+							WHERE user_id = $user_id AND $where_delete&quot;;
 
 				$_CLASS['core_db']-&gt;query($sql);
 			}
 
-			//$_CLASS['core_display']-&gt;meta_refresh(3, generate_link(&quot;Forums&amp;file=view$mode&amp;$u_url=$match_id&amp;start=$start&quot;));
-			//$message = $_CLASS['core_user']-&gt;lang['NOT_WATCHING_' . strtoupper($mode)] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_' . strtoupper($mode)], '&lt;a href=&quot;' . generate_link(&quot;Forums&amp;file=view$mode&amp;&quot; . $u_url . &quot;=$match_id&amp;start=$start&quot;) . '&quot;&gt;', '&lt;/a&gt;');
+			//$_CLASS['core_display']-&gt;meta_refresh(3, generate_link(&quot;Forums&amp;file=view$mode&amp;$url&amp;start=$start&quot;));
+			//$message = $_CLASS['core_user']-&gt;lang['NOT_WATCHING_' . strtoupper($mode)] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_' . strtoupper($mode)], '&lt;a href=&quot;' . generate_link(&quot;Forums&amp;file=view$mode&amp;$url&amp;start=$start&quot;) . '&quot;&gt;', '&lt;/a&gt;');
 			//trigger_error($message);
 		}
 		else
@@ -587,8 +605,7 @@
 			{
 				$sql = 'UPDATE ' . FORUMS_WATCH_TABLE . &quot;
 					SET notify_status = 0
-					WHERE $where_sql = $match_id
-						AND user_id = $user_id&quot;;
+					WHERE $where&quot;;
 				$_CLASS['core_db']-&gt;query($sql);
 			}
 		}
@@ -596,7 +613,7 @@
 
 	return array(
 			'watching' =&gt; true,
-			'link' =&gt; generate_link(&quot;Forums&amp;file=view$mode&amp;$u_url=$match_id&amp;&quot; . (($is_watching) ? 'unwatch' : 'watch') . &quot;=$mode&amp;start=$start&quot;),
+			'link' =&gt; generate_link(&quot;Forums&amp;file=view$mode&amp;$url&amp;&quot; . (($is_watching) ? 'unwatch' : 'watch') . &quot;=$mode&amp;start=$start&quot;),
 			'title' =&gt; $_CLASS['core_user']-&gt;lang[(($is_watching) ? 'STOP' : 'START') . '_WATCHING_' . strtoupper($mode)],
 	);
 }
@@ -664,10 +681,14 @@
 				{
 					foreach ($sql_insert as $forum_id)
 					{
-						$sql = 'INSERT INTO ' . FORUMS_TRACK_TABLE . ' (user_id, forum_id, mark_time)
-							VALUES (' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $time)&quot;;
+						$sql_ary = array(
+							'user_id'		=&gt; $_CLASS['core_user']-&gt;data['user_id'],
+							'topic_id'		=&gt; 0,
+							'forum_id'		=&gt; $forum_id,
+							'mark_time'		=&gt; $time
+						);
 
-						$_CLASS['core_db']-&gt;query($sql);
+						$_CLASS['core_db']-&gt;query('INSERT INTO ' . FORUMS_TRACK_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql_ary));
 					}
 				}
 			}

Modified: trunk/includes/forums/functions_display.php
===================================================================
--- trunk/includes/forums/functions_display.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/functions_display.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -154,14 +154,12 @@
 			}
 		}
 
-		if (!isset($row['mark_time']))
+		if (!$config['load_db_lastread'] || !$_CLASS['core_user']-&gt;is_user)
 		{
-			$row['mark_time'] = 0;
+			$row['mark_time'] = isset($tracking_topics[$forum_id][0]) ? base_convert($tracking_topics[$forum_id][0], 36, 10) + $config['board_startdate'] : 0;
 		}
 
-		$mark_time_forum = ($config['load_db_lastread']) ? $row['mark_time'] : ((isset($tracking_topics[$forum_id][0])) ? base_convert($tracking_topics[$forum_id][0], 36, 10) + $config['board_startdate'] : 0);
-
-		if ($mark_time_forum &lt; $row['forum_last_post_time'] &amp;&amp; $_CLASS['core_user']-&gt;is_user)
+		if ($row['mark_time'] &lt; $row['forum_last_post_time'])
 		{
 			$forum_unread[$parent_id] = true;
 		}

Modified: trunk/includes/forums/functions_posting.php
===================================================================
--- trunk/includes/forums/functions_posting.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/functions_posting.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -878,26 +878,42 @@
 		unset($ignore_array[$user_id]);
 	}
 
-	$processed = $update = array();
+	$processed = $delete_array = $update_array = array();
 
 	foreach ($holding as $user)
 	{
 		if (!in_array($user['user_id'], $ignore_array))
 		{
 			$processed[$user['template']][] = $user;
-			$update[$user['update']][] = $user['user_id'];
+			$update_array[$user['update']][] = $user['user_id'];
 		}
+		else
+		{
+			$delete_array[$user['update']] = $user['user_id'];
+		}
 	}
 	unset($holding, $ignore_array);
 
+	// Now delete the user_ids not authorized to receive notifications on this topic/forum
+	if (!empty($delete_array['topic']))
+	{
+		$_CLASS['core_db']-&gt;query('DELETE FROM ' . FORUMS_WATCH_TABLE . &quot;
+			WHERE topic_id = $topic_id
+				AND user_id IN (&quot; . implode(', ', $delete_array['topic']) . &quot;)&quot;);
+	}
+
+	if (!empty($delete_array['forum']))
+	{
+		$_CLASS['core_db']-&gt;query('DELETE FROM ' . FORUMS_WATCH_TABLE . &quot;
+			WHERE forum_id = $forum_id
+				AND user_id IN (&quot; . implode(', ', $delete_array['forum']) . &quot;)&quot;);
+	}
+
 	if (empty($processed))
 	{
 		return;
 	}
 
-	require_once($site_file_root.'includes/forums/functions_messenger.php');
-	$messenger = new messenger();
-
 	$email_sig = str_replace('&lt;br /&gt;', &quot;\n&quot;, &quot;-- \n&quot; . $config['board_email_sig']);
 
 	require_once($site_file_root.'includes/mailer.php');
@@ -916,7 +932,7 @@
 		$mailer-&gt;subject($_CLASS['core_user']-&gt;get_lang('FORUM_NOTIFICATION'));
 
 		$_CLASS['core_template']-&gt;assign_array(array(
-			'EMAIL_SIG'		=&gt; '',
+			'EMAIL_SIG'		=&gt; $email_sig,
 			'SITENAME'		=&gt; $_CORE_CONFIG['global']['site_name'],
 			'TOPIC_TITLE'	=&gt; $topic_title,  
 			'FORUM_NAME'	=&gt; $forum_name,
@@ -936,39 +952,22 @@
 
 	$_CLASS['core_db']-&gt;transaction();
 
-	if (!empty($update['topic']))
+	if (!empty($update_array['topic']))
 	{
 		$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_WATCH_TABLE . &quot;
 			SET notify_status = 1
 			WHERE topic_id = $topic_id
-				AND user_id IN (&quot; . implode(', ', $update['topic']) . &quot;)&quot;);
+				AND user_id IN (&quot; . implode(', ', $update_array['topic']) . &quot;)&quot;);
 	}
 
-	if (!empty($update['forum']))
+	if (!empty($update_array['forum']))
 	{
 		$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_WATCH_TABLE . &quot;
 			SET notify_status = 1
 			WHERE forum_id = $forum_id
-				AND user_id IN (&quot; . implode(', ', $update['forum']) . &quot;)&quot;);
+				AND user_id IN (&quot; . implode(', ', $update_array['forum']) . &quot;)&quot;);
 	}
 
-	// Now delete the user_ids not authorized to receive notifications on this topic/forum
-	/*
-	if (isset($delete_ids['topic']) &amp;&amp; sizeof($delete_ids['topic']))
-	{
-		$_CLASS['core_db']-&gt;query('DELETE FROM ' . TOPICS_WATCH_TABLE . &quot;
-			WHERE topic_id = $topic_id
-				AND user_id IN (&quot; . implode(', ', $delete_ids['topic']) . &quot;)&quot;);
-	}
-
-	if (isset($delete_ids['forum']) &amp;&amp; sizeof($delete_ids['forum']))
-	{
-		$_CLASS['core_db']-&gt;query('DELETE FROM ' . FORUMS_WATCH_TABLE . &quot;
-			WHERE forum_id = $forum_id
-				AND user_id IN (&quot; . implode(', ', $delete_ids['forum']) . &quot;)&quot;);
-	}
-	*/
-
 	$_CLASS['core_db']-&gt;sql_transaction('commit');
 }
 

Modified: trunk/includes/forums/functions_privmsgs.php
===================================================================
--- trunk/includes/forums/functions_privmsgs.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/functions_privmsgs.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -113,7 +113,7 @@
 );
 
 // Get all folder
- function get_folder($user_id, &amp;$folder, $folder_id = false)
+function get_folder($user_id, &amp;$folder, $folder_id = false)
 {
 	global $_CLASS;
 
@@ -139,7 +139,8 @@
 	$_CLASS['core_db']-&gt;free_result($result);
 
 	// Make sure the default boxes are defined
-	foreach (array(PRIVMSGS_INBOX, PRIVMSGS_OUTBOX, PRIVMSGS_SENTBOX) as $default_folder)
+	$folder_array = array(PRIVMSGS_INBOX, PRIVMSGS_OUTBOX, PRIVMSGS_SENTBOX);
+	foreach ($folder_array as $default_folder)
 	{
 		if (!isset($num_messages[$default_folder]))
 		{
@@ -194,8 +195,9 @@
 function clean_sentbox($num_sentbox_messages)
 {
 	global $_CLASS, $config;
-
-	$message_limit = (!$_CLASS['core_user']-&gt;data['user_message_limit']) ? $config['pm_max_msgs'] : $_CLASS['core_user']-&gt;data['user_message_limit'];
+// TEMP
+$_CLASS['core_user']-&gt;data['user_message_limit'] = isset($_CLASS['core_user']-&gt;data['user_message_limit']) ? $_CLASS['core_user']-&gt;data['user_message_limit'] : false;
+	$message_limit = ($_CLASS['core_user']-&gt;data['user_message_limit']) ? $config['pm_max_msgs'] : $_CLASS['core_user']-&gt;data['user_message_limit'];
 	
 	// Check Message Limit - 
 	if ($message_limit &amp;&amp; $num_sentbox_messages &gt; $message_limit)
@@ -289,7 +291,7 @@
 		$user_rules = $_CLASS['core_db']-&gt;fetch_row_assocset($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 
-		if (sizeof($user_rules))
+		if (!empty($user_rules))
 		{
 			$sql = 'SELECT zebra_id, friend, foe
 				FROM ' . ZEBRA_TABLE . &quot;
@@ -1091,8 +1093,6 @@
 		return;
 	}
 
-	$current_time = time();
-
 	// Collect some basic informations about which tables and which rows to update/insert
 	$sql_data = array();
 	$root_level = 0;
@@ -1163,7 +1163,7 @@
 				'author_id'			=&gt; (int) $_CLASS['core_user']-&gt;data['user_id'],
 				'icon_id'			=&gt; $data['icon_id'], 
 				'author_ip' 		=&gt; $_CLASS['core_user']-&gt;ip,
-				'message_time'		=&gt; $current_time,
+				'message_time'		=&gt; $_CLASS['core_user']-&gt;time,
 				'enable_bbcode' 	=&gt; $data['enable_bbcode'],
 				'enable_html' 		=&gt; $data['enable_html'],
 				'enable_smilies' 	=&gt; $data['enable_smilies'],
@@ -1183,7 +1183,7 @@
 		case 'edit':
 			$sql_data = array(
 				'icon_id'			=&gt; $data['icon_id'],
-				'message_edit_time'	=&gt; $current_time,
+				'message_edit_time'	=&gt; $_CLASS['core_user']-&gt;time,
 				'enable_bbcode' 	=&gt; $data['enable_bbcode'],
 				'enable_html' 		=&gt; $data['enable_html'],
 				'enable_smilies' 	=&gt; $data['enable_smilies'],
@@ -1196,12 +1196,12 @@
 				'bbcode_bitfield'	=&gt; $data['bbcode_bitfield'],
 				'bbcode_uid'		=&gt; $data['bbcode_uid']
 			);
-			break;
+		break;
 	}
 
 	$_CLASS['core_db']-&gt;transaction();
 
-	if (sizeof($sql_data))
+	if (!empty($sql_data))
 	{
 		if ($mode == 'post' || $mode == 'reply' || $mode == 'quote' || $mode == 'forward')
 		{
@@ -1231,15 +1231,15 @@
 				'msg_id'	=&gt; $data['msg_id'],
 				'user_id'	=&gt; $user_id,
 				'author_id'	=&gt; $_CLASS['core_user']-&gt;data['user_id'],
-				'folder_id'	=&gt; PRIVMSGS_NO_BOX,
-				'new'		=&gt; 1,
+				'folder_id'	=&gt; PRIVMSGS_INBOX,
+				'msg_new'	=&gt; 1,
 				'unread'	=&gt; 1,
 				'forwarded'	=&gt; ($mode == 'forward') ? 1 : 0))
 			);
 		}
 
 		$sql = 'UPDATE ' . USERS_TABLE . ' 
-			SET user_new_privmsg = user_new_privmsg + 1, user_unread_privmsg = user_unread_privmsg + 1, user_last_privmsg = ' . time() . '
+			SET user_new_privmsg = user_new_privmsg + 1, user_unread_privmsg = user_unread_privmsg + 1
 			WHERE user_id IN (' . implode(', ', array_keys($recipients)) . ')';
 		$_CLASS['core_db']-&gt;query($sql);
 
@@ -1251,7 +1251,7 @@
 				'user_id'	=&gt; (int) $_CLASS['core_user']-&gt;data['user_id'],
 				'author_id'	=&gt; (int) $_CLASS['core_user']-&gt;data['user_id'],
 				'folder_id'	=&gt; PRIVMSGS_OUTBOX,
-				'new'		=&gt; 0,
+				'msg_new'	=&gt; 0,
 				'unread'	=&gt; 0,
 				'forwarded'	=&gt; ($mode == 'forward') ? 1 : 0))
 			);
@@ -1262,13 +1262,13 @@
 	if ($mode == 'reply' || $mode == 'quote' || $mode == 'forward' || $mode == 'post')
 	{
 		$sql = 'UPDATE ' . USERS_TABLE . &quot;
-			SET user_lastpost_time = $current_time
+			SET user_last_post_time = {$_CLASS['core_user']-&gt;time}
 			WHERE user_id = &quot; . $_CLASS['core_user']-&gt;data['user_id'];
 		$_CLASS['core_db']-&gt;query($sql);
 	}
 
 	// Submit Attachments
-	if (sizeof($data['attachment_data']) &amp;&amp; $data['msg_id'] &amp;&amp; in_array($mode, array('post', 'reply', 'quote', 'edit', 'forward')))
+	if (!empty($data['attachment_data']) &amp;&amp; $data['msg_id'] &amp;&amp; in_array($mode, array('post', 'reply', 'quote', 'edit', 'forward')))
 	{
 		$space_taken = $files_added = 0;
 
@@ -1309,7 +1309,7 @@
 			}
 		}
 		
-		if (sizeof($data['attachment_data']))
+		if (!empty($data['attachment_data']))
 		{
 			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TABLE . '
 				SET message_attachment = 1
@@ -1328,6 +1328,7 @@
 
 	// Delete draft if post was loaded...
 	$draft_id = request_var('draft_loaded', 0);
+
 	if ($draft_id)
 	{
 		$sql = 'DELETE FROM ' . DRAFTS_TABLE . &quot; 
@@ -1349,7 +1350,7 @@
 function pm_notification($mode, $author, $recipients, $subject, $message)
 {
 	global $_CLASS, $config;
-
+return;
 	$subject = censor_text($subject);
 	
 	// Get banned User ID's

Modified: trunk/includes/forums/mcp/mcp_topic.php
===================================================================
--- trunk/includes/forums/mcp/mcp_topic.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/forums/mcp/mcp_topic.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -87,16 +87,16 @@
 	$posts_per_page = max(0, request_var('posts_per_page', intval($config['posts_per_page'])));
 
 	$sql = 'SELECT u.username, u.user_colour, p.*
-		FROM ' . POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+		FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
 		WHERE ' . (($action == 'reports') ? 'p.post_reported = 1 AND ' : '') . &quot;
 			p.topic_id = {$topic_id}
 			AND p.poster_id = u.user_id
 		ORDER BY $sort_order_sql&quot;;
-	$result = $_CLASS['core_db']-&gt;sql_query_limit($sql, $posts_per_page, $start);
+	$result = $_CLASS['core_db']-&gt;query_limit($sql, $posts_per_page, $start);
 
 	$rowset = array();
 	$bbcode_bitfield = 0;
-	while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
 		$rowset[] = $row;
 		$bbcode_bitfield |= $row['bbcode_bitfield'];
@@ -147,7 +147,7 @@
 			'MESSAGE'		=&gt; $message,
 			'POST_ID'		=&gt; $row['post_id'],
 
-			'MINI_POST_IMG' =&gt; ($row['post_time'] &gt; $_CLASS['core_user']-&gt;data['user_lastvisit'] &amp;&amp; $_CLASS['core_user']-&gt;data['is_registered']) ? $_CLASS['core_user']-&gt;img('icon_post_new', $_CLASS['core_user']-&gt;lang['NEW_POST']) : $_CLASS['core_user']-&gt;img('icon_post', $_CLASS['core_user']-&gt;lang['POST']),
+			'MINI_POST_IMG' =&gt; ($row['post_time'] &gt; $_CLASS['core_user']-&gt;data['user_last_visit'] &amp;&amp; $_CLASS['core_user']-&gt;is_user) ? $_CLASS['core_user']-&gt;img('icon_post_new', $_CLASS['core_user']-&gt;lang['NEW_POST']) : $_CLASS['core_user']-&gt;img('icon_post', $_CLASS['core_user']-&gt;lang['POST']),
 			
 			'S_CHECKBOX'		=&gt; $s_checkbox,
 			'S_POST_REPORTED'	=&gt; ($row['post_reported']) ? true : false,
@@ -323,11 +323,11 @@
 						$limit_time_sql
 					ORDER BY $sort_order_sql&quot;;
 			}
-			$result = $_CLASS['core_db']-&gt;sql_query_limit($sql, 0, $start);
+			$result = $_CLASS['core_db']-&gt;query_limit($sql, 0, $start);
 
 			$store = false;
 			$post_id_list = array();
-			while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 			{
 				// If splitted from selected post (split_beyond), we split the unapproved items too.
 				if (!$row['post_approved'] &amp;&amp; !$_CLASS['auth']-&gt;acl_get('m_approve', $row['forum_id']))

Modified: trunk/includes/functions.php
===================================================================
--- trunk/includes/functions.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/functions.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -707,7 +707,7 @@
 	
 	while ($file = readdir($handle))
 	{
-		if ($file{0} !== '.')
+		if (!mb_strpos($file, '.'))
 		{
 			if (file_exists($site_file_root.&quot;themes/$file/index.php&quot;))
 			{
@@ -807,6 +807,21 @@
 	}
 }
 
+//this doesn't work, maybe we should just translate those that can affect the html layout ?
+function core_html_entity_decode($string, $quote_style = ENT_COMPAT)
+{
+	$holding = get_html_translation_table(HTML_ENTITIES, $quote_style);
+
+	foreach ($holding as $from =&gt; $to)
+	{
+		$translations[utf8_encode($to)] = utf8_encode($from);
+	}
+
+	unset($translations['&amp;Epsilon;']);
+	//&#206;&#149;&#206;&#187;&#206;&#187;&#206;&#183;&#206;&#189;&#206;&#185;&#206;&#186;&#206;&#172;, Magyarul
+	return strtr($string, $translations);
+}
+
 if (!function_exists('html_entity_decode'))
 {
 	//string html_entity_decode ( string string [, int quote_style [, string charset]] )

Modified: trunk/includes/functions_user.php
===================================================================
--- trunk/includes/functions_user.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/functions_user.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -146,11 +146,11 @@
 
 	$default_data = array(
 		'user_allow_viewonline' =&gt; 1,
-		'user_allow_viewemail' =&gt; 1,
-		'user_allow_massemail' =&gt; 1,
-		'user_new_privmsg' =&gt; 0,
-		'user_allow_pm' =&gt; 1,
-		'user_allow_email' =&gt; 1,
+		'user_allow_viewemail'	=&gt; 1,
+		'user_allow_massemail'	=&gt; 1,
+		'user_new_privmsg'		=&gt; 0,
+		'user_allow_pm'			=&gt; 1,
+		'user_allow_email'		=&gt; 1,
 	);
 
 	$data = array_merge($default_data, $data);

Modified: trunk/includes/tables.php
===================================================================
--- trunk/includes/tables.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/tables.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,15 +1,25 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
 // Well this needs some works
 if (!defined('VIPERAL'))
 {
@@ -20,6 +30,15 @@
 // User related
 define('ANONYMOUS', 1);
 
+// status settings
+define('STATUS_DISABLED', 0);
+define('STATUS_PENDING', 1);
+define('STATUS_ACTIVE', 2);
+define('STATUS_DELETING', 3);
+
+define('STATUS_NORMAL', 9);
+define('STATUS_LEADER', 10);
+
 define('USER_ACTIVATION_NONE', 0);
 define('USER_ACTIVATION_SELF', 1);
 define('USER_ACTIVATION_ADMIN', 2);
@@ -29,14 +48,13 @@
 define('AVATAR_REMOTE', 2);
 define('AVATAR_GALLERY', 3);
 
-define('USER_GUEST', 2);
-define('USER_NORMAL', 4);
-define('USER_BOT', 8);
+define('USER_GUEST', 0);
+define('USER_NORMAL', 1);
+define('USER_BOT', 2);
 
-define('USER_ACTIVE', 16);
-define('USER_INACTIVE', 32);
-define('USER_UNACTIVATED', 64);
-define('USER_FOUNDER', 128);
+define('USER_UNACTIVATED', 0);
+define('USER_ACTIVE', 1);
+define('USER_DISABLE', 2);
 
 define('ADMIN_NOT_LOGGED', 0);
 define('ADMIN_NOT_ADMIN', 1);
@@ -71,19 +89,14 @@
 define('ACL_YES', 1);
 define('ACL_UNSET', -1);
 
-// Group settings
-define('GROUP_OPEN', 0);
-define('GROUP_CLOSED', 1);
-define('GROUP_HIDDEN', 2);
-define('GROUP_SPECIAL', 3);
-define('GROUP_FREE', 4);
+define('GROUP_HIDDEN', 0);
+define('GROUP_SYSTEM', 1);
+define('GROUP_SPECIAL', 2);
+define('GROUP_REQUEST', 3);
+define('GROUP_CLOSED', 4);
+define('GROUP_UNRESTRAINED', 5);
 
-// status settings
-define('STATUS_PENDING', 0);
-define('STATUS_NORMAL', 1);
-define('STATUS_LEADER', 2);
 
-
 // Forum/Topic states
 define('FORUM_CAT', 0);
 define('FORUM_POST', 1);
@@ -158,76 +171,73 @@
 define('FIELD_DATE', 6);
 
 
-define('AUTH_ADMIN_TABLE', $prefix.'admins');
-define('BLOCKS_TABLE', $prefix.'blocks');
-define('USER_GROUP_TABLE', $prefix.'groups_users');
-define('CORE_CONFIG_TABLE', $prefix.'config');
+// Table names
+
+define('FORUMS_ACL_TABLE', $prefix.'forums_auth');
+define('FORUMS_ACL_OPTIONS_TABLE', $prefix.'forums_auth_options');
+//define('ACL_DEPS_TABLE', $prefix.'forums_auth_deps');
+define('FORUMS_ACL_PRESETS_TABLE', $prefix.'forums_auth_presets');
+
+define('FORUMS_ATTACHMENTS_TABLE', $prefix.'forums_attachments');
+define('FORUMS_BOOKMARKS_TABLE', $prefix.'forums_bookmarks');
+define('FORUMS_BBCODES_TABLE', $prefix.'forums_bbcodes');
+define('FORUMS_CONFIG_TABLE', $prefix.'forums_config');
+define('FORUMS_DRAFTS_TABLE', $prefix.'forums_drafts');
+define('FORUMS_FORUMS_TABLE', $prefix.'forums_forums');
+define('FORUMS_ACCESS_TABLE', $prefix.'forums_access');
+define('FORUMS_ICONS_TABLE', $prefix.'forums_icons');
+define('FORUMS_LOG_TABLE', $prefix.'forums_log');
+define('FORUMS_MODERATOR_TABLE', $prefix.'forums_moderator_cache');
+define('FORUMS_MODULES_TABLE', $prefix . 'forums_modules');
+define('FORUMS_POSTS_TABLE', $prefix.'forums_posts');
+define('FORUMS_PRIVMSGS_TABLE', $prefix.'forums_privmsgs');
+define('FORUMS_PRIVMSGS_TO_TABLE', $prefix.'forums_privmsgs_to');
+define('FORUMS_PRIVMSGS_FOLDER_TABLE', $prefix.'forums_privmsgs_folder');
+define('FORUMS_PRIVMSGS_RULES_TABLE', $prefix.'forums_privmsgs_rules');
+define('FORUMS_REPORTS_TABLE', $prefix.'forums_reports');
+define('FORUMS_REASONS_TABLE', $prefix.'forums_reports_reasons');
+define('FORUMS_SEARCH_TABLE', $prefix.'forums_search_results');
+define('FORUMS_SEARCH_WORD_TABLE', $prefix.'forums_search_wordlist');
+define('FORUMS_SEARCH_MATCH_TABLE', $prefix.'forums_search_wordmatch');
+define('FORUMS_TOPICS_TABLE', $prefix.'forums_topics');
+define('FORUMS_POLL_OPTIONS_TABLE', $prefix.'forums_poll_results');
+define('FORUMS_POLL_VOTES_TABLE', $prefix.'forums_poll_voters');
+define('FORUMS_WORDS_TABLE', $prefix.'forums_words');
+define('FORUMS_WATCH_TABLE', $prefix.'forums_watch');
+define('FORUMS_TRACK_TABLE', $prefix.'forums_tracking');
+define('FORUMS_RANKS_TABLE', $prefix.'forums_ranks');
+
+
+define('ADMIN_AUTH_TABLE', 'test_admins');
+
+define('BLOCKS_TABLE', 'test_blocks');
+
+define('CORE_CONFIG_TABLE', 'test_config');
 define('CORE_MODULES_TABLE', $prefix.'modules');
 
+define('SMILIES_TABLE', 'test_smilies');
 
-// Table names
-//define('ACL_GROUPS_TABLE', $prefix.'forums_auth_groups');
-define('ACL_TABLE', $prefix.'forums_auth');
+define('USER_GROUP_TABLE', 'test_groups_members');
+define('GROUPS_TABLE', 'test_groups');
 
-define('ACL_OPTIONS_TABLE', $prefix.'forums_auth_options');
-define('ACL_DEPS_TABLE', $prefix.'forums_auth_deps');
-define('ACL_PRESETS_TABLE', $prefix.'forums_auth_presets');
-//define('ACL_USERS_TABLE', $prefix.'forums_auth_users');
-define('ATTACHMENTS_TABLE', $prefix.'forums_attachments');
-define('BANLIST_TABLE', $prefix.'forums_banlist');
-define('BBCODES_TABLE', $prefix.'forums_bbcodes');
-define('BOOKMARKS_TABLE', $prefix.'forums_bookmarks');
-define('BOTS_TABLE', $prefix.'forums_bots');
-define('CACHE_TABLE', $prefix.'forums_cache');
-define('CONFIG_TABLE', $prefix.'forums_config');
-define('CONFIRM_TABLE', $prefix.'forums_confirm');
-define('PROFILE_FIELDS_TABLE', $prefix.'forums_profile_fields');
-define('PROFILE_LANG_TABLE', $prefix.'forums_profile_lang');
-define('PROFILE_DATA_TABLE', $prefix.'forums_profile_fields_data');
-define('PROFILE_FIELDS_LANG_TABLE', $prefix.'forums_profile_fields_lang');
-define('DISALLOW_TABLE', $prefix.'forums_disallow');
-define('DRAFTS_TABLE', $prefix.'forums_drafts');
+define('SESSIONS_AUTOLOGIN_TABLE', 'test_sessions_auto_login');
+define('SESSIONS_TABLE', $prefix.'sessions');
+
+
 define('EXTENSIONS_TABLE', $prefix.'forums_extensions');
 define('EXTENSION_GROUPS_TABLE', $prefix.'forums_extension_groups');
-define('FORUMS_TABLE', $prefix.'forums_forums');
-define('FORUMS_ACCESS_TABLE', $prefix.'forums_access');
-define('GROUPS_TABLE', $prefix.'groups');
-define('ICONS_TABLE', $prefix.'forums_icons');
-define('LANG_TABLE', $prefix.'forums_lang');
-define('LOG_TABLE', $prefix.'forums_log');
-define('MODERATOR_TABLE', $prefix.'forums_moderator_cache');
-define('MODULES_TABLE', $prefix . 'forums_modules');
-define('POSTS_TABLE', $prefix.'forums_posts');
-define('PRIVMSGS_TABLE', $prefix.'forums_privmsgs');
-define('PRIVMSGS_TO_TABLE', $prefix.'forums_privmsgs_to');
-define('PRIVMSGS_FOLDER_TABLE', $prefix.'forums_privmsgs_folder');
-define('PRIVMSGS_RULES_TABLE', $prefix.'forums_privmsgs_rules');
-define('RANKS_TABLE', $prefix.'forums_ranks');
-define('RATINGS_TABLE', $prefix.'forums_ratings');
-define('REPORTS_TABLE', $prefix.'forums_reports');
-define('REASONS_TABLE', $prefix.'forums_reports_reasons');
-define('SEARCH_TABLE', $prefix.'forums_search_results');
-define('SEARCH_WORD_TABLE', $prefix.'forums_search_wordlist');
-define('SEARCH_MATCH_TABLE', $prefix.'forums_search_wordmatch');
-define('SESSIONS_TABLE', $prefix.'sessions');
-define('SITELIST_TABLE', $prefix.'forums_sitelist');
-define('SMILIES_TABLE', $prefix.'smilies');
-define('STYLES_TABLE', $prefix.'forums_styles');
-define('STYLES_TPL_TABLE', $prefix.'forums_styles_template');
-define('STYLES_TPLDATA_TABLE', $prefix.'forums_styles_template_data');
-define('STYLES_CSS_TABLE', $prefix.'forums_styles_theme');
-define('STYLES_IMAGE_TABLE', $prefix.'forums_styles_imageset');
-define('TOPICS_TABLE', $prefix.'forums_topics');
+
 define('USERS_TABLE', $prefix.'users');
 define('USERS_NOTES_TABLE', $prefix.'forums_users_notes');
-define('WORDS_TABLE', $prefix.'forums_words');
-define('POLL_OPTIONS_TABLE', $prefix.'forums_poll_results');
-define('POLL_VOTES_TABLE', $prefix.'forums_poll_voters');
 define('ZEBRA_TABLE', $prefix.'forums_zebra');
+//define('LOG_TABLE', $prefix.'log');
 
-//define('TOPICS_WATCH_TABLE', $prefix.'forums_topics_watch');
 
-define('FORUMS_WATCH_TABLE', $prefix.'forums_watch');
-define('FORUMS_TRACK_TABLE', $prefix.'forums_tracking');
+// can be removed
+define('PROFILE_FIELDS_TABLE', $prefix.'forums_profile_fields');
+define('PROFILE_LANG_TABLE', $prefix.'forums_profile_lang');
+define('PROFILE_DATA_TABLE', $prefix.'forums_profile_fields_data');
+define('PROFILE_FIELDS_LANG_TABLE', $prefix.'forums_profile_fields_lang');
+define('DISALLOW_TABLE', $prefix.'forums_disallow');
 
 ?&gt;
\ No newline at end of file

Modified: trunk/includes/templates/admin/blocks/edit.html
===================================================================
--- trunk/includes/templates/admin/blocks/edit.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/admin/blocks/edit.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -27,7 +27,7 @@
 			&lt;/tr&gt;
 			&lt;tr&gt; 
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_ACTIVE }: &lt;/b&gt;&lt;/td&gt;
-				&lt;td class=&quot;row2&quot; colspan=&quot;2&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;b_active&quot; value=&quot;1&quot;&lt;!-- IF { $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;/&gt;&lt;span class=&quot;genmed&quot;&gt;{ $L_YES }&lt;/span&gt;&nbsp;&nbsp;&lt;input type=&quot;radio&quot; name=&quot;b_active&quot; value=&quot;0&quot;&lt;!-- IF !{ $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;/&gt;&lt;span class=&quot;genmed&quot;&gt;{ $L_NO }&lt;/span&gt;&lt;/td&gt;
+				&lt;td class=&quot;row2&quot; colspan=&quot;2&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;b_active&quot; value=&quot;2&quot;&lt;!-- IF { $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;/&gt;&lt;span class=&quot;genmed&quot;&gt;{ $L_YES }&lt;/span&gt;&nbsp;&nbsp;&lt;input type=&quot;radio&quot; name=&quot;b_active&quot; value=&quot;0&quot;&lt;!-- IF !{ $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;/&gt;&lt;span class=&quot;genmed&quot;&gt;{ $L_NO }&lt;/span&gt;&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;tr&gt; 
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_STARTS }: &lt;/b&gt;&lt;/td&gt;

Modified: trunk/includes/templates/admin/messages/edit.html
===================================================================
--- trunk/includes/templates/admin/messages/edit.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/admin/messages/edit.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -29,7 +29,7 @@
 			&lt;/tr&gt;
 			&lt;tr&gt; 
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_ACTIVE }: &lt;/b&gt;&lt;/td&gt;
-				&lt;td class=&quot;row2&quot; colspan=&quot;2&quot;&gt;&lt;input name=&quot;active&quot; value=&quot;1&quot; &lt;!-- IF { $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;active&quot; value=&quot;0&quot; &lt;!-- IF !{ $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
+				&lt;td class=&quot;row2&quot; colspan=&quot;2&quot;&gt;&lt;input name=&quot;active&quot; value=&quot;2&quot; &lt;!-- IF { $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;active&quot; value=&quot;0&quot; &lt;!-- IF !{ $B_ACTIVE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;tr&gt; 
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_POSITION }: &lt;/b&gt;&lt;/td&gt;

Modified: trunk/includes/templates/admin/system/index.html
===================================================================
--- trunk/includes/templates/admin/system/index.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/admin/system/index.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -53,9 +53,7 @@
 			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_DEFAULT_THEME }: &lt;/b&gt;&lt;/td&gt;
 			&lt;td class=&quot;row2&quot;&gt;
 				&lt;select name=&quot;default_theme&quot;&gt;
-				&lt;!-- LOOP $site_theme --&gt;
-					&lt;option value=&quot;{ $site_theme:FILE }&quot; &lt;!-- IF { $site_theme:FILE } == { $DEFAULT_THEME } --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt; { $site_theme:NAME }&lt;/option&gt;
-				&lt;!-- ENDLOOP --&gt;
+					{ $SELECT_THEME }
 				&lt;/select&gt;
 			&lt;/td&gt;
 		&lt;/tr&gt;
@@ -92,29 +90,27 @@
 		&lt;tr&gt;
 			&lt;th colspan=&quot;2&quot;&gt;Server Settings&lt;/th&gt;
 		&lt;/tr&gt;
-	
 		&lt;tr&gt;
 			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Domain Name: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;The domain name this board runs from&lt;/span&gt;&lt;/td&gt;
 			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_domain&quot; value=&quot;{ $SITE_DOMAIN }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-	
-	
 		&lt;tr&gt;
 			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Server Port: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;The port your server is running on, usually 80, only change if different&lt;/span&gt;&lt;/td&gt;
 			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;5&quot; maxlength=&quot;5&quot; name=&quot;site_port&quot; value=&quot;{ $SITE_PORT }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-	
-	
 		&lt;tr&gt;
 			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Script path: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Site located relative to the domain name&lt;/span&gt;&lt;/td&gt;
 	
 			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;site_path&quot; value=&quot;{ $SITE_PATH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-	
-	
 		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SITE_SECURE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COOKIE_SECURE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;site_secure&quot; value=&quot;0&quot; &lt;!-- IF !{ $SITE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Disabled&nbsp;&nbsp;&lt;input name=&quot;site_secure&quot; value=&quot;1&quot; &lt;!-- IF { $SITE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Enabled&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
 			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Session IP validation: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Determines how much of the users IP is used to validate a session; All compares the complete address, A.B.C the first x.x.x, A.B the first x.x, None disables checking.&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;ip_check&quot; value=&quot;4&quot; &lt;!-- IF { $IP_CHECK } == 4  --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;type=&quot;radio&quot;&gt; All&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;3&quot; &lt;!-- IF { $IP_CHECK } == 3 --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B.C&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;2&quot; &lt;!-- IF { $IP_CHECK } == 2 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;0&quot; &lt;!-- IF { $IP_CHECK } == 0 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; None&nbsp;&nbsp;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;ip_check&quot; value=&quot;4&quot; &lt;!-- IF { $IP_CHECK } == 4  --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;type=&quot;radio&quot;&gt; All&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;3&quot; &lt;!-- IF { $IP_CHECK } == 3 --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B.C&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;2&quot; &lt;!-- IF { $IP_CHECK } == 2 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;0&quot; &lt;!-- IF { $IP_CHECK } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; None&nbsp;&nbsp;&lt;/td&gt;
 	
 		&lt;/tr&gt;
 		&lt;tr&gt;
@@ -157,12 +153,7 @@
 	
 			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;cookie_path&quot; value=&quot;{ $COOKIE_PATH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-	
-	
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_SECURE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COOKIE_SECURE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;cookie_secure&quot; value=&quot;0&quot; &lt;!-- IF !{ $COOKIE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Disabled&nbsp;&nbsp;&lt;input name=&quot;cookie_secure&quot; value=&quot;1&quot; &lt;!-- IF { $COOKIE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Enabled&lt;/td&gt;
-		&lt;/tr&gt;
+
 		&lt;script type=&quot;text/javascript&quot;&gt;
 			  Calendar.setup(
 				{
@@ -171,75 +162,9 @@
 				}
 			  );
 		&lt;/script&gt;
-	&lt;!-- ELSEIF { $SYSTEM_MODE } == 'users' --&gt;
-		&lt;tr&gt;
-			&lt;th colspan=&quot;2&quot;&gt;{ $L_USER_OPTIONS }&lt;/th&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ACC_ACTIVATION }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ACC_ACTIVATION_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-	
-			&lt;td class=&quot;row2&quot;&gt;
-			&lt;!-- LOOP $A_ACC_OPTION --&gt;
-				&lt;input name=&quot;require_activation&quot; value=&quot;{$A_ACC_OPTION:OPTION}&quot; &lt;!-- IF { $A_ACC_OPTION:OPTION } == { $ACTIVATION_OPTION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; {$A_ACC_OPTION:LANG}&nbsp;&nbsp;
-			&lt;!-- ENDLOOP --&gt;
-			&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ENABLE_COPPA }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ENABLE_COPPA_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-	
-			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;coppa_enable&quot; value=&quot;1&quot; &lt;!-- IF { $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;coppa_enable&quot; value=&quot;0&quot; &lt;!-- IF !{ $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_FAX }: &lt;/b&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;25&quot; maxlength=&quot;100&quot; name=&quot;coppa_fax&quot; value=&quot;{ $COPPA_FAX }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_MAIL }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COPPA_MAIL_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;textarea name=&quot;coppa_mail&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $COPPA_MAIL }&lt;/textarea&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_VISUAL_CONFIRM }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_VISUAL_CONFIRM_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-	
-			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;enable_confirm&quot; value=&quot;1&quot; &lt;!-- IF { $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;enable_confirm&quot; value=&quot;0&quot; &lt;!-- IF !{ $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_REG_LIMIT }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_REG_LIMIT_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;max_reg_attempts&quot; value=&quot;{ $MAX_REG_ATTEMPTS }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_name_chars&quot; value=&quot;{ $MIN_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_name_chars&quot; value=&quot;{ $MAX_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;allow_name_chars&quot;&gt;&lt;option value=&quot;.*&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '.*' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Any character&lt;/option&gt;&lt;option value=&quot;[\w]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric only&lt;/option&gt;&lt;option value=&quot;[\w_\+\. \-\[\]]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w_\+\. \-\[\]]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric and spacers&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-	
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_PASSWORD_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_pass_chars&quot; value=&quot;{ $MIN_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_pass_chars&quot; value=&quot;{ $MAX_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
-		&lt;/tr&gt;
-	
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;pass_complex&quot;&gt;&lt;option value=&quot;.*&quot;&gt;No requirements&lt;/option&gt;&lt;option value=&quot;[a-zA-Z]&quot;&gt;Must be mixed case&lt;/option&gt;&lt;option value=&quot;[a-zA-Z0-9]&quot;&gt;Must contain alphanumerics&lt;/option&gt;&lt;option value=&quot;[a-zA-Z\W]&quot;&gt;Must contain symbols&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_FORCE_PASS_CHANGE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_FORCE_PASS_CHANGE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;chg_passforce&quot; value=&quot;{ $CHG_PASSFORCE }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_EMAIL_REUSE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ALLOW_EMAIL_REUSE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_NAME_CHANGE }: &lt;/b&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_namechange&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_namechange&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
-		&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input name=&quot;submit&quot; value=&quot;Submit&quot; class=&quot;btnmain&quot; type=&quot;submit&quot;&gt;&nbsp;&nbsp;&lt;input value=&quot;Reset&quot; class=&quot;button&quot; type=&quot;reset&quot;&gt;&lt;/td&gt;
+			&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input name=&quot;submit&quot; value=&quot;Submit&quot; class=&quot;button&quot; type=&quot;submit&quot;&gt;&nbsp;&nbsp;&lt;input value=&quot;Reset&quot; class=&quot;button&quot; type=&quot;reset&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 	&lt;/tbody&gt;
 	&lt;/table&gt;

Modified: trunk/includes/templates/admin/users/header.html
===================================================================
--- trunk/includes/templates/admin/users/header.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/admin/users/header.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -78,6 +78,11 @@
 								&lt;a href=&quot;{ $LINK_ADD_USER }&quot; title=&quot;{ $L_VIEW_BOTS }&quot;&gt;{ $L_ADD_USER }&lt;/a&gt;
 							&lt;/td&gt;
 						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_SETTINGS }'; return false;&quot;&gt;
+								&lt;a href=&quot;{ $LINK_SETTINGS }&quot; title=&quot;{ $L_SETTINGS }&quot;&gt;{ $L_SETTINGS }&lt;/a&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
 					&lt;/tbody&gt;
 				&lt;/table&gt;
 			&lt;/td&gt;

Added: trunk/includes/templates/admin/users/setting.html
===================================================================
--- trunk/includes/templates/admin/users/setting.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/admin/users/setting.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,84 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
+{ $A_TABLE_OPEN }
+
+&lt;!-- INCLUDE admin/users/header.html --&gt;
+&lt;form method=&quot;post&quot; action=&quot;{ $S_ACTION }&quot;&gt;
+	&lt;table class=&quot;tablebg&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; width=&quot;100%&quot;&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;2&quot;&gt;{ $L_USER_OPTIONS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ACC_ACTIVATION }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ACC_ACTIVATION_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;
+			&lt;!-- LOOP $A_ACC_OPTION --&gt;
+				&lt;input name=&quot;activation&quot; value=&quot;{$A_ACC_OPTION:OPTION}&quot; &lt;!-- IF { $A_ACC_OPTION:OPTION } == { $ACTIVATION_OPTION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; {$A_ACC_OPTION:LANG}&nbsp;&nbsp;
+			&lt;!-- ENDLOOP --&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ENABLE_COPPA }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ENABLE_COPPA_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;coppa_enable&quot; value=&quot;1&quot; &lt;!-- IF { $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;coppa_enable&quot; value=&quot;0&quot; &lt;!-- IF !{ $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_FAX }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;25&quot; maxlength=&quot;100&quot; name=&quot;coppa_fax&quot; value=&quot;{ $COPPA_FAX }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_MAIL }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COPPA_MAIL_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;textarea name=&quot;coppa_mail&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $COPPA_MAIL }&lt;/textarea&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_VISUAL_CONFIRM }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_VISUAL_CONFIRM_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;enable_confirm&quot; value=&quot;1&quot; &lt;!-- IF { $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;enable_confirm&quot; value=&quot;0&quot; &lt;!-- IF !{ $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_REG_LIMIT }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_REG_LIMIT_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;max_reg_attempts&quot; value=&quot;{ $MAX_REG_ATTEMPTS }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_name_chars&quot; value=&quot;{ $MIN_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_name_chars&quot; value=&quot;{ $MAX_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;allow_name_chars&quot;&gt;&lt;option value=&quot;.*&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '.*' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Any character&lt;/option&gt;&lt;option value=&quot;[\w]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric only&lt;/option&gt;&lt;option value=&quot;[\w_\+\. \-\[\]]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w_\+\. \-\[\]]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric and spacers&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+	
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_PASSWORD_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_pass_chars&quot; value=&quot;{ $MIN_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_pass_chars&quot; value=&quot;{ $MAX_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
+		&lt;/tr&gt;
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;pass_complex&quot;&gt;&lt;option value=&quot;.*&quot;&gt;No requirements&lt;/option&gt;&lt;option value=&quot;[a-zA-Z]&quot;&gt;Must be mixed case&lt;/option&gt;&lt;option value=&quot;[a-zA-Z0-9]&quot;&gt;Must contain alphanumerics&lt;/option&gt;&lt;option value=&quot;[a-zA-Z\W]&quot;&gt;Must contain symbols&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+&lt;!--
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_FORCE_PASS_CHANGE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_FORCE_PASS_CHANGE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;chg_passforce&quot; value=&quot;{ $CHG_PASSFORCE }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+	
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_EMAIL_REUSE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ALLOW_EMAIL_REUSE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_NAME_CHANGE }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_namechange&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_namechange&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
+		&lt;/tr&gt;
+--!&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input name=&quot;submit&quot; value=&quot;Submit&quot; class=&quot;button&quot; type=&quot;submit&quot;&gt;&nbsp;&nbsp;&lt;input value=&quot;Reset&quot; class=&quot;button&quot; type=&quot;reset&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	&lt;/table&gt;
+&lt;/form&gt;
+
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Modified: trunk/includes/templates/confirmation.html
===================================================================
--- trunk/includes/templates/confirmation.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/confirmation.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -2,7 +2,7 @@
 
 { $A_TABLE_OPEN }
 
-&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
+&lt;form action=&quot;{ $CONFIRM_ACTION }&quot; method=&quot;post&quot;&gt;
 	&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 		&lt;tbody&gt;
 			&lt;tr&gt;

Modified: trunk/includes/templates/modules/Contact/email/index.html
===================================================================
--- trunk/includes/templates/modules/Contact/email/index.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Contact/email/index.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -2,8 +2,8 @@
 &lt;br/&gt;
 &lt;br/&gt;
 &lt;center&gt;
-	{ $L_SENT_FROM }{ $SENT_FROM }&lt;br&gt;
-	{ $L_SENDER_NAME }{ $SENDER_NAME }&lt;br&gt;
-	{ $L_SENDER_EMAIL }{ $SENDER_EMAIL }&lt;br&gt;
-	{ $L_SENDER_IP }{ $SENDER_IP }&lt;br&gt;
+	{ $L_SENT_FROM }: { $SENT_FROM }&lt;br&gt;
+	{ $L_SENDER_NAME }: { $SENDER_NAME }&lt;br&gt;
+	{ $L_SENDER_EMAIL }: { $SENDER_EMAIL }&lt;br&gt;
+	{ $L_SENDER_IP }: { $SENDER_IP }&lt;br&gt;
 &lt;/center&gt;
\ No newline at end of file

Modified: trunk/includes/templates/modules/Contact/index.html
===================================================================
--- trunk/includes/templates/modules/Contact/index.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Contact/index.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,5 +1,5 @@
+&lt;!-- DISPLAY_HEADER --&gt;
 
-
 { $A_TABLE_OPEN }
 
 &lt;form method=&quot;post&quot; action=&quot;{ $ACTION }&quot; &gt;
@@ -27,7 +27,7 @@
     &lt;/table&gt;
 &lt;/form&gt;
 
-&lt;!-- IF { $PREVIEW } --&gt;
+&lt;!-- IF isset({ $PREVIEW }) --&gt;
 &lt;table width=&quot;100%&quot;&gt;
 	&lt;tr&gt;
 		&lt;td style=&quot;padding: 10px;&quot; width=&quot;30%&quot; valign=&quot;top&quot;&gt;
@@ -41,4 +41,6 @@
 &lt;/table&gt;
 &lt;!-- ENDIF --&gt;
 
-{ $A_TABLE_CLOSE }
\ No newline at end of file
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Modified: trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -21,7 +21,7 @@
 	&lt;!-- LOOP $leader --&gt;
 	&lt;tr&gt;
 		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{ $leader:U_VIEW_GROUP }&quot;&gt;{ $leader:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $leader:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $leader:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $leader:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $leader:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $leader:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDLOOP --&gt;
 
@@ -45,7 +45,7 @@
 	&lt;!-- LOOP $pending --&gt;
 	&lt;tr&gt;
 		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{ $pending:U_VIEW_GROUP }&quot;&gt;{ $pending:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $pending:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $pending:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $pending:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $pending:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $pending:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDLOOP --&gt;
 	
@@ -57,11 +57,11 @@
 	&lt;!-- LOOP $nonmember --&gt;
 	&lt;tr&gt;
 		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{$nonmember:U_VIEW_GROUP}&quot;&gt;{ $nonmember:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $nonmember:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $nonmember:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $nonmember:GROUP_APPLY } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $nonmember:GROUP_APPLY } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $nonmember:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDLOOP --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;3&quot;&gt;&lt;/div&gt;&lt;div style=&quot;float:right&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;Select: &lt;/span&gt;&lt;select name=&quot;mode&quot;&gt;&lt;option value=&quot;join&quot;&gt;Join marked&lt;/option&gt;&lt;option value=&quot;resign&quot;&gt;Resign marked&lt;/option&gt;&lt;option value=&quot;demote&quot;&gt;Demote marked&lt;/option&gt;&lt;/select&gt;&nbsp;&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{$L_SUBMIT}&quot; /&gt;&nbsp;&lt;/div&gt;&lt;/td&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;3&quot;&gt;&lt;/div&gt;&lt;div style=&quot;float:right&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;Select: &lt;/span&gt;&lt;select name=&quot;mode&quot;&gt;&lt;option value=&quot;apply&quot;&gt;Apply marked&lt;/option&gt;&lt;option value=&quot;resign&quot;&gt;Resign marked&lt;/option&gt;&lt;option value=&quot;demote&quot;&gt;Demote marked&lt;/option&gt;&lt;/select&gt;&nbsp;&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{$L_SUBMIT}&quot; /&gt;&nbsp;&lt;/div&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 &lt;/table&gt;
 

Modified: trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -13,12 +13,12 @@
 		&lt;td class=&quot;row1&quot; width=&quot;35%&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_CURRENT_IMAGE }: &lt;/b&gt;&lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_AVATAR_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
 		&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;&lt;br /&gt;&lt;!-- IF { $AVATAR } --&gt;{$AVATAR}&lt;!-- ELSE --&gt;&lt;img src=&quot;{ $T_THEME_PATH }/images/no_avatar.gif&quot; alt=&quot;&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;br /&gt;&lt;br /&gt;&lt;input type=&quot;checkbox&quot; name=&quot;delete&quot; /&gt;&nbsp;&lt;span class=&quot;gensmall&quot;&gt;{ $L_DELETE_AVATAR }&lt;/span&gt;&lt;/td&gt;
 	&lt;/tr&gt;
-	&lt;!-- IF { $S_UPLOAD_AVATAR_FILE } --&gt;
+&lt;!-- IF !isset({ $S_DISPLAY_GALLERY }) --&gt;
+	&lt;!-- IF { $S_CAN_UPLOAD } --&gt;
 	&lt;tr&gt; 
 		&lt;td class=&quot;row1&quot; width=&quot;35%&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_UPLOAD_AVATAR_FILE }: &lt;/b&gt;&lt;/td&gt;
 		&lt;td class=&quot;row2&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;{ $AVATAR_SIZE }&quot; /&gt;&lt;input class=&quot;post&quot; type=&quot;file&quot; name=&quot;uploadfile&quot; /&gt;&lt;/td&gt;
 	&lt;/tr&gt;
-	&lt;!-- ENDIF --&gt;&lt;!-- IF { $S_UPLOAD_AVATAR_URL } --&gt;
 	&lt;tr&gt; 
 		&lt;td class=&quot;row1&quot; width=&quot;35%&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_UPLOAD_AVATAR_URL }: &lt;/b&gt;&lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_UPLOAD_AVATAR_URL_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
 		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;uploadurl&quot; size=&quot;40&quot; value=&quot;&quot; /&gt;&lt;/td&gt;
@@ -37,7 +37,8 @@
 		&lt;td class=&quot;row1&quot; width=&quot;35%&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_AVATAR_GALLERY }: &lt;/b&gt;&lt;/td&gt;
 		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;btnlite&quot; type=&quot;submit&quot; name=&quot;display_gallery&quot; value=&quot;{ $L_DISPLAY_GALLERY }&quot; /&gt;&lt;/td&gt;
 	&lt;/tr&gt;
-	&lt;!-- ENDIF --&gt;&lt;!-- IF isset({ $S_DISPLAY_GALLERY }) --&gt;
+	&lt;!-- ENDIF --&gt;
+&lt;!-- ELSE --&gt;
 	&lt;tr&gt; 
 		&lt;th colspan=&quot;2&quot;&gt;{ $L_AVATAR_GALLERY }&lt;/th&gt;
 	&lt;/tr&gt;
@@ -49,7 +50,7 @@
 		&lt;table cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot; width=&quot;100%&quot;&gt;
 			&lt;!-- LOOP $avatar --&gt;&lt;!-- IF ({ $avatar:#LOOP_INDEX } % 8) == 0 --&gt;&lt;/tr&gt;&lt;tr&gt;&lt;!-- ENDIF --&gt;
 				&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;{ $avatar:AVATAR_IMAGE }&quot; alt=&quot;{ $avatar:AVATAR_NAME }&quot; title=&quot;{ $avatar:AVATAR_NAME }&quot; /&gt;&lt;br/&gt;
-				&lt;input type=&quot;radio&quot; name=&quot;avatarselect&quot; value=&quot;{ $avatar:S_OPTIONS_AVATAR }&quot; /&gt;&lt;/td&gt;
+				&lt;input type=&quot;radio&quot; name=&quot;avatarselect&quot; value=&quot;{ $avatar:AVATAR_FILE }&quot; /&gt;&lt;/td&gt;
 			&lt;!-- LOOPELSE --&gt;
 			&lt;tr&gt;
 				&lt;td align=&quot;center&quot;&gt;&lt;b class=&quot;gen&quot;&gt;{ $L_NO_GALLERY_AVATAR }&lt;/b&gt;&lt;/td&gt;

Modified: trunk/includes/templates/modules/Control_Panel/ucp_register.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_register.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Control_Panel/ucp_register.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -39,8 +39,8 @@
 			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot;  name=&quot;email_confirm&quot; size=&quot;25&quot; maxlength=&quot;255&quot; value=&quot;{ $EMAIL_CONFIRM }&quot; /&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt; 
-			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_NEW_PASSWORD }: &lt;/b&gt;&lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_NEW_PASSWORD_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;password&quot; name=&quot;new_password&quot; size=&quot;25&quot; maxlength=&quot;100&quot; value=&quot;{ $PASSWORD }&quot; /&gt;&lt;/td&gt;
+			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_PASSWORD }: &lt;/b&gt;&lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_PASSWORD_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;password&quot; name=&quot;password&quot; size=&quot;25&quot; maxlength=&quot;100&quot; value=&quot;{ $PASSWORD }&quot; /&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt; 
 			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_CONFIRM_PASSWORD }: &lt;/b&gt;&lt;/td&gt;
@@ -54,7 +54,7 @@
 		--&gt;
 		&lt;tr&gt; 
 			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_TIMEZONE }: &lt;/b&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;tz&quot;&gt;{ $S_TZ_OPTIONS }&lt;/select&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;tz&quot;&gt;{ $SELECT_TZ }&lt;/select&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;!-- IF { $CONFIRM_IMG } --&gt;
 		&lt;tr&gt; 

Modified: trunk/includes/templates/modules/Control_Panel/ucp_sideblock.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_sideblock.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Control_Panel/ucp_sideblock.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,125 +1,74 @@
-&#239;&#187;&#191;{if $S_SHOW_PM_BOX &amp;&amp; $S_POST_ACTION }
-	&lt;form action=&quot;{$S_POST_ACTION}&quot; method=&quot;post&quot; name=&quot;post&quot;{$S_FORM_ENCTYPE}&gt;
-	&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
-		&lt;tr&gt;
-			&lt;th&gt;{$L_PM_TO}&lt;/th&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{$L_USERNAME}:&lt;/b&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;username&quot; size=&quot;20&quot; maxlength=&quot;40&quot; value=&quot;&quot; /&gt;&nbsp;&lt;input class=&quot;post&quot; type=&quot;submit&quot; name=&quot;add_to&quot; value=&quot;{$L_ADD}&quot; /&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-	{if $S_ALLOW_MASS_PM }
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{$L_USERNAMES}:&lt;/b&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;textarea name=&quot;username_list&quot; rows=&quot;5&quot; cols=&quot;22&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
-				&lt;ul class=&quot;nav&quot; style=&quot;margin: 0px; padding: 0px; list-style-type: none; line-height: 175%;&quot;&gt;
-					&lt;li&gt;&#187; &lt;a href=&quot;{$U_SEARCH_USER}&quot; onclick=&quot;window.open('{$U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=500,resizable=yes,scrollbars=yes,WIDTH=740');return false&quot;&gt;{$L_FIND_USERNAME}&lt;/a&gt;&lt;/li&gt;
-				&lt;/ul&gt;
-			&lt;/td&gt;
-		&lt;/tr&gt;
-	{ /if }
-	{if $S_GROUP_OPTIONS }
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{$L_USERGROUPS}:&lt;/b&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;group_list[]&quot; multiple=&quot;true&quot; size=&quot;5&quot; style=&quot;width:150px&quot;&gt;{$S_GROUP_OPTIONS}&lt;/select&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-	{ /if }
-	{if $S_ALLOW_MASS_PM }
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot;&gt;&lt;div style=&quot;float:left&quot;&gt;&nbsp;&lt;input class=&quot;post&quot; type=&quot;submit&quot; name=&quot;add_bcc&quot; value=&quot;{$L_ADD_BCC}&quot; /&gt;&nbsp;&lt;/div&gt;&lt;div style=&quot;float:right&quot;&gt;&nbsp;&lt;input class=&quot;post&quot; type=&quot;submit&quot; name=&quot;add_to&quot; value=&quot;{$L_ADD_TO}&quot; /&gt;&nbsp;&lt;/div&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-	{ /if }
-	&lt;/table&gt;
-	&lt;div style=&quot;padding: 2px;&quot;&gt;&lt;/div&gt;
-{ /if }
-
-&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
+&#239;&#187;&#191;&lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
 	&lt;tr&gt;
-		&lt;th&gt;{$L_OPTIONS}&lt;/th&gt;
+		&lt;th&gt;{ $L_OPTIONS }&lt;/th&gt;
 	&lt;/tr&gt;
-	{section name=ucp_sectionloop loop=$ucp_section}
+	&lt;!-- LOOP $ucp_section --&gt;
 	&lt;tr&gt;
-		{ if $ucp_section[ucp_sectionloop].S_SELECTED }
-		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;nav&quot;&gt;{$ucp_section[ucp_sectionloop].L_TITLE}&lt;/b&gt;
-
+		&lt;!-- IF { $ucp_section:S_SELECTED } --&gt;
+		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;nav&quot;&gt;{ $ucp_section:L_TITLE }&lt;/b&gt;
 			&lt;ul class=&quot;nav&quot; style=&quot;margin: 0px; padding: 0px; list-style-type: none; line-height: 175%;&quot;&gt;
-			{section name=ucp_subsectionloop loop=$ucp_subsection}
-			&lt;li&gt;&#187; { if $ucp_subsection[ucp_subsectionloop].S_SELECTED }&lt;b&gt;{$ucp_subsection[ucp_subsectionloop].L_TITLE}&lt;/b&gt;{ else }&lt;a href=&quot;{$ucp_subsection[ucp_subsectionloop].U_TITLE}&quot;&gt;{$ucp_subsection[ucp_subsectionloop].L_TITLE}&lt;/a&gt;{ /if }&lt;/li&gt;
-			{ /section }
+			&lt;!-- LOOP $ucp_subsection --&gt;
+			&lt;li&gt;&#187; &lt;!-- IF { $ucp_subsection:S_SELECTED } --&gt;&lt;b&gt;{ $ucp_subsection:L_TITLE }&lt;/b&gt;&lt;!-- ELSE --&gt;&lt;a href=&quot;{$ucp_subsection:U_TITLE}&quot;&gt;{ $ucp_subsection:L_TITLE }&lt;/a&gt;&lt;!-- ENDIF --&gt;&lt;/li&gt;
+			&lt;!-- ENDLOOP $ucp_subsection --&gt;
 			&lt;/ul&gt;
-
-		{ else }
-		&lt;td class=&quot;row2&quot; nowrap=&quot;nowrap&quot; onmouseover=&quot;this.className='row1'&quot; onmouseout=&quot;this.className='row2'&quot; onclick=&quot;location.href='{$ucp_section[ucp_sectionloop].U_TITLE}'&quot;&gt;&lt;a class=&quot;nav&quot; href=&quot;{$ucp_section[ucp_sectionloop].U_TITLE}&quot;&gt;{$ucp_section[ucp_sectionloop].L_TITLE}&lt;/a&gt;
-		{ /if }
+		&lt;!-- ELSE --&gt;
+		&lt;td class=&quot;row2&quot; nowrap=&quot;nowrap&quot; onmouseover=&quot;this.className='row1'&quot; onmouseout=&quot;this.className='row2'&quot; onclick=&quot;location.href='{ $ucp_section:U_TITLE }'&quot;&gt;&lt;a class=&quot;nav&quot; href=&quot;{ $ucp_section:U_TITLE }&quot;&gt;{ $ucp_section:L_TITLE }&lt;/a&gt;
+		&lt;!-- ENDIF --&gt;
 		&lt;/td&gt;
 	&lt;/tr&gt;
-	{ /section }
+	&lt;!-- ENDLOOP $ucp_section --&gt;
 &lt;/table&gt;
 
 &lt;div style=&quot;padding: 2px;&quot;&gt;&lt;/div&gt;
 
-{ if $S_SHOW_COLOUR_LEGEND }
+&lt;!-- IF { $S_SHOW_COLOUR_LEGEND } --&gt;
 &lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;0&quot;&gt;
 	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;{$L_MESSAGE_COLOURS}&lt;/th&gt;
+		&lt;th colspan=&quot;2&quot;&gt;{ $L_MESSAGE_COLOURS }&lt;/th&gt;
 	&lt;/tr&gt;
-	{section name=pm_colour_infoloop loop=$pm_colour_info}
+	&lt;!-- LOOP $pm_colour_info --&gt;
 	&lt;tr&gt;
-		{ if !$pm_colour_info[pm_colour_infoloop].IMG }
-			&lt;td class=&quot;row1 {$pm_colour_info[pm_colour_infoloop].CLASS}&quot; width=&quot;5&quot;&gt;&lt;img src=&quot;images/spacer.gif&quot; width=&quot;5&quot; alt=&quot;{$pm_colour_info[pm_colour_infoloop].LANG}&quot; border=&quot;0&quot; /&gt;&lt;/td&gt;
-		{ else }
-			&lt;td class=&quot;row1&quot; width=&quot;25&quot; align=&quot;center&quot;&gt;{$pm_colour_info[pm_colour_infoloop].IMG}&lt;/td&gt;
-		{ /if }
-		&lt;td class=&quot;row1&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;{$pm_colour_info[pm_colour_infoloop].LANG}&lt;/span&gt;&lt;/td&gt;
+		&lt;!-- IF { $pm_colour_info:IMG } --&gt;
+			&lt;td class=&quot;row1 { $pm_colour_info:CLASS }&quot; width=&quot;5&quot;&gt;&lt;img src=&quot;images/spacer.gif&quot; width=&quot;5&quot; alt=&quot;{ $pm_colour_info:LANG }&quot; border=&quot;0&quot; /&gt;&lt;/td&gt;
+		&lt;!-- ELSE --&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;25&quot; align=&quot;center&quot;&gt;{ $pm_colour_info:IMG }&lt;/td&gt;
+		&lt;!-- ENDIF --&gt;
+		&lt;td class=&quot;row1&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;{ $pm_colour_info:LANG }&lt;/span&gt;&lt;/td&gt;
 	&lt;/tr&gt;
-	{ /section }
+	&lt;!-- ENDLOOP $pm_colour_info --&gt;
 &lt;/table&gt;
-
+ 
 &lt;div style=&quot;padding: 2px;&quot;&gt;&lt;/div&gt;
-{ /if }
+&lt;!-- ENDIF --&gt;
 
 &lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
 	&lt;tr&gt;
-		&lt;th&gt;{$L_FRIENDS}&lt;/th&gt;
+		&lt;th&gt;{ $L_FRIENDS }&lt;/th&gt;
 	&lt;/tr&gt;
 	&lt;tr&gt;
 		&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
 		
-			&lt;b class=&quot;genmed&quot; style=&quot;color:green&quot;&gt;{$L_FRIENDS_ONLINE}&lt;/b&gt;
+			&lt;b class=&quot;genmed&quot; style=&quot;color:green&quot;&gt;{ $L_FRIENDS_ONLINE }&lt;/b&gt;
 
 			&lt;ul class=&quot;nav&quot; style=&quot;margin: 0px; padding: 0px; list-style-type: none; line-height: 175%;&quot;&gt;
-			{section name=friends_onlineloop loop=$friends_online}
-				&lt;li&gt;&lt;a href=&quot;{$friends_online[friends_onlineloop].U_PROFILE}&quot;&gt;{$friends_online[friends_onlineloop].USERNAME}&lt;/a&gt;
-				{ if $S_SHOW_PM_BOX }
-					&nbsp;[ &lt;input class=&quot;post&quot; type=&quot;submit&quot; name=&quot;add_to[{$friends_online[friends_onlineloop].USER_ID}]&quot; value=&quot;{$L_ADD}&quot; /&gt; ]
-				{ /if }
-				&lt;/li&gt;
-			{sectionelse}
-			&lt;li&gt;{$L_NO_FRIENDS_ONLINE}&lt;/li&gt;
-			{ /section }
+			&lt;!-- LOOP $friends_online --&gt;
+				&lt;li&gt;&lt;a href=&quot;{ $friends_online:U_PROFILE }&quot;&gt;{ $friends_online:USERNAME }&lt;/a&gt;&lt;/li&gt;
+			&lt;!-- LOOPELSE --&gt;
+			&lt;li&gt;{ $L_NO_FRIENDS_ONLINE }&lt;/li&gt;
+			&lt;!-- ENDLOOP $friends_online --&gt;
 			&lt;/ul&gt;
 
 			&lt;hr /&gt;
 
-			&lt;b class=&quot;genmed&quot; style=&quot;color:red&quot;&gt;{$L_FRIENDS_OFFLINE}&lt;/b&gt;
+			&lt;b class=&quot;genmed&quot; style=&quot;color:red&quot;&gt;{ $L_FRIENDS_OFFLINE }&lt;/b&gt;
 
 			&lt;ul class=&quot;nav&quot; style=&quot;margin: 0px; padding: 0px; list-style-type: none; line-height: 175%;&quot;&gt;
-			{section name=friends_offlineloop loop=$friends_offline}
-			&lt;li&gt;&lt;a href=&quot;{$friends_offline[friends_offlineloop].U_PROFILE}&quot;&gt;{$friends_offline[friends_offlineloop].USERNAME}&lt;/a&gt;
-				{ if $S_SHOW_PM_BOX }
-					&nbsp;[ &lt;input class=&quot;post&quot; type=&quot;submit&quot; name=&quot;add_to[{$friends_offline[friends_offlineloop].USER_ID}]&quot; value=&quot;{$L_ADD}&quot; /&gt; ]
-				{ /if }
-			{sectionelse}
+			&lt;!-- LOOP $friends_offline --&gt;
+			&lt;li&gt;&lt;a href=&quot;{ $friends_offline:U_PROFILE }&quot;&gt;{ $friends_offline:USERNAME }&lt;/a&gt;&lt;/li&gt;
+			&lt;!-- LOOPELSE --&gt;
 			&lt;li&gt;{$L_NO_FRIENDS_OFFLINE}&lt;/li&gt;
-			{ /section }
+			&lt;!-- ENDLOOP $friends_online --&gt;
 			&lt;/ul&gt;
-
 		&lt;/td&gt;
 	&lt;/tr&gt;
-&lt;/table&gt;
\ No newline at end of file
+&lt;/table&gt;

Modified: trunk/includes/templates/modules/Forums/images/Thumbs.db
===================================================================
(Binary files differ)

Modified: trunk/includes/templates/modules/Forums/images/en/Thumbs.db
===================================================================
(Binary files differ)

Modified: trunk/includes/templates/modules/Forums/images/karma/Thumbs.db
===================================================================
(Binary files differ)

Modified: trunk/includes/templates/modules/Forums/overall_footer.html
===================================================================
--- trunk/includes/templates/modules/Forums/overall_footer.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Forums/overall_footer.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -12,7 +12,6 @@
 &lt;br /&gt;
 &lt;div style=&quot;text-align: center;&quot; class=&quot;copyright&quot;&gt;
 &lt;!-- IF { $U_ACP } --&gt;&lt;span class=&quot;gensmall&quot;&gt;[ &lt;a href=&quot;{ $U_ACP }&quot;&gt;{ $L_ACP }&lt;/a&gt; ]&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;&lt;!-- ENDIF --&gt;
-Powered by &lt;a href=&quot;<A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>&quot; target=&quot;phpbb&quot;&gt;phpBB&lt;/a&gt; &copy; 2002, 2005 phpBB Group
-&lt;br /&gt;{ $TRANSLATION_INFO }&lt;/div&gt;
+Based on &lt;a href=&quot;<A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>&quot; target=&quot;phpbb&quot;&gt;phpBB&lt;/a&gt;&lt;/div&gt;
 
 { $A_TABLE_CLOSE }
\ No newline at end of file

Modified: trunk/includes/templates/modules/Forums/overall_header.html
===================================================================
--- trunk/includes/templates/modules/Forums/overall_header.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Forums/overall_header.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,28 +1,3 @@
-&lt;script language=&quot;Javascript&quot; type=&quot;text/javascript&quot;&gt;
-&lt;!--
-
-function popup(url, width, height)
-{
-	window.open(url, '_popup', 'HEIGHT=' + height + ',resizable=yes,scrollbars=yes, WIDTH=' + width);
-	return false;
-}
-
-&lt;!-- IF isset({ $ON_PAGE }) --&gt;
-function jumpto()
-{
-	var page = prompt('{ $L_JUMP_PAGE }:', '{ $ON_PAGE }');
-	var perpage = '{ $PER_PAGE }';
-	var base_url = '{ $BASE_URL }';
-
-	if (page !== null &amp;&amp; !isNaN(page) &amp;&amp; page &gt; 0)
-	{
-		document.location.href = base_url.replace('&amp;', '&amp;') + '&amp;start=' + ((page - 1) * perpage);
-	}
-}
-&lt;!-- ENDIF --&gt;
-//--&gt;
-&lt;/script&gt;
-
 { $A_TABLE_OPEN }
 
 &lt;table width=&quot;100%&quot; cellspacing=&quot;0&quot;&gt;

Modified: trunk/includes/templates/modules/Members_List/memberlist_footer.html
===================================================================
--- trunk/includes/templates/modules/Members_List/memberlist_footer.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/modules/Members_List/memberlist_footer.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,15 +1,16 @@
-&lt;!--
-	We request you retain the full copyright notice below including the link to www.phpbb.com.
-	This not only gives respect to the large amount of time given freely by the developers
-	but also helps build interest, traffic and use of phpBB2. If you (honestly) cannot retain
-	the full copyright we ask you at least leave in place the &quot;Powered by phpBB&quot; line, with
-	&quot;phpBB&quot; linked to www.phpbb.com. If you refuse to include even this then support on our 
-	forums may be affected.
-
-	The phpBB Group : 2003
---&gt;
-
-&lt;br /&gt;&lt;div style=&quot;text-align: center;&quot; class=&quot;copyright&quot;&gt;Powered by &lt;a href=&quot;<A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>&quot; target=&quot;phpbb&quot;&gt;phpBB&lt;/a&gt; &copy; 2002, 2003 phpBB Group
-&lt;br /&gt;{ $TRANSLATION_INFO }&lt;/div&gt;
-
+&lt;!--
+	We request you retain the full copyright notice below including the link to www.phpbb.com.
+	This not only gives respect to the large amount of time given freely by the developers
+	but also helps build interest, traffic and use of phpBB2. If you (honestly) cannot retain
+	the full copyright we ask you at least leave in place the &quot;Powered by phpBB&quot; line, with
+	&quot;phpBB&quot; linked to www.phpbb.com. If you refuse to include even this then support on our 
+	forums may be affected.
+
+	The phpBB Group : 2003
+--&gt;
+
+&lt;br /&gt;
+&lt;div style=&quot;text-align: center;&quot; class=&quot;copyright&quot;&gt;
+Based on &lt;a href=&quot;<A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>&quot; target=&quot;phpbb&quot;&gt;phpBB&lt;/a&gt;&lt;/div&gt;
+
 { $A_TABLE_CLOSE }
\ No newline at end of file

Added: trunk/includes/templates/rss/atom.html
===================================================================
--- trunk/includes/templates/rss/atom.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/rss/atom.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,14 @@
+&lt;feed xml:lang=&quot;en-us&quot; xmlns=&quot;<A HREF="http://www.w3.org/2005/Atom">http://www.w3.org/2005/Atom</A>&quot;&gt;
+	&lt;title&gt;{ $SITE_NAME }&lt;/title&gt;
+	&lt;link href=&quot;{ $SITE_URL }&quot; /&gt;
+
+&lt;!-- LOOP $items --&gt;
+&lt;entry&gt;
+	&lt;title&gt;{ $items:TITLE }&lt;/title&gt;
+	&lt;link href=&quot;{ $items:LINK }&quot; /&gt;
+	&lt;summary type=&quot;xhtml&quot;&gt;&lt;div xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;&gt;{ $items:DESCRIPTION_HTML }&lt;/summary&gt;
+	&lt;updated&gt;{ $items:TIME }&lt;/updated&gt;
+&lt;/entry&gt;
+&lt;!-- ENDLOOP --&gt;
+
+&lt;/feed&gt;
\ No newline at end of file

Modified: trunk/includes/templates/rss/rdf.html
===================================================================
--- trunk/includes/templates/rss/rdf.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/rss/rdf.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -6,7 +6,7 @@
 &lt;channel rdf:about=&quot;{ $SITE_URL }&quot;&gt;
 	&lt;title&gt;{ $SITE_NAME }&lt;/title&gt;
 	&lt;link&gt;{ $SITE_URL }&lt;/link&gt;
-	&lt;description&gt;{ $SLOGAN }&lt;/description&gt;
+	&lt;description&gt;&lt;/description&gt;
 	&lt;items&gt;
 		&lt;rdf:Seq&gt;
 &lt;!-- LOOP $items --&gt;

Modified: trunk/includes/templates/rss/rss2.html
===================================================================
--- trunk/includes/templates/rss/rss2.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/rss/rss2.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -3,26 +3,20 @@
   xmlns:sy=&quot;<A HREF="http://purl.org/rss/1.0/modules/syndication/">http://purl.org/rss/1.0/modules/syndication/</A>&quot;
   xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
 
-&lt;channel&gt;
-&lt;title&gt;{ $SITE_NAME }&lt;/title&gt;
-&lt;link&gt;{ $SITE_URL }&lt;/link&gt;
-&lt;dc:language&gt;en-us&lt;/dc:language&gt;
-&lt;dc:creator&gt;Viperal CMS&lt;/dc:creator&gt;
-&lt;dc:date&gt;{ $TIME }&lt;/dc:date&gt;
-
-&lt;!-- LOOP $items --&gt;
-&lt;item&gt;
-&lt;title&gt;{ $items:TITLE }&lt;/title&gt;
-&lt;link&gt;{ $items:LINK }&lt;/link&gt;
-&lt;description&gt;
-
-{ $items:DESCRIPTION }
-
-&lt;/description&gt;
-&lt;dc:subject&gt;&lt;/dc:subject&gt;
-&lt;dc:date&gt;{ $items:TIME }&lt;/dc:date&gt;
-&lt;/item&gt;
-&lt;!-- ENDLOOP --&gt;
-
-&lt;/channel&gt;
+	&lt;channel&gt;
+		&lt;title&gt;{ $SITE_NAME }&lt;/title&gt;
+		&lt;link&gt;{ $SITE_URL }&lt;/link&gt;
+		&lt;dc:language&gt;en-us&lt;/dc:language&gt;
+		&lt;dc:creator&gt;Viperal CMS&lt;/dc:creator&gt;
+		&lt;dc:date&gt;{ $TIME }&lt;/dc:date&gt;
+		&lt;!-- LOOP $items --&gt;
+		&lt;item&gt;
+			&lt;title&gt;{ $items:TITLE }&lt;/title&gt;
+			&lt;link&gt;{ $items:LINK }&lt;/link&gt;
+			&lt;description&gt;{ $items:DESCRIPTION }&lt;/description&gt;
+			&lt;dc:subject&gt;&lt;/dc:subject&gt;
+			&lt;dc:date&gt;{ $items:TIME }&lt;/dc:date&gt;
+		&lt;/item&gt;
+		&lt;!-- ENDLOOP --&gt;
+	&lt;/channel&gt;
 &lt;/rss&gt;
\ No newline at end of file

Modified: trunk/includes/templates/rss/rss91.html
===================================================================
--- trunk/includes/templates/rss/rss91.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/templates/rss/rss91.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,20 +1,18 @@
 &lt;!DOCTYPE rss PUBLIC &quot;-//Netscape Communications//DTD RSS 0.91//EN&quot;
  &quot;<A HREF="http://my.netscape.com/publish/formats/rss-0.91.dtd">http://my.netscape.com/publish/formats/rss-0.91.dtd</A>&quot;&gt;
 &lt;rss version=&quot;0.91&quot;&gt;
-&lt;channel&gt;
-&lt;title&gt;{ $SITE_NAME }&lt;/title&gt;
-&lt;link&gt;{ $SITE_URL }&lt;/link&gt;
-&lt;description&gt;{ $SLOGAN }&lt;/description&gt;
-&lt;language&gt;{ $LANG }&lt;/language&gt;
-
-&lt;!-- LOOP $items --&gt;
-	&lt;item&gt;
-	&lt;title&gt;{ $items:TITLE }&lt;/title&gt;
-	&lt;link&gt;{ $items:LINK }&lt;/link&gt;
-	&lt;description&gt;{ $items:DESCRIPTION }&lt;/description&gt;
-	&lt;pubDate&gt;{ $items:TIME }&lt;/pubDate&gt;
-	&lt;/item&gt;
-&lt;!-- ENDLOOP --&gt;
-
-&lt;/channel&gt;
+	&lt;channel&gt;
+		&lt;title&gt;{ $SITE_NAME }&lt;/title&gt;
+		&lt;link&gt;{ $SITE_URL }&lt;/link&gt;
+		&lt;description&gt;&lt;/description&gt;
+		&lt;language&gt;{ $LANG }&lt;/language&gt;
+		&lt;!-- LOOP $items --&gt;
+		&lt;item&gt;
+			&lt;title&gt;{ $items:TITLE }&lt;/title&gt;
+			&lt;link&gt;{ $items:LINK }&lt;/link&gt;
+			&lt;description&gt;{ $items:DESCRIPTION }&lt;/description&gt;
+			&lt;pubDate&gt;{ $items:TIME }&lt;/pubDate&gt;
+		&lt;/item&gt;
+		&lt;!-- ENDLOOP --&gt;
+	&lt;/channel&gt;
 &lt;/rss&gt;
\ No newline at end of file

Modified: trunk/includes/user.php
===================================================================
--- trunk/includes/user.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/includes/user.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -63,7 +63,9 @@
 				$this-&gt;url = mb_substr($this-&gt;url, 0, $pos - 1);
 			}
 
-			$this-&gt;url = htmlspecialchars(html_entity_decode($this-&gt;url, ENT_QUOTES));
+			//$this-&gt;url = htmlspecialchars(html_entity_decode($this-&gt;url, ENT_QUOTES));
+			$this-&gt;url = htmlspecialchars($this-&gt;url, ENT_QUOTES);
+
 			$this-&gt;url = mb_substr($this-&gt;url, 0, 255);
 		}
 		else

Modified: trunk/index.php
===================================================================
--- trunk/index.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/index.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -13,9 +13,11 @@
 //																//
 //**************************************************************//
 define('VIPERAL', 'CMS');
+//print_r($_GET);
 
 //echo str_replace('\\','/', dirname(getenv('SCRIPT_FILENAME'))).'/'; die;
 $site_file_root = '';
+
 require($site_file_root.'core.php');
 
 $mod = get_variable('mod', 'REQUEST', false);
@@ -24,10 +26,9 @@
 {
 	// Set as homepage 
 	$_CLASS['core_display']-&gt;homepage = true;
+	//$_CORE_CONFIG['index_page'];
+	$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.CORE_MODULES_TABLE.&quot; WHERE module_name IN ( 'Contact' )&quot;);
 
-	// Get homepage modules
-	$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.CORE_MODULES_TABLE.' WHERE homepage &gt; 0 ORDER BY homepage ASC');
-
 	While ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
 		$_CLASS['core_display']-&gt;add_module($row);
@@ -37,10 +38,11 @@
 
 	if (!($_CORE_MODULE = $_CLASS['core_display']-&gt;get_module()))
 	{
-		$_CORE_MODULE['sides'] = BLOCK_ALL;
-		$_CORE_MODULE += array('name' =&gt; '', 'title' =&gt; ''); // temp
+		$_CORE_MODULE['module_sides'] = BLOCK_ALL;
+		$_CORE_MODULE += array('module_name' =&gt; '', 'module_title' =&gt; ''); // temp
 
-		$_CLASS['core_display']-&gt;display_head();
+		$_CLASS['core_user']-&gt;user_setup();
+		$_CLASS['core_display']-&gt;display_header();
 		// Hey admin we don't have a modules set
 		if ($_CLASS['core_auth']-&gt;admin_auth('modules'))
 		{
@@ -66,8 +68,12 @@
 		script_close(false);
 	}
 
+	$sql = 'SELECT * FROM '.CORE_MODULES_TABLE.'
+				WHERE module_type = ' . MODULE_NORMAL . &quot;
+				AND module_name = '&quot; . $_CLASS['core_db']-&gt;escape($mod) . &quot;'&quot;;
+
 	//Grab module data if it exsits
-	$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.CORE_MODULES_TABLE.' WHERE type='.MODULE_NORMAL.&quot; AND name='&quot;.$_CLASS['core_db']-&gt;escape($mod).&quot;'&quot;);
+	$result = $_CLASS['core_db']-&gt;query($sql);
 	$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 	$_CLASS['core_db']-&gt;free_result($result);
 
@@ -81,8 +87,8 @@
 	$_CORE_MODULE = $_CLASS['core_display']-&gt;get_module();
 }
 
-$path = $site_file_root.'modules/'.$_CORE_MODULE['name'].'/index.php';
-$_CLASS['core_user']-&gt;page = $_CORE_MODULE['name'];
+$path = $site_file_root.'modules/'.$_CORE_MODULE['module_name'].'/index.php';
+$_CLASS['core_user']-&gt;page = $_CORE_MODULE['module_name'];
 
 require_once($path);
 

Modified: trunk/install/build_data.php
===================================================================
--- trunk/install/build_data.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/install/build_data.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -87,13 +87,13 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'site_path', '', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'site_port', '', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES (1, 'GUESTS', 1, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES (2, 'REGISTERED', 1, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES (3, 'REGISTERED_COPPA', 1, 2, '', 0, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES (4, 'ADMINISTRATORS', 1, 2, 'AA0000', 1, '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES (5, 'BOTS', 1, 2, '9E8DA7', 1, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('GUESTS', 1, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('REGISTERED', 1, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('REGISTERED_COPPA', 1, 2, '', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('ADMINISTRATORS', 1, 2, 'AA0000', 1, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('BOTS', 1, 2, '9E8DA7', 1, '')&quot;);
 // To be seperated
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES (6, 'SUPER_MODERATORS', 1, 2, '00AA00', 0, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_name, group_type, group_status, group_colour, group_legend, group_description) VALUES ('SUPER_MODERATORS', 1, 2, '00AA00', 0, '')&quot;);
 
 
 //Admin
@@ -121,7 +121,7 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_admin_options) VALUES ('groups', 0, 2, '')&quot;);
 
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_sides) VALUES ('Articles', 1, 2, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_sides) VALUES ('Contact', 1, 2, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_sides) VALUES ('Contact', 1, 1, 2)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_sides) VALUES ('Calender', 1, 2, 2)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_sides) VALUES ('Control_Panel', 1, 2, 2)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_type, module_status, module_sides) VALUES ('Forums', 1, 2, 2)&quot;);
@@ -152,24 +152,28 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':idea:', 'idea.png', 'Idea', 19, 19, 19, 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':arrow:', 'arrow.png', 'Arrow', 19, 19, 20, 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':|', 'neutral.png', 'Neutral', 19, 19, 21, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':mrgreen:', 'mrgreen.png', 'Mr. Green', 19, 19, 22, 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order, smiley_type) VALUES (':mrgreen:', 'mrgreen.png', 'Mr. Green', 19, 19, 22, 0)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (1, 0, 2, 1, 'Anonymous', '', '', '', $time, '', 1, 0, 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (2, 1, 2, 4, 'admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '', $time, '', '', 1, 1, 1, 1, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (3, 2, 2, 5, 'Googlebot', '', '', '', $time, '216.239.46.,64.68.8,66.249.64.', 'Googlebot/', '', 1, 0, 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (4, 2, 2, 5, 'MSN', '', '', '', $time, '65.54.188.', 'msnbot/', '', 1, 0, 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (5, 2, 2, 5, 'Yahoo', '', '', '', $time, '66.196.90.1', 'Yahoo! Slurp', '', 1, 0, 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (6, 2, 2, 5, 'Alexa', '', '', '', $time, '66.28.250.,209.237.238.', 'ia_archiver', '', 1, 0, 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (7, 2, 2, 5, 'NaverBot', '', '', '', $time, '218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '', 1, 0, 0, 0, 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email) VALUES (8, 2, 2, 5, 'Jetbot', '', '', '', $time, '64.71.144.', 'Jetbot/', '', 1, 0, 0, 0, 0)&quot;);
+$admin_data = $_CLASS['core_db']-&gt;escape('a:6:{s:7:&quot;viewimg&quot;;b:1;s:9:&quot;viewflash&quot;;b:1;s:11:&quot;viewsmilies&quot;;b:1;s:8:&quot;viewsigs&quot;;b:1;s:11:&quot;viewavatars&quot;;b:1;s:11:&quot;viewcensors&quot;;b:1;}');
+$guest_data = $_CLASS['core_db']-&gt;escape('a:6:{s:7:&quot;viewimg&quot;;b:1;s:9:&quot;viewflash&quot;;b:1;s:11:&quot;viewsmilies&quot;;b:1;s:8:&quot;viewsigs&quot;;b:1;s:11:&quot;viewavatars&quot;;b:1;s:11:&quot;viewcensors&quot;;b:1;}');
+$bot_data = $_CLASS['core_db']-&gt;escape('a:6:{s:7:&quot;viewimg&quot;;b:1;s:9:&quot;viewflash&quot;;b:1;s:11:&quot;viewsmilies&quot;;b:1;s:8:&quot;viewsigs&quot;;b:1;s:11:&quot;viewavatars&quot;;b:1;s:11:&quot;viewcensors&quot;;b:1;}');
 
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (1, 0, 2, 1, 'Anonymous', '', '', '', $time, '', 1, 0, 0, 0, 0, '$guest_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (2, 1, 2, 4, 'admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '', $time, '', '', 1, 1, 1, 1, 1, '$admin_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (3, 2, 2, 5, 'Googlebot', '', '', '', $time, '216.239.46.,64.68.8,66.249.64.', 'Googlebot/', '', 1, 0, 0, 0, 0, '$bot_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (4, 2, 2, 5, 'MSN', '', '', '', $time, '65.54.188.', 'msnbot/', '', 1, 0, 0, 0, 0, '$bot_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (5, 2, 2, 5, 'Yahoo', '', '', '', $time, '66.196.90.1', 'Yahoo! Slurp', '', 1, 0, 0, 0, 0, '$bot_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (6, 2, 2, 5, 'Alexa', '', '', '', $time, '66.28.250.,209.237.238.', 'ia_archiver', '', 1, 0, 0, 0, 0, '$bot_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (7, 2, 2, 5, 'NaverBot', '', '', '', $time, '218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '', 1, 0, 0, 0, 0, '$bot_data')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data) VALUES (8, 2, 2, 5, 'Jetbot', '', '', '', $time, '64.71.144.', 'Jetbot/', '', 1, 0, 0, 0, 0, '$bot_data')&quot;);
+
 // Forums
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_list', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_read', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_post', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_reply', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_quote', 1)&quot;);f_bbcode
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_quote', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_edit', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_user_lock', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_delete', 1)&quot;);

Modified: trunk/install/build_tables.php
===================================================================
--- trunk/install/build_tables.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/install/build_tables.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -260,6 +260,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('user_allow_massemail', array('max' =&gt; 1));
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_new_privmsg', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('user_unread_privmsg', array('max' =&gt; 1, 'null' =&gt; true));
 
 $_CLASS['core_db']-&gt;add_table_field_text('user_sig', 60000, true);
 $_CLASS['core_db']-&gt;add_table_field_char('user_from', 100, true);
@@ -550,7 +551,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('post_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000));
-$_CLASS['core_db']-&gt;add_table_field_int('right_id', array('max' =&gt; 16000));
+$_CLASS['core_db']-&gt;add_table_field_int('right_id', array('max' =&gt; 16000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('poster_id', array('max' =&gt; 16000000));
 field_unix_time('post_time');
 $_CLASS['core_db']-&gt;add_table_field_char('poster_ip', 20);
@@ -601,14 +602,14 @@
 
 // we should set this on topic creation
 $_CLASS['core_db']-&gt;add_table_field_int('topic_last_post_id', array('max' =&gt; 16000000, 'null' =&gt; true));
-$_CLASS['core_db']-&gt;add_table_field_int('topic_first_post_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_first_post_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 
-$_CLASS['core_db']-&gt;add_table_field_int('topic_moved_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_moved_id', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200));
 
 $_CLASS['core_db']-&gt;add_table_field_int('topic_attachment', array('max' =&gt; 1));
 $_CLASS['core_db']-&gt;add_table_field_int('topic_approved', array('max' =&gt; 1));
-$_CLASS['core_db']-&gt;add_table_field_int('topic_reported', array('max' =&gt; 1)); 
+$_CLASS['core_db']-&gt;add_table_field_int('topic_reported', array('max' =&gt; 1, 'null' =&gt; true)); 
 field_unix_time('topic_time_limit');
 $_CLASS['core_db']-&gt;add_table_field_int('topic_replies_real', array('max' =&gt; 16000000, 'null' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('topic_first_poster_name', 50);
@@ -773,6 +774,46 @@
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
+	Forums Words Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_search_wordlist');
+
+$_CLASS['core_db']-&gt;add_table_field_int('word_id', array('max' =&gt; 3000000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('word_text', 100);
+$_CLASS['core_db']-&gt;add_table_field_int('word_common', array('max' =&gt; 1));
+
+$_CLASS['core_db']-&gt;add_table_index('word_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('word_text');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+	Forums search_wordmatch Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_search_wordmatch');
+
+$_CLASS['core_db']-&gt;add_table_field_int('post_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('word_id', array('max' =&gt; 3000000000));
+$_CLASS['core_db']-&gt;add_table_field_int('title_match', array('max' =&gt; 1));
+
+$_CLASS['core_db']-&gt;add_table_index('word_id', 'primary');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+	Forums Words Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_words');
+
+$_CLASS['core_db']-&gt;add_table_field_int('word_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('word', 100);
+$_CLASS['core_db']-&gt;add_table_field_char('replacement', 100);
+
+$_CLASS['core_db']-&gt;add_table_index('word_id', 'primary');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
 	Forums Zebra Table
 */
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_zebra');
@@ -789,4 +830,122 @@
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
+/*
+	Forums Log Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_log');
+
+$_CLASS['core_db']-&gt;add_table_field_int('log_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('log_type', array('max' =&gt; 200));
+$_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('forum_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('topic_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('reportee_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('log_ip', 40);
+field_unix_time('log_time');
+$_CLASS['core_db']-&gt;add_table_field_text('log_operation', 60000);
+$_CLASS['core_db']-&gt;add_table_field_text('log_data', 60000);
+
+$_CLASS['core_db']-&gt;add_table_index('log_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('log_type');
+$_CLASS['core_db']-&gt;add_table_index('forum_id');
+$_CLASS['core_db']-&gt;add_table_index('topic_id');
+$_CLASS['core_db']-&gt;add_table_index('reportee_id');
+$_CLASS['core_db']-&gt;add_table_index('user_id');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_privmsgs');
+
+$_CLASS['core_db']-&gt;add_table_field_int('msg_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('root_level', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('author_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('icon_id', array('max' =&gt; 200, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('author_ip', 40);
+field_unix_time('message_time');
+$_CLASS['core_db']-&gt;add_table_field_int('message_reported', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_bbcode', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_html', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_smilies', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_magic_url', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('enable_sig', array('max' =&gt; 1));
+
+$_CLASS['core_db']-&gt;add_table_field_char('message_subject', 60);
+$_CLASS['core_db']-&gt;add_table_field_text('message_text', 10000000);
+$_CLASS['core_db']-&gt;add_table_field_char('message_edit_reason', 100, true);
+$_CLASS['core_db']-&gt;add_table_field_int('message_edit_user', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('message_checksum', 11);
+$_CLASS['core_db']-&gt;add_table_field_int('message_attachment', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('bbcode_bitfield', 1000000000);
+$_CLASS['core_db']-&gt;add_table_field_char('bbcode_uid', 5);
+field_unix_time('message_edit_time', true);
+$_CLASS['core_db']-&gt;add_table_field_text('message_edit_count', array('max' =&gt; 200, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_text('to_address', 1000000);
+$_CLASS['core_db']-&gt;add_table_field_text('bcc_address', 1000000);
+
+$_CLASS['core_db']-&gt;add_table_index('msg_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('author_ip');
+$_CLASS['core_db']-&gt;add_table_index('message_time');
+$_CLASS['core_db']-&gt;add_table_index('author_id');
+$_CLASS['core_db']-&gt;add_table_index('root_level');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+	Forums Log Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_privmsgs_folder');
+
+$_CLASS['core_db']-&gt;add_table_field_int('folder_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_char('folder_name', 40);
+$_CLASS['core_db']-&gt;add_table_field_int('pm_count', array('max' =&gt; 16000000, 'null' =&gt; true));
+
+$_CLASS['core_db']-&gt;add_table_index('folder_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('user_id');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+	Forums Log Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_privmsgs_rules');
+
+$_CLASS['core_db']-&gt;add_table_field_int('rule_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('rule_check', array('max' =&gt; 2000));
+$_CLASS['core_db']-&gt;add_table_field_int('rule_connection', array('max' =&gt; 2000));
+$_CLASS['core_db']-&gt;add_table_field_char('rule_string', 255);
+$_CLASS['core_db']-&gt;add_table_field_int('rule_user_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('rule_group_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('rule_action', array('max' =&gt; 2000));
+$_CLASS['core_db']-&gt;add_table_field_text('rule_folder_id', 16000000);
+
+$_CLASS['core_db']-&gt;add_table_index('rule_id', 'primary');
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
+/*
+	Forums Log Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_privmsgs_to');
+
+$_CLASS['core_db']-&gt;add_table_field_int('msg_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('author_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('deleted', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('msg_new', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('unread', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('replied', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('marked', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('forwarded', array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('folder_id', array('max' =&gt; 16000000));
+
+$_CLASS['core_db']-&gt;add_table_index('msg_id');
+$_CLASS['core_db']-&gt;add_table_index(array('user_id', 'folder_id'));
+
+$_CLASS['core_db']-&gt;table_create('commit');
+
 ?&gt;
\ No newline at end of file

Modified: trunk/javascript/menu.js
===================================================================
--- trunk/javascript/menu.js	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/javascript/menu.js	2005-09-03 01:42:07 UTC (rev 96)
@@ -16,8 +16,9 @@
 function get_offsets(element)
 {
 	var offsets = new Array();
+	var window_offset = (window.pageYOffset) ? window.pageYOffset : (document.body.scrollTop) ? document.body.scrollTop : document.documentElement.scrollTop;
 
-	offsets['top']	= element.offsetTop;
+	offsets['top']	= Number(window_offset) + element.offsetTop;
 	offsets['left']	= element.offsetLeft;
 
 	while ((element = element.offsetParent) != null)

Modified: trunk/language/en/common.php
===================================================================
--- trunk/language/en/common.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/language/en/common.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -22,7 +22,6 @@
 // in a url you again do not need to specify an order e.g., 'Click %sHERE%s' is fine
 
 $this-&gt;lang += array(
-	'ENCODING'		=&gt; 'utf-8',
 	'LANG'			=&gt; 'en',
 	'DIRECTION'		=&gt; 'ltr',
 	'LEFT'			=&gt; 'left',
@@ -48,7 +47,7 @@
 	'ALL_FORUMS'			=&gt; 'All Forums',
 	'ALL_MESSAGES'			=&gt; 'All Messages',
 	'ALL_POSTS'				=&gt; 'All Posts',
-	'ALL_TIMES'             =&gt; 'All times are GMT%1$s %2$s',
+	'ALL_TIMES'             =&gt; 'All times are %1$s %2$s',
 	'ALL_TOPICS'			=&gt; 'All Topics',
 	'AND'					=&gt; 'And',
 	'ARE_WATCHING_FORUM'	=&gt; 'You have subscribed to receive updates on this forum',
@@ -214,9 +213,10 @@
 	'LOGOUT' 			=&gt; 'Logout',
 	'LOG_ADMIN_AUTH_FAIL'   =&gt; '&lt;b&gt;Failed administration login attempt&lt;/b&gt;',
 	'LOG_ADMIN_AUTH_SUCCESS'=&gt; '&lt;b&gt;Sucessful administration login&lt;/b&gt;',
+	'LOG_DELETE_POST'	=&gt; '&lt;b&gt;Deleted post&lt;/b&gt;&lt;br /&gt;&#187; %s',
 	'LOG_DELETE_TOPIC'	=&gt; '&lt;b&gt;Deleted topic&lt;/b&gt;&lt;br /&gt;&#187; %s',
-	'LOG_EMAIL_ERROR'       =&gt; '&lt;b&gt;Email error&lt;br /&gt;&#187; %s',
-	'LOG_JABBER_ERROR'      =&gt; '&lt;b&gt;Jabber error&lt;br /&gt;&#187; %s',
+	'LOG_EMAIL_ERROR'	=&gt; '&lt;b&gt;Email error&lt;br /&gt;&#187; %s',
+	'LOG_JABBER_ERROR'	=&gt; '&lt;b&gt;Jabber error&lt;br /&gt;&#187; %s',
 	'LOG_ME_IN'			=&gt; 'Log me on automatically each visit',
 	'LOG_USER_FEEDBACK'     =&gt; '&lt;b&gt;Added user feedback&lt;/b&gt;&lt;br /&gt;&#187; %s',
 	'LOG_USER_GENERAL'	=&gt; '%s',

Modified: trunk/language/en/error.php
===================================================================
--- trunk/language/en/error.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/language/en/error.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,10 +1,28 @@
 &lt;?php
+//**************************************************************//
+//  Vipeal CMS:													//
+//**************************************************************//
+//																//
+//  Copyright 2004 - 2005										//
+//  By Ryan Marshall ( Viperal&#169;	)								//
+//																//
+//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
+//																//
+//  Viperal CMS is released under the terms and conditions		//
+//  of the GNU General Public License version 2					//
+//																//
+//**************************************************************//
+$homepage = '<A HREF="http://www.viperal.com">http://www.viperal.com</A>';
 
 $error = array(
-	'403'	=&gt; '&lt;div style=&quot;text-align: center&quot;&lt;b&gt;Sorry, you don\'t have currect authorization to view this page.&lt;/b&gt;&lt;br /&gt;&lt;br /&gt; Please check the URL for proper spelling and capitalization&lt;br /&gt;'
-					.'&lt;br /&gt;&lt;a href=&quot;<A HREF="http://www.wowbeyond.com">http://www.wowbeyond.com</A>&quot;&gt;Click here to homepage&lt;/a&gt;&lt;br /&gt;[ &lt;a href=&quot;javascript:history.go(-1)&quot;&gt;Go Back&lt;/a&gt; ]&lt;/div&gt;',
-	'404'	=&gt; '&lt;div style=&quot;text-align: center&quot;&lt;b&gt;Sorry, the page you requested was not found.&lt;/b&gt;&lt;br /&gt;&lt;br /&gt; Please check the URL for proper spelling and capitalization&lt;br /&gt; If you believe this is a broken like please contact the stie admin.&lt;br /&gt;'
-		.'&lt;br /&gt;&lt;a href=&quot;<A HREF="http://www.wowbeyond.com">http://www.wowbeyond.com</A>&quot;&gt;Click here to homepage&lt;/a&gt;&lt;br /&gt;[ &lt;a href=&quot;javascript:history.go(-1)&quot;&gt;Go Back&lt;/a&gt; ]&lt;/div&gt;',	
+	'403' =&gt; array(
+		'header'	=&gt; 'HTTP/1.0 403 Forbidden',
+		'lang'		=&gt; '&lt;div style=&quot;text-align: center&quot;&lt;b&gt;Sorry, you don\'t have currect authorization to view this page.&lt;/b&gt;&lt;br /&gt;&lt;br /&gt; Please check the URL for proper spelling and capitalization&lt;br /&gt;'
+					.'&lt;br /&gt;&lt;a href=&quot;'. $homepage .'&quot;&gt;Click here to homepage&lt;/a&gt;&lt;br /&gt;[ &lt;a href=&quot;javascript:history.go(-1)&quot;&gt;Go Back&lt;/a&gt; ]&lt;/div&gt;'),
+	'404' =&gt; array(
+		'header'	=&gt; 'HTTP/1.0 404 Not Found',
+		'lang'		=&gt; '&lt;div style=&quot;text-align: center&quot;&lt;b&gt;Sorry, the page you requested was not found.&lt;/b&gt;&lt;br /&gt;&lt;br /&gt; Please check the URL for proper spelling and capitalization&lt;br /&gt; If you believe this is a broken like please contact the stie admin.&lt;br /&gt;'
+		.'&lt;br /&gt;&lt;a href=&quot;'. $homepage .'&quot;&gt;Click here to homepage&lt;/a&gt;&lt;br /&gt;[ &lt;a href=&quot;javascript:history.go(-1)&quot;&gt;Go Back&lt;/a&gt; ]&lt;/div&gt;'),	
 );
 
 ?&gt;
\ No newline at end of file

Modified: trunk/modules/Control_Panel/index.php
===================================================================
--- trunk/modules/Control_Panel/index.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Control_Panel/index.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -70,7 +70,7 @@
 			if ($row['module_acl'])
 			{
 				$is_auth = false;
-				eval('$is_auth = (' . preg_replace(array('#acl_([a-z_]+)#e', '#cfg_([a-z_]+)#e'), array('(int) $_CLASS[\'auth\']'.'-&gt;acl_get(&quot;\\1&quot;)', '(int) $config[&quot;\\1&quot;]'), trim($row['module_acl'])) . ');');
+				eval('$is_auth = (' . preg_replace(array('#acl_([a-z_]+)#e', '#cfg_([a-z_]+)#e'), array('$_CLASS[\'auth\']-&gt;acl_get(&quot;\\1&quot;)', '$config[&quot;\\1&quot;]'), trim($row['module_acl'])) . ');');
 
 				// The user is not authorised to use this module, skip it
 				if (!$is_auth)

Modified: trunk/modules/Control_Panel/ucp/ucp_main.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_main.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Control_Panel/ucp/ucp_main.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -201,7 +201,7 @@
 				}
 
 				// Do the relevant calculations 
-				$memberdays = max(1, round((time() - $_CLASS['core_user']-&gt;data['user_regdate']) / 86400));
+				$memberdays = max(1, round((time() - $_CLASS['core_user']-&gt;data['user_reg_date']) / 86400));
 				$posts_per_day = $_CLASS['core_user']-&gt;data['user_posts'] / $memberdays;
 				$percentage = ($config['num_posts']) ? min(100, ($num_real_posts / $config['num_posts']) * 100) : 0;
 
@@ -228,7 +228,7 @@
 
 				$_CLASS['core_template']-&gt;assign_array(array(
 					'USER_COLOR'		=&gt; (!empty($_CLASS['core_user']-&gt;data['user_colour'])) ? $_CLASS['core_user']-&gt;data['user_colour'] : '', 
-					'JOINED'			=&gt; $_CLASS['core_user']-&gt;format_date($_CLASS['core_user']-&gt;data['user_regdate']),
+					'JOINED'			=&gt; $_CLASS['core_user']-&gt;format_date($_CLASS['core_user']-&gt;data['user_reg_date']),
 					'VISITED'			=&gt; (empty($_CLASS['core_user']-&gt;data['user_lastvisit'])) ? ' - ' : $_CLASS['core_user']-&gt;format_date($_CLASS['core_user']-&gt;data['user_lastvisit']),
 					'POSTS'				=&gt; ($_CLASS['core_user']-&gt;data['user_posts']) ? $_CLASS['core_user']-&gt;data['user_posts'] : 0,
 					'POSTS_DAY'			=&gt; sprintf($_CLASS['core_user']-&gt;lang['POST_DAY'], $posts_per_day),

Modified: trunk/modules/Control_Panel/ucp/ucp_pm.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_pm.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Control_Panel/ucp/ucp_pm.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -140,7 +140,7 @@
 			case 'options':
 				$sql = 'SELECT group_message_limit
 					FROM ' . GROUPS_TABLE . '
-					WHERE group_id = ' . $_CLASS['core_user']-&gt;data['group_id'];
+					WHERE group_id = ' . $_CLASS['core_user']-&gt;data['user_group'];
 				$result = $_CLASS['core_db']-&gt;query($sql);
 
 				list($message_limit) = $_CLASS['core_db']-&gt;fetch_row_num($result);
@@ -169,7 +169,7 @@
 			
 				$sql = 'SELECT group_message_limit
 					FROM ' . GROUPS_TABLE . '
-					WHERE group_id = ' . $_CLASS['core_user']-&gt;data['group_id'];
+					WHERE group_id = ' . $_CLASS['core_user']-&gt;data['user_group'];
 				$result = $_CLASS['core_db']-&gt;query($sql);
 				list($message_limit) = $_CLASS['core_db']-&gt;fetch_row_num($result);
 				$_CLASS['core_db']-&gt;free_result($result);
@@ -286,7 +286,7 @@
 					}
 	
 					$sql = 'SELECT t.*, p.*, u.*
-						FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . FORUMS_USERS_TABLE . ' u
+						FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . ' u
 						WHERE t.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;
 							AND p.author_id = u.user_id
 							AND t.folder_id = $folder_id
@@ -379,6 +379,7 @@
 
 			default:
 				trigger_error('NO_ACTION_MODE');
+			break;
 		}
 
 		$_CLASS['core_template']-&gt;assign(array( 

Modified: trunk/modules/Control_Panel/ucp/ucp_pm_compose.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_pm_compose.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Control_Panel/ucp/ucp_pm_compose.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -17,10 +17,6 @@
 {
 	global $_CLASS, $site_file_root, $config;
 	
-	require($site_file_root.'includes/forums/functions_admin.php');
-	require($site_file_root.'includes/forums/functions_posting.php');
-	require($site_file_root.'includes/forums/message_parser.php');
-
 	if (!$action)
 	{
 		$action = 'post';
@@ -52,18 +48,18 @@
 	// Do NOT use request_var or specialchars here
 	$address_list	= isset($_REQUEST['address_list']) ? $_REQUEST['address_list'] : array();
 
-	$submit		= (isset($_POST['post']));
-	$preview	= (isset($_POST['preview']));
-	$save		= (isset($_POST['save']));
-	$load		= (isset($_POST['load']));
-	$cancel		= (isset($_POST['cancel']));
-	$confirm	= (isset($_POST['confirm']));
-	$delete		= (isset($_POST['delete']));
+	$submit		= isset($_POST['post']);
+	$preview	= isset($_POST['preview']);
+	$save		= isset($_POST['save']);
+	$load		= isset($_POST['load']);
+	$cancel		= isset($_POST['cancel']);
+	$confirm	= isset($_POST['confirm']);
+	$delete		= isset($_POST['delete']);
 
-	$remove_u	= (isset($_REQUEST['remove_u']));
-	$remove_g	= (isset($_REQUEST['remove_g']));
-	$add_to		= (isset($_REQUEST['add_to']));
-	$add_bcc	= (isset($_REQUEST['add_bcc']));
+	$remove_u	= isset($_REQUEST['remove_u']);
+	$remove_g	= isset($_REQUEST['remove_g']);
+	$add_to		= isset($_REQUEST['add_to']);
+	$add_bcc	= isset($_REQUEST['add_bcc']);
 
 	$refresh	= isset($_POST['add_file']) || isset($_POST['delete_file']) || isset($_POST['edit_comment']) || $save || $load
 		|| $remove_u || $remove_g || $add_to || $add_bcc;
@@ -71,7 +67,7 @@
 	$action		= ($delete &amp;&amp; !$preview &amp;&amp; !$refresh &amp;&amp; $submit) ? 'delete' : $action;
 
 	$error = array();
-	$current_time = time();
+	$current_time = gmtime();
 
 	// Was cancel pressed? If so then redirect to the appropriate page
 	if ($cancel || ($current_time - $lastclick &lt; 2 &amp;&amp; $submit))
@@ -80,6 +76,16 @@
 		redirect($redirect);
 	}
 
+	if ($action == 'forward' &amp;&amp; (!$config['forward_pm'] || !$_CLASS['auth']-&gt;acl_get('u_pm_forward')))
+	{
+		trigger_error('NO_AUTH_FORWARD_MESSAGE');
+	}
+
+	if ($action == 'edit' &amp;&amp; !$_CLASS['auth']-&gt;acl_get('u_pm_edit'))
+	{
+		trigger_error('NO_AUTH_EDIT_MESSAGE');
+	}
+
 	$sql = '';
 
 	// What is all this following SQL for? Well, we need to know
@@ -92,13 +98,11 @@
 			{
 				trigger_error('NO_AUTH_SEND_MESSAGE');
 			}
-		
-			break;
+		break;
 			
 		case 'reply':
 		case 'quote':
 		case 'forward':
-		
 			if (!$msg_id)
 			{
 				trigger_error('NO_MESSAGE');
@@ -108,11 +112,11 @@
 			{
 				trigger_error('NO_AUTH_SEND_MESSAGE');
 			}
-			
+
 			if ($quote_post)
 			{
 				$sql = 'SELECT p.post_text as message_text, p.poster_id as author_id, p.post_time as message_time, p.bbcode_bitfield, p.bbcode_uid, p.enable_sig, p.enable_html, p.enable_smilies, p.enable_magic_url, t.topic_title as message_subject, u.username as quote_username
-					FROM ' . POSTS_TABLE . ' p, ' . TOPICS_TABLE . ' t, ' . USERS_TABLE . &quot; u
+					FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_TOPICS_TABLE . ' t, ' . USERS_TABLE . &quot; u
 					WHERE p.post_id = $msg_id
 						AND t.topic_id = p.topic_id
 						AND u.user_id = p.poster_id&quot;;
@@ -120,13 +124,13 @@
 			else
 			{
 				$sql = 'SELECT t.*, p.*, u.username as quote_username
-					FROM ' . PRIVMSGS_TO_TABLE . ' t, ' . PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . ' u
+					FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . ' u
 					WHERE t.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;
 						AND p.author_id = u.user_id
 						AND t.msg_id = p.msg_id
 						AND p.msg_id = $msg_id&quot;;
 			}
-			break;
+		break;
 
 		case 'edit':
 			if (!$msg_id)
@@ -136,12 +140,12 @@
 
 			// check for outbox (not read) status, we do not allow editing if one user already having the message
 			$sql = 'SELECT p.*, t.*
-				FROM ' . PRIVMSGS_TO_TABLE . ' t, ' . PRIVMSGS_TABLE . ' p
+				FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p
 				WHERE t.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . '
 					AND t.folder_id = ' . PRIVMSGS_OUTBOX . &quot;
 					AND t.msg_id = $msg_id
 					AND t.msg_id = p.msg_id&quot;;
-			break;
+		break;
 
 		case 'delete':
 			if (!$_CLASS['auth']-&gt;acl_get('u_pm_delete'))
@@ -155,29 +159,24 @@
 			}
 
 			$sql = 'SELECT msg_id, unread, new, author_id, folder_id
-				FROM ' . PRIVMSGS_TO_TABLE . '
+				FROM ' . FORUMS_PRIVMSGS_TO_TABLE . '
 				WHERE user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;
 					AND msg_id = $msg_id&quot;;
 			break;
 
 		case 'smilies':
+			require_once($site_file_root.'includes/forums/functions_posting.php');
+	
 			generate_smilies('window', 0);
-			break;
+	
+			script_close(false);
+		break;
 
 		default:
 			trigger_error('NO_ACTION_MODE');
+		break;
 	}
 
-	if ($action == 'forward' &amp;&amp; (!$config['forward_pm'] || !$_CLASS['auth']-&gt;acl_get('u_pm_forward')))
-	{
-		trigger_error('NO_AUTH_FORWARD_MESSAGE');
-	}
-
-	if ($action == 'edit' &amp;&amp; !$_CLASS['auth']-&gt;acl_get('u_pm_edit'))
-	{
-		trigger_error('NO_AUTH_EDIT_MESSAGE');
-	}
-
 	if ($sql)
 	{
 		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
@@ -198,11 +197,11 @@
 			trigger_error('NO_AUTHOR');
 		}
 
-		if (($action == 'reply' || $action == 'quote') &amp;&amp; !sizeof($address_list) &amp;&amp; !$refresh &amp;&amp; !$submit &amp;&amp; !$preview)
+		if (($action == 'reply' || $action == 'quote') &amp;&amp; empty($address_list) &amp;&amp; !$refresh &amp;&amp; !$submit &amp;&amp; !$preview)
 		{
 			$address_list = array('u' =&gt; array($author_id =&gt; 'to'));
 		}
-		else if ($action == 'edit' &amp;&amp; !sizeof($address_list) &amp;&amp; !$refresh &amp;&amp; !$submit &amp;&amp; !$preview)
+		elseif ($action == 'edit' &amp;&amp; empty($address_list) &amp;&amp; !$refresh &amp;&amp; !$submit &amp;&amp; !$preview)
 		{
 			// Rebuild TO and BCC Header
 			$address_list = rebuild_header(array('to' =&gt; $to_address, 'bcc' =&gt; $bcc_address));
@@ -229,7 +228,6 @@
 		trigger_error('NO_AUTH_GROUP_MESSAGE');
 	}
 
-
 	if ($action == 'edit' &amp;&amp; !$refresh &amp;&amp; !$preview &amp;&amp; !$submit)
 	{
 		if (!($message_time &gt; time() - $config['pm_edit_time'] || !$config['pm_edit_time']))
@@ -237,16 +235,20 @@
 			trigger_error('CANNOT_EDIT_MESSAGE_TIME');
 		}
 	}
+
 	if (!isset($icon_id))
 	{
 		$icon_id = 0;
 	}
 
+	require_once($site_file_root.'includes/forums/functions_admin.php');
+	require_once($site_file_root.'includes/forums/functions_posting.php');
+	require_once($site_file_root.'includes/forums/message_parser.php');
 
 	$message_parser = new parse_message();
 
-	$message_subject = (isset($message_subject)) ? $message_subject : '';
-	$message_parser-&gt;message = ($action == 'reply') ? '' : ((isset($message_text)) ? $message_text : '');
+	$message_subject = isset($message_subject) ? $message_subject : '';
+	$message_parser-&gt;message = ($action == 'reply') ? '' : (isset($message_text) ? $message_text : '');
 	unset($message_text);
 
 	$s_action = &quot;Control_Panel&amp;i=$id&amp;mode=$mode&amp;action=$action&quot;;
@@ -295,7 +297,7 @@
 	if ($message_attachment &amp;&amp; !$submit &amp;&amp; !$refresh &amp;&amp; !$preview &amp;&amp; $action == 'edit')
 	{
 		$sql = 'SELECT attach_id, physical_filename, comment, real_filename, extension, mimetype, filesize, filetime, thumbnail
-			FROM ' . ATTACHMENTS_TABLE . &quot;
+			FROM ' . FORUMS_ATTACHMENTS_TABLE . &quot;
 			WHERE post_msg_id = $msg_id
 				AND in_message = 1
 				ORDER BY filetime &quot; . ((!$config['display_order']) ? 'DESC' : 'ASC');
@@ -320,7 +322,7 @@
 	if ($_CLASS['auth']-&gt;acl_get('u_savedrafts') &amp;&amp; $action != 'delete')
 	{
 		$sql = 'SELECT draft_id
-			FROM ' . DRAFTS_TABLE . '
+			FROM ' . FORUMS_DRAFTS_TABLE . '
 			WHERE (forum_id = 0 AND topic_id = 0)
 				AND user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . 
 				(($draft_id) ? &quot; AND draft_id &lt;&gt; $draft_id&quot; : '');
@@ -338,6 +340,7 @@
 		$message_parser-&gt;bbcode_uid = $bbcode_uid;
 	}
 
+$config['auth_bbcode_pm'] = true;
 	$html_status	= ($config['allow_html'] &amp;&amp; $config['auth_html_pm'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_html'));
 	$bbcode_status	= ($config['allow_bbcode'] &amp;&amp; $config['auth_bbcode_pm'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_bbcode'));
 	$smilies_status	= ($config['allow_smilies'] &amp;&amp; $config['auth_smilies_pm'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_smilies'));
@@ -353,7 +356,7 @@
 
 		if ($subject &amp;&amp; $message)
 		{
-			$sql = 'INSERT INTO ' . DRAFTS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
+			$sql = 'INSERT INTO ' . FORUMS_DRAFTS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
 				'user_id'	=&gt; $_CLASS['core_user']-&gt;data['user_id'],
 				'topic_id'	=&gt; 0,
 				'forum_id'	=&gt; 0,
@@ -377,7 +380,7 @@
 	if ($draft_id &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_savedrafts'))
 	{
 		$sql = 'SELECT draft_subject, draft_message 
-			FROM ' . DRAFTS_TABLE . &quot; 
+			FROM ' . FORUMS_DRAFTS_TABLE . &quot; 
 			WHERE draft_id = $draft_id
 				AND topic_id = 0
 				AND forum_id = 0
@@ -387,7 +390,7 @@
 		if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
 			$_REQUEST['subject'] = $row['draft_subject'];
-			$_POST['message'] = $row['draft_message'];
+			$_REQUEST['message'] = $row['draft_message'];
 			$refresh = true;
 			$_CLASS['core_template']-&gt;assign('S_DRAFT_LOADED', true);
 		}
@@ -405,18 +408,10 @@
 
 	if ($submit || $preview || $refresh)
 	{
-		$subject = request_var('subject', '');
+		$subject = mb_strtolower(get_variable('subject', 'POST', ''));
 
-		if (strcmp($subject, strtoupper($subject)) == 0 &amp;&amp; $subject)
-		{
-			$subject = strtolower($subject);
-		}
-		$subject = preg_replace('#&amp;(\#[0-9]+;)#', '&amp;\1', $subject);
+		$message_parser-&gt;message = request_var('message', '', true);
 
-	
-		$message_parser-&gt;message = (isset($_POST['message'])) ? htmlspecialchars(str_replace(array('\\\'', '\\&quot;', '\\0', '\\\\'), array('\'', '&quot;', '\0', '\\'), $_POST['message'])) : '';
-		$message_parser-&gt;message = preg_replace('#&amp;(\#[0-9]+;)#', '&amp;\1', $message_parser-&gt;message);
-
 		$icon_id			= request_var('icon', 0);
 
 		$enable_html 		= (!$html_status || isset($_POST['disable_html'])) ? false : true;
@@ -443,6 +438,7 @@
 
 		// Check checksum ... don't re-parse message if the same
 		$update_message = ($action != 'edit' || $message_md5 != $post_checksum || $status_switch || $preview) ? true : false;
+
 		if ($update_message)
 		{
 			$message_parser-&gt;parse($enable_html, $enable_bbcode, $enable_urls, $enable_smilies, $img_status, $flash_status, true);
@@ -455,7 +451,7 @@
 		if ($action != 'edit' &amp;&amp; !$preview &amp;&amp; !$refresh &amp;&amp; $config['flood_interval'] &amp;&amp; !$_CLASS['auth']-&gt;acl_get('u_ignoreflood'))
 		{
 			// Flood check
-			$last_post_time = $_CLASS['core_user']-&gt;data['user_lastpost_time'];
+			$last_post_time = $_CLASS['core_user']-&gt;data['user_last_post_time'];
 
 			if ($last_post_time)
 			{
@@ -472,18 +468,18 @@
 			$error[] = $_CLASS['core_user']-&gt;lang['EMPTY_SUBJECT'];
 		}
 
-		if (!sizeof($address_list))
+		if (empty($address_list))
 		{
 			$error[] = $_CLASS['core_user']-&gt;lang['NO_RECIPIENT'];
 		}
 
-		if (sizeof($message_parser-&gt;warn_msg) &amp;&amp; !($remove_u || $remove_g || $add_to || $add_bcc))
+		if (!empty($message_parser-&gt;warn_msg) &amp;&amp; !($remove_u || $remove_g || $add_to || $add_bcc))
 		{
 			$error[] = implode('&lt;br /&gt;', $message_parser-&gt;warn_msg);
 		}
 
 		// Store message, sync counters
-		if (!sizeof($error) &amp;&amp; $submit)
+		if (empty($error) &amp;&amp; $submit)
 		{
 			$pm_data = array(
 				'msg_id'				=&gt; (int) $msg_id,
@@ -519,7 +515,7 @@
 		$message_subject = stripslashes($subject);
 	}
 
-	if (!sizeof($error) &amp;&amp; $preview)
+	if (empty($error) &amp;&amp; $preview)
 	{
 		$post_time = ($action == 'edit') ? $post_time : $current_time;
 
@@ -546,7 +542,7 @@
 		}
 
 		// Attachment Preview
-		if (sizeof($message_parser-&gt;attachment_data))
+		if (!empty($message_parser-&gt;attachment_data))
 		{
 			require($site_file_root.'includes/forums/functions_display.php');
 			$extensions = $update_count = array();
@@ -557,7 +553,7 @@
 
 		$preview_subject = censor_text($subject);
 
-		if (!sizeof($error))
+		if (empty($error))
 		{
 			$_CLASS['core_template']-&gt;assign(array(
 				'POST_DATE'					=&gt; $_CLASS['core_user']-&gt;format_date($post_time),
@@ -572,7 +568,7 @@
 	}
 
 	// Decode text for message display
-	$bbcode_uid = (($action == 'quote' || $action == 'forward')&amp;&amp; !$preview &amp;&amp; !$refresh &amp;&amp; !sizeof($error)) ? $bbcode_uid : $message_parser-&gt;bbcode_uid;
+	$bbcode_uid = (($action == 'quote' || $action == 'forward')&amp;&amp; !$preview &amp;&amp; !$refresh &amp;&amp; empty($error)) ? $bbcode_uid : $message_parser-&gt;bbcode_uid;
 
 	$message_parser-&gt;decode_message($bbcode_uid);
 
@@ -623,18 +619,18 @@
 
 	// Build address list for display
 	// array('u' =&gt; array($author_id =&gt; 'to'));
-	if (sizeof($address_list))
+	if (!empty($address_list))
 	{
 		// Get Usernames and Group Names
 		$result = array();
-		if (isset($address_list['u']) &amp;&amp; sizeof($address_list['u']))
+		if (isset($address_list['u']) &amp;&amp; !empty($address_list['u']))
 		{
 			$result['u'] = $_CLASS['core_db']-&gt;query('SELECT user_id as id, username as name, user_colour as colour 
 				FROM ' . USERS_TABLE . ' 
 				WHERE user_id IN (' . implode(', ', array_map('intval', array_keys($address_list['u']))) . ')');
 		}
 		
-		if (isset($address_list['g']) &amp;&amp; sizeof($address_list['g']))
+		if (isset($address_list['g']) &amp;&amp; !empty($address_list['g']))
 		{
 			$result['g'] = $_CLASS['core_db']-&gt;query('SELECT group_id as id, group_name as name, group_colour as colour 
 				FROM ' . GROUPS_TABLE . ' 
@@ -745,7 +741,7 @@
 		'FLASH_STATUS'			=&gt; ($flash_status) ? $_CLASS['core_user']-&gt;lang['FLASH_IS_ON'] : $_CLASS['core_user']-&gt;lang['FLASH_IS_OFF'],
 		'SMILIES_STATUS'		=&gt; ($smilies_status) ? $_CLASS['core_user']-&gt;lang['SMILIES_ARE_ON'] : $_CLASS['core_user']-&gt;lang['SMILIES_ARE_OFF'],
 		'MINI_POST_IMG'			=&gt; $_CLASS['core_user']-&gt;img('icon_post', $_CLASS['core_user']-&gt;lang['PM']),
-		'ERROR'					=&gt; (sizeof($error)) ? implode('&lt;br /&gt;', $error) : '', 
+		'ERROR'					=&gt; empty($error) ? '' : implode('&lt;br /&gt;', $error), 
 
 		'S_EDIT_POST'			=&gt; ($action == 'edit'),
 		'S_SHOW_PM_ICONS'		=&gt; $s_pm_icons,
@@ -777,7 +773,7 @@
 // For composing messages, handle list actions
 function handle_message_list_actions(&amp;$address_list, $remove_u, $remove_g, $add_to, $add_bcc)
 {
-	global $_REQUEST;
+	global $_REQUEST, $site_file_root;
 
 	// Delete User [TO/BCC]
 	if ($remove_u)
@@ -801,7 +797,7 @@
 		// Add Selected Groups
 		$group_list = isset($_REQUEST['group_list']) ? array_map('intval', $_REQUEST['group_list']) : array();
 
-		if (sizeof($group_list))
+		if (!empty($group_list))
 		{
 			foreach ($group_list as $group_id)
 			{
@@ -818,12 +814,13 @@
 		}
 
 		// Reveal the correct user_ids
-		if (sizeof($usernames))
+		if (!empty($usernames))
 		{
-			$user_id_ary = array();
-			user_get_id_name($user_id_ary, $usernames);
+			require_once($site_file_root.'includes/functions_user.php');
+
+			$user_id_ary = user_get_id($usernames, $difference);
 			
-			if (sizeof($user_id_ary))
+			if (!empty($user_id_ary))
 			{
 				foreach ($user_id_ary as $user_id)
 				{

Modified: trunk/modules/Control_Panel/ucp/ucp_pm_viewmessage.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_pm_viewmessage.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Control_Panel/ucp/ucp_pm_viewmessage.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -46,12 +46,9 @@
 	$message = $message_row['message_text'];
 
 	// If the board has HTML off but the message has HTML on then we process it, else leave it alone
-	if (!$config['auth_html_pm'] || !$_CLASS['auth']-&gt;acl_get('u_pm_html'))
+	if ($message_row['enable_html'] &amp;&amp; (!$config['auth_html_pm'] || !$_CLASS['auth']-&gt;acl_get('u_pm_html')))
 	{
-		if ($message_row['enable_html'] &amp;&amp; $config['auth_bbcode_pm'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_bbcode'))
-		{
-			$message = preg_replace('#(&lt;)([\/]?.*?)(&gt;)#is', &quot;&lt;\\2&gt;&quot;, $message);
-		}
+		$message = preg_replace('#(&lt;!\-\- h \-\-&gt;&lt;)([\/]?.*?)(&gt;&lt;!\-\- h \-\-&gt;)#is', &quot;&lt;\\2&gt;&quot;, $message);
 	}
 
 	// Second parse bbcode here
@@ -89,7 +86,7 @@
 			require($site_file_root.'includes/forums/functions_display.php');
 
 			$sql = 'SELECT * 
-				FROM ' . ATTACHMENTS_TABLE . &quot;
+				FROM ' . FORUMS_ATTACHMENTS_TABLE . &quot;
 				WHERE post_msg_id = $msg_id
 					AND in_message = 1
 				ORDER BY filetime &quot; . ((!$config['display_order']) ? 'DESC' : 'ASC') . ', post_msg_id ASC';
@@ -102,9 +99,9 @@
 			$_CLASS['core_db']-&gt;free_result($result);
 	
 			// No attachments exist, but message table thinks they do so go ahead and reset attach flags
-			if (!sizeof($attachments))
+			if (empty($attachments))
 			{
-				$sql = 'UPDATE ' . PRIVMSGS_TABLE . &quot; 
+				$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TABLE . &quot; 
 					SET message_attachment = 0 
 					WHERE msg_id = $msg_id&quot;;
 				$_CLASS['core_db']-&gt;query($sql);
@@ -117,7 +114,7 @@
 	}
 
 	// Assign inline attachments
-	if (isset($attachments) &amp;&amp; sizeof($attachments))
+	if (!empty($attachments))
 	{
 		$unset_attachments = parse_inline_attachments($message, $attachments, $update_count, 0);
 	
@@ -157,7 +154,7 @@
 		'AUTHOR_RANK' 		=&gt; $user_info['rank_title'],
 		'RANK_IMAGE' 		=&gt; $user_info['rank_image'],
 		'AUTHOR_AVATAR'		=&gt; (isset($user_info['avatar'])) ? $user_info['avatar'] : '',
-		'AUTHOR_JOINED'		=&gt; $_CLASS['core_user']-&gt;format_date($user_info['user_regdate'], $_CLASS['core_user']-&gt;lang['DATE_FORMAT']),
+		'AUTHOR_JOINED'		=&gt; $_CLASS['core_user']-&gt;format_date($user_info['user_reg_date']),
 		'AUTHOR_POSTS' 		=&gt; (!empty($user_info['user_posts'])) ? $user_info['user_posts'] : '',
 		'AUTHOR_FROM' 		=&gt; (!empty($user_info['user_from'])) ? $user_info['user_from'] : '',
 
@@ -195,10 +192,10 @@
 		'S_HAS_ATTACHMENTS' =&gt; (sizeof($attachments)) ? true : false,
 		'S_DISPLAY_NOTICE'	=&gt; $display_notice &amp;&amp; $message_row['message_attachment'],
 
-		'U_PRINT_PM'		=&gt; ($config['print_pm'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_printpm')) ? generate_link(&quot;$url&amp;f=$folder_id&amp;p=&quot; . $message_row['msg_id'] . &quot;&amp;view=print&quot;) : '',
-		'U_EMAIL_PM'		=&gt; ($config['email_pm'] &amp;&amp; $_CORE_CONFIG['email']['email_enable'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_emailpm')) ? 'Email' : '',
-		'U_FORWARD_PM'		=&gt; ($config['forward_pm'] &amp;&amp; $_CLASS['auth']-&gt;acl_get('u_pm_forward')) ? generate_link(&quot;$url&amp;mode=compose&amp;action=forward&amp;f=$folder_id&amp;p=&quot; . $message_row['msg_id']) : '')
-	);
+		'U_PRINT_PM'		=&gt; generate_link(&quot;$url&amp;f=$folder_id&amp;p=&quot; . $message_row['msg_id'] . &quot;&amp;view=print&quot;),
+		'U_EMAIL_PM'		=&gt; ($_CORE_CONFIG['email']['email_enable']) ? 'Email' : '',
+		'U_FORWARD_PM'		=&gt; generate_link(&quot;$url&amp;mode=compose&amp;action=forward&amp;f=$folder_id&amp;p=&quot; . $message_row['msg_id'])
+	));
 
 	// Display not already displayed Attachments for this post, we already parsed them. ;)
 	if (isset($attachments) &amp;&amp; sizeof($attachments))
@@ -229,7 +226,7 @@
 
 	// Get History Messages (could be newer)
 	$sql = 'SELECT t.*, p.*, u.*
-		FROM ' . PRIVMSGS_TABLE . ' p, ' . PRIVMSGS_TO_TABLE . ' t, ' . USERS_TABLE . ' u
+		FROM ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . USERS_TABLE . ' u
 		WHERE t.msg_id = p.msg_id 
 			AND p.author_id = u.user_id
 			AND t.folder_id &lt;&gt; ' . PRIVMSGS_NO_BOX . &quot;
@@ -243,6 +240,7 @@
 	{
 		$sql .= &quot; AND (p.root_level = &quot; . $message_row['root_level'] . ' OR p.msg_id = ' . $message_row['root_level'] . ')';
 	}
+
 	$sql .= ' ORDER BY p.message_time ';
 	$sort_dir = (!empty($_CLASS['core_user']-&gt;data['user_sortby_dir'])) ? $_CLASS['core_user']-&gt;data['user_sortby_dir'] : 'd';
 	$sql .= ($sort_dir == 'd') ? 'ASC' : 'DESC';
@@ -372,30 +370,30 @@
 	}
 
 	// Grab ranks
-	$ranks = array();
-	obtain_ranks($ranks);
+	$ranks = obtain_ranks();
 
 	// Generate online information for user
+	
+	$user_row['online'] = false;
+
 	if ($config['load_onlinetrack'])
 	{
-		$sql = 'SELECT session_user_id, MAX(session_time) as online_time, MIN(session_viewonline) AS viewonline
+		$sql = 'SELECT session_user_id, MAX(session_hidden) AS session_hidden
 			FROM ' . SESSIONS_TABLE . &quot; 
 			WHERE session_user_id = $user_id
-			GROUP BY session_user_id&quot;;
+			AND session_time &lt; &quot; . ($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['server']['session_length']) . '
+				GROUP BY session_user_id';
 		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
 
 		$update_time = $config['load_online_time'] * 60;
+
 		if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
-			$user_row['online'] = (time() - $update_time &lt; $row['online_time'] &amp;&amp; ($row['viewonline'] &amp;&amp; $user_row['user_allow_viewonline'])) ? true : false;
-		} else {
-			$user_row['online'] = false;
+			$user_row['online'] = (!$row['session_hidden'] &amp;&amp; $user_row['user_allow_viewonline']) ? true : false;
 		}
+
+		$_CLASS['core_db']-&gt;free_result($result);
 	}
-	else
-	{
-		$user_row['online'] = false;
-	}
 
 	if ($user_row['user_avatar'] &amp;&amp; $_CLASS['core_user']-&gt;optionget('viewavatars'))
 	{
@@ -419,7 +417,7 @@
 		$user_row['rank_title'] = (!empty($ranks['special'][$user_row['user_rank']]['rank_title'])) ? $ranks['special'][$user_row['user_rank']]['rank_title'] : '';
 		$user_row['rank_image'] = (!empty($ranks['special'][$user_row['user_rank']]['rank_image'])) ? '&lt;img src=&quot;' . $config['ranks_path'] . '/' . $ranks['special'][$user_row['user_rank']]['rank_image'] . '&quot; border=&quot;0&quot; alt=&quot;' . $ranks['special'][$user_row['user_rank']]['rank_title'] . '&quot; title=&quot;' . $ranks['special'][$user_row['user_rank']]['rank_title'] . '&quot; /&gt;&lt;br /&gt;' : '';
 	}
-	elseif(isset($ranks['normal']))
+	elseif (isset($ranks['normal']))
 	{
 		foreach ($ranks['normal'] as $rank)
 		{
@@ -431,6 +429,10 @@
 			}
 		}
 	}
+	else
+	{
+		$user_row['rank_title'] = $user_row['rank_image'] = '';
+	}
 
 	if (!empty($user_row['user_allow_viewemail']) || $_CLASS['auth']-&gt;acl_get('a_email'))
 	{

Modified: trunk/modules/Control_Panel/ucp/ucp_prefs.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_prefs.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Control_Panel/ucp/ucp_prefs.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -15,12 +15,14 @@
 {
 	function ucp_prefs($id, $mode)
 	{
-		global $config, $_CLASS, $SID, $_CORE_CONFIG;
+		global $config, $_CLASS, $site_file_root, $_CORE_CONFIG;
 
 		$submit = (isset($_POST['submit'])) ? true : false;
 		$error = $data = array();
 		$s_hidden_fields = '';
 
+		require_once($site_file_root.'includes/forums/functions_user.php');
+
 		switch($mode)
 		{
 			case 'personal':
@@ -49,7 +51,6 @@
 					}
 
 					$var_ary = array(
-						//'dateformat'	=&gt; array('string', false, 3, 15), 
 						'lang'			=&gt; array('match', false, '#^[a-z_]{2,}$#i'),
 						'tz'			=&gt; array('num', false, -13, 13),
 					);
@@ -69,11 +70,11 @@
 							'user_allow_massemail'	=&gt; $massemail, 
 							'user_allow_viewonline'	=&gt; ($_CLASS['auth']-&gt;acl_get('u_hideonline')) ? !$hideonline : $_CLASS['core_user']-&gt;data['user_allow_viewonline'], 
 							'user_notify_type'		=&gt; $notifymethod, 
-							'user_notify_pm'		=&gt; $notifypm,
+							//'user_notify_pm'		=&gt; $notifypm,
 							'user_data'				=&gt; serialize($_CLASS['core_user']-&gt;data['user_data']), 
 
 							'user_dst'				=&gt; $dst,
-							'user_dateformat'		=&gt; $dateformat,
+							'user_time_format'		=&gt; $dateformat,
 							'user_lang'				=&gt; $lang,
 							'user_timezone'			=&gt; $tz * 3600,
 							'user_theme'			=&gt; $theme,
@@ -109,7 +110,7 @@
 				$hideonline = (isset($hideonline)) ? $hideonline : !$_CLASS['core_user']-&gt;data['user_allow_viewonline'];
 				$hide_online_yes = ($hideonline) ? ' checked=&quot;checked&quot;' : '';
 				$hide_online_no = (!$hideonline) ? ' checked=&quot;checked&quot;' : '';
-				$notifypm = (isset($notifypm)) ? $notifypm : $_CLASS['core_user']-&gt;data['user_notify_pm'];
+				$notifypm = (isset($notifypm)) ? $notifypm : '';
 				$notify_pm_yes = ($notifypm) ? ' checked=&quot;checked&quot;' : '';
 				$notify_pm_no = (!$notifypm) ? ' checked=&quot;checked&quot;' : '';
 				$popuppm = (isset($popuppm)) ? $popuppm : $_CLASS['core_user']-&gt;optionget('popuppm');
@@ -123,7 +124,7 @@
 				$dst_no = (!$dst) ? ' checked=&quot;checked&quot;' : '';
 
 				$notifymethod = (isset($notifymethod)) ? $notifymethod : $_CLASS['core_user']-&gt;data['user_notify_type'];
-				$dateformat = (isset($dateformat)) ? $dateformat : $_CLASS['core_user']-&gt;data['user_dateformat'];
+				$dateformat = (isset($dateformat)) ? $dateformat : $_CLASS['core_user']-&gt;data['user_time_format'];
 				$lang = (isset($lang)) ? $lang : $_CLASS['core_user']-&gt;data['user_lang'];
 				$theme = (isset($theme)) ? $theme : $_CLASS['core_user']-&gt;data['user_theme'];
 				$tz = (isset($tz)) ? $tz * 3600 : $_CLASS['core_user']-&gt;data['user_timezone'] / 3600;
@@ -227,7 +228,7 @@
 						$_CLASS['core_db']-&gt;sql_query($sql);
 
 						$_CLASS['core_display']-&gt;meta_refresh(3, generate_link(&quot;Control_Panel&amp;i=$id&amp;mode=$mode&quot;));
-						$message = $_CLASS['core_user']-&gt;lang['PREFERENCES_UPDATED'] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_UCP'], '&lt;a href=&quot;'.generate_link(&quot;Control_Panel$SID&amp;i=$id&amp;mode=$mode&quot;).'&quot;&gt;', '&lt;/a&gt;');
+						$message = $_CLASS['core_user']-&gt;lang['PREFERENCES_UPDATED'] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_UCP'], '&lt;a href=&quot;'.generate_link(&quot;Control_Panel&amp;i=$id&amp;mode=$mode&quot;).'&quot;&gt;', '&lt;/a&gt;');
 						trigger_error($message);
 					}
 					// Replace &quot;error&quot; strings with their real, localised form

Modified: trunk/modules/Forums/posting.php
===================================================================
--- trunk/modules/Forums/posting.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Forums/posting.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -206,7 +206,7 @@
 $message_parser-&gt;get_submitted_attachment_data();
 
 // Set uninitialized variables
-$uninit = array('post_attachment' =&gt; 0, 'poster_id' =&gt; 0, 'enable_magic_url' =&gt; 0, 'topic_status' =&gt; 0, 'topic_type' =&gt; POST_NORMAL, 'subject' =&gt; '', 'topic_title' =&gt; '', 'post_time' =&gt; 0, 'post_edit_reason' =&gt; '');
+$uninit = array('post_attachment' =&gt; 0, 'poster_id' =&gt; 0, 'enable_magic_url' =&gt; 0, 'topic_status' =&gt; ITEM_UNLOCKED, 'topic_type' =&gt; POST_NORMAL, 'subject' =&gt; '', 'topic_title' =&gt; '', 'post_time' =&gt; 0, 'post_edit_reason' =&gt; '');
 
 foreach ($uninit as $var_name =&gt; $default_value)
 {
@@ -510,8 +510,8 @@
 	
 	if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
-		$_REQUEST['subject'] = html_entity_decode($row['draft_subject'], HTML_ENTITIES);
-		$_REQUEST['message'] = html_entity_decode($row['draft_message'], HTML_ENTITIES);
+		$_REQUEST['subject'] = $row['draft_subject'];
+		$_REQUEST['message'] = $row['draft_message'];
 
 		$refresh = true;
 		$_CLASS['core_template']-&gt;assign('S_DRAFT_LOADED', true);
@@ -536,7 +536,7 @@
 	$topic_cur_post_id	= get_variable('topic_cur_post_id', 'POST', 0, 'int');
 
 	$subject = mb_strtolower(get_variable('subject', 'POST', ''));
-	$message_parser-&gt;message = get_variable('message', 'POST', '');
+	$message_parser-&gt;message = request_var('message', '', true);
 
 
 	$topic_time_limit	= (isset($_POST['topic_time_limit'])) ? (int) $_POST['topic_time_limit'] : (($mode != 'post') ? $topic_time_limit : 0);
@@ -841,6 +841,7 @@
 				'topic_first_post_id'	=&gt; (isset($topic_first_post_id)) ? (int) $topic_first_post_id : 0,
 				'topic_last_post_id'	=&gt; (isset($topic_last_post_id)) ? (int) $topic_last_post_id : 0,
 				'topic_time_limit'		=&gt; (int) $topic_time_limit,
+				'topic_status'			=&gt; (int) $posting_data['topic_status'],
 				'post_id'				=&gt; (int) $post_id,
 				'topic_id'				=&gt; (int) $topic_id,
 				'forum_id'				=&gt; (int) $forum_id,
@@ -1482,6 +1483,7 @@
 				'topic_first_poster_name' =&gt; (!$_CLASS['core_user']-&gt;is_user &amp;&amp; $username) ? stripslashes($username) : $_CLASS['core_user']-&gt;data['username'],
 				'topic_type'		=&gt; $topic_type,
 				'topic_time_limit'	=&gt; ($topic_type == POST_STICKY || $topic_type == POST_ANNOUNCE) ? ($data['topic_time_limit'] * 86400) : 0,
+				'topic_status'		=&gt; $data['topic_status'],
 				'topic_attachment'	=&gt; (isset($data['filename_data']['physical_filename']) &amp;&amp; sizeof($data['filename_data'])) ? 1 : 0
 			);
 

Modified: trunk/modules/Forums/viewforum.php
===================================================================
--- trunk/modules/Forums/viewforum.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Forums/viewforum.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -66,21 +66,21 @@
 }
 else
 {
-		if ($config['load_db_lastread'])
-		{
-			$sql_lastread = 'LEFT JOIN ' . FORUMS_TRACK_TABLE . ' ft ON (ft.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . ' 
-				AND ft.forum_id = f.forum_id AND ft.topic_id = 0)';
-			$lastread_select = ', ft.mark_time ';
-		}
-		else
-		{
-			$sql_lastread = $lastread_select = '';
-			$tracking_topics = (isset($_COOKIE[$_CORE_CONFIG['server']['cookie_name'] . '_track'])) ? unserialize(stripslashes($_COOKIE[$_CORE_CONFIG['server']['cookie_name'] . '_track'])) : array();
-		}
+	if ($config['load_db_lastread'])
+	{
+		$sql_lastread = 'LEFT JOIN ' . FORUMS_TRACK_TABLE . ' ft ON (ft.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . ' 
+			AND ft.forum_id = f.forum_id AND ft.topic_id = 0)';
+		$lastread_select = ', ft.mark_time ';
+	}
+	else
+	{
+		$sql_lastread = $lastread_select = '';
+		$tracking_topics = (isset($_COOKIE[$_CORE_CONFIG['server']['cookie_name'] . '_track'])) ? unserialize(stripslashes($_COOKIE[$_CORE_CONFIG['server']['cookie_name'] . '_track'])) : array();
+	}
 
-		$sql = &quot;SELECT f.*, fw.notify_status $lastread_select 
-			FROM &quot; . FORUMS_FORUMS_TABLE . ' f LEFT JOIN ' . FORUMS_WATCH_TABLE . ' fw ON (fw.forum_id = f.forum_id AND fw.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;) $sql_lastread
-			WHERE f.forum_id = $forum_id&quot;;
+	$sql = &quot;SELECT f.*, fw.notify_status $lastread_select 
+		FROM &quot; . FORUMS_FORUMS_TABLE . ' f LEFT JOIN ' . FORUMS_WATCH_TABLE . ' fw ON (fw.forum_id = f.forum_id AND fw.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;) $sql_lastread
+		WHERE f.forum_id = $forum_id&quot;;
 }
 
 $result = $_CLASS['core_db']-&gt;query($sql);
@@ -187,7 +187,7 @@
 	if ($_CLASS['auth']-&gt;acl_get('f_subscribe', $forum_id))
 	{
 		$notify_status = (isset($forum_data['notify_status'])) ? $forum_data['notify_status'] : NULL;
-		$s_watching_forum = watch_topic_forum('forum', $_CLASS['core_user']-&gt;data['user_id'], $forum_id, $notify_status);
+		$s_watching_forum = watch_topic_forum('forum', $_CLASS['core_user']-&gt;data['user_id'], $forum_id, 0, $notify_status);
 	}
 	else
 	{
@@ -224,6 +224,7 @@
 		{
 			$start = 0;
 		}
+
 		$topics_count = ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result)) ? $row['num_topics'] : 0;
 		$sql_limit_time = &quot;AND t.topic_last_post_time &gt;= $min_post_time&quot;;
 	}
@@ -295,11 +296,16 @@
 	$rowset = $announcement_list = $topic_list = array();
 
 	$sql_from = FORUMS_TOPICS_TABLE.' t ';
-	$sql_from .= ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['load_db_lastread']) ? ' LEFT JOIN ' . FORUMS_TRACK_TABLE . ' tt ON (tt.topic_id = t.topic_id AND tt.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . ')' : '';
+	$sql_select = '';
 
-	$sql_approved = ($_CLASS['auth']-&gt;acl_get('m_approve', $forum_id)) ? '' : 'AND t.topic_approved = 1';
-	$sql_select = (($config['load_db_lastread'] || $config['load_db_track']) &amp;&amp; $_CLASS['core_user']-&gt;is_user) ? ', tt.mark_time' : '';
+	if ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['load_db_lastread'])
+	{
+		$sql_from .= ' LEFT JOIN ' . FORUMS_TRACK_TABLE . ' tt ON (tt.topic_id = t.topic_id AND tt.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . ')';
+		$sql_select .= ', tt.mark_time';
+	}
 
+	$sql_approved = $_CLASS['auth']-&gt;acl_get('m_approve', $forum_id) ? '' : 'AND t.topic_approved = 1';
+
 	if ($forum_data['forum_type'] == FORUM_POST)
 	{
 		// Obtain announcements ... removed sort ordering, sort by time in all cases
@@ -322,6 +328,7 @@
 	$store_reverse = false;
 	$sql_limit = $config['topics_per_page'];
 
+// what's this store_reverse all about ?
 	if ($start &gt; $topics_count / 2)
 	{
 		$store_reverse = true;
@@ -343,7 +350,7 @@
 	}
 
 	// Obtain other topics
-	$sql_where = ($forum_data['forum_type'] == FORUM_POST || !sizeof($active_forum_ary)) ? &quot;= $forum_id&quot; : 'IN (' . implode(', ', $active_forum_ary['forum_id']) . ')';
+	$sql_where = ($forum_data['forum_type'] == FORUM_POST || empty($active_forum_ary)) ? &quot;= $forum_id&quot; : 'IN (' . implode(', ', $active_forum_ary['forum_id']) . ')';
 	$sql = &quot;SELECT t.* $sql_select
 		FROM $sql_from
 		WHERE t.forum_id $sql_where
@@ -364,10 +371,10 @@
 
 	// we only update the mark if this is made into an (int) time
 	// We don't check when $start is used
-	$mark_forum_read = ($start) ? false : true;
+	$mark_forum_read = ($sql_start || $sql_limit != $config['topics_per_page'] || $sql_limit_time) ? false : true;
 
 	// Okay, lets dump out the page ...
-	if (sizeof($topic_list))
+	if (!empty($topic_list))
 	{
 		if ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['load_db_lastread'])
 		{
@@ -419,7 +426,7 @@
 			$s_type_switch_test = ($row['topic_type'] == POST_ANNOUNCE || $row['topic_type'] == POST_GLOBAL) ? 1 : 0;
 
 			// Replies
-			$replies = ($_CLASS['auth']-&gt;acl_get('m_approve', $forum_id)) ? $row['topic_replies_real'] : $row['topic_replies'];
+			$replies = ($_CLASS['auth']-&gt;acl_get('m_approve', $forum_id)) ? (int) $row['topic_replies_real'] : (int) $row['topic_replies'];
 
 			if ($row['topic_status'] == ITEM_MOVED)
 			{

Modified: trunk/modules/Forums/viewtopic.php
===================================================================
--- trunk/modules/Forums/viewtopic.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Forums/viewtopic.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -150,9 +150,9 @@
 
 if ($_CLASS['core_user']-&gt;is_user)
 {
-	$extra_fields .= ', tw.notify_status';
+	$extra_fields .= ', tw.notify_status, tw.topic_id AS watch_topic';
 	$join_sql_table .= ' LEFT JOIN ' . FORUMS_WATCH_TABLE . ' tw ON (tw.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot; 
-		AND (tw.forum_id = $forum_id OR tw.topic_id = $topic_id))&quot;;
+		AND tw.forum_id = $forum_id AND tw.topic_id IN ($topic_id, 0))&quot;;
 
 	if ($config['allow_bookmarks'])
 	{
@@ -193,9 +193,14 @@
 }
 
 // Are we watching this topic?
-$topic_data['notify_status'] = isset($topic_data['notify_status']) ? $topic_data['notify_status'] : null;
-$s_watching_topic = watch_topic_forum('topic', $_CLASS['core_user']-&gt;data['user_id'], $topic_id, $topic_data['notify_status'], $start);
+if (!isset($topic_data['notify_status']))
+{
+	$topic_data['notify_status'] = null;
+	$topic_data['watch_topic'] = false;
+}
 
+$s_watching_topic = watch_topic_forum('topic', $_CLASS['core_user']-&gt;data['user_id'], $forum_id, $topic_id, $topic_data['notify_status'], $start);
+
 // Bookmarks
 if ($config['allow_bookmarks'] &amp;&amp; $_CLASS['core_user']-&gt;is_user &amp;&amp; request_var('bookmark', 0))
 {
@@ -394,21 +399,21 @@
 		}
 	}
 
-	$s_can_vote = (((!sizeof($cur_voted_id) &amp;&amp; $_CLASS['auth']-&gt;acl_get('f_vote', $forum_id)) || 
+	$s_can_vote = (((empty($cur_voted_id) &amp;&amp; $_CLASS['auth']-&gt;acl_get('f_vote', $forum_id)) || 
 		($_CLASS['auth']-&gt;acl_get('f_votechg', $forum_id) &amp;&amp; $poll_vote_change)) &amp;&amp;
 		(($poll_length != 0 &amp;&amp; $poll_start + $poll_length &gt; time()) || $poll_length == 0) &amp;&amp;
 		$topic_data['topic_status'] != ITEM_LOCKED &amp;&amp; 
 		$topic_data['forum_status'] != ITEM_LOCKED) ? true : false;
 		
-		$s_display_results = (!$s_can_vote || ($s_can_vote &amp;&amp; sizeof($cur_voted_id)) || $view == 'viewpoll') ? true : false;
+		$s_display_results = (!$s_can_vote || ($s_can_vote &amp;&amp; !empty($cur_voted_id)) || $view == 'viewpoll') ? true : false;
 		
 	if ($update &amp;&amp; $s_can_vote)
 	{
-		if (!sizeof($voted_id) || sizeof($voted_id) &gt; $poll_max_options)
+		if (empty($voted_id) || !empty($voted_id) &gt; $poll_max_options)
 		{
 			$_CLASS['core_display']-&gt;meta_refresh(5, generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&quot;));
 
-			$message = (!sizeof($voted_id)) ? 'NO_VOTE_OPTION' : 'TOO_MANY_VOTE_OPTIONS';
+			$message = empty($voted_id) ? 'NO_VOTE_OPTION' : 'TOO_MANY_VOTE_OPTIONS';
 			$message = $_CLASS['core_user']-&gt;lang[$message] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_TOPIC'], '&lt;a href=&quot;'.generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&quot;).'&quot;&gt;', '&lt;/a&gt;');
 			trigger_error($message);
 		}
@@ -483,7 +488,7 @@
 		require_once($site_file_root.'includes/forums/bbcode.php');
 		$poll_bbcode = new bbcode();
 		
-		$size = sizeof($poll_info);
+		$size = !empty($poll_info);
 		for ($i = 0, $size; $i &lt; $size; $i++)
 		{
 			$poll_bbcode-&gt;bbcode_second_pass($poll_info[$i]['poll_option_text'], $poll_info[$i]['bbcode_uid'], $poll_option['bbcode_bitfield']);
@@ -757,7 +762,7 @@
 			}
 			else
 			{
-				if (isset($ranks['normal']) &amp;&amp; sizeof($ranks['normal']))
+				if (isset($ranks['normal']) &amp;&amp; !empty($ranks['normal']))
 				{
 					foreach ($ranks['normal'] as $rank)
 					{
@@ -801,7 +806,7 @@
 $_CLASS['core_db']-&gt;free_result($result);
 
 // Generate online information for user
-if ($config['load_onlinetrack'] &amp;&amp; sizeof($id_cache))
+if ($config['load_onlinetrack'] &amp;&amp; !empty($id_cache))
 {
 	$sql = 'SELECT session_user_id, session_hidden, MAX(session_time) as online_time
 		FROM ' . SESSIONS_TABLE . ' 
@@ -820,7 +825,7 @@
 unset($id_cache);
 
 // Pull attachment data
-if (sizeof($attach_list))
+if (!empty($attach_list))
 {
 	if ($_CLASS['auth']-&gt;acl_gets('f_download', 'u_download', $forum_id))
 	{
@@ -840,7 +845,7 @@
 		$_CLASS['core_db']-&gt;free_result($result);
 
 		// No attachments exist, but post table thinks they do so go ahead and reset post_attach flags
-		if (!sizeof($attachments))
+		if (empty($attachments))
 		{
 			$sql = 'UPDATE ' . FORUMS_POSTS_TABLE . ' 
 				SET post_attachment = 0 
@@ -848,7 +853,7 @@
 			$_CLASS['core_db']-&gt;query($sql);
 
 			// We need to update the topic indicator too if the complete topic is now without an attachment
-			if (sizeof($rowset) != $total_posts)
+			if (!empty($rowset) != $total_posts)
 			{
 				// Not all posts are displayed so we query the db to find if there's any attachment for this topic
 				$sql = 'SELECT a.post_msg_id as post_id
@@ -942,7 +947,7 @@
 	$message = $row['post_text'];
 
 	// If the board has HTML off but the post has HTML on then we process it, else leave it alone
-	if ((!$config['allow_html'] || !$_CLASS['auth']-&gt;acl_get('f_html', $forum_id)) &amp;&amp; $row['enable_html'])
+	if ($row['enable_html'] &amp;&amp; (!$config['allow_html'] || !$_CLASS['auth']-&gt;acl_get('f_html', $forum_id)))
 	{
 		$message = preg_replace('#(&lt;!\-\- h \-\-&gt;&lt;)([\/]?.*?)(&gt;&lt;!\-\- h \-\-&gt;)#is', &quot;&lt;\\2&gt;&quot;, $message);
 	}
@@ -956,7 +961,7 @@
 	// Always process smilies after parsing bbcodes
 	$message = smiley_text($message);
 
-	if (isset($attachments[$row['post_id']]) &amp;&amp; sizeof($attachments[$row['post_id']]))
+	if (isset($attachments[$row['post_id']]) &amp;&amp; !empty($attachments[$row['post_id']]))
 	{
 		$unset_attachments = parse_inline_attachments($message, $attachments[$row['post_id']], $update_count, $forum_id);
 
@@ -989,7 +994,7 @@
 	if (($row['post_edit_count'] &amp;&amp; $config['display_last_edited']) || $row['post_edit_reason'])
 	{
 		// Get usernames for all following posts if not already stored
-		if (!sizeof($post_edit_list) &amp;&amp; $row['post_edit_reason'])
+		if (empty($post_edit_list) &amp;&amp; $row['post_edit_reason'])
 		{
 			// Remove all post_ids already parsed (we do not have to check them)
 			$post_storage_list = (!$store_reverse) ? array_slice($post_list, $i) : array_slice(array_reverse($post_list), $i);
@@ -1041,7 +1046,7 @@
 	$post_attachments = array();
 
 	// Remove this foreach.
-	if (isset($attachments[$row['post_id']]) &amp;&amp; sizeof($attachments[$row['post_id']]))
+	if (isset($attachments[$row['post_id']]) &amp;&amp; !empty($attachments[$row['post_id']]))
 	{
 		foreach ($attachments[$row['post_id']] as $attachment)
 		{
@@ -1146,6 +1151,7 @@
 $topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? '&lt;option value=&quot;viewlogs&quot;&gt;' . $_CLASS['core_user']-&gt;lang['VIEW_TOPIC_LOGS'] . '&lt;/option&gt;' : '';
 
 $pagination = generate_pagination(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;$u_sort_param&quot; . (($highlight_match) ? &quot;&amp;hilit=$highlight&quot; : ''), $total_posts, $config['posts_per_page'], $start);
+$topic_data['topic_title'] = censor_text($topic_data['topic_title']);
 
 // Send vars to template
 $_CLASS['core_template']-&gt;assign_array(array(
@@ -1153,14 +1159,14 @@
 	'FORUM_NAME' 		=&gt; $topic_data['forum_name'],
 	'FORUM_DESC'		=&gt; $topic_data['forum_desc'],
 	'TOPIC_ID' 			=&gt; $topic_id,
-	'TOPIC_TITLE' 		=&gt; censor_text($topic_data['topic_title']),
+	'TOPIC_TITLE' 		=&gt; $topic_data['topic_title'],
 	'PAGINATION'		=&gt; $pagination['formated'],
 	'PAGINATION_ARRAY'	=&gt; $pagination['array'],
 	'PAGE_NUMBER' 		=&gt; on_page($total_posts, $config['posts_per_page'], $start),
 	'TOTAL_POSTS'		=&gt; ($total_posts == 1) ? $_CLASS['core_user']-&gt;lang['VIEW_TOPIC_POST'] : sprintf($_CLASS['core_user']-&gt;lang['VIEW_TOPIC_POSTS'], $total_posts), 
 	'U_MCP' 			=&gt; ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? generate_link(&quot;Forums&amp;file=mcp&amp;mode=topic_view&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param&quot;, false, false) : '',
 
-	'MODERATORS'	=&gt; (isset($forum_moderators[$forum_id]) &amp;&amp; sizeof($forum_moderators[$forum_id])) ? implode(', ', $forum_moderators[$forum_id]) : '',
+	'MODERATORS'	=&gt; (isset($forum_moderators[$forum_id]) &amp;&amp; !empty($forum_moderators[$forum_id])) ? implode(', ', $forum_moderators[$forum_id]) : '',
 
 	'POST_IMG' 		=&gt; ($topic_data['forum_status'] == ITEM_LOCKED) ? $_CLASS['core_user']-&gt;img('btn_locked', 'FORUM_LOCKED') : $_CLASS['core_user']-&gt;img('btn_post', 'POST_NEW_TOPIC'),
 	'QUOTE_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_quote', 'REPLY_WITH_QUOTE'),
@@ -1201,6 +1207,7 @@
 	'U_PRINT_TOPIC'			=&gt; ($_CLASS['auth']-&gt;acl_get('f_print', $forum_id)) ? generate_link($viewtopic_url . '&amp;view=print') : '',
 	'U_EMAIL_TOPIC'			=&gt; ($_CLASS['auth']-&gt;acl_get('f_email', $forum_id) &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('Members_List&amp;mode=email&amp;t='.$topic_id) : '', 
 
+	'S_WATCH_FORUMS'		=&gt; $topic_data['watch_topic'] ? false : true,
 	'U_WATCH_TOPIC' 		=&gt; $s_watching_topic['link'], 
 	'L_WATCH_TOPIC' 		=&gt; $s_watching_topic['title'], 
 
@@ -1209,7 +1216,7 @@
 	
 	'U_POST_NEW_TOPIC' 		=&gt; generate_link('Forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id),
 	'U_POST_REPLY_TOPIC' 	=&gt; generate_link(&quot;Forums&amp;file=posting&amp;mode=reply&amp;t=$topic_id&quot;),
-	'U_BUMP_TOPIC'			=&gt; (bump_topic_allowed($forum_id, $topic_data['topic_bumped'], $topic_data['topic_last_post_time'], $topic_data['topic_poster'], $topic_data['topic_last_poster_id'])) ? generate_link(&quot;Forums&amp;file=posting&amp;mode=bump&amp;t=$topic_id&quot;) : '')
+	'U_BUMP_TOPIC'			=&gt; bump_topic_allowed($forum_id, $topic_data['topic_bumped'], $topic_data['topic_last_post_time'], $topic_data['topic_poster'], $topic_data['topic_last_poster_id']) ? generate_link(&quot;Forums&amp;file=posting&amp;mode=bump&amp;t=$topic_id&quot;) : '')
 );
 
 // Update topic view and if necessary attachment view counters ... but only
@@ -1224,7 +1231,7 @@
 	$_CLASS['core_db']-&gt;query($sql);
 
 	// Update the attachment download counts
-	if (sizeof($update_count))
+	if (!empty($update_count))
 	{
 		$sql = 'UPDATE ' . FORUMS_ATTACHMENTS_TABLE . ' 
 			SET download_count = download_count + 1 
@@ -1238,7 +1245,6 @@
 {
 	// Now lets get the all topics that are in the markable range,
 	// with is the max topics displayed on the forum's viewforum page
-// Need forum_topic_per_page along with whatever users have to after listing
 
 	// Get the user's last mark time for this forums
 	$sql = 'SELECT mark_time FROM '.FORUMS_TRACK_TABLE . ' 
@@ -1250,7 +1256,7 @@
 	$_CLASS['core_db']-&gt;free_result($result);
 		
 	$sql = 'SELECT t.topic_id, t.topic_last_post_time, tr.mark_time FROM ' . FORUMS_TOPICS_TABLE . ' t
-			LEFT JOIN ' . FORUMS_TRACK_TABLE . ' tr ON ( tr.topic_id = t.topic_id AND tr.user_id = '.$_CLASS['core_user']-&gt;data['user_id'].&quot;)
+			LEFT JOIN ' . FORUMS_TRACK_TABLE . ' tr ON (tr.topic_id = t.topic_id AND tr.user_id = '.$_CLASS['core_user']-&gt;data['user_id'].&quot;)
 				WHERE t.forum_id = $forum_id
 					ORDER BY topic_last_post_time DESC&quot;;
 
@@ -1265,11 +1271,13 @@
 		do
 		{
 			$last_mark_time = max($row['mark_time'], $forum_marktime);
+
 			if ($row['topic_last_post_time'] &gt; $last_mark_time &amp;&amp; $row['topic_id'] != $topic_id)
 			{
 				// We have a winner/loser
 				// Set so the forum isn't marked
 				$update_forum_mark = false;
+
 				break;
 			}
 		}
@@ -1297,7 +1305,7 @@
 
 make_jumpbox(generate_link('Forums&amp;file=viewforum'), $forum_id);
 
-$_CLASS['core_display']-&gt;display(array($_CLASS['core_user']-&gt;lang['VIEW_TOPIC'], $topic_data['topic_title']), 'modules/Forums/viewtopic_body.html');
+$_CLASS['core_display']-&gt;display(array($_CLASS['core_user']-&gt;get_lang('VIEWING_TOPIC'), $topic_data['topic_title']), 'modules/Forums/viewtopic_body.html');
 
 //Move if we can
 function topic_last_read($topic_id, $forum_id)

Modified: trunk/modules/Members_List/index.php
===================================================================
--- trunk/modules/Members_List/index.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/modules/Members_List/index.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -127,12 +127,12 @@
 			
 			if ($row['group_type'] == GROUP_HIDDEN &amp;&amp; !$_CLASS['auth']-&gt;acl_gets('a_group', 'a_groupadd', 'a_groupdel') &amp;&amp; $row['ug_user_id'] != $_CLASS['core_user']-&gt;data['user_id'])
 			{
-				$group_name = $_CLASS['core_user']-&gt;lang['UNDISCLOSED'];
+				$group_name = $_CLASS['core_user']-&gt;get_lang('UNDISCLOSED');
 				$u_group = '';
 			}
 			else
 			{
-				$group_name = ($row['group_type'] == GROUP_SPECIAL) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name'];
+				$group_name = isset($_CLASS['core_user']-&gt;lang['G_' . $row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name'];
 				$u_group = generate_link('Members_List&amp;mode=group&amp;g='.$row['group_id']);
 			}
 
@@ -319,7 +319,7 @@
 		
 		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
-			$group_options .= '&lt;option value=&quot;' . $row['group_id'] . '&quot;'.(($member['user_group'] == $row['group_id'])? ' selected=&quot;selected&quot;' : '').'&gt;' . (($row['group_type'] == GROUP_SPECIAL) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
+			$group_options .= '&lt;option value=&quot;' . $row['group_id'] . '&quot;'.(($member['user_group'] == $row['group_id'])? ' selected=&quot;selected&quot;' : '').'&gt;' . (isset($_CLASS['core_user']-&gt;lang['G_' . $row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
 		}
 		$_CLASS['core_db']-&gt;free_result($result);
 		
@@ -498,7 +498,6 @@
 
 			'S_PROFILE_ACTION'	=&gt; generate_link('Members_List&amp;mode=group'),
 			'S_GROUP_OPTIONS'	=&gt; $group_options,
-			'S_CUSTOM_FIELDS'	=&gt; (isset($profile_fields['row']) &amp;&amp; sizeof($profile_fields['row'])) ? true : false,
 			
 			'U_ADD_FRIEND'		=&gt; generate_link('Control_Panel&amp;i=zebra&amp;add=' . urlencode($member['username'])),
 			'U_ADD_FOE'			=&gt; generate_link('Control_Panel&amp;i=zebra&amp;mode=foes&amp;add=' . urlencode($member['username'])),
@@ -508,19 +507,7 @@
 			'L_VIEWING_PROFILE' 	=&gt; sprintf($_CLASS['core_user']-&gt;lang['VIEWING_PROFILE'], $member['username']),
 		));
 		
-		if (isset($profile_fields['row']) &amp;&amp; sizeof($profile_fields['row']))
-		{
-			$_CLASS['core_template']-&gt;assign($profile_fields['row']);
-		}
-		
-		if (isset($profile_fields['blockrow']) &amp;&amp; sizeof($profile_fields['blockrow']))
-		{
-			foreach ($profile_fields['blockrow'] as $field_data)
-			{
-				$_CLASS['core_template']-&gt;assign_vars_array('custom_fields', $field_data);
-			}
-		}
-		break;
+	break;
 
 	case 'email':
 		// Send an email
@@ -897,7 +884,7 @@
 
 				case GROUP_UNRESTRAINED:
 					$group_row['group_type'] = 'FREE';
-					break;
+				break;
 			}
 
 			$avatar_img = '';
@@ -927,7 +914,7 @@
 
 			$_CLASS['core_template']-&gt;assign_array(array(
 				'GROUP_DESC'    =&gt; $group_row['group_description'],
-				'GROUP_NAME'    =&gt; $group_row['group_name'],
+				'GROUP_NAME'    =&gt; isset($_CLASS['core_user']-&gt;lang['G_' . $group_row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $group_row['group_name']] : $group_row['group_name'],
 				'GROUP_COLOR'   =&gt; $group_row['group_colour'],
 				'GROUP_TYPE'	=&gt; $_CLASS['core_user']-&gt;lang['GROUP_IS_'. $group_row['group_type']],
 				'GROUP_RANK'	=&gt; $rank_title,

Deleted: trunk/themes/login_body_full.css
===================================================================
--- trunk/themes/login_body_full.css	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/themes/login_body_full.css	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,42 +0,0 @@
-body {
-    font-family: Verdana, Helvetica, sans-serif;
-    font-size: 10px;
-    margin-top: 10%;
-    padding: 0px;
-    background-color: white;
-    background: url(/images/bg.gif);
-}
-
-.error { color: red; }
-
-/* 
-	TABLE
-*/
-th { height: 28px; color: #FFA34F; font-size: 110%; font-weight: bold; background-color: #006699; background-image: url('./images/cellpic3.gif'); white-space: nowrap; padding-left: 5px; padding-right: 5px; }
-.tablebg { background-color: #A9B8C2; }
-.catdiv { height: 28px; margin: 0px; padding: 0px; border: 0px; background-color: white; background-image: url('./images/cellpic2.jpg'); background-repeat: repeat-y; }
-.cat { height: 28px; margin: 0px; padding: 0px; border: 0px; background-color: #C7D0D7; background-image: url('../images/cellpic1.gif'); text-indent: 4px; }
-.row1 { background-color: #ECECEC; padding: 4px; }
-.row2 { background-color: #DCE1E5; padding: 4px; }
-.row3 { background-color: #C0C8D0; padding: 4px; }
-.rowgood { background-color: #C2D6CD; padding: 4px; }
-.rowneutral { background-color: #CAC1D7; padding: 4px; }
-.rowbad { background-color: #D7C1C3; padding: 4px; }
-.spacer { background-color: #D1D7DC; }
-hr { height: 1px; border-width: 0px; background-color: #D1D7DC; color: #D1D7DC }
-
-
-/* 
-	ANCHOR
-*/
-a:link { color: #005784; text-decoration: none; }
-a:active { color: #005784; text-decoration: none; }
-a:visited { color: #005784; text-decoration: none; }
-a:hover { color: #000000; text-decoration: none; }
-
-form { margin: 0px; padding: 0px; border: 0px; }
-input { font-weight: normal; background-color: #FAFAFA; border-style: solid; border-width: 1px; border-color: #ccc; color: black; font-family: Verdana, serif; font-size: 100%; }
-textarea { background-color: white; color: black; font-family: Verdana, serif; font-size: 110%; font-weight: normal; border-color: black; border-style: solid; border-width: 1px; }
-select { color: black; background-color: white; font-family: Verdana, serif; font-size: 100%; font-weight: normal; border-color: black; border-style: solid; border-width: 1px; }
-.post { background-color: white; border-style: solid; border-width: 1px; border-color: #ccc;}
-.btnmain { font-weight: bold; background-color: #FAFAFA; border-style: solid; border-width: 1px; }
\ No newline at end of file

Modified: trunk/themes/viperal/index.php
===================================================================
--- trunk/themes/viperal/index.php	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/themes/viperal/index.php	2005-09-03 01:42:07 UTC (rev 96)
@@ -1,17 +1,26 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright 2004 - 2005										//
-//  By Ryan Marshall ( Viperal&#169;	)								//
-//																//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
 if (!defined('VIPERAL'))
 {
     die;
@@ -51,7 +60,7 @@
 		}
 		else
 		{
-			$_CLASS['core_template']-&gt;assign('PAGE_TITLE', $_CLASS['core_user']-&gt;lang['HOME'].' &gt; '.(is_array($_CORE_MODULE['title']) ? implode(' &gt; ', $_CORE_MODULE['title']) : $_CORE_MODULE['title']));
+			$_CLASS['core_template']-&gt;assign('PAGE_TITLE', $_CLASS['core_user']-&gt;lang['HOME'].' &gt; '.(is_array($_CORE_MODULE['module_title']) ? implode(' &gt; ', $_CORE_MODULE['module_title']) : $_CORE_MODULE['module_title']));
 		}
 		
 		$_CLASS['core_blocks']-&gt;display(BLOCK_LEFT);

Added: trunk/themes_admin/viperal_admin/style/images/Thumbs.db
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/Thumbs.db
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/background.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/background.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/bg.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/bg.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/cellpic.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/cellpic.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/cellpic1.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/cellpic1.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/cellpic2.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/cellpic2.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/cellpic3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/cellpic3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/created_by.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/created_by.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/curve.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/curve.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_faq.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_faq.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_groups.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_groups.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_login.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_login.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_members.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_members.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_message.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_message.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_profile.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_profile.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_register.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_register.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/icon_mini_search.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/icon_mini_search.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/index.htm
===================================================================
--- trunk/themes_admin/viperal_admin/style/images/index.htm	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/themes_admin/viperal_admin/style/images/index.htm	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,16 @@
+&lt;html&gt;
+&lt;head&gt;
+&lt;title&gt;subSilver created by subBlue Design&lt;/title&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;
+&lt;/head&gt;
+
+&lt;body bgcolor=&quot;#FFFFFF&quot; text=&quot;#000000&quot;&gt;
+
+&lt;table width=&quot;100%&quot; height=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
+	&lt;tr&gt;
+		&lt;td align=&quot;center&quot; valign=&quot;middle&quot;&gt;&lt;a href=&quot;<A HREF="http://www.subblue.com/">http://www.subblue.com/</A>&quot; target=&quot;_new&quot;&gt;&lt;img src=&quot;created_by.jpg&quot; width=&quot;400&quot; height=&quot;300&quot; border=&quot;0&quot; alt=&quot;Created by subBlue Design&quot; /&gt;&lt;/a&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/themes_admin/viperal_admin/style/images/logo-christmas.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/logo-christmas.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/no_avatar.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/no_avatar.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/sitelogo.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/sitelogo.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/spacer.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/spacer.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/images/whosonline.gif
===================================================================
(Binary files differ)


Property changes on: trunk/themes_admin/viperal_admin/style/images/whosonline.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/themes_admin/viperal_admin/style/style.css
===================================================================
--- trunk/themes_admin/viperal_admin/style/style.css	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/themes_admin/viperal_admin/style/style.css	2005-09-03 01:42:07 UTC (rev 96)
@@ -0,0 +1,444 @@
+body
+{
+    font-family: Verdana, Helvetica, sans-serif;
+    font-size: 10px;
+
+    /* Needed for opera */
+    margin: 0px; 
+
+    padding: 0px;
+    background: url(/images/bg.gif);
+}
+
+.logo
+{
+	position:fixed;
+	top: -1px;
+	left: -1px;
+	z-index: 1;
+}
+
+#nav li a
+{
+	display: block;
+	padding: 5px 10px 5px 5px; 
+	border-bottom: 1px solid black;
+	color: black;
+}
+
+#nav li a:hover
+{
+	background-color: #FFFFFF;
+	color: black;
+	font-weight: bold; 
+	letter-spacing: .6px; 
+}
+
+/* 
+	LAYOUT CONTAINERS
+*/
+#page
+{
+	position: relative;
+	height: 15px;
+	background: url(images/curve.gif) top left no-repeat;
+	background-color: #eee;
+	color: #999;
+	padding: 2px;
+	padding-left: 20px;
+}
+
+#blocksleft
+{
+	position:absolute;
+	top: 20px;
+	left:0px;
+	width: 180px;
+	height:100%;
+	margin: 0px 0px 10px 0px;
+}
+	
+#blocksright
+{
+	position:absolute;
+	top: 0px;
+	right: 0px;
+	width: 180px;
+	margin: 0px 0px 10px 0px;
+}
+
+/* 
+	MAIN SECTION
+*/
+.mainbody
+{
+	position: relative;
+	height: 100%;
+	border-left:1px solid #ccc;
+	border-top:1px solid #ccc;
+	background-color:white;
+}
+	
+.bodymain
+{
+	position: relative;
+	border-top: 1px solid #ccc;
+	height: 100%;
+	min-height: 1500px;
+	border-right:1px dashed #ccc;
+}
+
+.main
+{
+    width: 100%;
+    background-color: #eee;
+}
+
+/* 
+	FOOTER
+*/	
+.footer
+{
+	position:relative;
+	border-top:1px dashed black;
+	padding:5px;
+	background-color:white;
+}
+
+/* 
+	SIDE BLOCKS
+*/
+.blocks
+{
+	position: relative;
+	margin: 0px 0px 10px 0px;
+	min-height: 12px;
+	padding: 5px;
+}
+
+.blocks .top
+{
+  position: relative;
+  border-bottom: 1px dashed;
+  padding: 2px;
+  background-color:#C7D0D7;
+}
+
+.blocks .content
+{
+	width : 100%;
+}
+
+/* 
+	GENERAL CONTANER
+*/
+.OpenTable
+{
+	padding: 5px;
+	position:relative;
+}
+
+.OpenTable .outer
+{
+	border-top: 1px solid #ccc;
+	border-bottom: 1px solid #ccc;
+	background: #C7D0D7;
+	padding:1px;
+}	
+
+.OpenTable .inner
+{
+	border: 1px dashed #ccc;
+	background: #F2F1ED;
+	padding:5px;
+}
+
+img
+{
+	border: 0px;
+}
+
+
+.forumrules
+{
+	border: 1px solid #A9B8C2;
+	background-color: #ECECEC; padding: 4px;
+}
+
+.page_link_normal
+{
+	background: #F2F1ED;
+	border: 1px solid #A9B8C2;
+	padding: 1px 3px 1px 3px;
+	margin: 2px
+}
+
+.page_link_current
+{
+	background: #F2F1ED;
+	border: 1px solid #A9B8C2;
+	padding: 1px 3px 1px 3px;
+	margin: 2px
+}
+
+/* 
+	TEXT
+*/
+
+h1 { margin: 0px; color: black; font-family: 'Trebuchet MS', Verdana, sans-serif; font-weight: bold; font-size: 140%; text-decoration: none; }
+h2 { margin: 0px; font-family: Arial, Helvetica, sans-serif; font-weight: bold; font-size: 130%; text-decoration: none; line-height: 120%; }
+h3 { margin: 0px; font-size: 120%; font-weight: bold; font-family: Verdana, serif; line-height: 120%; }
+h4 { margin: 0px; font-size: 130%; font-weight: bold; }
+
+p.moderators { margin: 0px; float: left; color: black; font-size: 100%; font-weight: bold; }
+p.linkmcp { margin: 0px; float: right; font-size: 100%; white-space: nowrap; }
+p.breadcrumbs { margin: 0px; float: left; color: black; font-size: 100%; font-weight: bold; white-space: normal; }
+p.datetime { margin: 0px; float: right; font-size: 100%; white-space: nowrap; }
+p.searchbar { margin: 0px; font-size: 100%; white-space: nowrap; } 
+p.searchbarreg { margin: 0px; float: right; font-size: 100%; white-space: nowrap; }
+
+p.forumdesc { margin: 0px 4px 0px 0px; padding: 4px; font-size: 100%; }
+a.forumlink { color: #069; font-size: 120%; font-weight: bold; }
+
+p.topictitle { margin: 1px 0px; display: inline; font-size: 100%; font-weight: bold; }
+p.topicauthor { margin: 1px 0px; font-size: 100%; }
+p.topicdetails { margin: 1px 0px; font-size: 95%; }
+
+p.postreported { margin: 1px 0px; color: red; }
+p.postapprove { margin: 1px 0px; color: green; }
+
+.postauthor { color: #000000; font-size: 100%; }
+.postdetails { color: #000000; font-size: 100%; }
+.postbody { font-size: 110%; line-height: 140%; }
+.posthilit { background-color: yellow; }
+
+
+.nav { margin: 0px; color: black; font-size: 100%; font-weight: bold; }
+.pagination { padding: 4px; color: black; font-size: 100%; font-weight: bold; }
+
+
+.cattitle {  }
+
+.gen { margin: 1px 1px; font-size: 120%; }
+.genmed { margin: 1px 1px; font-size: 110%; }
+.gensmall { margin: 1px 1px; font-size: 100%; }
+
+.copyright { color: #444; font-weight: normal; font-size: 100%; font-family: Verdana, Arial, Helvetica, sans-serif;}
+.titles { color: black; font-family: Arial, Helvetica, sans-serif; font-weight: bold; font-size: 130%; text-decoration: none;  }
+.error { color: red; }
+
+/* 
+	TABLE
+*/
+th
+{
+	height: 28px;
+	color: #FFA34F;
+	font-size: 110%;
+	font-weight: bold;
+	background-color: #006699;
+	background-image: url('./images/cellpic3.gif');
+	white-space: nowrap;
+	padding-left: 5px;
+	padding-right: 5px;
+}
+
+.tablebg
+{
+	background-color: #A9B8C2;
+}
+
+.catdiv
+{
+	height: 28px;
+	margin: 0px;
+	padding: 0px;
+	border: 0px;
+	background-color:white;
+	background-image: url('./images/cellpic2.jpg');
+	background-repeat: repeat-y;
+}
+
+.cat
+{
+	height: 28px;
+	margin: 0px;
+	padding: 0px;
+	border: 0px;
+	background-color: #C7D0D7;
+	background-image: url('../images/cellpic1.gif');
+	text-indent: 4px;
+}
+
+.row1
+{
+	background-color: #ECECEC;
+	padding: 4px;
+}
+.row2
+{
+	background-color: #DCE1E5;
+	padding: 4px;
+}
+
+.row3
+{
+	background-color: #C0C8D0;
+	padding: 4px;
+}
+
+.spacer
+{
+	background-color: #ECECEC;
+}
+
+hr
+{
+	height: 1px; border-width: 0px; background-color: #D1D7DC; color: #D1D7DC
+}
+
+
+/* 
+	ANCHOR
+*/
+a:link
+{
+	color: #005784; text-decoration: none;
+}
+
+a:active, a:visited
+{
+	color: #005784; text-decoration: none;
+}
+
+a:hover
+{
+	color: #000000; text-decoration: none;
+}
+
+a.topictitle:visited
+{
+	color: #5493B4; text-decoration: none;
+}
+
+a.th:link, a.th:active, a.th:visited
+{
+	color: #FFA34F; text-decoration: none;
+}
+
+a.th:hover
+{
+	color: #FFA34F; text-decoration: underline;
+}
+
+
+/*
+	FORM
+*/
+form
+{
+	margin: 0px; padding: 0px;
+}
+
+input
+{
+	font-size: 100%; color: black; font-family: Verdana, serif; font-weight: normal;
+}
+
+textarea
+{
+	background-color: white;
+	font-family: Verdana, serif;
+	font-size: 110%; font-weight: normal;
+	border:1px solid #999;
+	padding: 3px;
+}
+
+select
+{
+	background-color: white;
+	font-family: Verdana, serif;
+	font-size: 100%;
+	font-weight: normal;;
+}
+
+.button, .btnbbcode, .button_main
+{
+	background-color: #FAFAFA;
+	border: 1px solid #ccc;
+	color: black;
+}
+
+.button_main
+{
+	font-weight: bold;
+}
+
+/* Rename this */
+.post
+{
+	background-color: white; border-style: solid; border-width: 1px; border-color: #ccc;
+}
+
+.helpline
+{
+	background-color: #DEE3E7; border-style: none;
+}
+
+/* Rename this */
+
+
+/* 
+	BBCODE 
+*/
+.quotetitle { margin: 10px 5px 0px 5px; padding: 4px; border-width: 1px 1px 0px 1px; border-style: solid; border-color: #A9B8C2; color: black; background-color: #A9B8C2; font-size: 8pt; }
+.quotecontent { margin: 0px 5px 10px 5px; padding: 5px; border-color: #A9B8C2; border-width: 0px 1px 1px 1px; border-style: solid; color: black; font-weight: normal; font-size: 8pt; font-family: Verdana, sans-serif; background-color: #FAFAFA; }
+
+.codetitle { margin: 10px 5px 0px 5px; padding: 4px; border-width: 1px 1px 0px 1px; border-style: solid; border-color: #A9B8C2; color: black; background-color: #A9B8C2; font-size: 8pt; }
+.codecontent { margin: 0px 5px 10px 5px; padding: 5px; border-color: #A9B8C2; border-width: 0px 1px 1px 1px; border-style: solid; color: black; font-weight: normal; color: #006600; font-weight: normal; font-size: 8pt; font-family: 'Courier New', monospace; background-color: #FAFAFA; }
+
+.syntaxbg { color: #FFFFFF; }
+.syntaxcomment { color: #FF8000; }
+.syntaxdefault { color: #0000BB; }
+.syntaxhtml { color: #000000; }
+.syntaxkeyword { color: #007700; }
+.syntaxstring { color: #DD0000; }
+
+.poster_details
+{
+	padding: 3px;
+	width: 85%;
+	border: 1px solid #C7D0D7;
+	border-right: 2px solid #C7D0D7;
+	border-left: 1px solid #C7D0D7;
+	border-bottom: 2px solid #C7D0D7;
+	margin-bottom: 3px;
+}
+
+/*
+	PM
+*/
+
+.pm_message_reported_colour
+{
+	background-color: #FFFFFF;
+}
+
+.pm_marked_colour
+{
+	background-color: #000000;
+}
+.pm_replied_colour
+{
+	background-color: #A9B8C2;
+}
+
+.pm_friend_colour
+{
+	background-color: #007700;
+}
+
+.pm_foe_colour
+{
+	background-color: #DD0000;
+}
\ No newline at end of file

Modified: trunk/themes_admin/viperal_admin/template/header.html
===================================================================
--- trunk/themes_admin/viperal_admin/template/header.html	2005-08-31 14:26:25 UTC (rev 95)
+++ trunk/themes_admin/viperal_admin/template/header.html	2005-09-03 01:42:07 UTC (rev 96)
@@ -31,7 +31,7 @@
 { $HEADER_BODY }
 
 &lt;a name=&quot;Top&quot;&gt;&lt;/a&gt;
-
+&lt;div style=&quot;position:fixed;top: -1px;left: -1px;z-index: 1;&quot;&gt;
 &lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 	&lt;tr&gt;
 		&lt;td nowrap=&quot;nowrap&quot; class=&quot;row2&quot;&gt;&lt;a href=&quot;{ $LINK_HOME }&quot;&gt;{ $L_SITE_INDEX }&lt;/a&gt;&lt;/td&gt;
@@ -40,7 +40,13 @@
 		&lt;td width=&quot;100%&quot; class=&quot;row2&quot;&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 &lt;/table&gt;
+&lt;/div&gt;
 
+&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+	&lt;tr&gt;
+		&lt;td height=&quot;20&quot; class=&quot;row2&quot;&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;
 { $MENU_MAIN }
 
 &lt;!-- include blockleft.html --&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000020.html">[Viperals-svncheckins] r97 - in trunk: admin admin/functions includes includes/templates/admin/modules modules/Quick_Message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19">[ date ]</a>
              <a href="thread.html#19">[ thread ]</a>
              <a href="subject.html#19">[ subject ]</a>
              <a href="author.html#19">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">More information about the Viperals-svncheckins
mailing list</a><br>
</body></html>
