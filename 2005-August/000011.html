<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Viperals-svncheckins] r87 - in trunk: admin admin/functions blocks includes includes/db includes/display install javascript modules modules/Control_Panel/ucp modules/Forums modules/Members_List
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/viperals-svncheckins/2005-August/index.html" >
   <LINK REL="made" HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r87%20-%20in%20trunk%3A%20admin%20admin/functions%20blocks%20includes%20includes/db%20includes/display%20install%20javascript%20modules%20modules/Control_Panel/ucp%20modules/Forums%20modules/Members_List&In-Reply-To=%3C200508190149.j7J1nflN026661%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000010.html">
   <LINK REL="Next"  HREF="000012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Viperals-svncheckins] r87 - in trunk: admin admin/functions blocks includes includes/db includes/display install javascript modules modules/Control_Panel/ucp modules/Forums modules/Members_List</H1>
    <B>Ryan Marshall at BerliOS</B> 
    <A HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r87%20-%20in%20trunk%3A%20admin%20admin/functions%20blocks%20includes%20includes/db%20includes/display%20install%20javascript%20modules%20modules/Control_Panel/ucp%20modules/Forums%20modules/Members_List&In-Reply-To=%3C200508190149.j7J1nflN026661%40sheep.berlios.de%3E"
       TITLE="[Viperals-svncheckins] r87 - in trunk: admin admin/functions blocks includes includes/db includes/display install javascript modules modules/Control_Panel/ucp modules/Forums modules/Members_List">viperal at berlios.de
       </A><BR>
    <I>Fri Aug 19 03:49:41 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000010.html">[Viperals-svncheckins] r86 - trunk/includes
</A></li>
        <LI>Next message: <A HREF="000012.html">[Viperals-svncheckins] r88 - in trunk: admin images includes includes/auth includes/crons includes/forums includes/forums/admin includes/templates includes/templates/admin includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/modules includes/templates/admin/system includes/templates/admin/users includes/templates/modules includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Quick_Message install modules/Control_Panel modules/Control_Panel/ucp modules/Quick_Message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11">[ date ]</a>
              <a href="thread.html#11">[ thread ]</a>
              <a href="subject.html#11">[ subject ]</a>
              <a href="author.html#11">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: viperal
Date: 2005-08-19 03:49:31 +0200 (Fri, 19 Aug 2005)
New Revision: 87

Added:
   trunk/admin/users.php
   trunk/javascript/menu.js
Removed:
   trunk/admin/bots.php
   trunk/modules/Submit_News/
   trunk/modules/View_Online/
Modified:
   trunk/admin/blocks.php
   trunk/admin/functions/block_functions.php
   trunk/admin/index.php
   trunk/admin/messages.php
   trunk/blocks/block-theme_select.php
   trunk/includes/db/mysql.php
   trunk/includes/display/display.php
   trunk/includes/functions.php
   trunk/includes/functions_user.php
   trunk/includes/mailer.php
   trunk/includes/session.php
   trunk/includes/user.php
   trunk/install/build_data.php
   trunk/install/build_tables.php
   trunk/modules/Control_Panel/ucp/ucp_zebra.php
   trunk/modules/Forums/faq.php
   trunk/modules/Forums/posting.php
   trunk/modules/Forums/viewforum.php
   trunk/modules/Forums/viewtopic.php
   trunk/modules/Members_List/index.php
Log:


Modified: trunk/admin/blocks.php
===================================================================
--- trunk/admin/blocks.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/admin/blocks.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,18 +1,26 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright 2004 - 2005										//
-//  By Ryan Marshall ( Viperal )								//
-//																//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 if (VIPERAL !== 'Admin') 
 {
 	die;
@@ -63,18 +71,22 @@
 					blocks_change_position($position, $id);
 				}
 			break;
-	
+
+			case 'edit':
+				block_add($id);
+				script_close(false);
+			break;
+
 			case 'auth':
 				block_auth($id);
 			break;
 		}
 	}
-	
+
 	switch ($_REQUEST['mode'])
 	{
 		case 'add':
-		case 'edit':
-			block_add($id);
+			block_add(false);
 			script_close(false);
 		break;
 		   
@@ -88,7 +100,7 @@
 
 $result = $_CLASS['core_db']-&gt;query('SELECT block_id, block_title, block_type,  block_position, block_order, block_status, block_file, block_auth
 	FROM '.BLOCKS_TABLE.'
-	WHERE block_position IN ('.BLOCK_RIGHT.', '.BLOCK_TOP.', '.BLOCK_BOTTOM.', '.BLOCK_LEFT.')  ORDER BY block_position, block_order ASC');
+	WHERE block_position IN ('.BLOCK_RIGHT.', '.BLOCK_TOP.', '.BLOCK_BOTTOM.', '.BLOCK_LEFT.') ORDER BY block_position, block_order ASC');
 
 $block_position = array(BLOCK_RIGHT =&gt; 'right', BLOCK_TOP =&gt; 'centertop', BLOCK_BOTTOM =&gt; 'centerbottom', BLOCK_LEFT =&gt; 'left');
 $in_position = false;
@@ -329,9 +341,9 @@
 		$data['block_position'] = BLOCK_RIGHT;
 	}
 
-	$data['block_status'] = (int) get_variable('b_active', 'POST', 0);
-	$data['block_expires'] = get_variable('b_expires', 'POST', '');
-	$data['block_starts'] = get_variable('b_time', 'POST', '');
+	$data['block_status']	= get_variable('b_active', 'POST', 0, 'integer');
+	$data['block_expires']	= get_variable('b_expires', 'POST', '');
+	$data['block_starts']	= get_variable('b_time', 'POST', '');
 
 	$start = $expires = '';
 

Deleted: trunk/admin/bots.php
===================================================================
--- trunk/admin/bots.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/admin/bots.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,73 +0,0 @@
-&lt;?php
-
-if (VIPERAL !== 'Admin') 
-{
-	die;
-}
-
-$id = (int) get_variable('id', 'GET', false);
-
-if ($id &amp;&amp; isset($_REQUEST['option']))
-{
-	require_once($site_file_root.'includes/functions_user.php');
-
-	switch ($_REQUEST['option'])
-	{
-		case 'activate':
-			user_activate($id);
-		break;
-
-		case 'deactivate':
-			user_disable($id);
-		break;
-	
-		case 'delete':
-			if (display_confirmation())
-			{
-				$sql = 'SELECT user_id, user_type
-					FROM ' . USERS_TABLE . ' 
-					WHERE user_id = '.$id;
-	
-				$result = $_CLASS['core_db']-&gt;query($sql);
-				$row = $_CLASS['core_db']&gt;fetch_row_assoc($result);
-				$_CLASS['core_db']-&gt;free_result($result);
-	
-				if ($row['user_type'] != USER_BOT)
-				{
-					break;
-				}
-	
-				user_delete($id);
-	
-				trigger_error($_CLASS['core_user']-&gt;lang['BOT_DELETED']);
-			}
-		break;
-	}
-}
-
-$sql = 'SELECT user_id, username, user_status, user_last_visit 
-	FROM ' . USERS_TABLE . ' u
-	WHERE user_type = ' . USER_BOT . ' ORDER BY user_last_visit DESC';
-
-$result = $_CLASS['core_db']-&gt;query($sql);
-
-while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-{
-	$_CLASS['core_template']-&gt;assign_vars_array('admin_bots', array(
-		'ACTIVE'		=&gt; ($row['user_status'] == USER_ACTIVE),
-		'NAME'			=&gt; $row['username'],
-		'DELETE_LINK'	=&gt; generate_link('bots&amp;option=delete&amp;id='.$row['user_id'], array('admin' =&gt; true)),
-		'STATUS_LINK'	=&gt; generate_link('bots&amp;option='.(($row['user_status'] == USER_ACTIVE) ? 'deactivate' :  'activate').'&amp;id='.$row['user_id'], array('admin' =&gt; true)),
-		'EDIT_LINK'		=&gt; generate_link('bots&amp;options=edite&amp;id='.$row['user_id'], array('admin' =&gt; true)),
-		'LAST_VISIT'	=&gt; ($row['user_last_visit']) ?  $_CLASS['core_user']-&gt;format_date($row['user_last_visit']) : $_CLASS['core_user']-&gt;lang['BOT_NEVER'],
-		'L_STATUS'		=&gt; ($row['user_status'] == USER_ACTIVE) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
-	));
-}
-
-$_CLASS['core_db']-&gt;free_result($result);
-
-$_CLASS['core_template']-&gt;assign('ACTION', generate_link('system&amp;mode=bots', array('admin' =&gt; true))); 
-
-$_CLASS['core_display']-&gt;display(false, 'admin/bots.html');
-
-?&gt;
\ No newline at end of file

Modified: trunk/admin/functions/block_functions.php
===================================================================
--- trunk/admin/functions/block_functions.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/admin/functions/block_functions.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,23 +1,31 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright 2004 - 2005										//
-//  By Ryan Marshall ( Viperal )								//
-//																//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 function block_auth($id)
 {
 	global $_CLASS;
 
-	$result = $_CLASS['core_db']-&gt;query('SELECT position, auth FROM ' . BLOCKS_TABLE . ' WHERE id='.$id);
+	$result = $_CLASS['core_db']-&gt;query('SELECT block_position, block_auth FROM ' . BLOCKS_TABLE . ' WHERE block_id = '.$id);
 	$block = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 	$_CLASS['core_db']-&gt;free_result($result);
 	
@@ -26,27 +34,27 @@
 		trigger_error('BLOCK_NOT_FOUND');
 	}
 	
-	$block['auth'] = ($block['auth']) ? unserialize($block['auth']) : '';
+	$block['block_auth'] = ($block['block_auth']) ? unserialize($block['block_auth']) : '';
 	
-	check_position($block['position']);
+	check_position($block['block_position']);
 	
 	$_CLASS['core_display']-&gt;display_header();
 
-	$auth = $_CLASS['core_auth']-&gt;generate_auth_options($block['auth']);
+	$auth = $_CLASS['core_auth']-&gt;generate_auth_options($block['block_auth']);
 
 	if ($auth !== false)
 	{
 		if (is_null($auth))
 		{
-			$block['auth'] = $auth = '';
+			$block['block_auth'] = $auth = '';
 		}
 		else
 		{
-			$block['auth'] = $auth;
+			$block['block_auth'] = $auth;
 			$auth = $_CLASS['core_db']-&gt;escape(serialize($auth));
 		}
 
-		$_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . &quot; SET auth = '$auth' WHERE id = $id&quot;);
+		$_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . &quot; SET block_auth = '$auth' WHERE block_id = $id&quot;);
 		$_CLASS['core_cache']-&gt;destroy('blocks');
 	}
 	
@@ -107,35 +115,35 @@
 			{
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = block_order-1 WHERE block_position = '.$block['block_position'].' AND block_order='.($block['block_order'] + 1));
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = '.($block['block_order'] + 1).' WHERE block_id ='. $id);
+
+				$_CLASS['core_cache']-&gt;destroy('blocks');
 			}
-
-			$_CLASS['core_cache']-&gt;destroy('blocks');
 		break;
 
 		case 'bottom':
 
-			$result = $_CLASS['core_db']-&gt;query('SELECT MAX(weight) as block_order FROM ' . BLOCKS_TABLE . ' WHERE block_position='.$block['block_position']);
-			list($max_order) = $_CLASS['core_db']-&gt;fetch_row_($result);
+			$result = $_CLASS['core_db']-&gt;query('SELECT MAX(block_order) as block_order FROM ' . BLOCKS_TABLE . ' WHERE block_position='.$block['block_position']);
+			list($max_order) = $_CLASS['core_db']-&gt;fetch_row_num($result);
 			$_CLASS['core_db']-&gt;free_result($result);
 
 			if ($block['block_order'] &lt; $max_order)
 			{
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = block_order-1 WHERE block_position='.$block['block_position'].' AND block_order &gt; '.$block['block_order']);
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = '.$max_order.' WHERE block_id = '.$id);
+
+				$_CLASS['core_cache']-&gt;destroy('blocks');
 			}
-
-			$_CLASS['core_cache']-&gt;destroy('blocks');
 		break;
 
 		case 'up':
 
-			if ($block['block_order'] &amp;&amp; $block['weight'] != 1)
+			if ($block['block_order'] &amp;&amp; $block['block_order'] != 1)
 			{
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = block_order+1 WHERE block_position='.$block['block_position'].' AND block_order = '.($block['block_order'] - 1));
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order='.($block['block_order'] -1 ).' WHERE block_id ='. $id);
+
+				$_CLASS['core_cache']-&gt;destroy('blocks');
 			}
-
-			$_CLASS['core_cache']-&gt;destroy('blocks');
 		break;
 
 		case 'top':
@@ -144,9 +152,9 @@
 			{
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = block_order+1 WHERE block_position='.$block['block_position'].' AND block_order &lt; '.$block['block_order']);
 				$result = $_CLASS['core_db']-&gt;query('UPDATE ' . BLOCKS_TABLE . ' SET block_order = 1 WHERE block_id = '.$id);
+
+				$_CLASS['core_cache']-&gt;destroy('blocks');
 			}
-
-			$_CLASS['core_cache']-&gt;destroy('blocks');
 		break;
 	}
 }

Modified: trunk/admin/index.php
===================================================================
--- trunk/admin/index.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/admin/index.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -61,13 +61,13 @@
 	$sql = 'SELECT user_id, username, user_regdate
 		FROM ' . USERS_TABLE . '
 			WHERE user_type = '.USER_NORMAL.'
-			AND user_status IN (' . USER_DISABLE . ',  '.USER_UNACTIVATED.')';
+			AND user_status IN (' . STATUS_PENDING . ',  ' . STATUS_DISABLED . ')';
 		
 	$result = $_CLASS['core_db']-&gt;query_limit($sql, 20);
 	
 	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
-		$type = ($row['user_id'] == USER_DISABLE) ? 'users_disabled' : 'users_unactivated';
+		$type = ($row['user_id'] == STATUS_DISABLED) ? 'users_disabled' : 'users_unactivated';
 	
 		$_CLASS['core_template']-&gt;assign_vars_array($type, array(
 				'user_id'		=&gt; $row['user_id'],

Modified: trunk/admin/messages.php
===================================================================
--- trunk/admin/messages.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/admin/messages.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,18 +1,26 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright 2004 - 2005										//
-//  By Ryan Marshall ( Viperal )								//
-//																//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 if (VIPERAL !== 'Admin') 
 {
 	die;
@@ -30,8 +38,7 @@
 	{
 		if ($redirect)
 		{
-			url_redirect(generate_link('messages', array('admin' =&gt; true)));
-			die;
+			redirect(generate_link('messages', array('admin' =&gt; true, 'full' =&gt; true)));
 		}
 		return false;
 	}
@@ -39,160 +46,108 @@
 	return true;
 }
 
-function get_id($rediret = true)
-{
-	$id = get_variable('id', 'GET', false, 'integer');
-
-	if (!$id &amp;&amp; $rediret)
-	{
-		url_redirect(generate_link('messages', array('admin' =&gt; true)));
-		die;
-	}
-	
-	return $id;
-}
-
-switch (get_variable('mode', 'GET', false))
+if (isset($_REQUEST['mode']))
 {
-	case 'change':
-		block_change(get_id());
-		url_redirect(generate_link('messages', array('admin' =&gt; true)));
-    break;
-    
-    case 'weight':
-		block_weight(get_id(), get_variable('option', 'GET', false));
-		url_redirect(generate_link('messages', array('admin' =&gt; true)));
-    break;
+	if ($id = get_variable('id', 'GET', false, 'integer'))
+	{
+		switch ($_REQUEST['mode'])
+		{
+			case 'change':
+				block_change($id);
+			break;
+			
+			case 'order':
+				block_order($id, get_variable('option', 'GET', false));
+			break;
+		
+			case 'delete':
+				block_delete($id, generate_link('messages', array('admin' =&gt; true)));
+			break;
+		  
+			case 'auth':
+				block_auth($id);
+			break;
+		}
+	}
 
-    case 'delete':
-		block_delete(get_id());
-		url_redirect(generate_link('messages', array('admin' =&gt; true)));
-    break;
-  
-    case 'edit':
-		message_edit(get_id());
-    break;
-    
-    case 'add':
-		message_edit(false);
-    break;
-       
-    case 'save':
-		message_save();
-    break;
+	switch ($_REQUEST['mode'])
+	{
+		case 'add':
+		case 'edit':
+			message_edit($id);
+			script_close(false);
+		break;
 
-    case 'auth':
-		block_auth(get_id());
-    break;
-
-    default:
-		message_admin();
+		case 'save':
+			message_save($id);
+		break;
+	}
 }
 
-script_close(false);
+$result = $_CLASS['core_db']-&gt;query('SELECT block_id, block_position, block_title, block_starts, block_expires, block_order, block_status FROM ' . BLOCKS_TABLE . '
+				WHERE block_position IN ('.BLOCK_MESSAGE_TOP.', '.BLOCK_MESSAGE_BOTTOM.') 
+					 ORDER BY block_position, block_order ASC');
 
-function message_admin()
-{
-    global $prefix, $_CLASS;
+$block_position = array(BLOCK_MESSAGE_TOP =&gt; 'top', BLOCK_MESSAGE_BOTTOM =&gt; 'bottom');
+$in_position = false;
+$messages = array();
 
-    $result = $_CLASS['core_db']-&gt;query('SELECT id, position, title, start, weight, active, expires FROM '.BLOCKS_TABLE.'
-					WHERE position IN ('.BLOCK_MESSAGE_TOP.', '.BLOCK_MESSAGE_BOTTOM.') 
-						ORDER BY weight ASC');
-	$block_position = array(BLOCK_MESSAGE_TOP =&gt; 'top', BLOCK_MESSAGE_BOTTOM =&gt; 'bottom');
-	$in_position = false;
-	$messages = array();
-
-	while($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-    {
-		if ($in_position != $row['position'])
-		{
-			$weigth[$row['position']] = $row['weight'];
-			$in_position == $row['position'];
-		}
-		$messages[] = $row;
+while($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+{
+	if ($in_position != $row['block_position'])
+	{
+		$weigth[$row['block_position']] = $row['block_order'];
+		$in_position == $row['block_position'];
 	}
-	$_CLASS['core_db']-&gt;free_result($result);
+	$messages[] = $row;
+}
 
-	foreach ($messages as $row)
-	{
-		$_CLASS['core_template']-&gt;assign_vars_array($block_position[$row['position']].'_admin_messages', array(
-			'ACTIVE'		=&gt; ($row['active']) ? true : false,
-			'CHANGE'		=&gt; ($row['active']) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
+$_CLASS['core_db']-&gt;free_result($result);
 
-			'AUTH_LINK'		=&gt; generate_link('messages&amp;mode=auth&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'ACTIVE_LINK'	=&gt; generate_link('messages&amp;mode=change&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'VIEW_LINK' 	=&gt; generate_link('messages&amp;mode=show&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'EDIT_LINK'		=&gt; generate_link('messages&amp;mode=edit&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'DELETE_LINK' 	=&gt; generate_link('messages&amp;mode=delete&amp;id='.$row['id'], array('admin' =&gt; true)),
+foreach ($messages as $row)
+{
+	$_CLASS['core_template']-&gt;assign_vars_array($block_position[$row['block_position']].'_admin_messages', array(
+		'ACTIVE'		=&gt; ($row['block_status']) ? true : false,
+		'CHANGE'		=&gt; ($row['block_status']) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
 
-			'EXPIRES'		=&gt; ($row['expires'] &amp;&amp; ($row['expires'] &lt; $_CLASS['core_user']-&gt;time)) ? $_CLASS['core_user']-&gt;format_date($row['expires']) : false,
-			'STARTS'		=&gt; ($row['start'] &gt; $_CLASS['core_user']-&gt;time) ? $_CLASS['core_user']-&gt;format_date($row['start']) : false,
-			'TITLE'			=&gt; $row['title'],
+		'AUTH_LINK'		=&gt; generate_link('messages&amp;mode=auth&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'ACTIVE_LINK'	=&gt; generate_link('messages&amp;mode=change&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'VIEW_LINK' 	=&gt; generate_link('messages&amp;mode=show&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'EDIT_LINK'		=&gt; generate_link('messages&amp;mode=edit&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'DELETE_LINK' 	=&gt; generate_link('messages&amp;mode=delete&amp;id='.$row['block_id'], array('admin' =&gt; true)),
 
-			'WEIGHT_DOWN' 		=&gt; ($row['weight'] &lt; $weigth[$row['position']]),
-			'WEIGHT_UP'		=&gt; ($row['weight'] &gt; 1),
-
-			'WEIGHT_MOVE_UP' 	=&gt; generate_link('messages&amp;mode=weight&amp;option=up&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'WEIGHT_MOVE_TOP' 	=&gt; generate_link('messages&amp;mode=weight&amp;option=top&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'WEIGHT_MOVE_DOWN'	=&gt; generate_link('messages&amp;mode=weight&amp;option=down&amp;id='.$row['id'], array('admin' =&gt; true)),
-			'WEIGHT_MOVE_BOTTOM'=&gt; generate_link('messages&amp;mode=weight&amp;option=bottom&amp;id='.$row['id'], array('admin' =&gt; true)),
-		));
-    }
-    $_CLASS['core_db']-&gt;free_result($result);
+		'EXPIRES'		=&gt; ($row['block_expires'] &amp;&amp; $row['block_expires'] &lt; $_CLASS['core_user']-&gt;time) ? $_CLASS['core_user']-&gt;format_date($row['block_expires']) : false,
+		'STARTS'		=&gt; ($row['block_starts'] &gt; $_CLASS['core_user']-&gt;time) ? $_CLASS['core_user']-&gt;format_date($row['block_starts']) : false,
+		'TITLE'			=&gt; $row['block_title'],
 
-    $_CLASS['core_template']-&gt;assign(array(
-		'L_ADD_NEW'			=&gt; 'New Message',
-		'L_BLOCK_HTML'		=&gt; 'Add HTML block',
-		'L_BLOCK_RSS'		=&gt; 'Add RSS block',
-		'B_ACTION'			=&gt; generate_link('messages&amp;mode=add', array('admin' =&gt; true))
-	));
+		'ORDER_DOWN' 	=&gt; ($row['block_order'] &lt; $weigth[$row['block_position']]),
+		'ORDER_UP'		=&gt; ($row['block_order'] &gt; 1),
 
-	$_CLASS['core_template']-&gt;display('admin/messages/index.html');
+		'LINK_ORDER_UP' 	=&gt; generate_link('messages&amp;mode=order&amp;option=up&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'LINK_ORDER_TOP' 	=&gt; generate_link('messages&amp;mode=order&amp;option=top&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'LINK_ORDER_DOWN'	=&gt; generate_link('messages&amp;mode=order&amp;option=down&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+		'LINK_ORDER_BOTTOM'	=&gt; generate_link('messages&amp;mode=order&amp;option=bottom&amp;id='.$row['block_id'], array('admin' =&gt; true)),
+	));
 }
 
-function message_delete($id)
-{
-    global $_CLASS;
+$_CLASS['core_template']-&gt;assign_array(array(
+	'L_ADD_NEW'			=&gt; 'New Message',
+	'L_BLOCK_HTML'		=&gt; 'Add HTML block',
+	'L_BLOCK_RSS'		=&gt; 'Add RSS block',
+	'B_ACTION'			=&gt; generate_link('messages&amp;mode=add', array('admin' =&gt; true))
+));
 
-    if (get_variable('ok', 'GET', false))
-    {
-		$result = $_CLASS['core_db']-&gt;query('SELECT weight, position FROM '.BLOCKS_TABLE.' WHERE id='.$id);
-		$block = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-		$_CLASS['core_db']-&gt;free_result($result);
+$_CLASS['core_template']-&gt;display('admin/messages/index.html');
 
-		if (!$block)
-		{
-			url_redirect(generate_link('messages', array('admin' =&gt; true)));
-		}
-		
-		check_position($block['position']);
-				
-        $result = $_CLASS['core_db']-&gt;query('UPDATE '.BLOCKS_TABLE.' SET weight= weight - 1 WHERE position='.$block['position'].' AND weight &gt; '.$block['weight']);
-        $_CLASS['core_db']-&gt;query('DELETE from '.BLOCKS_TABLE.' where id='.$id);
+script_close();
 
-        $_CLASS['core_cache']-&gt;destroy('blocks');
-		url_redirect(generate_link('messages', array('admin' =&gt; true)));
-    }
-    else
-    {
-		$_CLASS['core_display']-&gt;display_head();
-		OpenTable();
-		echo '&lt;center&gt;Remove Message ?';
-		echo '&lt;br /&gt;&lt;br /&gt;[ &lt;a href=&quot;'.generate_link(&quot;messages&amp;mode=delete&amp;id=$id&amp;ok=1&quot;, array('admin' =&gt; true)).'&quot;&gt;Yes&lt;/a&gt; | &lt;a href=&quot;'.generate_link('messages', array('admin' =&gt; true)).'&quot;&gt;No&lt;/a&gt; ]&lt;/center&gt;';
-		CloseTable();
-        $_CLASS['core_display']-&gt;display_footer();
-    }
-}
-
-function message_edit($block = false, $error = false)
+function message_edit($id = false, $block = false, $error = false)
 {
     global $_CLASS;
-    
-    $id = false;
 
-	if (isset($_REQUEST['id']) &amp;&amp; $id = get_id())
+	if ($id)
 	{
-		$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.BLOCKS_TABLE.' WHERE id='.$id);
+		$result = $_CLASS['core_db']-&gt;query('SELECT * FROM '.BLOCKS_TABLE.' WHERE block_id = ' . $id);
 		$block = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 		
@@ -201,7 +156,7 @@
 			url_redirect(generate_link('messages', array('admin' =&gt; true)));
 		}
 		
-		check_position($block['position']);
+		check_position($block['block_position']);
 
 		if (isset($_POST['submit']))
 		{
@@ -213,20 +168,19 @@
 		unset($block_post);
 	}
 	
-	$_CLASS['core_template']-&gt;assign(array(
-		'B_TITLE'			=&gt; $block['title'],
-		'B_CONTENT'			=&gt; $block['content'],
-		'B_ACTIVE'			=&gt; $block['active'],
-		'B_EXPIRES'			=&gt; is_numeric($block['expires']) ? $_CLASS['core_user']-&gt;format_date($block['expires'], 'M d, Y h:i a') : $block['expires'],
+	$_CLASS['core_template']-&gt;assign_array(array(
+		'B_TITLE'			=&gt; $block['block_title'],
+		'B_CONTENT'			=&gt; $block['block_content'],
+		'B_ACTIVE'			=&gt; $block['block_status'],
+		'B_EXPIRES'			=&gt; is_numeric($block['block_expires']) ? $_CLASS['core_user']-&gt;format_date($block['block_expires'], 'M d, Y h:i a') : $block['block_expires'],
 		'B_ERROR'			=&gt; $error,
-		'B_STARTS'			=&gt; is_numeric($block['start']) ? $_CLASS['core_user']-&gt;format_date($block['start'], 'M d, Y h:i a') : $block['start'],
-		'B_CURRENT_TIME'	=&gt; $_CLASS['core_user']-&gt;format_date($_CLASS['core_user']-&gt;time),
-		'B_POSITION'		=&gt; message_position_select($block['position']),
-		'B_TYPE'			=&gt; message_type_select($block['type']),
+		'B_STARTS'			=&gt; is_numeric($block['block_starts']) ? $_CLASS['core_user']-&gt;format_date($block['block_starts'], 'M d, Y h:i a') : $block['block_starts'],
+		'B_POSITION'		=&gt; message_position_select($block['block_position']),
+		'B_TYPE'			=&gt; message_type_select($block['block_type']),
 		'B_DELETE_LINK'		=&gt; ($id) ? generate_link('messages&amp;mode=delete&amp;id='.$id, array('admin' =&gt; true)) : false,
-		'B_ACTION'			=&gt; generate_link('messages&amp;mode=save'.(($id) ? '&amp;id='.$id : ''), array('admin' =&gt; true))
-		)		
-	);
+		'B_ACTION'			=&gt; generate_link('messages&amp;mode=save'.(($id) ? '&amp;id='.$id : ''), array('admin' =&gt; true)),
+		'B_CURRENT_TIME'=&gt; $_CLASS['core_user']-&gt;format_date($_CLASS['core_user']-&gt;time)
+	));
 	
 	$_CLASS['core_template']-&gt;display('admin/messages/edit.html');
 }
@@ -243,40 +197,40 @@
 		return;
 	}
 
-	$data['title'] = get_variable('title', 'POST', '');
-	$data['content'] = trim(get_variable('content', 'POST', ''));
+	$data['block_title'] = get_variable('title', 'POST', '');
+	$data['block_content'] = trim(get_variable('content', 'POST', ''));
 	
 	foreach ($data as $field =&gt; $value)
 	{
 		if (!$value)
 		{
-			$error .= $_CLASS['core_user']-&gt;lang['ERROR_'.$field].'&lt;br /&gt;';
+			$error .= $_CLASS['core_user']-&gt;get_lang('ERROR_'.$field).'&lt;br /&gt;';
 		}
 	}
 	
-	$data['active']		= get_variable('active', 'POST', 0);
-	$data['expires']	= get_variable('expires', 'POST', 0);
-	$data['start']		= get_variable('time', 'POST', '');
-	$data['position']	= get_variable('b_position', 'POST', BLOCK_MESSAGE_TOP, 'integer');
-	$data['type'] 		= (int) get_variable('b_type', 'REQUEST', BLOCKTYPE_MESSAGE);
+	$data['block_status']	= get_variable('active', 'POST', 0);
+	$data['block_expires']	= get_variable('expires', 'POST', 0);
+	$data['block_starts']	= get_variable('time', 'POST', '');
+	$data['block_position']	= get_variable('b_position', 'POST', BLOCK_MESSAGE_TOP, 'integer');
+	$data['block_type'] 	= get_variable('b_type', 'REQUEST', BLOCKTYPE_MESSAGE, 'integer');
 
 	$appoved_types = array(BLOCKTYPE_MESSAGE, BLOCKTYPE_MESSAGE_GLOBAL);
 
-	if (!in_array($data['type'], $appoved_types, true))
+	if (!in_array($data['block_type'], $appoved_types, true))
 	{
-		$data['type'] = BLOCKTYPE_MESSAGE;
+		$data['block_type'] = BLOCKTYPE_MESSAGE;
 	}
 	
-	if (!$data['position'] || !check_position($data['position'], false))
+	if (!$data['block_position'] || !check_position($data['block_position'], false))
 	{
-		$data['position'] = BLOCK_MESSAGE_TOP;
+		$data['block_position'] = BLOCK_MESSAGE_TOP;
 	}
 	
 	$start = $expires = '';
 
-	if ($data['start'])
+	if ($data['block_starts'])
 	{
-		$start = strtotime($data['start']);
+		$start = strtotime($data['block_start']);
 
 		if (!$start || $start == -1)
 		{
@@ -284,9 +238,9 @@
 		}
 	}
 
-	if ($data['expires'])
+	if ($data['block_expires'])
 	{
-		$expires = strtotime($data['expires']);
+		$expires = strtotime($data['block_expires']);
 
 		if (!$expires || $expires == -1)
 		{
@@ -296,36 +250,36 @@
 	
 	if (!$error)
 	{
-		$data['start'] = ($start) ? $_CLASS['core_user']-&gt;time_convert($start, 'gmt') : 0;
-		$data['expires'] = ($expires) ? $_CLASS['core_user']-&gt;time_convert($expires, 'gmt') : 0;
+		$data['block_starts'] = ($start) ? $_CLASS['core_user']-&gt;time_convert($start, 'gmt') : 0;
+		$data['block_expires'] = ($expires) ? $_CLASS['core_user']-&gt;time_convert($expires, 'gmt') : 0;
 	}
 }
 
-function message_save()
+function message_save($id = false)
 {
     global $_CLASS;
     
-	if (isset($_REQUEST['id']) &amp;&amp; $id = get_id())
+	if ($id)
 	{
-		$result = $_CLASS['core_db']-&gt;query('SELECT position FROM '.BLOCKS_TABLE.' WHERE id='.$id);
+		$result = $_CLASS['core_db']-&gt;query('SELECT block_position FROM ' . BLOCKS_TABLE . ' WHERE block_id = '. $id);
 		$block = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
-		
+
 		if (!$block)
 		{
 			url_redirect(generate_link('messages', array('admin' =&gt; true)));
 		}
-		
-		check_position($block['position']);
+
+		check_position($block['block_position']);
 		// need to validate data with the db type
 		messages_get_data($data, $error);
 		
 		if ($error)
 		{
-			return message_edit($data, $error);
+			return message_edit($id, $data, $error);
 		}
 	
-		$sql = 'UPDATE '.BLOCKS_TABLE.' SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $data) .'  WHERE id='.$id;
+		$sql = 'UPDATE ' . BLOCKS_TABLE . ' SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $data) .'  WHERE block_id = '.$id;
 
 		$_CLASS['core_db']-&gt;query($sql);
 	}
@@ -335,18 +289,16 @@
 
 		if ($error)
 		{
-			return message_edit($data, $error);
+			return message_edit(false, $data, $error);
 		}
 
-		$result = $_CLASS['core_db']-&gt;query('SELECT MAX(weight) as weight FROM '.BLOCKS_TABLE.' WHERE position = '.$data['position']);
-		$maxweight = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+		$result = $_CLASS['core_db']-&gt;query('SELECT MAX(block_order) as block_order FROM ' . BLOCKS_TABLE . ' WHERE block_position = '.$data['block_position']);
+		list($max_order) = $_CLASS['core_db']-&gt;fetch_row_num($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 
-		$data['weight'] = (int) $maxweight['weight'] + 1;
+		$data['block_order'] = (int) $max_order + 1;
 
-		$sql = 'INSERT INTO '.BLOCKS_TABLE.' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $data);
-
-		$_CLASS['core_db']-&gt;query($sql);
+		$_CLASS['core_db']-&gt;query('INSERT INTO ' . BLOCKS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $data));
 	}
 
 	$_CLASS['core_cache']-&gt;destroy('blocks');

Added: trunk/admin/users.php
===================================================================
--- trunk/admin/users.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/admin/users.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -0,0 +1,116 @@
+&lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
+if (VIPERAL !== 'Admin') 
+{
+	die;
+}
+
+if (isset($_REQUEST['mode']) &amp;&amp; $_REQUEST['mode'] == 'bots')
+{
+	$id = (int) get_variable('id', 'GET', false);
+	
+	if ($id &amp;&amp; isset($_REQUEST['option']))
+	{
+		require_once($site_file_root.'includes/functions_user.php');
+	
+		switch ($_REQUEST['option'])
+		{
+			case 'activate':
+				user_activate($id);
+			break;
+	
+			case 'deactivate':
+				user_disable($id);
+			break;
+		
+			case 'delete':
+				if (display_confirmation())
+				{
+					$sql = 'SELECT user_id, user_type
+						FROM ' . USERS_TABLE . ' 
+						WHERE user_id = '.$id;
+		
+					$result = $_CLASS['core_db']-&gt;query($sql);
+					$row = $_CLASS['core_db']&gt;fetch_row_assoc($result);
+					$_CLASS['core_db']-&gt;free_result($result);
+		
+					if ($row['user_type'] != USER_BOT)
+					{
+						break;
+					}
+		
+					user_delete($id);
+		
+					trigger_error($_CLASS['core_user']-&gt;lang['BOT_DELETED']);
+				}
+			break;
+		}
+	}
+	
+	$sql = 'SELECT user_id, username, user_status, user_last_visit 
+		FROM ' . USERS_TABLE . '
+		WHERE user_type = ' . USER_BOT . ' ORDER BY user_last_visit DESC';
+	
+	$result = $_CLASS['core_db']-&gt;query($sql);
+	
+	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	{
+		$_CLASS['core_template']-&gt;assign_vars_array('admin_bots', array(
+			'ACTIVE'		=&gt; ($row['user_status'] == STATUS_ACTIVE),
+			'NAME'			=&gt; $row['username'],
+			'LINK_DELETE'	=&gt; generate_link('users&amp;mode=bots&amp;option=delete&amp;id='.$row['user_id'], array('admin' =&gt; true)),
+			'LINK_STATUS'	=&gt; generate_link('users&amp;mode=bots&amp;option='.(($row['user_status'] == STATUS_ACTIVE) ? 'deactivate' :  'activate').'&amp;id='.$row['user_id'], array('admin' =&gt; true)),
+			'LINK_EDIT'		=&gt; generate_link('users&amp;mode=bots&amp;options=edit&amp;id='.$row['user_id'], array('admin' =&gt; true)),
+			'LAST_VISIT'	=&gt; ($row['user_last_visit']) ?  $_CLASS['core_user']-&gt;format_date($row['user_last_visit']) : $_CLASS['core_user']-&gt;lang['BOT_NEVER'],
+			'L_STATUS'		=&gt; ($row['user_status'] == STATUS_ACTIVE) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
+		));
+	}
+	
+	$_CLASS['core_db']-&gt;free_result($result);
+	
+	$_CLASS['core_display']-&gt;display(false, 'admin/users/bots.html');
+}
+
+$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM ' . USERS_TABLE . ' WHERE user_type = ' . USER_BOT);
+list($count_bots) = $_CLASS['core_db']-&gt;fetch_row_num($result);
+$_CLASS['core_db']-&gt;free_result($result);
+
+$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM ' . USERS_TABLE . ' WHERE user_type = ' . USER_NORMAL);
+list($count_users) = $_CLASS['core_db']-&gt;fetch_row_num($result);
+$_CLASS['core_db']-&gt;free_result($result);
+
+
+$_CLASS['core_template']-&gt;assign_array(array(
+	'COUNT_BOTS'	=&gt; $count_bots,
+	'COUNT_USERS'	=&gt; $count_users,
+	'LINK_BOTS'		=&gt; generate_link('users&amp;mode=bots', array('admin' =&gt; true)),
+	'LINK_ADD_USER'	=&gt; generate_link('users&amp;mode=add_user', array('admin' =&gt; true)),
+	'LINK_EDIT_USER'=&gt; generate_link('users&amp;mode=edit_user', array('admin' =&gt; true)),
+	//'LAST_VISIT'	=&gt; ($row['user_last_visit']) ?  $_CLASS['core_user']-&gt;format_date($row['user_last_visit']) : $_CLASS['core_user']-&gt;lang['BOT_NEVER'],
+	//'L_STATUS'		=&gt; ($row['user_status'] == STATUS_ACTIVE) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
+));
+
+$_CLASS['core_display']-&gt;display(false, 'admin/users/index.html');
+
+?&gt;
\ No newline at end of file

Modified: trunk/blocks/block-theme_select.php
===================================================================
--- trunk/blocks/block-theme_select.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/blocks/block-theme_select.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -17,7 +17,7 @@
 }
 
 $this-&gt;content = '
-&lt;form action=&quot;'.generate_link($_CLASS['core_user']-&gt;url).'&quot; method=&quot;post&quot;&gt;
+&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
 	&lt;p style=&quot;text-align: center;&quot;&gt;
 		&lt;select name=&quot;prevtheme&quot; onchange=&quot;this.form.submit();&quot;&gt;'.theme_select().'&lt;/select&gt;
 		&lt;br /&gt;&lt;br /&gt;&lt;input class=&quot;button&quot; value=&quot;Select&quot; type=&quot;submit&quot; /&gt;

Modified: trunk/includes/db/mysql.php
===================================================================
--- trunk/includes/db/mysql.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/db/mysql.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -17,6 +17,8 @@
 ||  of the GNU General Public License version 2					||
 ||																||
 ||**************************************************************||
+
+$Id$
 */
 
 class db_mysql
@@ -424,7 +426,7 @@
 			return;
 		}
 
-		$message = '&lt;u&gt;SQL ERROR&lt;/u&gt;&lt;br /&gt;&lt;br /&gt;' . @mysql_error() . '&lt;br /&gt;&lt;br /&gt;File:&lt;br/&gt;&lt;br/&gt;'.$backtrace['file'].'&lt;br /&gt;&lt;br /&gt;Line:&lt;br /&gt;&lt;br /&gt;'.$backtrace['line'].'&lt;br /&gt;&lt;br /&gt;&lt;u&gt;CALLING PAGE&lt;/u&gt;&lt;br /&gt;&lt;br /&gt;'.(($sql) ? '&lt;br /&gt;&lt;br /&gt;&lt;u&gt;SQL&lt;/u&gt;&lt;br /&gt;&lt;br /&gt;' . $sql : '') . '&lt;br /&gt;';
+		$message = '&lt;br clear=&quot;all&quot;/&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;u&gt;SQL ERROR&lt;/u&gt;&lt;br /&gt;&lt;br /&gt;' . @mysql_error() . '&lt;br /&gt;&lt;br /&gt;File:&lt;br/&gt;&lt;br/&gt;'.$backtrace['file'].'&lt;br /&gt;&lt;br /&gt;Line:&lt;br /&gt;&lt;br /&gt;'.$backtrace['line'].'&lt;br /&gt;&lt;br /&gt;&lt;u&gt;CALLING PAGE&lt;/u&gt;&lt;br /&gt;&lt;br /&gt;'.(($sql) ? '&lt;br /&gt;&lt;br /&gt;&lt;u&gt;SQL&lt;/u&gt;&lt;br /&gt;&lt;br /&gt;' . $sql : '') . '&lt;br /&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';
 
 		if ($this-&gt;in_transaction)
 		{


Property changes on: trunk/includes/db/mysql.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: trunk/includes/display/display.php
===================================================================
--- trunk/includes/display/display.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/display/display.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -111,8 +111,11 @@
 	{
 		global $_CLASS, $_CORE_MODULE;
 
-		$_CORE_MODULE['title'] = $title;
-		
+		if ($title)
+		{
+			$_CORE_MODULE['title'] = $title;
+		}
+
 		if ($template)
 		{
 			$_CLASS['core_template']-&gt;display($template);
@@ -166,7 +169,7 @@
 
 		$_CLASS['core_template']-&gt;assign_array(array(
 			'SITE_LANG'			=&gt;	$_CLASS['core_user']-&gt;lang['LANG'],
-			'SITE_TITLE'		=&gt;	$_CORE_CONFIG['global']['site_name'].': '.$_CORE_MODULE['title'],
+			'SITE_TITLE'		=&gt;	$_CORE_CONFIG['global']['site_name'].': '.(is_array($_CORE_MODULE['title']) ? implode(' &gt; ', $_CORE_MODULE['title']) : $_CORE_MODULE['title']),
 			'SITE_BASE'			=&gt;	generate_base_url(),
 			'SITE_CHARSET'		=&gt;	'UTF-8',
 			'SITE_NAME'			=&gt;	$_CORE_CONFIG['global']['site_name'],

Modified: trunk/includes/functions.php
===================================================================
--- trunk/includes/functions.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/functions.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -17,6 +17,8 @@
 ||  of the GNU General Public License version 2					||
 ||																||
 ||**************************************************************||
+
+$Id$
 */
 
 // Redo
@@ -371,7 +373,7 @@
 	{
 		$link = $file;
 
-		if ($options['force_sid'] || ($_CLASS['core_user']-&gt;sid_link &amp;&amp; $options['sid']))
+		if ($options['force_sid'] || ($options['sid'] &amp;&amp; $_CLASS['core_user']-&gt;sid_link))
 		{
 			$link .= '?'.$_CLASS['core_user']-&gt;sid_link;
 		}
@@ -385,7 +387,7 @@
 
 		$link = $file.'?mod='.$link;
 
-		if ($options['force_sid'] || ($_CLASS['core_user']-&gt;sid_link &amp;&amp; $options['sid']))
+		if ($options['force_sid'] || ($options['sid'] &amp;&amp; $_CLASS['core_user']-&gt;sid_link))
 		{
 			$link .= '&amp;'.$_CLASS['core_user']-&gt;sid_link;
 		}
@@ -509,17 +511,17 @@
 {
 	global $_CLASS, $_CORE_CONFIG;
 	
-	$sql = 'UPDATE ' . CORE_CONFIG_TABLE . &quot; SET config_value ='&quot;.$_CLASS['core_db']-&gt;escape($value) . &quot;'
+	$sql = 'UPDATE ' . CORE_CONFIG_TABLE . &quot; SET config_value = '&quot;.$_CLASS['core_db']-&gt;escape($value) . &quot;'
 		WHERE config_section = '&quot; . $_CLASS['core_db']-&gt;escape($section) . &quot;'
 			AND config_name = '&quot;. $_CLASS['core_db']-&gt;escape($name) .&quot;'&quot;;
 
 	if ($auto_add &amp;&amp; (!$_CLASS['core_db']-&gt;query($sql) || !$_CLASS['core_db']-&gt;affected_rows()))
 	{
 		$sql_array = array(
-			'config_section'	=&gt; (string) $section,
-			'config_name'		=&gt; (string) $name,
-			'config_value'		=&gt; (string) $value,
-			'config_cache'		=&gt; (int) $cache,
+			'config_section'=&gt; (string) $section,
+			'config_name'	=&gt; (string) $name,
+			'config_value'	=&gt; (string) $value,
+			'config_cache'	=&gt; (int) $cache,
 		);
 
 		$_CLASS['core_db']-&gt;return_on_error(true);
@@ -690,8 +692,7 @@
 
 function redirect($url = false, $save = false)
 {
-	$url = ($url) ? $url : generate_link(false, array('full' =&gt; true));
-	$url = trim(str_replace('&amp;', '&amp;', $url));
+	$url = ($url) ? str_replace('&amp;', '&amp;', $url) : generate_link();
 
 	header('Location: ' . $url);
 


Property changes on: trunk/includes/functions.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: trunk/includes/functions_user.php
===================================================================
--- trunk/includes/functions_user.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/functions_user.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -17,6 +17,8 @@
 ||  of the GNU General Public License version 2					||
 ||																||
 ||**************************************************************||
+
+$Id$
 */
 
 function user_get_id($username, &amp;$difference)
@@ -90,7 +92,7 @@
 	}
 // hook here -- maybe ?
 	$sql = 'UPDATE ' . USERS_TABLE . '
-		SET user_status = ' . USER_ACTIVE . '
+		SET user_status = ' . STATUS_ACTIVE . '
 			WHERE user_id  IN (' . implode(', ', $user_id) . ')
 			AND user_type &lt;&gt;' . USER_GUEST;
 
@@ -111,7 +113,7 @@
 	}
 // hook here -- maybe ?
 	$sql = 'UPDATE ' . USERS_TABLE . '
-		SET user_status = ' . USER_DISABLE . '
+		SET user_status = ' . STATUS_DISABLED . '
 			WHERE user_id  IN (' . implode(', ', $user_id) . ')
 			AND user_type &lt;&gt;' . USER_GUEST;
 	$_CLASS['core_db']-&gt;query($sql);
@@ -119,10 +121,10 @@
 	if (in_array($_CORE_CONFIG['user']['newest_user_id'], $user_id))
 	{
 		$sql = 'SELECT user_id, username FROM ' . USERS_TABLE . '
-			WHERE user_type = '.USER_NORMAL.' AND user_status = '.USER_ACTIVE.'
+			WHERE user_type = '.USER_NORMAL.' AND user_status = '.STATUS_ACTIVE.'
 			ORDER BY user_regdate';
 
-		$result = $_CLASS['core_db']-&gt;query($sql);
+		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
 		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 
@@ -147,7 +149,7 @@
 	}
 // hook here -- maybe ?
 	$sql = 'UPDATE ' . USERS_TABLE . '
-		SET user_status = ' . USER_ACTIVE . '
+		SET user_status = ' . STATUS_ACTIVE . '
 			WHERE user_id  IN (' . implode(', ', $user_id) . ')
 			AND user_type =' . USER_NORMAL;
 


Property changes on: trunk/includes/functions_user.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: trunk/includes/mailer.php
===================================================================
--- trunk/includes/mailer.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/mailer.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,18 +1,26 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright 2004 - 2005										//
-//  By Ryan Marshall ( Viperal&#169;	)								//
-//																//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 class core_mailer
 {
 	var $message;
@@ -24,7 +32,7 @@
 	
 	// Needed for some windows sendmail emulator/ SMTP
 	// Set to false is you have problems sending
-	var $named_addresses = true;
+	var $named_addresses = false;
 	var $error = '';
 
 	function core_mailer($html = false)
@@ -174,7 +182,7 @@
 			$message = &quot;\n&quot;.strip_tags(preg_replace('#&lt;br */?&gt;#i', &quot;\n&quot;, modify_lines($this-&gt;message))).&quot;\n&quot;;
 		}
 
-		if ($_CORE_CONFIG['email']['smtp'])
+		if (!$_CORE_CONFIG['email']['smtp'])
 		{
 			$smtp = new smtp_mailer;
 			if ($connect = $smtp-&gt;connect($_CORE_CONFIG['email']['smtp_host'], $_CORE_CONFIG['email']['smtp_port']))


Property changes on: trunk/includes/mailer.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: trunk/includes/session.php
===================================================================
--- trunk/includes/session.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/session.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -19,10 +19,6 @@
 ||**************************************************************||
 
 $Id$
-$Id$
-$Date$
-$Rev$
-$Author$
 */
 
 class sessions
@@ -69,11 +65,11 @@
 			$this-&gt;data = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 			$_CLASS['core_db']-&gt;free_result($result);
 
-			if (isset($this-&gt;data['user_id']) &amp;&amp; ($this-&gt;data['user_id'] == ANONYMOUS || $this-&gt;data['user_status'] == USER_ACTIVE))
+			if (isset($this-&gt;data['user_id']) &amp;&amp; ($this-&gt;data['user_id'] == ANONYMOUS || $this-&gt;data['user_status'] == STATUS_ACTIVE))
 			{
 				$valid  = true;
 
-				if ($_CORE_CONFIG['server']['browser_check'] &amp;&amp; ($this-&gt;data['session_browser'] != $this-&gt;browser))
+				if ($this-&gt;data['session_browser'] != $this-&gt;browser)
 				{
 					$valid  = false;
 				}


Property changes on: trunk/includes/session.php
___________________________________________________________________
Name: svn:keywords
   - Author Rev Date Id
   + Id

Modified: trunk/includes/user.php
===================================================================
--- trunk/includes/user.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/includes/user.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -17,6 +17,8 @@
 ||  of the GNU General Public License version 2					||
 ||																||
 ||**************************************************************||
+
+$Id$
 */
 
 // sessions should extend this
@@ -35,6 +37,10 @@
 	var $timezone;
 	var $dst;
 
+	var $is_admin;
+	var $is_bot;
+	var $is_user;
+
 	var $user_setup = false;
 
 	var $lang_name;
@@ -190,56 +196,60 @@
 
 		$this-&gt;user_setup = true;
 		$this-&gt;data['user_unread_privmsg'] = 0; // TEMP
-		// Do the theme
-		$theme_prev = get_variable('theme_preview', 'REQUEST', false);
-		$theme = ($theme) ? $theme : $_CLASS['core_user']-&gt;session_data_get('user_theme');
-		
-		if ($theme_prev &amp;&amp; ($theme_prev != $theme) &amp;&amp; check_theme($theme_prev))
-		{
-			$theme = $theme_prev;
-
-			if (!get_variable('temp_preview', 'REQUEST', false))
+		
+		if (!is_null($theme))
+		{
+			// Do the theme
+			$theme_prev = get_variable('theme_preview', 'REQUEST', false);
+			$theme = ($theme) ? $theme : $_CLASS['core_user']-&gt;session_data_get('user_theme');
+			
+			if ($theme_prev &amp;&amp; ($theme_prev != $theme) &amp;&amp; check_theme($theme_prev))
 			{
-				$_CLASS['core_user']-&gt;session_data_set('user_theme', $theme);
+				$theme = $theme_prev;
+	
+				if (!get_variable('temp_preview', 'REQUEST', false))
+				{
+					$_CLASS['core_user']-&gt;session_data_set('user_theme', $theme);
+				}
 			}
-		}
-		elseif (!$theme || !check_theme($theme))
-		{
-			$theme = ($_CLASS['core_user']-&gt;data['user_theme']) ? $_CLASS['core_user']-&gt;data['user_theme'] : $_CORE_CONFIG['global']['default_theme'];     
-		
-			if (!check_theme($theme))
+			elseif (!$theme || !check_theme($theme))
 			{
-				if (check_theme($_CORE_CONFIG['global']['default_theme']))
+				$theme = ($_CLASS['core_user']-&gt;data['user_theme']) ? $_CLASS['core_user']-&gt;data['user_theme'] : $_CORE_CONFIG['global']['default_theme'];     
+			
+				if (!check_theme($theme))
 				{
-					$theme = $_CORE_CONFIG['global']['default_theme'];
-				}
-				else
-				{
-					// We need a theme, don't we ?
-					$handle = opendir('themes');
-					$theme = false;
-					
-					while ($file = readdir($handle))
+					if (check_theme($_CORE_CONFIG['global']['default_theme']))
 					{
-						if ($file{0} !== '.' &amp;&amp; check_theme($file))
+						$theme = $_CORE_CONFIG['global']['default_theme'];
+					}
+					else
+					{
+						// We need a theme, don't we ?
+						$handle = opendir('themes');
+						$theme = false;
+						
+						while ($file = readdir($handle))
 						{
-							$theme = $file;
-							break;
+							if ($file{0} !== '.' &amp;&amp; check_theme($file))
+							{
+								$theme = $file;
+								break;
+							}
 						}
+						closedir($handle);
+						
+						if (!$theme)
+						{
+							trigger_error('Something here');
+						}
 					}
-					closedir($handle);
-					
-					if (!$theme)
-					{
-						trigger_error('Something here');
-					}
 				}
-			}
+			}
+	
+			$path = $site_file_root.'themes/'.$theme;
+			
+			$_CLASS['core_display']-&gt;load_theme($theme, $path);
 		}
-
-		$path = $site_file_root.'themes/'.$theme;
-		
-		$_CLASS['core_display']-&gt;load_theme($theme, $path);
 
 		$this-&gt;lang_name = $_CORE_CONFIG['global']['default_lang'];
 		$this-&gt;lang_path = $site_file_root.'language/' . $this-&gt;lang_name . '/';


Property changes on: trunk/includes/user.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: trunk/install/build_data.php
===================================================================
--- trunk/install/build_data.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/install/build_data.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,280 +1,322 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 $install_prefix = 'test_';
 
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;admins (admin_section, member_user_id, admin_status) VALUES ('/all/', 2, 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;admins (user_id, group_id, section, status, options) VALUES (2, 0, '/all/', 1, '')&quot;);
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;blocks (id, title, type, content, position, weight, active, file) VALUES (1, 'Control Panel', , 'block-Control_Panel.php')&quot;);
 
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'site_name', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'site_url', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'start_date', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'default_theme', 'viperal', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'foot1', '&lt;a href=\&quot;feed.php?feed=rss1\&quot; title=\&quot;RSS 1.0 / RDF Feed\&quot;&gt;&lt;img alt=\&quot;RSS 1.0 / RDF\&quot; src=\&quot;images/rss10_logo.gif\&quot; /&gt;&lt;/a&gt; &lt;a href=\&quot;feed.php?feed=rss2\&quot; title=\&quot;RSS 2.0 Feed\&quot;&gt;&lt;img alt=\&quot;RSS 2.0\&quot; src=\&quot;images/rss20_logo.gif\&quot; /&gt;&lt;/a&gt; &lt;a href=\&quot;feed.php?feed=rss\&quot; title=\&quot;RSS 0.91 Feed\&quot;&gt;&lt;img alt=\&quot;RSS 0.9\&quot; src=\&quot;images/rss090_logo.gif\&quot; /&gt;&lt;/a&gt;', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'foot2', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'default_lang', 'en', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'default_dst', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'only_registered', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'default_dateformat', 'D M d, Y g:i a', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'default_timezone', '-5', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'link_optimization', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('global', 'index_page', 'News', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('maintenance', 'active', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('maintenance', 'start', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('maintenance', 'text', '&lt;p align=\&quot;center\&quot;&gt;&lt;b&gt;Sorry we are currently updating this site.&lt;br&gt;\nPlease try again later&lt;/b&gt;&lt;/p&gt;\n&lt;p align=\&quot;center\&quot;&gt;&lt;b&gt;Viperal&lt;/b&gt;\n&lt;/p&gt;', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'allow_html_email', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'email_enable', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'email_function_name', 'mb_mail', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_auth_type', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_username', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_password', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_host', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'allow_name_chars', '[\\w_\\+\\. \\-\\[\\]]+', 1)&quot;);
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'enable_confirm', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'coppa_enable', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'coppa_fax', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'coppa_mail', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'min_name_chars', '5', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'max_reg_attempts', '10', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'max_name_chars', '50', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'min_pass_chars', '5', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'max_pass_chars', '25', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'allow_email_reuse', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'allow_name_change', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'newest_username', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'newest_user_id', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'activation', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'total_users', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'path', '/', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'cookie_domain', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'cookie_name', 'viperal', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'cookie_path', '/', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'cookie_secure', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'limit_load', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'limit_sessions', '0', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'ip_check', '4', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'browser_check', '1', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'session_length', '3600', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'error_options', '0', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;blocks (id, title, type, content, position, weight, active, file) VALUES (1, 'Control Panel', , 'block-Control_Panel.php')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'site_domain', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'site_path', '', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'site_port', '', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'site_name', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'site_url', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'start_date', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'default_theme', 'viperal')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'foot1', '&lt;a href=\&quot;feed.php?feed=rss1\&quot; title=\&quot;RSS 1.0 / RDF Feed\&quot;&gt;&lt;img alt=\&quot;RSS 1.0 / RDF\&quot; src=\&quot;images/rss10_logo.gif\&quot; /&gt;&lt;/a&gt; &lt;a href=\&quot;feed.php?feed=rss2\&quot; title=\&quot;RSS 2.0 Feed\&quot;&gt;&lt;img alt=\&quot;RSS 2.0\&quot; src=\&quot;images/rss20_logo.gif\&quot; /&gt;&lt;/a&gt; &lt;a href=\&quot;feed.php?feed=rss\&quot; title=\&quot;RSS 0.91 Feed\&quot;&gt;&lt;img alt=\&quot;RSS 0.9\&quot; src=\&quot;images/rss090_logo.gif\&quot; /&gt;&lt;/a&gt;')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'foot2', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'default_lang', 'en')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'only_registered', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'default_dateformat', 'D M d, Y g:i a')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'default_timezone', '-5')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'link_optimization', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('global', 'index_page', 'News')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('maintenance', 'active', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('maintenance', 'start', '1118095980')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('maintenance', 'text', '&lt;p align=\&quot;center\&quot;&gt;&lt;b&gt;Sorry we are currently updating this site.&lt;br&gt;\nPlease try again later&lt;/b&gt;&lt;/p&gt;\n&lt;p align=\&quot;center\&quot;&gt;&lt;b&gt;Viperal&lt;/b&gt;\n&lt;/p&gt;')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'allow_html_email', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'email_enable', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'email_function_name', 'mail')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'smtp_auth_type', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'smtp_username', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'smtp_password', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('email', 'smtp_host', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'require_activation', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'coppa_enable', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'coppa_fax', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'coppa_mail', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'enable_confirm', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'min_name_chars', '5')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'allow_name_chars', '[\\w_\\+\\. \\-\\[\\]]+')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'max_reg_attempts', '10')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'max_name_chars', '50')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'min_pass_chars', '5')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'max_pass_chars', '25')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'chg_passforce', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'allow_emailreuse', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('user', 'allow_namechange', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'path', '/')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'cookie_domain', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'cookie_name', 'viperal')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'cookie_path', '/')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'cookie_secure', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'limit_load', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'limit_sessions', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'ip_check', '4')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'browser_check', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'session_length', '3600')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'error_options', '0')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'optimize_rate', '1200000')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'optimize_last', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'site_domain', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'site_path', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('server', 'site_port', '')&quot;);
 
-
-
-
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_colour, group_legend, group_avatar, group_description) VALUES (1, 'GUESTS', 3, '', 0, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_colour, group_legend, group_avatar, group_description) VALUES (2, 'REGISTERED', 3, '', 0, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_colour, group_legend, group_avatar, group_description) VALUES (3, 'REGISTERED_COPPA', 3, '', 0, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_colour, group_legend, group_avatar, group_description) VALUES (4, 'ADMINISTRATORS', 3, 'AA0000', 1, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_colour, group_legend, group_avatar, group_description) VALUES (5, 'BOTS', 3, '9E8DA7', 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_avatar, group_description) VALUES (1, 'GUESTS', 1, 2, '', 0, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_avatar, group_description) VALUES (2, 'REGISTERED', 1, 2, '', 0, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_avatar, group_description) VALUES (3, 'REGISTERED_COPPA', 1, 2, '', 0, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_avatar, group_description) VALUES (4, 'ADMINISTRATORS', 1, 2, 'AA0000', 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_avatar, group_description) VALUES (5, 'BOTS', 1, 2, '9E8DA7', 1, '', '')&quot;);
 // To be seperated
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_colour, group_legend, group_avatar, group_description) VALUES (6, 'SUPER_MODERATORS', 3, '00AA00', 0, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups (group_id, group_name, group_type, group_status, group_colour, group_legend, group_avatar, group_description) VALUES (6, 'SUPER_MODERATORS', 1, 2, '00AA00', 0, '', '')&quot;);
 
 
 //Admin
-#$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (2, 2, 2)&quot;);
-#$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (3, 2, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (4, 2, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (6, 2, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (4, 2, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (6, 2, 2)&quot;);
 // Anonymous
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (1, 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (1, 1, 1)&quot;);
 // Bots
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (5, 3, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (5, 4, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (5, 5, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (5, 6, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (5, 7, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_users (group_id, user_id, user_status) VALUES (5, 8, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (5, 3, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (5, 4, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (5, 5, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (5, 6, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (5, 7, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;groups_members (group_id, member_user_id, member_status) VALUES (5, 8, 1)&quot;);
 
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (1, 'blocks', 'Blocks', 0, 0, 0, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (2, 'messages', 'Messages', 0, 0, 0, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (3, 'system', 'System', 0, 0, 0, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (4, 'modules', 'Modules', 0, 0, 0, '', 'add:radio\r\n')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (5, 'News', 'News', 1, 1, 1, '0', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (6, 'Recommend_Us', 'Recommend Us', 1, 1, 1, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (7, 'Submit_News', 'Submit News', 1, 1, 1, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (8, 'Forums', 'Forums', 1, 1, 2, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (9, 'View_Online', 'View_Online', 1, 1, 1, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (10, 'Members_List', 'Members_List', 1, 1, 2, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (11, 'Control_Panel', 'Control_Panel', 1, 1, 2, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (12, 'Calender', 'Calender', 1, 1, 2, '', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (id, name, title, active, type, sides, auth, admin_options) VALUES (13, 'Quick_Message', 'Quick_Message', 1, 1, 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('blocks', 'Blocks', 0, 2,'')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('groups', 'Groups', 0, 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('system', 'System', 0, 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('messages', 'Messages', 0, 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('modules', 'Modules', 0, 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('services', 'Services', 0, 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('smiles', 'Smiles', 0, 2, '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_admin_options) VALUES ('users', 'Users', 0, 2, '')&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (5, 'News', 'News', 1, 1, 1, '0', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (6, 'Recommend_Us', 'Recommend Us', 1, 1, 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (7, 'Submit_News', 'Submit News', 1, 1, 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (8, 'Forums', 'Forums', 1, 1, 2, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (9, 'View_Online', 'View_Online', 1, 1, 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (10, 'Members_List', 'Members_List', 1, 1, 2, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (11, 'Control_Panel', 'Control_Panel', 1, 1, 2, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (12, 'Calender', 'Calender', 1, 1, 2, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;modules (module_name, module_title, module_type, module_status, module_sides) VALUES (13, 'Quick_Message', 'Quick_Message', 1, 1, 1, '', '')&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':D', 'grin.png', 'Very Happy', 19, 19, 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':)', 'smile.png', 'Smile', 19, 19, 2)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':(', 'sad.png', 'Sad', 19, 19, 3)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':o', 'surprised.png', 'Surprised', 19, 19, 4)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':eek:', 'surprised.png', 'Surprised', 19, 19, 4)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES ('8O', 'eek.png', 'Shocked', 19, 19, 5)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':?', 'confused.png', 'Confused', 19, 19, 6)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES ('8)', 'cool.png', 'Cool', 19, 19, 7)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':lol:', 'laugh.png', 'Laughing', 19, 19, 8)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':x', 'mad.png', 'Mad', 19, 19, 9)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':P', 'icon_razz.gif', 'Razz', 19, 19, 10)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':oops:', 'embarrassed.png', 'Embarassed', 19, 19, 11)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':cry:', 'cry.png', 'Crying or Very sad', 19, 19, 12)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':evil:', 'evil.png', 'Evil or Very Mad', 19, 19, 13)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':twisted:', 'twisted.png', 'Twisted Evil', 19, 19, 14)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':roll:', 'rolleyes.png', 'Rolling Eyes', 19, 19, 19)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (';)', 'wink.png', 'Wink', 19, 19, 16)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':!:', 'exclaim.png', 'Exclamation', 19, 19, 17)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':?:', 'question.png', 'Question', 19, 19, 18)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':idea:', 'idea.png', 'Idea', 19, 19, 19)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':arrow:', 'arrow.png', 'Arrow', 19, 19, 20)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':|', 'neutral.png', 'Neutral', 19, 19, 21)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (code, smiley_url, emotion, smiley_width, smiley_height, smiley_order) VALUES (':mrgreen:', 'mrgreen.png', 'Mr. Green', 19, 19, 22)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':D', 'grin.png', 'Very Happy', 19, 19, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':)', 'smile.png', 'Smile', 19, 19, 2)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':(', 'sad.png', 'Sad', 19, 19, 3)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':o', 'surprised.png', 'Surprised', 19, 19, 4)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':eek:', 'surprised.png', 'Surprised', 19, 19, 4)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES ('8O', 'eek.png', 'Shocked', 19, 19, 5)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':?', 'confused.png', 'Confused', 19, 19, 6)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES ('8)', 'cool.png', 'Cool', 19, 19, 7)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':lol:', 'laugh.png', 'Laughing', 19, 19, 8)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':x', 'mad.png', 'Mad', 19, 19, 9)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':P', 'icon_razz.gif', 'Razz', 19, 19, 10)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':oops:', 'embarrassed.png', 'Embarassed', 19, 19, 11)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':cry:', 'cry.png', 'Crying or Very sad', 19, 19, 12)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':evil:', 'evil.png', 'Evil or Very Mad', 19, 19, 13)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':twisted:', 'twisted.png', 'Twisted Evil', 19, 19, 14)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':roll:', 'rolleyes.png', 'Rolling Eyes', 19, 19, 19)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (';)', 'wink.png', 'Wink', 19, 19, 16)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':!:', 'exclaim.png', 'Exclamation', 19, 19, 17)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':?:', 'question.png', 'Question', 19, 19, 18)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':idea:', 'idea.png', 'Idea', 19, 19, 19)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':arrow:', 'arrow.png', 'Arrow', 19, 19, 20)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':|', 'neutral.png', 'Neutral', 19, 19, 21)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;smilies (smiley_code, smiley_src, smiley_description, smiley_width, smiley_height, smiley_order) VALUES (':mrgreen:', 'mrgreen.png', 'Mr. Green', 19, 19, 22)&quot;);
 
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username) VALUES (1, 16, 1, 'Anonymous')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_password, user_password_encoding, user_colour) VALUES (2, 148, 4, 'Admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (3, 24, 5, 'Googlebot', '216.239.46.,64.68.8,66.249.64.', 'Googlebot/', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (4, 24, 5, 'MSN', '65.54.188.', 'msnbot/', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (5, 24, 5, 'Yahoo', '66.196.90.1', 'Yahoo! Slurp', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (6, 24, 5, 'Alexa', '66.28.250.,209.237.238.', 'ia_archiver', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (7, 24, 5, 'NaverBot', '218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (8, 24, 5, 'Jetbot', '64.71.144.', 'Jetbot/', '')&quot;);
 
+// Forums
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_list', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_read', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_post', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_reply', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_quote', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_edit', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_user_lock', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_delete', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_bump', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_poll', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_vote', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_votechg', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_announce', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_sticky', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_download', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_icons', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_html', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_bbsmiley_code', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_smilies', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_img', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_flash', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_sigs', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_search', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_email', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_rate', 1)&quot;);
+#$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_print', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_ignoreflood', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_postcount', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_moderate', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_report', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_subscribe', 1)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_edit', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_delete', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_move', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_lock', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_split', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_merge', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_approve', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_unrate', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_auth', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_ip', 1, 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_info', 1, 1)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_server', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_defaults', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_board', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_cookies', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_clearlogs', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_words', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_icons', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_bbsmiley_code', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_email', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_styles', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_user', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_useradd', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_userdel', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_ranks', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_ban', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_names', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_group', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_groupadd', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_groupdel', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_forum', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_forumadd', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_forumdel', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_prune', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_auth', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authmods', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authadmins', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authusers', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authgroups', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_authdeps', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_backup', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_restore', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_search', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_events', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_cron', 1)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sendemail', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_readpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sendpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sendim', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_hideonline', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_viewonline', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_viewprofile', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgavatar', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chggrp', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgemail', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgname', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgpasswd', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_chgcensors', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_search', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_savedrafts', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_download', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_sig', 1)&quot;);
+
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_attach', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_html', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_bbsmiley_code', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_smilies', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_download', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_report', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_edit', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_printpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_emailpm', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_forward', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_delete', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_img', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_flash', 1)&quot;);
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username) VALUES (1, 2, 1, 'Anonymous')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_password, user_password_encoding, user_colour) VALUES (2, 3, 4, 'Admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (3, 4, 5, 'Googlebot', '216.239.46.,64.68.8,66.249.64.', 'Googlebot/', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (4, 4, 5, 'MSN', '65.54.188.', 'msnbot/', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (5, 4, 5, 'Yahoo', '66.196.90.1', 'Yahoo! Slurp', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (6, 4, 5, 'Alexa', '66.28.250.,209.237.238.', 'ia_archiver', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (7, 4, 5, 'NaverBot', '218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;users (user_id, user_type, group_id, username, user_ip, user_agent, user_colour) VALUES (8, 4, 5, 'Jetbot', '64.71.144.', 'Jetbot/', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'u_%'&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'a_%'&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 1, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 2, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html')&quot;);
 
-
-
-
-// Forums
-
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_list', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_read', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_post', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_reply', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_quote', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_edit', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_user_lock', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_delete', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_bump', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_poll', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_vote', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_votechg', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_announce', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_sticky', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_attach', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_download', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_icons', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_html', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_bbcode', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_smilies', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_img', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_flash', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_sigs', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_search', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_email', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_rate', 1&quot;);
-#$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_print', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_ignoreflood', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_postcount', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_moderate', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_report', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local) VALUES ('f_subscribe', 1&quot;);
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'm_%';
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'm_%';
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_edit', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_delete', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_move', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_lock', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_split', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_merge', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_approve', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_unrate', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_auth', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_ip', 1, 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_local, is_global) VALUES ('m_info', 1, 1&quot;);
+# ADMINISTRATOR group - admin and forum rights
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%';
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'a_%';
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html');
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_server', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_defaults', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_board', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_cookies', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_clearlogs', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_words', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_icons', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_bbcode', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_attach', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_email', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_styles', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_user', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_useradd', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_userdel', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_ranks', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_ban', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_names', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_group', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_groupadd', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_groupdel', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_forum', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_forumadd', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_forumdel', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_prune', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_auth', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_authmods', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_authadmins', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_authusers', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_authgroups', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_authdeps', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_backup', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_restore', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_search', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_events', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('a_cron', 1&quot;);
+# SUPER MODERATOR group - moderator rights
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 6, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chggrp', 'u_chgname');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 6, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'm_%';
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_sendemail', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_readpm', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_sendpm', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_sendim', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_hideonline', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_viewonline', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_viewprofile', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_chgavatar', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_chggrp', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_chgemail', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_chgname', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_chgpasswd', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_chgcensors', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_search', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_savedrafts', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_download', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_attach', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_sig', 1&quot;);
+# REGISTERED/REGISTERED COPPA groups - common forum rights
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chggrp', 'u_viewonline', 'u_chgname');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_subscribe');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_votechg', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_report', 'f_subscribe');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 5, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chgcensors', 'u_chggrp', 'u_viewonline', 'u_chgname');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 5, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_subscribe');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 5, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_votechg', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_report', 'f_subscribe');
 
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_attach', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_html', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_bbcode', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_smilies', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_download', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_report', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_edit', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_printpm', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_emailpm', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_forward', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_delete', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_img', 1&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;auth_options (auth_option, is_global) VALUES ('u_pm_flash', 1&quot;);
+# GUESTS, INACTIVE, INACTIVE_COPPA group - basic rights
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 1, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 1, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 2, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 2, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 3, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 3, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
+
+# BOTS - read/view only
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 8, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read');
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 8, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read');
 
-
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_attachments', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_bbcode', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_bbsmiley_code', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_html', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_html_tags', 'b,i,u,pre', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_smilies', '1', 0)&quot;);
@@ -383,7 +425,7 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('pm_max_boxes', '4', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('pm_max_msgs', '50', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_html_pm', '1', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_bbcode_pm', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_bbsmiley_code_pm', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_smilies_pm', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_download_pm', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('auth_report_pm', '1', 0)&quot;);
@@ -412,7 +454,7 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('enable_karma', '1', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_img', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('board_hide_emails', '0', 0)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_bbcode', '1', 0)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_bbsmiley_code', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_flash', '0', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_html', '0', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_sig_img', '1', 0)&quot;);
@@ -420,30 +462,17 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('max_post_urls', '0', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('database_last_gc', '0', 1)&quot;);
 
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'MAIN', 'main', 1, 1, 'front\r\nsubscribed\r\nbookmarks,cfg_allow_bookmarks\r\ndrafts', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'PM', 'pm', 2, 1, 'view_messages\r\ncompose\r\nunread\r\ndrafts\r\noptions', 'cfg_allow_privmsg')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'PROFILE', 'profile', 3, 1, 'profile_info\r\nreg_details\r\nsignature\r\navatar', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'PREFS', 'prefs', 4, 1, 'personal\r\nview\r\npost', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'ZEBRA', 'zebra', 5, 1, 'friends\r\nfoes', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'ATTACHMENTS', 'attachments', 6, 1, '', 'acl_u_attach &amp;&amp; cfg_allow_attachments')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'GROUPS', 'groups', 7, 1, '', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('ucp', 'CALENDER', 'calender', 3, 1, 'month_view\r\nday_view\r\nadd_event', '')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('mcp', 'MAIN', 'main', 1, 1, 'front\r\nforum_view\r\ntopic_view\r\npost_details', 'acl_m_')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('mcp', 'QUEUE', 'queue', 2, 1, 'unapproved_topics\r\nunapproved_posts\r\nreports', 'acl_m_approve')&quot;);
 
 
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('quick_message', 'time', '1')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('quick_message', 'number', '25')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('quick_message', 'height', '200')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('quick_message', 'allow_anonymous', '2')&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (section, name, value) VALUES ('quick_message', 'maxlength', '150')&quot;);
-
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;quick_message (id, user_id, user_name, ip, message, time) VALUES (1, 0, 'Site', '', 'Lets do this !', &quot;.gmtime().&quot;)&quot;);
+//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;quick_message (id, user_id, user_name, ip, message, time) VALUES (1, 0, 'Site', '', 'Lets do this !', &quot;.gmtime().&quot;)&quot;);
 ?&gt;
\ No newline at end of file

Modified: trunk/install/build_tables.php
===================================================================
--- trunk/install/build_tables.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/install/build_tables.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,34 +1,52 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 $install_prefix = 'test_';
-$time_field = 1122762758; // max Friday January 19th 2038
+
+function field_unix_time($name, $null = false)
+{
+	global $_CLASS;
+
+	$_CLASS['core_db']-&gt;add_table_field_int(array('name' =&gt; $name, 'min' =&gt; 0, 'max' =&gt; 200000000, 'null' =&gt; $null));
+}
 
 /*
 	Admin Auth Table
 */
+
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'admins');
 
-$_CLASS['core_db']-&gt;add_table_field_char('section', 100);
-$_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('group_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('status', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_text('options', 60000);
+$_CLASS['core_db']-&gt;add_table_field_char('admin_section', 100);
 
-$_CLASS['core_db']-&gt;add_table_index('auth_id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('user_id');
-$_CLASS['core_db']-&gt;add_table_index('group_id');
+$_CLASS['core_db']-&gt;add_table_field_int('member_user_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('member_group_id', array('max' =&gt; 16000000, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('admin_status', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_text('admin_options', 60000, true);
 
+$_CLASS['core_db']-&gt;add_table_index('member_user_id');
+$_CLASS['core_db']-&gt;add_table_index('member_group_id');
+$_CLASS['core_db']-&gt;add_table_index('admin_status');
+
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
@@ -36,85 +54,88 @@
 */
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'blocks');
 
-$_CLASS['core_db']-&gt;add_table_field_int('id', 0, 16000000, 0, true);
-$_CLASS['core_db']-&gt;add_table_field_char('title', 100);
-$_CLASS['core_db']-&gt;add_table_field_int('type', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('position', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('weight', 0, 200);
-$_CLASS['core_db']-&gt;add_table_field_int('active', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('start', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_int('expires', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_text('content', 60000);
-$_CLASS['core_db']-&gt;add_table_field_char('file', 255);
-$_CLASS['core_db']-&gt;add_table_field_text('auth', 60000);
-$_CLASS['core_db']-&gt;add_table_field_char('rss_url', 255);
-$_CLASS['core_db']-&gt;add_table_field_int('rss_rate', 0, 60000);
-$_CLASS['core_db']-&gt;add_table_field_int('rss_expires', 0, $time_field);
+$_CLASS['core_db']-&gt;add_table_field_int('block_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('block_title', 100);
+$_CLASS['core_db']-&gt;add_table_field_int('block_type', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('block_status', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('block_position', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('block_order', array('max' =&gt; 200));
+field_unix_time('block_starts', true);
+field_unix_time('block_expires', true);
+$_CLASS['core_db']-&gt;add_table_field_text('block_content', 60000, true);
+$_CLASS['core_db']-&gt;add_table_field_char('block_file', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('block_rss_url', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_int('block_rss_rate', array('min' =&gt; -1, 'max' =&gt; 60000, 'null' =&gt; true));
+field_unix_time('block_rss_expires', true);
+$_CLASS['core_db']-&gt;add_table_field_text('block_auth', 60000, true);
 
-$_CLASS['core_db']-&gt;add_table_index('id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('type');
-$_CLASS['core_db']-&gt;add_table_index('position');
+$_CLASS['core_db']-&gt;add_table_index('block_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('block_type');
+$_CLASS['core_db']-&gt;add_table_index('block_position');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
-	Sessions Table
+	Config Table
 */
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'config');
 
-$_CLASS['core_db']-&gt;add_table_field_char('section', 20);
-$_CLASS['core_db']-&gt;add_table_field_char('name', 20);
-$_CLASS['core_db']-&gt;add_table_field_text('value', 60000);
+$_CLASS['core_db']-&gt;add_table_field_char('config_section', 20);
+$_CLASS['core_db']-&gt;add_table_field_char('config_name', 20);
+$_CLASS['core_db']-&gt;add_table_field_text('config_value', 60000);
+$_CLASS['core_db']-&gt;add_table_field_int('config_cache', array('max' =&gt; 1, 'null' =&gt; true));
 
-$_CLASS['core_db']-&gt;add_table_index('section');
-$_CLASS['core_db']-&gt;add_table_index('name');
+$_CLASS['core_db']-&gt;add_table_index(array('config_section', 'config_name'), 'primary');
+$_CLASS['core_db']-&gt;add_table_index('config_cache');
 
-
 $_CLASS['core_db']-&gt;table_create('commit');
 
 
 /*
-	Grouyps Table
-	`group_chgpass` smallint(6) NOT NULL default '0',
-
+	Groups Table
 */
+
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'groups');
 
-$_CLASS['core_db']-&gt;add_table_field_int('group_id', 0, 16000000, 0, true);
-$_CLASS['core_db']-&gt;add_table_field_int('group_type', 0, 1, 1);
+$_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('group_name', 50);
-$_CLASS['core_db']-&gt;add_table_field_int('group_display', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_char('group_avatar', 100);
+$_CLASS['core_db']-&gt;add_table_field_int('group_type', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('group_status', array('max' =&gt; 10));
 
-$_CLASS['core_db']-&gt;add_table_field_int('group_avatar_type', 0, 2000);
-$_CLASS['core_db']-&gt;add_table_field_int('group_avatar_width', 0, 2000);
-$_CLASS['core_db']-&gt;add_table_field_int('group_avatar_height', 0, 2000);
-$_CLASS['core_db']-&gt;add_table_field_int('group_rank', 0, 20000, -1);
-
+$_CLASS['core_db']-&gt;add_table_field_int('group_rank', array('max' =&gt; 2000));
 $_CLASS['core_db']-&gt;add_table_field_char('group_colour', 6);
-$_CLASS['core_db']-&gt;add_table_field_int('group_sig_chars', 0, 160000);
-$_CLASS['core_db']-&gt;add_table_field_int('group_receive_pm', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('group_message_limit', 0, 16000000);
+$_CLASS['core_db']-&gt;add_table_field_char('group_avatar', 100);
+$_CLASS['core_db']-&gt;add_table_field_int('group_avatar_type', 0, 200);
+$_CLASS['core_db']-&gt;add_table_field_int('group_avatar_width', 0, 200);
+$_CLASS['core_db']-&gt;add_table_field_int('group_avatar_height', 0, 200);
 
+$_CLASS['core_db']-&gt;add_table_field_int('group_sig_chars', array('max' =&gt; 160000));
+$_CLASS['core_db']-&gt;add_table_field_int('group_receive_pm', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('group_message_limit', array('max' =&gt; 10000));
+
 $_CLASS['core_db']-&gt;add_table_field_char('group_description', 255);
-$_CLASS['core_db']-&gt;add_table_field_int('group_legend', 0, 1);
+$_CLASS['core_db']-&gt;add_table_field_int('group_display', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('group_legend', array('max' =&gt; 10));
 
+
 $_CLASS['core_db']-&gt;add_table_index('group_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('group_display');
 $_CLASS['core_db']-&gt;add_table_index('group_legend');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
-	Groups Users Table
+	Groups Members Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'groups_users');
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'groups_members');
 
-$_CLASS['core_db']-&gt;add_table_field_int('group_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_char('user_id', 100);
-$_CLASS['core_db']-&gt;add_table_field_int('user_status', 0, 1);
+$_CLASS['core_db']-&gt;add_table_field_int('group_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('member_user_id', array('max' =&gt; 16000000));
+$_CLASS['core_db']-&gt;add_table_field_int('member_status', array('max' =&gt; 16000000));
 
-$_CLASS['core_db']-&gt;add_table_index('user_id');
 $_CLASS['core_db']-&gt;add_table_index('group_id');
+$_CLASS['core_db']-&gt;add_table_index('member_user_id');
+$_CLASS['core_db']-&gt;add_table_index('member_status');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
@@ -123,18 +144,18 @@
 */
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'modules');
 
-$_CLASS['core_db']-&gt;add_table_field_int('id', 0, 16000000, 0, true);
-$_CLASS['core_db']-&gt;add_table_field_char('name', 100);
-$_CLASS['core_db']-&gt;add_table_field_char('title', 100);
-$_CLASS['core_db']-&gt;add_table_field_int('active', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('type', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('sides', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_text('auth', 60000);
-$_CLASS['core_db']-&gt;add_table_field_text('admin_options', 200);
+$_CLASS['core_db']-&gt;add_table_field_int('module_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('module_name', 100);
+$_CLASS['core_db']-&gt;add_table_field_char('module_title', 100);
+$_CLASS['core_db']-&gt;add_table_field_int('module_type', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('module_status', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('module_sides', array('max' =&gt; 10, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_text('module_auth', 60000, true);
+$_CLASS['core_db']-&gt;add_table_field_text('module_auth_options', 60000, true);
+$_CLASS['core_db']-&gt;add_table_field_text('module_admin_options', 6000, true);
 
-$_CLASS['core_db']-&gt;add_table_index('id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('name', 'unique');
-$_CLASS['core_db']-&gt;add_table_index('homepage'); // to be removed late on
+$_CLASS['core_db']-&gt;add_table_index('module_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('module_name', 'unique');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
@@ -145,17 +166,19 @@
 
 $_CLASS['core_db']-&gt;add_table_field_char('session_id', 40);
 $_CLASS['core_db']-&gt;add_table_field_int('session_user_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('session_last_visit', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_int('session_start', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_int('session_time', 0, $time_field);
+field_unix_time('session_last_visit');
+field_unix_time('session_start');
+field_unix_time('session_time');
 $_CLASS['core_db']-&gt;add_table_field_char('session_ip', 18);
 $_CLASS['core_db']-&gt;add_table_field_char('session_browser', 255);
 $_CLASS['core_db']-&gt;add_table_field_char('session_page', 100);
 $_CLASS['core_db']-&gt;add_table_field_char('session_url', 255);
-$_CLASS['core_db']-&gt;add_table_field_int('session_user_type', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('session_admin', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_text('session_auth', 60000);
+$_CLASS['core_db']-&gt;add_table_field_int('session_user_type', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('session_admin', array('max' =&gt; 10));
+$_CLASS['core_db']-&gt;add_table_field_int('session_hidden', array('max' =&gt; 10));
+
 $_CLASS['core_db']-&gt;add_table_field_text('session_data', 60000);
+$_CLASS['core_db']-&gt;add_table_field_text('session_auth', 60000);
 
 $_CLASS['core_db']-&gt;add_table_index('session_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('session_time');
@@ -164,60 +187,47 @@
 $_CLASS['core_db']-&gt;table_create('commit');
 
 /*
-	Smiles Table
+	Sessions Auto login Table
 */
-$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'smilies');
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'sessions_auto_login');
 
-$_CLASS['core_db']-&gt;add_table_field_int('smiley_id', 0, 16000000, 0, true);
-$_CLASS['core_db']-&gt;add_table_field_char('code', 10);
-$_CLASS['core_db']-&gt;add_table_field_char('emotion', 50);
-$_CLASS['core_db']-&gt;add_table_field_char('smiley_url', 50);
-$_CLASS['core_db']-&gt;add_table_field_int('smiley_width', 0, 200);
-$_CLASS['core_db']-&gt;add_table_field_int('smiley_height', 0, 200);
-$_CLASS['core_db']-&gt;add_table_field_int('smiley_order', 0, 200);
-$_CLASS['core_db']-&gt;add_table_field_int('display_on_posting', 0, 1);
+$_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);
+$_CLASS['core_db']-&gt;add_table_field_char('auto_login_browser', 255);
+$_CLASS['core_db']-&gt;add_table_field_char('auto_login_code', 40);
+field_unix_time('auto_login_time');
 
-$_CLASS['core_db']-&gt;add_table_index('smiley_id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('display_on_posting');
+$_CLASS['core_db']-&gt;add_table_index(array('user_id', 'auto_login_code'), 'primary');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
-//////
-//Quick Message
-//////
+/*
+	Smiles Table
+*/
+$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'smilies');
 
-$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'quick_message');
+$_CLASS['core_db']-&gt;add_table_field_int('smiley_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 
-$_CLASS['core_db']-&gt;add_table_field_int('id', 0, 16000000, 0, true);
-$_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_char('user_name', 80);
-$_CLASS['core_db']-&gt;add_table_field_char('ip', 18);
-$_CLASS['core_db']-&gt;add_table_field_text('message', 200);
-$_CLASS['core_db']-&gt;add_table_field_int('time', 0, $time_field);
+$_CLASS['core_db']-&gt;add_table_field_char('smiley_code', 10);
+$_CLASS['core_db']-&gt;add_table_field_char('smiley_src', 200);
+$_CLASS['core_db']-&gt;add_table_field_char('smiley_description', 50);
 
-$_CLASS['core_db']-&gt;add_table_index('id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('time');
+$_CLASS['core_db']-&gt;add_table_field_int('smiley_width', array('max' =&gt; 200));
+$_CLASS['core_db']-&gt;add_table_field_int('smiley_height', array('max' =&gt; 200));
+$_CLASS['core_db']-&gt;add_table_field_int('smiley_order', array('max' =&gt; 200));
+$_CLASS['core_db']-&gt;add_table_field_int('smiley_type', array('max' =&gt; 10));
 
+$_CLASS['core_db']-&gt;add_table_index('smiley_id', 'primary');
+$_CLASS['core_db']-&gt;add_table_index('smiley_type');
+
 $_CLASS['core_db']-&gt;table_create('commit');
 
-
 /*
 
-`user_passchg` int(11) NOT NULL default '0',
-`user_timezone` decimal(5,2) NOT NULL default '0.00',
-`user_dst` tinyint(1) NOT NULL default '0',
- `user_unread_privmsg` tinyint(4) unsigned NOT NULL default '0',
-`user_occ` varchar(255) NOT NULL default '',
+`user_unread_privmsg` tinyint(4) unsigned NOT NULL default '0',
 `user_newpasswd` varchar(40) NOT NULL default '',
- `user_emailtime` int(11) NOT NULL default '0',
-  `user_actkey` varchar(32) NOT NULL default '',
-  `user_newpasswd` varchar(40) NOT NULL default '',
-  `user_viewemail` tinyint(1) NOT NULL default '0',
-user_lastpost_time
-  
+`user_viewemail` tinyint(1) NOT NULL default '0',
 */
 
-
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'users');
 
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000, 0, true);
@@ -230,14 +240,15 @@
 $_CLASS['core_db']-&gt;add_table_field_char('user_ip', 255);
 $_CLASS['core_db']-&gt;add_table_field_char('user_agent', 255);
 $_CLASS['core_db']-&gt;add_table_field_int('user_timezone', -43200 , 46800);
+$_CLASS['core_db']-&gt;add_table_field_int('user_dst', 0 , 1);
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_regdate', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_text('user_permissions', 60000); // phpBBs
+field_unix_time('user_regdate');
+$_CLASS['core_db']-&gt;add_table_field_text('user_permissions', 60000); // phpBBs rename user_forums_permissions
 $_CLASS['core_db']-&gt;add_table_field_char('user_email', 100);
 $_CLASS['core_db']-&gt;add_table_field_char('user_birthday', 10);
 $_CLASS['core_db']-&gt;add_table_field_text('user_data', 6000);
-$_CLASS['core_db']-&gt;add_table_field_int('user_last_visit', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_int('user_last_post_time', 0, $time_field);
+field_unix_time('user_last_visit');
+field_unix_time('user_last_post_time');
 $_CLASS['core_db']-&gt;add_table_field_int('user_warnings', 0, 10000);
 $_CLASS['core_db']-&gt;add_table_field_char('user_lang', 10);
 $_CLASS['core_db']-&gt;add_table_field_char('user_theme', 60);
@@ -258,8 +269,6 @@
 $_CLASS['core_db']-&gt;add_table_field_char('user_interests', 255);
 $_CLASS['core_db']-&gt;add_table_field_char('user_occ', 255);
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_posts', 16000000);
-
 $_CLASS['core_db']-&gt;add_table_field_int('user_message_limit', 0, 200);
 $_CLASS['core_db']-&gt;add_table_field_int('user_message_rules', 0, 1);
 
@@ -286,6 +295,9 @@
 $_CLASS['core_db']-&gt;add_table_field_char('user_post_sortby_type', 1);
 $_CLASS['core_db']-&gt;add_table_field_char('user_post_sortby_dir', 1);
 
+$_CLASS['core_db']-&gt;add_table_field_int('user_posts', 16000000);
+field_unix_time('user_lastpost_time');
+
 $_CLASS['core_db']-&gt;add_table_field_int('user_allow_viewonline', 0, 1, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('user_allow_viewemail', 0, 1, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('user_allow_massemail', 0, 1, 1);
@@ -296,6 +308,8 @@
 $_CLASS['core_db']-&gt;add_table_field_int('user_avatar_height', 0, 100);
 
 $_CLASS['core_db']-&gt;add_table_field_char('user_act_key', 40);
+$_CLASS['core_db']-&gt;add_table_field_char('user_new_password', 40);
+$_CLASS['core_db']-&gt;add_table_field_char('user_new_password_encoding', 10);
 
 $_CLASS['core_db']-&gt;add_table_index('user_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('username');
@@ -326,7 +340,7 @@
 $_CLASS['core_db']-&gt;add_table_field_char('extension', 50);
 $_CLASS['core_db']-&gt;add_table_field_char('mimetype', 100);
 $_CLASS['core_db']-&gt;add_table_field_int('filesize', 0, 1000000000);
-$_CLASS['core_db']-&gt;add_table_field_int('filetime', 0, $time_field);
+field_unix_time('filetime');
 
 $_CLASS['core_db']-&gt;add_table_index('attach_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('post_msg_id');
@@ -349,7 +363,6 @@
 $_CLASS['core_db']-&gt;add_table_index('user_id');
 $_CLASS['core_db']-&gt;add_table_index('group_id');
 $_CLASS['core_db']-&gt;add_table_index('auth_option_id');
-#$_CLASS['core_db']-&gt;add_table_index('auth_option', 'unique');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
@@ -365,7 +378,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('founder_only', 0, 1);
 
 $_CLASS['core_db']-&gt;add_table_index('auth_option_id', 'primary');
-$_CLASS['core_db']-&gt;add_table_index('auth_option');
+$_CLASS['core_db']-&gt;add_table_index('auth_option', 'unique');
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
@@ -435,7 +448,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('save_time', 0, $time_field);
+field_unix_time('save_time');
 $_CLASS['core_db']-&gt;add_table_field_char('draft_subject', 50);
 $_CLASS['core_db']-&gt;add_table_field_text('draft_message', 0, 16000000);
 
@@ -506,13 +519,13 @@
 $_CLASS['core_db']-&gt;add_table_field_int('forum_topics_real', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('forum_last_post_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('forum_last_poster_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('forum_last_post_time', 0, $time_field);
+field_unix_time('forum_last_post_time');
 $_CLASS['core_db']-&gt;add_table_field_char('forum_last_poster_name', 50);
 $_CLASS['core_db']-&gt;add_table_field_int('forum_flags', 0, 200);
 $_CLASS['core_db']-&gt;add_table_field_int('display_on_index', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('enable_indexing', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('enable_icons', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('prune_next', 0, $time_field);
+field_unix_time('prune_next');
 
 //////
 $_CLASS['core_db']-&gt;add_table_field_int('prune_days', 0, 200);
@@ -536,14 +549,14 @@
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', 0, 16000);
 $_CLASS['core_db']-&gt;add_table_field_int('right_id', 0, 16000);
 $_CLASS['core_db']-&gt;add_table_field_int('poster_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('post_time', 0, $time_field);
+field_unix_time('post_time');
 $_CLASS['core_db']-&gt;add_table_field_char('poster_ip', 20);
 $_CLASS['core_db']-&gt;add_table_field_char('post_username', 50);
 $_CLASS['core_db']-&gt;add_table_field_int('enable_bbcode', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('enable_html', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('enable_smilies', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('enable_sig', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('post_edit_time', 0, $time_field);
+field_unix_time('post_edit_time');
 $_CLASS['core_db']-&gt;add_table_field_int('post_edit_count', 0, 20000);
 $_CLASS['core_db']-&gt;add_table_field_int('post_attachment', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_char('post_subject', 50);
@@ -578,7 +591,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_char('topic_title', 50);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_poster', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('topic_time', 0, $time_field);
+field_unix_time('topic_time');
 $_CLASS['core_db']-&gt;add_table_field_int('topic_views', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_replies', 0, 16000000);  
 $_CLASS['core_db']-&gt;add_table_field_int('topic_status', 0, 1);
@@ -591,22 +604,22 @@
 $_CLASS['core_db']-&gt;add_table_field_int('topic_attachment', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_approved', 0, 1, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_reported', 0, 1); 
-$_CLASS['core_db']-&gt;add_table_field_int('topic_time_limit', 0, $time_field);
+field_unix_time('topic_time_limit');
 $_CLASS['core_db']-&gt;add_table_field_int('topic_replies_real', 16000000);
 $_CLASS['core_db']-&gt;add_table_field_char('topic_first_poster_name', 50);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_last_poster_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_char('topic_last_poster_name', 50);
-$_CLASS['core_db']-&gt;add_table_field_int('topic_last_post_time', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_int('topic_last_view_time', 0, $time_field);
+field_unix_time('topic_last_post_time');
+field_unix_time('topic_last_view_time');
 
 $_CLASS['core_db']-&gt;add_table_field_int('topic_bumped', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_bumper', 0, 16000000);
   
 $_CLASS['core_db']-&gt;add_table_field_char('poll_title', 100);
-$_CLASS['core_db']-&gt;add_table_field_int('poll_start', 0, $time_field);
-$_CLASS['core_db']-&gt;add_table_field_int('poll_length', 0, $time_field); 
+field_unix_time('poll_start');
+field_unix_time('poll_length'); 
 $_CLASS['core_db']-&gt;add_table_field_int('poll_max_options', 0, 200, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('poll_last_vote', 0, $time_field);
+field_unix_time('poll_last_vote');
 $_CLASS['core_db']-&gt;add_table_field_int('poll_vote_change', 0, 1);
 
 $_CLASS['core_db']-&gt;add_table_index('topic_id', 'primary');
@@ -625,7 +638,7 @@
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('mark_time', 0, $time_field);
+field_unix_time('mark_time');
 
 $_CLASS['core_db']-&gt;add_table_index('user_id');
 $_CLASS['core_db']-&gt;add_table_index('forum_id');
@@ -652,23 +665,9 @@
 /*
 	Forums Forums Watch Table
 */
+
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'forums_watch');
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('notify_status', 0, 1);
-
-$_CLASS['core_db']-&gt;add_table_index('user_id');
-
-$_CLASS['core_db']-&gt;table_create('commit');
-
-//
-//Combine, maybe
-//
-/*
-	Forums Topics Watch Table
-*/
-$_CLASS['core_db']-&gt;table_create('start', $install_prefix.'topics_watch');
-
 $_CLASS['core_db']-&gt;add_table_field_int('forum_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('topic_id', 0, 16000000);
 $_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000);

Added: trunk/javascript/menu.js
===================================================================
--- trunk/javascript/menu.js	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/javascript/menu.js	2005-08-19 01:49:31 UTC (rev 87)
@@ -0,0 +1,151 @@
+// Menu Code by Ryan Marshall ( <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A> )
+
+/*
+* To do:
+*
+*	Add some kind of slide affect
+*	Menu generator in javascript
+*	Auto closing of menu...
+*	
+*/
+
+var active_menu = false;
+
+function get_offsets(element)
+{
+	var offsets = new Array();
+
+	offsets['top']	= element.offsetTop;
+	offsets['left']	= element.offsetLeft;
+
+	while ((element = element.offsetParent) != null)
+	{
+		offsets['top']	+= element.offsetTop;
+		offsets['left']	+= element.offsetLeft;
+	}
+
+	return offsets;
+}
+
+function menu_init(object_name)
+{
+	var menu		= document.getElementById(object_name + '_menu');
+	var object		= document.getElementById(object_name);
+
+	if (menu == null|| object == null)
+	{
+		return;
+	}
+
+	object.onclick = function()
+	{
+		/* Open or close the menu */
+		if (menu.style.display == 'none')
+		{
+			menu_show(object_name);
+		}
+		else
+		{
+			menu_hide(object_name);
+		}
+
+		return false;
+	}
+	
+/*
+	need to read more to get these working :-(
+
+	object.onmouseover = function()
+	{
+		//menu_show(object_name);
+	}
+	
+	object.onmouseout = function(e)
+	{
+		menu_hide(object_name);
+	}
+
+	menu.onmouseout = function(e)
+	{
+		menu_hide(object_name);
+	}
+
+	menu.onmouseover = function(e)
+	{
+		this.onmouseout = function(e)
+		{
+			menu_hide(object_name);
+		}
+
+		e.preventDefault();
+		e.stopPropagation();
+	}
+
+	menu.onmouseout = function()
+	{
+		menu_hide(object_name);
+	}
+*/
+
+	menu.style.display	= 'none';
+	menu.style.position	= 'absolute';
+	menu.style.zIndex = 1000;
+	object.style.cursor = 'pointer';
+}
+
+function menu_show(object_name)
+{
+	var menu		= document.getElementById(object_name + '_menu');
+	var object		= document.getElementById(object_name);
+
+	if (menu == null|| object == null)
+	{
+		return;
+	}
+
+	// If a menu is open, lets close it
+	if (active_menu)
+	{
+		menu_hide(active_menu);
+	}
+
+	active_menu = object_name;
+
+	// best to do this everytime, incase the windows is resized
+	var object_offsets = get_offsets(object);
+
+	menu.style.display	= '';
+	
+//Move to init function, once done
+	menu.style.position	= 'absolute';
+
+	if ((object_offsets['left'] + menu.offsetWidth) &gt; document.body.clientWidth)
+	{
+		// It to wide to show on the right so we have to put it on the left
+		menu.style.left = (object_offsets['left'] + object.offsetWidth - menu.offsetWidth) + 'px';
+	}
+	else
+	{
+		menu.style.left = object_offsets['left'] + 'px';
+	}
+
+	menu.style.top = (object_offsets['top'] + object.offsetHeight) + 'px';
+}
+
+function menu_hide(object_name)
+{
+	if (!object_name)
+	{
+		object_name = active_menu;
+	}
+
+	var menu		= document.getElementById(object_name + '_menu');
+	var object		= document.getElementById(object_name);
+
+	if (active_menu == object_name)
+	{
+		active_menu = false;
+	}
+	
+	menu.style.display = 'none';	
+}
\ No newline at end of file

Modified: trunk/modules/Control_Panel/ucp/ucp_zebra.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_zebra.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/modules/Control_Panel/ucp/ucp_zebra.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -59,11 +59,11 @@
 				$data['add'] = array_diff($data['add'], $friends, $foes, array($_CLASS['core_user']-&gt;data['username']));
 				unset($friends, $foes);
 
-				$data['add'] = implode(', ', preg_replace('#^[\s]*?(.*?)[\s]*?$#e', &quot;\&quot;'\&quot; . \$_CLASS['core_db']-&gt;sql_escape('\\1') . \&quot;'\&quot;&quot;, $data['add']));
+				$data['add'] = &quot;'&quot;.implode(&quot;', '&quot;, $_CLASS['core_db']-&gt;escape_array($data['add'])).&quot;'&quot;;
 
 				if ($data['add'])
 				{
-					$sql = 'SELECT user_id, user_type
+					$sql = 'SELECT user_id, user_type, user_status
 						FROM ' . USERS_TABLE . ' 
 						WHERE username IN (' . $data['add'] . ')';
 					$result = $_CLASS['core_db']-&gt;query($sql);
@@ -73,7 +73,7 @@
 						$user_id_ary = array();
 						do
 						{
-							if (!in_array($row['user_type'], array(USER_IGNORE, USER_INACTIVE, USER_BOT_ACTIVE, USER_BOT_INACTIVE)))
+							if ($row['user_type'] == USER_NORMAL &amp;&amp; $row['user_status'] == STATUS_ACTIVE)
 							{
 								$user_id_ary[] = $row['user_id'];
 							}

Modified: trunk/modules/Forums/faq.php
===================================================================
--- trunk/modules/Forums/faq.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/modules/Forums/faq.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -1,129 +1,106 @@
 &lt;?php
-//**************************************************************//
-//  Vipeal CMS:													//
-//**************************************************************//
-//																//
-//  Copyright &#169; 2004 by Viperal									//
-//  <A HREF="http://www.viperal.com">http://www.viperal.com</A>										//
-//																//
-//  Viperal CMS is released under the terms and conditions		//
-//  of the GNU General Public License version 2					//
-//																//
-//**************************************************************//
+/*
+||**************************************************************||
+||  Viperal CMS &#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
-// -------------------------------------------------------------
-//
-// $Id: faq.php,v 1.27 2004/07/08 22:40:42 acydburn Exp $
-//
-// FILENAME  : faq.php 
-// STARTED   : Mon Jul 8, 2001
-// COPYRIGHT : &#169; 2001, 2003 phpBB Group
-// WWW       : <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
-// LICENCE   : GPL vs2.0 [ see /docs/COPYING ] 
-// 
-// -------------------------------------------------------------
+$Id$
+*/
 
 if (!defined('VIPERAL'))
 {
-    die();
+    die;
 }
 
-$mode = request_var('mode', '');
-
-// Load the appropriate faq file
-switch ($mode)
+if (isset($_REQUEST['mode']) &amp;&amp; $_REQUEST['mode'] == 'bbcode')
 {
-	case 'bbcode':
-		$_CLASS['core_user']-&gt;add_lang('help_bbcode','Forums');
-		$l_title = $_CLASS['core_user']-&gt;get_lang('BBCODE_GUIDE');
-		$link = '&amp;mode=bbcode';
-	break;
-
-	default:
-		$_CLASS['core_user']-&gt;add_lang('help_faq','Forums');
-		$l_title = $_CLASS['core_user']-&gt;get_lang('FAQ');
-		$link = '';
-	break;
+	$_CLASS['core_user']-&gt;add_lang('help_bbcode','Forums');
+	$l_title = $_CLASS['core_user']-&gt;get_lang('BBCODE_GUIDE');
+	$link = '&amp;mode=bbcode';
+	$mode = 'bbcode';
 }
+else
+{
+	$_CLASS['core_user']-&gt;add_lang('help_faq','Forums');
+	$l_title = $_CLASS['core_user']-&gt;get_lang('FAQ');
+	$link = $mode = '';
+}
 
-// Pull the array data from the lang pack
-$j = 0;
-$counter = 0;
-$counter_2 = 0;
-$help_block = array();
-$help_block_titles = array();
+$_CLASS['core_template']-&gt;assign_array(array(
+	'L_FAQ_TITLE'	=&gt; $l_title,
+	'S_BACK_TO_TOP'	=&gt; generate_link('Forums&amp;file=faq'.$link.'#Top')
+));
 
-foreach ($_CLASS['core_user']-&gt;lang['help'] as $help_ary)
+$id = 0;
+$next_title = false;
+
+$size = count($_CLASS['core_user']-&gt;lang['help']);
+
+for ($i = 0; $i &lt; $size; $i++)
 {
-	if ($help_ary[0] != '--')
+	if ($_CLASS['core_user']-&gt;lang['help'][$i][0] == '--')
 	{
-		$help_block[$j][$counter]['id'] = $counter_2;
-		$help_block[$j][$counter]['question'] = $help_ary[0];
-		$help_block[$j][$counter]['answer'] = $help_ary[1];
-
-		$counter++;
-		$counter_2++;
+		if ($next_title !== false)
+		{
+			$_CLASS['core_template']-&gt;assign_vars_array('faq_block', array(
+				'BLOCK_TITLE'	=&gt; $_CLASS['core_user']-&gt;lang['help'][$next_title][1],
+				'faq_row'		=&gt; $faq_row
+			));
+	
+			$_CLASS['core_template']-&gt;assign_vars_array('faq_block_link', array(
+				'BLOCK_TITLE'		=&gt; $_CLASS['core_user']-&gt;lang['help'][$next_title][1],
+				'faq_row_link'		=&gt; $faq_row_link
+			));
+		}
+		
+		$next_title = $i;
+		$faq_row = $faq_row_link = array();
 	}
 	else
 	{
-		$j = ($counter != 0) ? $j + 1 : 0;
+		$id ++;
 
-		$help_block_titles[$j] = $help_ary[1];
+		$faq_row[] = array(
+			'FAQ_QUESTION' 		=&gt; $_CLASS['core_user']-&gt;lang['help'][$i][0],
+			'FAQ_ANSWER'		=&gt; $_CLASS['core_user']-&gt;lang['help'][$i][1],
 
-		$counter = 0;
+			'U_FAQ_ID' 			=&gt; $id
+		);
+
+		$faq_row_link[] = array(
+			'FAQ_LINK' 			=&gt; $_CLASS['core_user']-&gt;lang['help'][$i][0],
+			'U_FAQ_LINK'		=&gt; generate_link('Forums&amp;file=faq'.$link.'#' . $id)
+		);
 	}
 }
 
-//
-// Lets build a page ...
-$_CLASS['core_template']-&gt;assign('L_FAQ_TITLE', $l_title);
-
-$size = sizeof($help_block);
-for ($i = 0, $size; $i &lt; $size; $i++)
+if ($next_title !== false)
 {
-	if (sizeof($help_block[$i]))
-	{
-		$_size = sizeof($help_block[$i]);
-		$faq_row_link = $faq_row = array();
-		
-		for ($j = 0; $j &lt; $_size; $j++)
-		{
-			$faq_row[] = array(
-				'FAQ_SECTION' 		=&gt; $i,
-				'FAQ_QUESTION' 		=&gt; $help_block[$i][$j]['question'],
-				'FAQ_ANSWER'		=&gt; $help_block[$i][$j]['answer'],
-
-				'U_FAQ_ID' 			=&gt; $help_block[$i][$j]['id']
-			);
-
-			$faq_row_link[] = array(
-				'FAQ_LINK' 			=&gt; $help_block[$i][$j]['question'],
-				'FAQ_SECTION' 		=&gt; $i,
-				'U_FAQ_LINK'		=&gt; generate_link('Forums&amp;file=faq'.$link.'#' . $help_block[$i][$j]['id'])
-			);
-		}
-		
-		$_CLASS['core_template']-&gt;assign_vars_array('faq_block', array(
-			'BLOCK_TITLE'	=&gt; $help_block_titles[$i],
-			'faq_row'		=&gt; $faq_row
-		));
-
-		$_CLASS['core_template']-&gt;assign_vars_array('faq_block_link', array(
-			'BLOCK_TITLE'		=&gt; $help_block_titles[$i],
-			'faq_row_link'		=&gt; $faq_row_link
-		));
-		
-	}
+	$_CLASS['core_template']-&gt;assign_vars_array('faq_block', array(
+		'BLOCK_TITLE'	=&gt; $_CLASS['core_user']-&gt;lang['help'][$next_title][1],
+		'faq_row'		=&gt; $faq_row
+	));
+	
+	$_CLASS['core_template']-&gt;assign_vars_array('faq_block_link', array(
+		'BLOCK_TITLE'		=&gt; $_CLASS['core_user']-&gt;lang['help'][$next_title][1],
+		'faq_row_link'		=&gt; $faq_row_link
+	));
 }
 
-$_CLASS['core_template']-&gt;assign(array(
-	'L_BACK_TO_TOP'			=&gt; $_CLASS['core_user']-&gt;lang['BACK_TO_TOP'],
-	'L_JUMP_TO'				=&gt; $_CLASS['core_user']-&gt;lang['JUMP_TO'],
-	'L_GO'					=&gt; $_CLASS['core_user']-&gt;lang['GO'],
-	'S_BACK_TO_TOP'			=&gt; generate_link('Forums&amp;file=faq'.$link.'#Top')
-));
-
-
 $_CLASS['core_template']-&gt;assign('DISPLAY_STYLESHEET_LINK', ($mode == 'bbcode'));
 
 page_header();

Modified: trunk/modules/Forums/posting.php
===================================================================
--- trunk/modules/Forums/posting.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/modules/Forums/posting.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -420,7 +420,7 @@
 		WHERE user_id = &quot; . $_CLASS['core_user']-&gt;data['user_id']);
 
 	$_CLASS['core_db']-&gt;transaction('commit');
-	
+
 	markread('topic', $forum_id, $topic_id, $current_time);
 
 	add_log('mod', $forum_id, $topic_id, sprintf($_CLASS['core_user']-&gt;lang['LOGM_BUMP'], $topic_title));

Modified: trunk/modules/Forums/viewforum.php
===================================================================
--- trunk/modules/Forums/viewforum.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/modules/Forums/viewforum.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -145,7 +145,7 @@
 	// Handle marking posts
 	if ($mark_read == 'topics')
 	{
-		markread('mark', $forum_id);
+		markread('forum', $forum_id);
 		
 		$_CLASS['core_display']-&gt;meta_refresh(3, generate_link('Forums&amp;file=viewforum&amp;f='.$forum_id));
 
@@ -391,7 +391,7 @@
 			{
 				if ($mark_forum_read)
 				{
-					//$mark_forum_read = ($row['topic_last_post_time'] &lt; $mark_time_topic) ? (int) max($mark_time_topic, $row['topic_last_post_time']) : false;
+					$mark_forum_read = ($row['topic_last_post_time'] &lt;= $mark_time_topic) ? (int) $mark_time_topic : false;
 				}
 				$mark_time = $mark_time_topic;
 			}
@@ -470,7 +470,7 @@
 	// Update the marktime only if $mark_forum_read is set to a time
 	if ($forum_data['forum_type'] == FORUM_POST &amp;&amp; is_int($mark_forum_read))
 	{
-		markread('forum', $forum_id, 0, $mark_forum_read);
+		markread('forum', $forum_id, false, $mark_forum_read);
 	}
 }
 else

Modified: trunk/modules/Forums/viewtopic.php
===================================================================
--- trunk/modules/Forums/viewtopic.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/modules/Forums/viewtopic.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -58,9 +58,6 @@
 $sort_key	= request_var('sk', ((!empty($_CLASS['core_user']-&gt;data['user_post_sortby_type'])) ? $_CLASS['core_user']-&gt;data['user_post_sortby_type'] : 't'));
 $sort_dir	= request_var('sd', ((!empty($_CLASS['core_user']-&gt;data['user_post_sortby_dir'])) ? $_CLASS['core_user']-&gt;data['user_post_sortby_dir'] : 'a'));
 
-// Find topic id if user requested a newer or older topic
-$unread_post_id = 0;
-
 if ($topic_id)
 {
 	$sql = 'SELECT forum_id, topic_last_post_time FROM ' . FORUMS_TOPICS_TABLE . '
@@ -85,80 +82,48 @@
 $topic_id = ($topic_id) ? $topic_id : $row['topic_id'];
 $topic_last_post_time = isset($row['topic_last_post_time']) ? $row['topic_last_post_time'] : false;
 
-if ($view)
+if ($view == 'next' || $view == 'previous')
 {
-	if ($view == 'unread')
+	if ($view == 'next')
 	{
-		$topic_last_read = topic_last_read($topic_id, $forum_id);
+		$sql_condition = '&gt;';
+		$sql_ordering = 'ASC';
+	}
+	else
+	{
+		$sql_condition = '&lt;';
+		$sql_ordering = 'DESC';
+	}
 
-		$sql = 'SELECT p.post_id, p.topic_id, p.forum_id
-			FROM (' . POSTS_TABLE . ' p, ' . TOPICS_TABLE . &quot; t)
-			WHERE t.topic_id = $topic_id
-				AND p.topic_id = t.topic_id
-				&quot; . (($_CLASS['auth']-&gt;acl_get('m_approve', $forum_id)) ? '' : 'AND p.post_approved = 1') . &quot;
-				AND p.post_time &gt; $topic_last_read
-			ORDER BY p.post_time ASC&quot;;
-		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+	if (!$topic_last_post_time)
+	{
+		$sql = 'SELECT topic_last_post_time FROM ' . FORUMS_TOPICS_TABLE . '
+					WHERE topic_id = '.$topic_id;
+
+		$result = $_CLASS['core_db']-&gt;query($sql);
+		list($topic_last_post_time) = $_CLASS['core_db']-&gt;fetch_row_num($result);
 		$_CLASS['core_db']-&gt;free_result($result);
+	}
 
-		if (!$row)
-		{
-			// Setup user environment so we can process lang string
-			$_CLASS['core_user']-&gt;add_lang('viewtopic');
+	$sql = 'SELECT topic_id, forum_id
+		FROM ' . FORUMS_TOPICS_TABLE . &quot;
+		 WHERE forum_id = $forum_id AND topic_last_post_time $sql_condition $topic_last_post_time&quot;
+		 . ($_CLASS['auth']-&gt;acl_get('m_approve', $forum_id) ? '' : ' AND topic_approved = 1') . &quot;
+		ORDER BY topic_last_post_time $sql_ordering&quot;;
 
-			$_CLASS['core_display']-&gt;meta_refresh(3, generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&quot;));
-			$message = $_CLASS['core_user']-&gt;lang['NO_UNREAD_POSTS'] . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_TOPIC'], '&lt;a href=&quot;'.generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&quot;).'&quot;&gt;', '&lt;/a&gt;');
-			trigger_error($message);
-		}
+	$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
+	$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+	$_CLASS['core_db']-&gt;free_result($result);
 
-		$unread_post_id = $post_id = $row['post_id'];
-		$topic_id = $row['topic_id'];
+	if (!$row)
+	{
+		$message = ($view == 'next') ? 'NO_NEWER_TOPICS' : 'NO_OLDER_TOPICS';
+		trigger_error($message);
 	}
-	elseif ($view == 'next' || $view == 'previous')
+	else
 	{
-		if ($view == 'next')
-		{
-			$sql_condition = '&gt;';
-			$sql_ordering = 'ASC';
-		}
-		else
-		{
-			$sql_condition = '&lt;';
-			$sql_ordering = 'DESC';
-		}
-
-		if (!$topic_last_post_time)
-		{
-			$sql = 'SELECT topic_last_post_time FROM ' . FORUMS_TOPICS_TABLE . '
-						WHERE topic_id = '.$topic_id;
-
-			$result = $_CLASS['core_db']-&gt;query($sql);
-			list($topic_last_post_time) = $_CLASS['core_db']-&gt;fetch_row_num($result);
-			$_CLASS['core_db']-&gt;free_result($result);
-		}
-
-// should we only find the next topic with in the forum ?
-		$sql = 'SELECT topic_id, forum_id
-			FROM ' . FORUMS_TOPICS_TABLE . &quot;
-			 WHERE forum_id = $forum_id AND topic_last_post_time $sql_condition $topic_last_post_time&quot;
-			 . ($_CLASS['auth']-&gt;acl_get('m_approve', $forum_id) ? '' : ' AND topic_approved = 1') . &quot;
-			ORDER BY topic_last_post_time $sql_ordering&quot;;
-	
-		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-		$_CLASS['core_db']-&gt;free_result($result);
-
-		if (!$row)
-		{
-			$message = ($view == 'next') ? 'NO_NEWER_TOPICS' : 'NO_OLDER_TOPICS';
-			trigger_error($message);
-		}
-		else
-		{
-			$topic_id = $row['topic_id'];
-			$forum_id = $row['forum_id'];
-		}
+		$topic_id = $row['topic_id'];
+		$forum_id = $row['forum_id'];
 	}
 }
 
@@ -385,87 +350,6 @@
 
 gen_forum_auth_level('topic', $forum_id);
 
-// Quick mod tools
-$topic_mod = '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_lock', $forum_id) || ($_CLASS['auth']-&gt;acl_get('f_user_lock', $forum_id) &amp;&amp; $_CLASS['core_user']-&gt;data['user_id'] != ANONYMOUS &amp;&amp; $_CLASS['core_user']-&gt;data['user_id'] == $topic_data['topic_poster'])) ? (($topic_data['topic_status'] == ITEM_UNLOCKED) ? '&lt;option value=&quot;lock&quot;&gt;' . $_CLASS['core_user']-&gt;lang['LOCK_TOPIC'] . '&lt;/option&gt;' : '&lt;option value=&quot;unlock&quot;&gt;' . $_CLASS['core_user']-&gt;lang['UNLOCK_TOPIC'] . '&lt;/option&gt;') : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_delete', $forum_id)) ? '&lt;option value=&quot;delete_topic&quot;&gt;' . $_CLASS['core_user']-&gt;lang['DELETE_TOPIC'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_move', $forum_id)) ? '&lt;option value=&quot;move&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MOVE_TOPIC'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_split', $forum_id)) ? '&lt;option value=&quot;split&quot;&gt;' . $_CLASS['core_user']-&gt;lang['SPLIT_TOPIC'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_merge', $forum_id)) ? '&lt;option value=&quot;merge&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MERGE_TOPIC'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? '&lt;option value=&quot;fork&quot;&gt;' . $_CLASS['core_user']-&gt;lang['FORK_TOPIC'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_NORMAL) ? '&lt;option value=&quot;make_normal&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_NORMAL'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('f_sticky', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_STICKY) ? '&lt;option value=&quot;make_sticky&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_STICKY'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('f_announce', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_ANNOUNCE) ? '&lt;option value=&quot;make_announce&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_ANNOUNCE'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('f_announce', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_GLOBAL) ? '&lt;option value=&quot;make_global&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_GLOBAL'] . '&lt;/option&gt;' : '';
-$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? '&lt;option value=&quot;viewlogs&quot;&gt;' . $_CLASS['core_user']-&gt;lang['VIEW_TOPIC_LOGS'] . '&lt;/option&gt;' : '';
-
-$pagination = generate_pagination(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;$u_sort_param&quot; . (($highlight_match) ? &quot;&amp;hilit=$highlight&quot; : ''), $total_posts, $config['posts_per_page'], $start);
-
-// Send vars to template
-$_CLASS['core_template']-&gt;assign_array(array(
-	'FORUM_ID' 		=&gt; $forum_id,
-	'FORUM_NAME' 	=&gt; $topic_data['forum_name'],
-	'FORUM_DESC'	=&gt; $topic_data['forum_desc'],
-	'TOPIC_ID' 		=&gt; $topic_id,
-	'TOPIC_TITLE' 	=&gt; censor_text($topic_data['topic_title']),
-	'PAGINATION'		=&gt; $pagination['formated'],
-	'PAGINATION_ARRAY'	=&gt; $pagination['array'],
-	'PAGE_NUMBER' 	=&gt; on_page($total_posts, $config['posts_per_page'], $start),
-	'TOTAL_POSTS'	=&gt; ($total_posts == 1) ? $_CLASS['core_user']-&gt;lang['VIEW_TOPIC_POST'] : sprintf($_CLASS['core_user']-&gt;lang['VIEW_TOPIC_POSTS'], $total_posts), 
-	'U_MCP' 		=&gt; ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? generate_link(&quot;Forums&amp;file=mcp&amp;mode=topic_view&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param&quot;, false, false) : '',
-
-	'MODERATORS'	=&gt; (isset($forum_moderators[$forum_id]) &amp;&amp; sizeof($forum_moderators[$forum_id])) ? implode(', ', $forum_moderators[$forum_id]) : '',
-
-	'POST_IMG' 		=&gt; ($topic_data['forum_status'] == ITEM_LOCKED) ? $_CLASS['core_user']-&gt;img('btn_locked', 'FORUM_LOCKED') : $_CLASS['core_user']-&gt;img('btn_post', 'POST_NEW_TOPIC'),
-	'QUOTE_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_quote', 'REPLY_WITH_QUOTE'),
-	'REPLY_IMG'		=&gt; ($topic_data['forum_status'] == ITEM_LOCKED || $topic_data['topic_status'] == ITEM_LOCKED) ? $_CLASS['core_user']-&gt;img('btn_locked', 'TOPIC_LOCKED') : $_CLASS['core_user']-&gt;img('btn_reply', 'REPLY_TO_TOPIC'),
-	'EDIT_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_edit', 'EDIT_POST'),
-	'DELETE_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_delete', 'DELETE_POST'),
-	'INFO_IMG'		=&gt; $_CLASS['core_user']-&gt;img('btn_info', 'VIEW_INFO'),
-	'PROFILE_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_profile', 'READ_PROFILE'), 
-	'SEARCH_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_search', 'SEARCH_USER_POSTS'),
-	'PM_IMG'		=&gt; $_CLASS['core_user']-&gt;img('btn_pm', 'SEND_PRIVATE_MESSAGE'),
-	'EMAIL_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_email', 'SEND_EMAIL'),
-	'WWW_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_www', 'VISIT_WEBSITE'),
-	'ICQ_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_icq', 'ICQ'),
-	'AIM_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_aim', 'AIM'),
-	'MSN_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_msnm', 'MSNM'),
-	'YIM_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_yim', 'YIM'),
-	'JABBER_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_jabber', 'JABBER') ,
-	'REPORT_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_report', 'REPORT_POST'),
-	'REPORTED_IMG'	=&gt; $_CLASS['core_user']-&gt;img('icon_reported', 'POST_REPORTED'),
-	'UNAPPROVED_IMG'=&gt; $_CLASS['core_user']-&gt;img('icon_unapproved', 'POST_UNAPPROVED'),
-	
-	'S_SELECT_SORT_DIR' 	=&gt; $s_sort_dir,
-	'S_SELECT_SORT_KEY' 	=&gt; $s_sort_key,
-	'S_SELECT_SORT_DAYS' 	=&gt; $s_limit_days,
-	'S_TOPIC_ACTION' 		=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;start=$start&quot;),
-	'S_TOPIC_MOD' 			=&gt; ($topic_mod != '') ? '&lt;select name=&quot;mode&quot;&gt;' . $topic_mod . '&lt;/select&gt;' : '',
-	'S_MOD_ACTION' 			=&gt; generate_link(&quot;Forums&amp;file=mcp&amp;t=$topic_id&amp;quickmod=1&quot;, false, false), 
-
-	'S_DISPLAY_SEARCHBOX'	=&gt; ($_CLASS['auth']-&gt;acl_get('f_search', $forum_id)) ? true : false, 
-	'S_SEARCHBOX_ACTION'	=&gt; generate_link('Forums&amp;file=search&amp;search_forum[]='.$forum_id), 
-
-	'U_TOPIC'				=&gt; ($view == 'print') ? generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id, array('full' =&gt; true)) : generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id),
-	'U_VIEW_UNREAD_POST'	=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=unread&quot;).'#unread',
-	'U_VIEW_TOPIC' 			=&gt; generate_link($viewtopic_url, false),
-	'U_VIEW_FORUM' 			=&gt; generate_link('Forums&amp;file=viewforum&amp;f='.$forum_id),
-	'U_VIEW_OLDER_TOPIC'	=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=previous&quot;),
-	'U_VIEW_NEWER_TOPIC'	=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=next&quot;),
-	'U_PRINT_TOPIC'			=&gt; ($_CLASS['auth']-&gt;acl_get('f_print', $forum_id)) ? generate_link($viewtopic_url . '&amp;view=print', false) : '',
-	'U_EMAIL_TOPIC'			=&gt; ($_CLASS['auth']-&gt;acl_get('f_email', $forum_id) &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('Members_List&amp;mode=email&amp;t='.$topic_id) : '', 
-
-	'U_WATCH_TOPIC' 		=&gt; $s_watching_topic['link'], 
-	'L_WATCH_TOPIC' 		=&gt; $s_watching_topic['title'], 
-
-	'U_BOOKMARK_TOPIC'		=&gt; ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['allow_bookmarks']) ? generate_link($viewtopic_url . '&amp;bookmark=1', false) : '',
-	'L_BOOKMARK_TOPIC'		=&gt; ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['allow_bookmarks'] &amp;&amp; $topic_data['bookmarked']) ? $_CLASS['core_user']-&gt;lang['BOOKMARK_TOPIC_REMOVE'] : $_CLASS['core_user']-&gt;lang['BOOKMARK_TOPIC'],
-	
-	'U_POST_NEW_TOPIC' 		=&gt; generate_link('Forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id),
-	'U_POST_REPLY_TOPIC' 	=&gt; generate_link(&quot;Forums&amp;file=posting&amp;mode=reply&amp;t=$topic_id&quot;),
-	'U_BUMP_TOPIC'			=&gt; (bump_topic_allowed($forum_id, $topic_data['topic_bumped'], $topic_data['topic_last_post_time'], $topic_data['topic_poster'], $topic_data['topic_last_poster_id'])) ? generate_link(&quot;Forums&amp;file=posting&amp;mode=bump&amp;t=$topic_id&quot;) : '')
-);
-
 // Does this topic contain a poll?
 if (!empty($poll_start))
 {
@@ -1016,11 +900,13 @@
 
 $i_total = count($rowset) - 1;
 $prev_post_id = '';
+$first_unread_makred = false;
 
 $_CLASS['core_template']-&gt;assign('S_NUM_POSTS', count($post_list));
 
 // Output the posts
 //foreach ($rowset as $i =&gt; $row)
+
 for ($i = 0, $end = sizeof($post_list); $i &lt; $end; ++$i)
 {
 	$row =&amp; $rowset[$post_list[$i]];
@@ -1226,21 +1112,106 @@
 		'S_DISPLAY_NOTICE'	=&gt; ($display_notice &amp;&amp; $row['post_attachment']) ? true : false, 
 		'S_FRIEND'			=&gt; ($row['friend']) ? true : false,
 		'S_UNREAD_POST'		=&gt; $unread,
-		'S_FIRST_UNREAD'	=&gt; ($unread_post_id == $row['post_id']) ? true : false,
+		'S_FIRST_UNREAD'	=&gt; false,
 	);
 
+	if ($unread &amp;&amp; !$first_unread_makred)
+	{
+		$postrow['S_FIRST_UNREAD'] = true;
+		$first_unread_makred = true;
+	}
+
 	// Dump vars into template
 	$_CLASS['core_template']-&gt;assign_vars_array('postrow', $postrow);
 	
 	$prev_post_id = $row['post_id'];
 
-	unset($rowset[$i], $post_attachments);
-	unset($attachments[$row['post_id']]);
+	unset($rowset[$i], $post_attachments, $attachments[$row['post_id']]);
 }
 
-unset($rowset);
-unset($user_cache);
+unset($rowset, $user_cache);
 
+// Quick mod tools
+$topic_mod = '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_lock', $forum_id) || ($_CLASS['auth']-&gt;acl_get('f_user_lock', $forum_id) &amp;&amp; $_CLASS['core_user']-&gt;data['user_id'] != ANONYMOUS &amp;&amp; $_CLASS['core_user']-&gt;data['user_id'] == $topic_data['topic_poster'])) ? (($topic_data['topic_status'] == ITEM_UNLOCKED) ? '&lt;option value=&quot;lock&quot;&gt;' . $_CLASS['core_user']-&gt;lang['LOCK_TOPIC'] . '&lt;/option&gt;' : '&lt;option value=&quot;unlock&quot;&gt;' . $_CLASS['core_user']-&gt;lang['UNLOCK_TOPIC'] . '&lt;/option&gt;') : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_delete', $forum_id)) ? '&lt;option value=&quot;delete_topic&quot;&gt;' . $_CLASS['core_user']-&gt;lang['DELETE_TOPIC'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_move', $forum_id)) ? '&lt;option value=&quot;move&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MOVE_TOPIC'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_split', $forum_id)) ? '&lt;option value=&quot;split&quot;&gt;' . $_CLASS['core_user']-&gt;lang['SPLIT_TOPIC'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_merge', $forum_id)) ? '&lt;option value=&quot;merge&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MERGE_TOPIC'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? '&lt;option value=&quot;fork&quot;&gt;' . $_CLASS['core_user']-&gt;lang['FORK_TOPIC'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_NORMAL) ? '&lt;option value=&quot;make_normal&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_NORMAL'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('f_sticky', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_STICKY) ? '&lt;option value=&quot;make_sticky&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_STICKY'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('f_announce', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_ANNOUNCE) ? '&lt;option value=&quot;make_announce&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_ANNOUNCE'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('f_announce', $forum_id) &amp;&amp; $topic_data['topic_type'] != POST_GLOBAL) ? '&lt;option value=&quot;make_global&quot;&gt;' . $_CLASS['core_user']-&gt;lang['MAKE_GLOBAL'] . '&lt;/option&gt;' : '';
+$topic_mod .= ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? '&lt;option value=&quot;viewlogs&quot;&gt;' . $_CLASS['core_user']-&gt;lang['VIEW_TOPIC_LOGS'] . '&lt;/option&gt;' : '';
+
+$pagination = generate_pagination(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;$u_sort_param&quot; . (($highlight_match) ? &quot;&amp;hilit=$highlight&quot; : ''), $total_posts, $config['posts_per_page'], $start);
+
+// Send vars to template
+$_CLASS['core_template']-&gt;assign_array(array(
+	'FORUM_ID' 			=&gt; $forum_id,
+	'FORUM_NAME' 		=&gt; $topic_data['forum_name'],
+	'FORUM_DESC'		=&gt; $topic_data['forum_desc'],
+	'TOPIC_ID' 			=&gt; $topic_id,
+	'TOPIC_TITLE' 		=&gt; censor_text($topic_data['topic_title']),
+	'PAGINATION'		=&gt; $pagination['formated'],
+	'PAGINATION_ARRAY'	=&gt; $pagination['array'],
+	'PAGE_NUMBER' 		=&gt; on_page($total_posts, $config['posts_per_page'], $start),
+	'TOTAL_POSTS'		=&gt; ($total_posts == 1) ? $_CLASS['core_user']-&gt;lang['VIEW_TOPIC_POST'] : sprintf($_CLASS['core_user']-&gt;lang['VIEW_TOPIC_POSTS'], $total_posts), 
+	'U_MCP' 			=&gt; ($_CLASS['auth']-&gt;acl_get('m_', $forum_id)) ? generate_link(&quot;Forums&amp;file=mcp&amp;mode=topic_view&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param&quot;, false, false) : '',
+
+	'MODERATORS'	=&gt; (isset($forum_moderators[$forum_id]) &amp;&amp; sizeof($forum_moderators[$forum_id])) ? implode(', ', $forum_moderators[$forum_id]) : '',
+
+	'POST_IMG' 		=&gt; ($topic_data['forum_status'] == ITEM_LOCKED) ? $_CLASS['core_user']-&gt;img('btn_locked', 'FORUM_LOCKED') : $_CLASS['core_user']-&gt;img('btn_post', 'POST_NEW_TOPIC'),
+	'QUOTE_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_quote', 'REPLY_WITH_QUOTE'),
+	'REPLY_IMG'		=&gt; ($topic_data['forum_status'] == ITEM_LOCKED || $topic_data['topic_status'] == ITEM_LOCKED) ? $_CLASS['core_user']-&gt;img('btn_locked', 'TOPIC_LOCKED') : $_CLASS['core_user']-&gt;img('btn_reply', 'REPLY_TO_TOPIC'),
+	'EDIT_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_edit', 'EDIT_POST'),
+	'DELETE_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_delete', 'DELETE_POST'),
+	'INFO_IMG'		=&gt; $_CLASS['core_user']-&gt;img('btn_info', 'VIEW_INFO'),
+	'PROFILE_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_profile', 'READ_PROFILE'), 
+	'SEARCH_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_search', 'SEARCH_USER_POSTS'),
+	'PM_IMG'		=&gt; $_CLASS['core_user']-&gt;img('btn_pm', 'SEND_PRIVATE_MESSAGE'),
+	'EMAIL_IMG' 	=&gt; $_CLASS['core_user']-&gt;img('btn_email', 'SEND_EMAIL'),
+	'WWW_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_www', 'VISIT_WEBSITE'),
+	'ICQ_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_icq', 'ICQ'),
+	'AIM_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_aim', 'AIM'),
+	'MSN_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_msnm', 'MSNM'),
+	'YIM_IMG' 		=&gt; $_CLASS['core_user']-&gt;img('btn_yim', 'YIM'),
+	'JABBER_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_jabber', 'JABBER') ,
+	'REPORT_IMG'	=&gt; $_CLASS['core_user']-&gt;img('btn_report', 'REPORT_POST'),
+	'REPORTED_IMG'	=&gt; $_CLASS['core_user']-&gt;img('icon_reported', 'POST_REPORTED'),
+	'UNAPPROVED_IMG'=&gt; $_CLASS['core_user']-&gt;img('icon_unapproved', 'POST_UNAPPROVED'),
+	
+	'S_SELECT_SORT_DIR' 	=&gt; $s_sort_dir,
+	'S_SELECT_SORT_KEY' 	=&gt; $s_sort_key,
+	'S_SELECT_SORT_DAYS' 	=&gt; $s_limit_days,
+	'S_TOPIC_ACTION' 		=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;start=$start&quot;),
+	'S_TOPIC_MOD' 			=&gt; ($topic_mod) ? '&lt;select name=&quot;mode&quot;&gt;' . $topic_mod . '&lt;/select&gt;' : '',
+	'S_MOD_ACTION' 			=&gt; generate_link(&quot;Forums&amp;file=mcp&amp;t=$topic_id&amp;quickmod=1&quot;, false, false), 
+
+	'S_DISPLAY_SEARCHBOX'	=&gt; ($_CLASS['auth']-&gt;acl_get('f_search', $forum_id)) ? true : false, 
+	'S_SEARCHBOX_ACTION'	=&gt; generate_link('Forums&amp;file=search&amp;search_forum[]='.$forum_id), 
+
+	'U_TOPIC'				=&gt; ($view == 'print') ? generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id, array('full' =&gt; true)) : generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id),
+	'U_VIEW_UNREAD_POST'	=&gt; ($first_unread_makred) ? generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id#unread&quot;) : false,
+	'U_VIEW_TOPIC' 			=&gt; generate_link($viewtopic_url),
+	'U_VIEW_FORUM' 			=&gt; generate_link('Forums&amp;file=viewforum&amp;f='.$forum_id),
+	'U_VIEW_OLDER_TOPIC'	=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=previous&quot;),
+	'U_VIEW_NEWER_TOPIC'	=&gt; generate_link(&quot;Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=next&quot;),
+	'U_PRINT_TOPIC'			=&gt; ($_CLASS['auth']-&gt;acl_get('f_print', $forum_id)) ? generate_link($viewtopic_url . '&amp;view=print') : '',
+	'U_EMAIL_TOPIC'			=&gt; ($_CLASS['auth']-&gt;acl_get('f_email', $forum_id) &amp;&amp; $_CORE_CONFIG['email']['email_enable']) ? generate_link('Members_List&amp;mode=email&amp;t='.$topic_id) : '', 
+
+	'U_WATCH_TOPIC' 		=&gt; $s_watching_topic['link'], 
+	'L_WATCH_TOPIC' 		=&gt; $s_watching_topic['title'], 
+
+	'U_BOOKMARK_TOPIC'		=&gt; ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['allow_bookmarks']) ? generate_link($viewtopic_url . '&amp;bookmark=1') : '',
+	'L_BOOKMARK_TOPIC'		=&gt; ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['allow_bookmarks'] &amp;&amp; $topic_data['bookmarked']) ? $_CLASS['core_user']-&gt;lang['BOOKMARK_TOPIC_REMOVE'] : $_CLASS['core_user']-&gt;lang['BOOKMARK_TOPIC'],
+	
+	'U_POST_NEW_TOPIC' 		=&gt; generate_link('Forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id),
+	'U_POST_REPLY_TOPIC' 	=&gt; generate_link(&quot;Forums&amp;file=posting&amp;mode=reply&amp;t=$topic_id&quot;),
+	'U_BUMP_TOPIC'			=&gt; (bump_topic_allowed($forum_id, $topic_data['topic_bumped'], $topic_data['topic_last_post_time'], $topic_data['topic_poster'], $topic_data['topic_last_poster_id'])) ? generate_link(&quot;Forums&amp;file=posting&amp;mode=bump&amp;t=$topic_id&quot;) : '')
+);
+
 // Update topic view and if necessary attachment view counters ... but only
 // if this is the first 'page view'
 

Modified: trunk/modules/Members_List/index.php
===================================================================
--- trunk/modules/Members_List/index.php	2005-08-17 19:08:38 UTC (rev 86)
+++ trunk/modules/Members_List/index.php	2005-08-19 01:49:31 UTC (rev 87)
@@ -36,7 +36,7 @@
 $_CLASS['core_user']-&gt;add_lang();
 $_CLASS['core_user']-&gt;add_img(false, 'Forums');
 
-$_CLASS['core_template']-&gt;assign(array(
+$_CLASS['core_template']-&gt;assign_array(array(
 	'S_SEARCH_USER'	=&gt; false,
 	'S_SHOW_GROUP'	=&gt; false
 	));
@@ -157,13 +157,11 @@
 		}
 		$_CLASS['core_db']-&gt;free_result($result);
 
-		$_CLASS['core_template']-&gt;assign(array(
-			'PM_IMG'		=&gt; $_CLASS['core_user']-&gt;img('btn_pm', $_CLASS['core_user']-&gt;lang['MESSAGE']))
-		);
+		$_CLASS['core_template']-&gt;assign('PM_IMG', $_CLASS['core_user']-&gt;img('btn_pm', $_CLASS['core_user']-&gt;lang['MESSAGE']));
 		break;
 
 	case 'contact':
-		$_CLASS['core_template']-&gt;assign(array(
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'S_SEND_ICQ'	=&gt; false,
 			'S_SEND_AIM'	=&gt; false,
 			'S_SEND_JABBER' =&gt; false,
@@ -218,7 +216,7 @@
 		$sql = &quot;SELECT user_id, username, user_email, user_lang, $sql_field
 			FROM &quot; . USERS_TABLE . &quot;
 			WHERE user_id = $user_id
-				AND user_type = &quot; . USER_NORMAL;
+				AND user_type = &quot; . USER_NORMAL .' AND user_status = ' . STATUS_ACTIVE;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		if (!($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result)))
@@ -267,8 +265,7 @@
 				break;
 		}
 
-		$_CLASS['core_template']-&gt;assign(array(
-		
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'CONTACT_NAME'	=&gt; $row[$sql_field],
 			'IM_CONTACT'	=&gt; $row[$sql_field],
 			'USERNAME'		=&gt; addslashes($row['username']),
@@ -302,14 +299,12 @@
 		$member = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 
-		if (!$member || (!$_CLASS['core_auth']-&gt;admin_power('users') &amp;&amp; $member['user_status'] != USER_ACTIVE))
+		if (!$member || (!$_CLASS['core_auth']-&gt;admin_power('users') &amp;&amp; $member['user_status'] != STATUS_ACTIVE))
 		{
 			$_CLASS['core_db']-&gt;free_result($result);
 			trigger_error(($member) ? 'USER_INACTIVE' : 'NO_USER');
 		}
 		
-		
-
 		$sql = 'SELECT g.group_id, g.group_name, g.group_type
 			FROM ' . USER_GROUP_TABLE . ' ug, ' . GROUPS_TABLE . &quot; g
 			WHERE ug.user_id = $user_id
@@ -358,7 +353,7 @@
 
 		// Grab all the relevant data
 		$sql = 'SELECT COUNT(p.post_id) AS num_posts
-			FROM ' . POSTS_TABLE . ' p, ' . FORUMS_TABLE . &quot; f
+			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_FORUMS_TABLE . &quot; f
 			WHERE p.poster_id = $user_id
 				AND f.forum_id = p.forum_id
 				$post_count_sql&quot;;
@@ -386,7 +381,7 @@
 		if ($post_count_sql)
 		{
 			$sql = 'SELECT f.forum_id, f.forum_name, COUNT(post_id) AS num_posts
-				FROM ' . POSTS_TABLE . ' p, ' . FORUMS_TABLE . &quot; f
+				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_FORUMS_TABLE . &quot; f
 				WHERE p.poster_id = $user_id
 					AND f.forum_id = p.forum_id
 					$post_count_sql
@@ -398,7 +393,7 @@
 			$_CLASS['core_db']-&gt;free_result($result);
 
 			$sql = 'SELECT t.topic_id, t.topic_title, COUNT(p.post_id) AS num_posts
-				FROM ' . POSTS_TABLE . ' p, ' . TOPICS_TABLE . ' t, ' . FORUMS_TABLE . &quot; f
+				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_TOPICS_TABLE . ' t, ' . FORUMS_FORUMS_TABLE . &quot; f
 				WHERE p.poster_id = $user_id
 					AND t.topic_id = p.topic_id
 					AND f.forum_id = t.forum_id
@@ -470,9 +465,9 @@
 			$poster_avatar = '&lt;img src=&quot;' . $poster_avatar . '&quot; width=&quot;' . $member['user_avatar_width'] . '&quot; height=&quot;' . $member['user_avatar_height'] . '&quot; border=&quot;0&quot; alt=&quot;&quot; /&gt;';
 		}
 
-		$_CLASS['core_template']-&gt;assign(show_profile($member));
+		$_CLASS['core_template']-&gt;assign_array(show_profile($member));
 		
-		$_CLASS['core_template']-&gt;assign(array(
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'POSTS_DAY'			=&gt; sprintf($_CLASS['core_user']-&gt;lang['POST_DAY'], $posts_per_day),
 			'POSTS_PCT'			=&gt; sprintf($_CLASS['core_user']-&gt;lang['POST_PCT'], $percentage),
 			'ACTIVE_FORUM'		=&gt; $active_f_name,
@@ -529,7 +524,7 @@
 		$page_title = $_CLASS['core_user']-&gt;lang['SEND_EMAIL'];
 		$template_html = 'memberlist_email.html';
 		
-		$_CLASS['core_template']-&gt;assign(array(
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'MESSAGE' =&gt; false,
 			'SUBJECT' =&gt; false)
 		);
@@ -570,7 +565,7 @@
 			$sql = 'SELECT username, user_email, user_allow_viewemail, user_lang, user_jabber, user_notify_type
 				FROM ' . USERS_TABLE . &quot;
 				WHERE user_id = $user_id
-					AND user_type = &quot;. USER_NORMAL;
+					AND user_type = &quot;. USER_NORMAL . ' AND u.user_status = ' . STATUS_ACTIVE;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
 			if (!($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result)))
@@ -588,7 +583,7 @@
 		else
 		{
 			$sql = 'SELECT forum_id, topic_title
-				FROM ' . TOPICS_TABLE . &quot;
+				FROM ' . FORUMS_TOPICS_TABLE . &quot;
 				WHERE topic_id = $topic_id&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -641,7 +636,7 @@
 			if (!sizeof($error))
 			{
 				$sql = 'UPDATE ' . USERS_TABLE . '
-					SET user_emailtime = ' . time() . '
+					SET user_emailtime = ' . gmtime() . '
 					WHERE user_id = ' . $_CLASS['core_user']-&gt;data['user_id'];
 				$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -697,7 +692,7 @@
 
 		if ($topic_id)
 		{
-			$_CLASS['core_template']-&gt;assign(array(
+			$_CLASS['core_template']-&gt;assign_array(array(
 				'EMAIL'			=&gt; htmlspecialchars($email),
 				'NAME'			=&gt; htmlspecialchars($name),
 				'TOPIC_TITLE'	=&gt; $row['topic_title'],
@@ -706,7 +701,7 @@
 				'S_LANG_OPTIONS'=&gt; ($topic_id) ? language_select($email_lang) : '')
 			);
 		}
-		$_CLASS['core_template']-&gt;assign(array(
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'USERNAME'		=&gt; (!$topic_id) ? addslashes($row['username']) : '',
 			'ERROR_MESSAGE'	=&gt; (sizeof($error)) ? implode('&lt;br /&gt;', $error) : '',
 
@@ -812,7 +807,7 @@
 				$ips = (preg_match('#[a-z]#', $ipdomain)) ? implode(', ', preg_replace('#([0-9]{1,3}\.[0-9]{1,3}[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})#', &quot;'\\1'&quot;, gethostbynamel($ipdomain))) : &quot;'&quot; . str_replace('*', '%', $ipdomain) . &quot;'&quot;;
 
 				$sql = 'SELECT DISTINCT poster_id
-					FROM ' . POSTS_TABLE . '
+					FROM ' . FORUMS_POSTS_TABLE . '
 					WHERE poster_ip ' . ((preg_match('#%#', $ips)) ? 'LIKE' : 'IN') . &quot; ($ips)&quot;;
 				$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -859,7 +854,8 @@
 			$sql = 'SELECT g.*, ug.user_id
 				FROM ' . GROUPS_TABLE . ' g
 				LEFT JOIN ' . USER_GROUP_TABLE . ' ug ON (ug.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot; AND ug.group_id = $group_id)
-				WHERE g.group_id = $group_id&quot;;
+				WHERE g.group_id = $group_id
+				AND group_status = &quot;.STATUS_ACTIVE;
 	
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			$group_row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
@@ -872,13 +868,14 @@
 
 			switch ($group_row['group_type'])
 			{
-				case GROUP_OPEN:
+// rename the lang names
+				case GROUP_REQUEST:
 					$group_row['group_type'] = 'OPEN';
-					break;
+				break;
 
 				case GROUP_CLOSED:
 					$group_row['group_type'] = 'CLOSED';
-					break;
+				break;
 
 				case GROUP_HIDDEN:
 					$group_row['group_type'] = 'HIDDEN';
@@ -888,13 +885,14 @@
 					{
 						trigger_error('NO_GROUP');
 					}
-					break;
+				break;
 
+				case GROUP_SYSTEM:
 				case GROUP_SPECIAL:
 					$group_row['group_type'] = 'SPECIAL';
-					break;
+				break;
 
-				case GROUP_FREE:
+				case GROUP_UNRESTRAINED:
 					$group_row['group_type'] = 'FREE';
 					break;
 			}
@@ -917,13 +915,14 @@
 			}
 
 			$rank_title = $rank_img = '';
-			if ($group_row['group_rank'] != -1)
+	
+			if (isset($ranks['special'][$group_row['group_rank']]))
 			{
 				$rank_title = $ranks['special'][$group_row['group_rank']]['rank_title'];
-				$rank_img = (!empty($ranks['special'][$group_row['group_rank']]['rank_image'])) ? '&lt;img src=&quot;' . $config['ranks_path'] . '/' . $ranks['special'][$group_row['group_rank']]['rank_image'] . '&quot; border=&quot;0&quot; alt=&quot;' . $ranks['special'][$group_row['group_rank']]['rank_title'] . '&quot; title=&quot;' . $ranks['special'][$group_row['group_rank']]['rank_title'] . '&quot; /&gt;&lt;br /&gt;' : '';	
+				$rank_img = empty($ranks['special'][$group_row['group_rank']]['rank_image']) ? '' : '&lt;img src=&quot;' . $config['ranks_path'] . '/' . $ranks['special'][$group_row['group_rank']]['rank_image'] . '&quot; border=&quot;0&quot; alt=&quot;' . $ranks['special'][$group_row['group_rank']]['rank_title'] . '&quot; title=&quot;' . $ranks['special'][$group_row['group_rank']]['rank_title'] . '&quot; /&gt;&lt;br /&gt;';	
 			}
 
-			$_CLASS['core_template']-&gt;assign(array(
+			$_CLASS['core_template']-&gt;assign_array(array(
 				'GROUP_DESC'    =&gt; $group_row['group_description'],
 				'GROUP_NAME'    =&gt; $group_row['group_name'],
 				'GROUP_COLOR'   =&gt; $group_row['group_colour'],
@@ -936,7 +935,7 @@
 				'U_PM'			=&gt; ($_CLASS['auth']-&gt;acl_get('u_sendpm') &amp;&amp; $group_row['group_receive_pm'] &amp;&amp; $config['allow_mass_pm']) ? generate_link('Control_Panel&amp;i=pm&amp;mode=compose&amp;g='.$group_id) : '',)
 			);
 
-			$sql_fields = ', ug.user_status';
+			$sql_fields = ', ug.member_status';
 			$sql_from = ', ' . USER_GROUP_TABLE . ' ug ';
 			$sql_where .= &quot; AND u.user_id = ug.user_id AND ug.group_id = $group_id&quot;;
 		}
@@ -949,7 +948,7 @@
 		{
 			$sql = 'SELECT COUNT(u.user_id) AS total_users
 				FROM ' . USERS_TABLE . &quot; u$sql_from
-				WHERE u.user_type = &quot; . USER_NORMAL .&quot;
+				WHERE u.user_type = &quot; . USER_NORMAL .' AND u.user_status = ' . STATUS_ACTIVE .&quot;
 				$sql_where&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -974,6 +973,7 @@
 
 		// Build a relevant pagination_url
 		$global_var = ($submit) ? '_POST' : '_GET';
+
 		foreach ($$global_var as $key =&gt; $var)
 		{
 			// what don't we need ?
@@ -992,7 +992,7 @@
 		// Some search user specific data
 		if ($mode == 'searchuser' &amp;&amp; ($config['load_search'] || $_CLASS['auth']-&gt;acl_get('a_')))
 		{
-			$_CLASS['core_template']-&gt;assign(array(
+			$_CLASS['core_template']-&gt;assign_array(array(
 				'USERNAME'	=&gt; $username,
 				'EMAIL'		=&gt; $email,
 				'ICQ'		=&gt; $icq,
@@ -1033,7 +1033,7 @@
 		// Do the SQL thang
 		$sql = 'SELECT u.username, u.user_id, u.user_colour, u.user_allow_viewemail, u.user_posts, u.user_regdate, u.user_rank, u.user_from, u.user_website, u.user_email, u.user_icq, u.user_aim, u.user_yim, u.user_msnm, u.user_jabber, u.user_avatar, u.user_avatar_type, u.user_last_visit 
 			'. $sql_fields .' FROM ' . USERS_TABLE . &quot; u$sql_from
-			WHERE u.user_type = &quot; . USER_NORMAL . &quot;
+			WHERE u.user_type = &quot; . USER_NORMAL . ' AND u.user_status = ' . STATUS_ACTIVE .&quot;
 				$sql_where
 			ORDER BY $order_by&quot;;
 		$result = $_CLASS['core_db']-&gt;query_limit($sql, $config['topics_per_page'], $start);
@@ -1041,7 +1041,7 @@
 		$id_cache = array();
 		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
-			if ($mode == 'group' &amp;&amp; $row['user_status'] == STATUS_PENDING)
+			if ($mode == 'group' &amp;&amp; $row['member_status'] == STATUS_PENDING)
 			{
 				 continue;
 			}
@@ -1053,7 +1053,7 @@
 		
 		foreach ($id_cache as $user_id =&gt; $row)
 		{
-			$option_row = ($mode == 'group' &amp;&amp; $row['user_status'] == STATUS_LEADER) ? 'leader_row' : 'member_row';
+			$option_row = ($mode == 'group' &amp;&amp; $row['member_status'] == STATUS_LEADER) ? 'leader_row' : 'member_row';
 
 			$$option_row = array_merge(show_profile($row), array(
 				'U_VIEWPROFILE'		=&gt; generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']))
@@ -1065,7 +1065,7 @@
 	}
 
 	// Generate page
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'PAGINATION' 	=&gt; generate_pagination($pagination_url2, $total_users, $config['topics_per_page'], $start),
 		'PAGE_NUMBER' 	=&gt; on_page($total_users, $config['topics_per_page'], $start),
 		'TOTAL_USERS'	=&gt; ($total_users == 1) ? $_CLASS['core_user']-&gt;lang['LIST_USER'] : sprintf($_CLASS['core_user']-&gt;lang['LIST_USERS'], $total_users),
@@ -1109,10 +1109,10 @@
 
 // Output the page
 $_CLASS['core_template']-&gt;assign('DISPLAY_STYLESHEET_LINK', $window);
-
 page_header();
-$_CLASS['core_template']-&gt;display('modules/Members_List/'.$template_html);
 
+$_CLASS['core_display']-&gt;display($page_title, 'modules/Members_List/'.$template_html);
+
 script_close();
 // ---------
 // FUNCTIONS


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000010.html">[Viperals-svncheckins] r86 - trunk/includes
</A></li>
	<LI>Next message: <A HREF="000012.html">[Viperals-svncheckins] r88 - in trunk: admin images includes includes/auth includes/crons includes/forums includes/forums/admin includes/templates includes/templates/admin includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/modules includes/templates/admin/system includes/templates/admin/users includes/templates/modules includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Quick_Message install modules/Control_Panel modules/Control_Panel/ucp modules/Quick_Message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11">[ date ]</a>
              <a href="thread.html#11">[ thread ]</a>
              <a href="subject.html#11">[ subject ]</a>
              <a href="author.html#11">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">More information about the Viperals-svncheckins
mailing list</a><br>
</body></html>
