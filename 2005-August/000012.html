<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Viperals-svncheckins] r88 - in trunk: admin images includes includes/auth includes/crons includes/forums includes/forums/admin includes/templates includes/templates/admin includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/modules includes/templates/admin/system includes/templates/admin/users includes/templates/modules includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Quick_Message install modules/Control_Panel modules/Control_Panel/ucp modules/Quick_Message
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/viperals-svncheckins/2005-August/index.html" >
   <LINK REL="made" HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r88%20-%20in%20trunk%3A%20admin%20images%20includes%20includes/auth%20includes/crons%20includes/forums%20includes/forums/admin%20includes/templates%20includes/templates/admin%20includes/templates/admin/blocks%20includes/templates/admin/messages%20includes/templates/admin/modules%20includes/templates/admin/system%20includes/templates/admin/users%20includes/templates/modules%20includes/templates/modules/Control_Panel%20includes/templates/modules/Forums%20includes/templates/modules/Quick_Message%20install%20modules/Control_Panel%20modules/Control_Panel/ucp%20modules/Quick_Message&In-Reply-To=%3C200508221555.j7MFtE3a026851%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000011.html">
   <LINK REL="Next"  HREF="000013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Viperals-svncheckins] r88 - in trunk: admin images includes includes/auth includes/crons includes/forums includes/forums/admin includes/templates includes/templates/admin includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/modules includes/templates/admin/system includes/templates/admin/users includes/templates/modules includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Quick_Message install modules/Control_Panel modules/Control_Panel/ucp modules/Quick_Message</H1>
    <B>Ryan Marshall at BerliOS</B> 
    <A HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r88%20-%20in%20trunk%3A%20admin%20images%20includes%20includes/auth%20includes/crons%20includes/forums%20includes/forums/admin%20includes/templates%20includes/templates/admin%20includes/templates/admin/blocks%20includes/templates/admin/messages%20includes/templates/admin/modules%20includes/templates/admin/system%20includes/templates/admin/users%20includes/templates/modules%20includes/templates/modules/Control_Panel%20includes/templates/modules/Forums%20includes/templates/modules/Quick_Message%20install%20modules/Control_Panel%20modules/Control_Panel/ucp%20modules/Quick_Message&In-Reply-To=%3C200508221555.j7MFtE3a026851%40sheep.berlios.de%3E"
       TITLE="[Viperals-svncheckins] r88 - in trunk: admin images includes includes/auth includes/crons includes/forums includes/forums/admin includes/templates includes/templates/admin includes/templates/admin/blocks includes/templates/admin/messages includes/templates/admin/modules includes/templates/admin/system includes/templates/admin/users includes/templates/modules includes/templates/modules/Control_Panel includes/templates/modules/Forums includes/templates/modules/Quick_Message install modules/Control_Panel modules/Control_Panel/ucp modules/Quick_Message">viperal at berlios.de
       </A><BR>
    <I>Mon Aug 22 17:55:14 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000011.html">[Viperals-svncheckins] r87 - in trunk: admin admin/functions blocks includes includes/db includes/display install javascript modules modules/Control_Panel/ucp modules/Forums modules/Members_List
</A></li>
        <LI>Next message: <A HREF="000013.html">[Viperals-svncheckins] r89 - in trunk: blocks includes includes/db includes/forums includes/forums/admin javascript modules/Control_Panel/ucp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12">[ date ]</a>
              <a href="thread.html#12">[ thread ]</a>
              <a href="subject.html#12">[ subject ]</a>
              <a href="author.html#12">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: viperal
Date: 2005-08-22 17:55:13 +0200 (Mon, 22 Aug 2005)
New Revision: 88

Added:
   trunk/admin/menu.php
   trunk/images/add_user.png
   trunk/images/calender.png
   trunk/images/calender_small.png
   trunk/includes/crons/session.php
   trunk/includes/templates/admin/users/
   trunk/includes/templates/admin/users/bots.html
   trunk/includes/templates/admin/users/header.html
   trunk/includes/templates/admin/users/index.html
   trunk/includes/templates/admin/users/unactivated.html
   trunk/includes/templates/confirmation.html
   trunk/includes/templates/message.html
   trunk/install/installer.php
Removed:
   trunk/includes/forums/admin/admin_ban.php
   trunk/includes/templates/admin/system/bots.html
   trunk/includes/templates/modules/Submit_News/
   trunk/includes/templates/modules/View_Online/
Modified:
   trunk/admin/index.php
   trunk/admin/system.php
   trunk/admin/users.php
   trunk/includes/auth/auth.php
   trunk/includes/forums/admin/admin_board.php
   trunk/includes/forums/admin/admin_forums.php
   trunk/includes/forums/admin/admin_icons.php
   trunk/includes/forums/admin/admin_permissions.php
   trunk/includes/forums/admin/links.php
   trunk/includes/forums/admin/main.php
   trunk/includes/forums/auth.php
   trunk/includes/forums/bbcode.php
   trunk/includes/forums/functions.php
   trunk/includes/forums/functions_admin.php
   trunk/includes/forums/functions_display.php
   trunk/includes/forums/functions_posting.php
   trunk/includes/forums/functions_privmsgs.php
   trunk/includes/forums/message_parser.php
   trunk/includes/functions.php
   trunk/includes/functions_user.php
   trunk/includes/session.php
   trunk/includes/system.php
   trunk/includes/templates/admin/blocks/edit.html
   trunk/includes/templates/admin/blocks/index.html
   trunk/includes/templates/admin/index.html
   trunk/includes/templates/admin/messages/edit.html
   trunk/includes/templates/admin/messages/index.html
   trunk/includes/templates/admin/modules/index.html
   trunk/includes/templates/admin/system/index.html
   trunk/includes/templates/login_admin.html
   trunk/includes/templates/login_body.html
   trunk/includes/templates/login_body_full.html
   trunk/includes/templates/modules/Control_Panel/ucp_agreement.html
   trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html
   trunk/includes/templates/modules/Control_Panel/ucp_posting_body.html
   trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html
   trunk/includes/templates/modules/Control_Panel/ucp_profile_signature.html
   trunk/includes/templates/modules/Control_Panel/ucp_register.html
   trunk/includes/templates/modules/Forums/faq_body.html
   trunk/includes/templates/modules/Forums/overall_header.html
   trunk/includes/templates/modules/Forums/posting_body.html
   trunk/includes/templates/modules/Forums/viewforum_body.html
   trunk/includes/templates/modules/Forums/viewtopic_body.html
   trunk/includes/templates/modules/Quick_Message/index.html
   trunk/includes/templates/permission.html
   trunk/includes/user.php
   trunk/install/build_data.php
   trunk/install/build_tables.php
   trunk/modules/Control_Panel/index.php
   trunk/modules/Control_Panel/ucp/ucp_register.php
   trunk/modules/Quick_Message/index.php
   trunk/modules/Quick_Message/install.php
Log:


Modified: trunk/admin/index.php
===================================================================
--- trunk/admin/index.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/admin/index.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,4 +1,26 @@
 &lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
 if (VIPERAL !== 'Admin') 
 {
 	die;
@@ -57,30 +79,38 @@
 
 if ($_CLASS['core_auth']-&gt;admin_power('users'))
 {
-	// seperate this
-	$sql = 'SELECT user_id, username, user_regdate
-		FROM ' . USERS_TABLE . '
-			WHERE user_type = '.USER_NORMAL.'
-			AND user_status IN (' . STATUS_PENDING . ',  ' . STATUS_DISABLED . ')';
-		
-	$result = $_CLASS['core_db']-&gt;query_limit($sql, 20);
-	
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	$user_status = array(STATUS_PENDING, STATUS_DISABLED);
+	$count = 0;
+
+	foreach ($user_status as $status)
 	{
-		$type = ($row['user_id'] == STATUS_DISABLED) ? 'users_disabled' : 'users_unactivated';
-	
-		$_CLASS['core_template']-&gt;assign_vars_array($type, array(
-				'user_id'		=&gt; $row['user_id'],
-				'user_name'		=&gt; $row['username'],
-				'registered'	=&gt; $_CLASS['core_user']-&gt;format_time($row['user_regdate']),
-				'link_profile'	=&gt; generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']),
-				'link_activate'	=&gt; generate_link('&amp;user_mode=activate&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
-				'link_remove'	=&gt; generate_link('&amp;user_mode=remove&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
-				'link_remind'	=&gt; generate_link('&amp;user_mode=remind&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
-				'link_details'	=&gt; '',
-		));
+		$sql = 'SELECT user_id, username, user_regdate
+			FROM ' . USERS_TABLE . '
+				WHERE user_type = '.USER_NORMAL.'
+				AND user_status = '.$status;
+		
+		$limit = ($count) ? 10 : 20 - $count;
+		$result = $_CLASS['core_db']-&gt;query_limit($sql, $limit);
+
+		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+		{
+			$type = ($status == STATUS_DISABLED) ? 'users_disabled' : 'users_unactivated';
+		
+			$_CLASS['core_template']-&gt;assign_vars_array($type, array(
+					'user_id'		=&gt; $row['user_id'],
+					'user_name'		=&gt; $row['username'],
+					'registered'	=&gt; $_CLASS['core_user']-&gt;format_time($row['user_regdate']),
+					'link_profile'	=&gt; generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']),
+					'link_activate'	=&gt; generate_link('&amp;user_mode=activate&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+					'link_remove'	=&gt; generate_link('&amp;user_mode=remove&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+					'link_remind'	=&gt; generate_link('&amp;user_mode=remind&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+					'link_details'	=&gt; '',
+			));
+			
+			$count ++;
+		}
+		$_CLASS['core_db']-&gt;free_result($result);
 	}
-	$_CLASS['core_db']-&gt;free_result($result);
 }
 
 $_CLASS['core_template']-&gt;display('admin/index.html');

Added: trunk/admin/menu.php
===================================================================
--- trunk/admin/menu.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/admin/menu.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,108 @@
+&lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
+/*
+	this is temp.. until I know if I want to make this a class and how i'm going to do the styles
+*/
+// add spacer
+
+$menu['blocks'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('BLOCKS'), 'link' =&gt; generate_link('blocks', array('admin' =&gt; true)));
+$menu['blocks'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MANAGE'), 'link' =&gt; generate_link('blocks', array('admin' =&gt; true)));
+$menu['blocks'][] = '';
+$menu['blocks'][] = array('lang' =&gt; 'Add Regular Block', 'link' =&gt; generate_link('blocks&amp;mode=add&amp;type=0', array('admin' =&gt; true)));
+$menu['blocks'][] = array('lang' =&gt; 'Add Feed Block', 'link' =&gt; generate_link('blocks&amp;mode=add&amp;type=1', array('admin' =&gt; true)));
+$menu['blocks'][] = array('lang' =&gt; 'Add HTML Block', 'link' =&gt; generate_link('blocks&amp;mode=add&amp;type=2', array('admin' =&gt; true)));
+
+
+$menu['messages'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MESSAGES'), 'link' =&gt; generate_link('messages', array('admin' =&gt; true)));
+$menu['messages'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MANAGE'), 'link' =&gt; generate_link('messages', array('admin' =&gt; true)));
+$menu['messages'][] = '';
+$menu['messages'][] = array('lang' =&gt; 'Add Message', 'link' =&gt; generate_link('messages&amp;mode=add', array('admin' =&gt; true)));
+
+$menu['modules'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MODULES'), 'link' =&gt; generate_link('modules', array('admin' =&gt; true)));
+$menu['modules'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MANAGE'), 'link' =&gt; generate_link('modules', array('admin' =&gt; true)));
+$menu['modules'][] = '';
+
+$menu['forums'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('FORUMS'), 'link' =&gt; generate_link('Forums', array('admin' =&gt; true)));
+$menu['forums'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('ADMIN_INDEX'), 'link' =&gt; generate_link('Forums', array('admin' =&gt; true)));
+$menu['forums'][] = '';
+$menu['forums'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MANAGE_FORUMS'), 'link' =&gt; generate_link('Forums&amp;file=admin_forums', array('admin' =&gt; true)));
+$menu['forums'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('PERMISSIONS'), 'link' =&gt; generate_link('Forums&amp;file=admin_permissions&amp;mode=forum', array('admin' =&gt; true)));
+$menu['forums'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('ADMINISTRATORS'), 'link' =&gt; generate_link('Forums&amp;file=admin_permissions&amp;mode=admin', array('admin' =&gt; true)));
+$menu['forums'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('MODERATORS'), 'link' =&gt; generate_link('Forums&amp;file=admin_permissions&amp;mode=mod', array('admin' =&gt; true)));
+
+$menu['system'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('SYSTEM'), 'link' =&gt; generate_link('system', array('admin' =&gt; true)));
+$menu['system'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('SITE_SETTINGS'), 'link' =&gt; generate_link('system&amp;mode=site', array('admin' =&gt; true)));
+$menu['system'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('SYSTEM_SETTINGS'), 'link' =&gt; generate_link('system&amp;mode=system', array('admin' =&gt; true)));
+$menu['system'][] = array('lang' =&gt; $_CLASS['core_user']-&gt;get_lang('BOTS'), 'link' =&gt; generate_link('users&amp;mode=bots', array('admin' =&gt; true)));
+
+function build_menu($menu)
+{
+	$names = array_keys($menu);
+	
+	$script = '&lt;script type=&quot;text/javascript&quot;&gt;';
+	$menu_items = '';
+
+	foreach ($names as $name)
+	{
+		if (isset($menu[$name][0]))
+		{
+			$menu_items .= '&lt;td id=&quot;'.$name.'&quot; nowrap=&quot;nowrap&quot; class=&quot;row2&quot;&gt;&lt;a href=&quot;'.$menu[$name][0]['link'].'&quot;&gt;'.$menu[$name][0]['lang'].'&lt;/a&gt;&lt;/td&gt;';
+			unset($menu[$name][0]);
+		}
+
+		$content[$name] = '&lt;div id=&quot;'.$name.'_menu&quot; style=&quot;display: none;&quot;&gt;&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;';
+
+		foreach ($menu[$name] as $item)
+		{
+			if (is_array($item))
+			{
+				$content[$name] .= '
+				&lt;tr&gt;
+					&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className=\'row2\'&quot; onmouseout=&quot;this.className=\'row1\'&quot;  onclick=&quot;location.href=\''.$item['link'].'\'&quot; nowrap=&quot;nowrap&quot;&gt;&lt;a href=&quot;'.$item['link'].'&quot; title=&quot;&quot;&gt;'.$item['lang'].'&lt;/a&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+				';
+			}
+			else
+			{
+				$content[$name] .= '
+				&lt;tr&gt;
+					&lt;td class=&quot;row2&quot; nowrap=&quot;nowrap&quot;&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+				';
+			}
+		}
+
+		$content[$name] .= '&lt;/table&gt;&lt;/div&gt;';
+
+		$script .= &quot;menu_init('$name');\n&quot;;
+	}
+
+	$script .= '&lt;/script&gt;';
+
+	$return['content'] = implode(&quot;\n&quot;, $content).&quot;\n$script&quot;;
+	$return['menu'] = $menu_items;
+
+	return $return;
+}
+?&gt;
\ No newline at end of file

Modified: trunk/admin/system.php
===================================================================
--- trunk/admin/system.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/admin/system.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,5 +1,26 @@
 &lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 if (VIPERAL !== 'Admin') 
 {
 	die;
@@ -66,11 +87,9 @@
 		$data = array('global'	=&gt; array(
 			'default_theme'		=&gt; array('post_name' =&gt; 'default_theme'),
 			'link_optimization' =&gt; array('post_name' =&gt; 'link_optimization'),
-			'site_logo'			=&gt; array('post_name' =&gt; 'site_logo'),
 			'site_name'			=&gt; array('post_name' =&gt; 'site_name'),
 			'site_url'			=&gt; array('post_name' =&gt; 'site_url'),
-			'slogan'			=&gt; array('post_name' =&gt; 'slogan'),
-			'startdate'			=&gt; array('post_name' =&gt; 'startdate')
+			'start_date'		=&gt; array('post_name' =&gt; 'start_date')
 			)
 		);
 		admin_save($data);
@@ -118,7 +137,11 @@
 {
 	if ($save)
 	{
-		$_POST['maintenance_start'] = (($expires = strtotime($_POST['maintenance_start'])) === -1) ? '' : $expires;
+		if (!empty($_POST['maintenance_start']))
+		{
+			$expires = strtotime($_POST['maintenance_start']);
+			$_POST['maintenance_start'] = (!$expires || $expires == -1) ? '' : $expires;
+		}
 
 		$data = array(
 			'maintenance' =&gt; array(
@@ -136,7 +159,6 @@
 				'site_port' 	=&gt; array('post_name' =&gt; 'site_port'),
 				'site_path' 	=&gt; array('post_name' =&gt; 'site_path'),
 				'ip_check' 		=&gt; array('post_name' =&gt; 'ip_check'),
-				'browser_check' =&gt; array('post_name' =&gt; 'browser_check'),
 				'limit_load' 	=&gt; array('post_name' =&gt; 'limit_load'),
 				'limit_sessions'	=&gt; array('post_name' =&gt; 'limit_sessions'),
 				'session_length'	=&gt; array('post_name' =&gt; 'session_length'),

Modified: trunk/admin/users.php
===================================================================
--- trunk/admin/users.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/admin/users.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -26,72 +26,7 @@
 	die;
 }
 
-if (isset($_REQUEST['mode']) &amp;&amp; $_REQUEST['mode'] == 'bots')
-{
-	$id = (int) get_variable('id', 'GET', false);
-	
-	if ($id &amp;&amp; isset($_REQUEST['option']))
-	{
-		require_once($site_file_root.'includes/functions_user.php');
-	
-		switch ($_REQUEST['option'])
-		{
-			case 'activate':
-				user_activate($id);
-			break;
-	
-			case 'deactivate':
-				user_disable($id);
-			break;
-		
-			case 'delete':
-				if (display_confirmation())
-				{
-					$sql = 'SELECT user_id, user_type
-						FROM ' . USERS_TABLE . ' 
-						WHERE user_id = '.$id;
-		
-					$result = $_CLASS['core_db']-&gt;query($sql);
-					$row = $_CLASS['core_db']&gt;fetch_row_assoc($result);
-					$_CLASS['core_db']-&gt;free_result($result);
-		
-					if ($row['user_type'] != USER_BOT)
-					{
-						break;
-					}
-		
-					user_delete($id);
-		
-					trigger_error($_CLASS['core_user']-&gt;lang['BOT_DELETED']);
-				}
-			break;
-		}
-	}
-	
-	$sql = 'SELECT user_id, username, user_status, user_last_visit 
-		FROM ' . USERS_TABLE . '
-		WHERE user_type = ' . USER_BOT . ' ORDER BY user_last_visit DESC';
-	
-	$result = $_CLASS['core_db']-&gt;query($sql);
-	
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-	{
-		$_CLASS['core_template']-&gt;assign_vars_array('admin_bots', array(
-			'ACTIVE'		=&gt; ($row['user_status'] == STATUS_ACTIVE),
-			'NAME'			=&gt; $row['username'],
-			'LINK_DELETE'	=&gt; generate_link('users&amp;mode=bots&amp;option=delete&amp;id='.$row['user_id'], array('admin' =&gt; true)),
-			'LINK_STATUS'	=&gt; generate_link('users&amp;mode=bots&amp;option='.(($row['user_status'] == STATUS_ACTIVE) ? 'deactivate' :  'activate').'&amp;id='.$row['user_id'], array('admin' =&gt; true)),
-			'LINK_EDIT'		=&gt; generate_link('users&amp;mode=bots&amp;options=edit&amp;id='.$row['user_id'], array('admin' =&gt; true)),
-			'LAST_VISIT'	=&gt; ($row['user_last_visit']) ?  $_CLASS['core_user']-&gt;format_date($row['user_last_visit']) : $_CLASS['core_user']-&gt;lang['BOT_NEVER'],
-			'L_STATUS'		=&gt; ($row['user_status'] == STATUS_ACTIVE) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
-		));
-	}
-	
-	$_CLASS['core_db']-&gt;free_result($result);
-	
-	$_CLASS['core_display']-&gt;display(false, 'admin/users/bots.html');
-}
-
+// Just testing the layout, i know they not acurrate
 $result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM ' . USERS_TABLE . ' WHERE user_type = ' . USER_BOT);
 list($count_bots) = $_CLASS['core_db']-&gt;fetch_row_num($result);
 $_CLASS['core_db']-&gt;free_result($result);
@@ -104,13 +39,173 @@
 $_CLASS['core_template']-&gt;assign_array(array(
 	'COUNT_BOTS'	=&gt; $count_bots,
 	'COUNT_USERS'	=&gt; $count_users,
-	'LINK_BOTS'		=&gt; generate_link('users&amp;mode=bots', array('admin' =&gt; true)),
 	'LINK_ADD_USER'	=&gt; generate_link('users&amp;mode=add_user', array('admin' =&gt; true)),
 	'LINK_EDIT_USER'=&gt; generate_link('users&amp;mode=edit_user', array('admin' =&gt; true)),
-	//'LAST_VISIT'	=&gt; ($row['user_last_visit']) ?  $_CLASS['core_user']-&gt;format_date($row['user_last_visit']) : $_CLASS['core_user']-&gt;lang['BOT_NEVER'],
-	//'L_STATUS'		=&gt; ($row['user_status'] == STATUS_ACTIVE) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
+	
+	'LINK_USER_INDEX'		=&gt; generate_link('users', array('admin' =&gt; true)),
+	'LINK_VIEW_BOTS'		=&gt; generate_link('users&amp;mode=bots', array('admin' =&gt; true)),
+	'LINK_VIEW_DISABLED'	=&gt; generate_link('users&amp;mode=disabled', array('admin' =&gt; true)),
+	'LINK_VIEW_UNACTIVATED'	=&gt; generate_link('users&amp;mode=unactivated', array('admin' =&gt; true)),
 ));
 
+if (isset($_REQUEST['mode']))
+{
+	switch ($_REQUEST['mode'])
+	{
+		case 'bots':
+			$id = (int) get_variable('id', 'GET', false);
+			
+			if ($id &amp;&amp; isset($_REQUEST['option']))
+			{
+				require_once($site_file_root.'includes/functions_user.php');
+			
+				switch ($_REQUEST['option'])
+				{
+					case 'activate':
+						user_activate($id);
+					break;
+			
+					case 'deactivate':
+						user_disable($id);
+					break;
+				
+					case 'delete':
+						if (display_confirmation())
+						{
+							$sql = 'SELECT user_id, user_type
+								FROM ' . USERS_TABLE . ' 
+								WHERE user_id = '.$id;
+				
+							$result = $_CLASS['core_db']-&gt;query($sql);
+							$row = $_CLASS['core_db']&gt;fetch_row_assoc($result);
+							$_CLASS['core_db']-&gt;free_result($result);
+				
+							if ($row['user_type'] != USER_BOT)
+							{
+								break;
+							}
+				
+							user_delete($id);
+				
+							trigger_error($_CLASS['core_user']-&gt;lang['BOT_DELETED']);
+						}
+					break;
+				}
+			}
+			
+			$sql = 'SELECT user_id, username, user_status, user_last_visit 
+				FROM ' . USERS_TABLE . '
+				WHERE user_type = ' . USER_BOT . ' ORDER BY user_last_visit DESC';
+			
+			$result = $_CLASS['core_db']-&gt;query($sql);
+			
+			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+			{
+				$_CLASS['core_template']-&gt;assign_vars_array('admin_bots', array(
+					'ACTIVE'		=&gt; ($row['user_status'] == STATUS_ACTIVE),
+					'NAME'			=&gt; $row['username'],
+					'LINK_DELETE'	=&gt; generate_link('users&amp;mode=bots&amp;option=delete&amp;id='.$row['user_id'], array('admin' =&gt; true)),
+					'LINK_STATUS'	=&gt; generate_link('users&amp;mode=bots&amp;option='.(($row['user_status'] == STATUS_ACTIVE) ? 'deactivate' :  'activate').'&amp;id='.$row['user_id'], array('admin' =&gt; true)),
+					'LINK_EDIT'		=&gt; generate_link('users&amp;mode=bots&amp;options=edit&amp;id='.$row['user_id'], array('admin' =&gt; true)),
+					'LAST_VISIT'	=&gt; ($row['user_last_visit']) ?  $_CLASS['core_user']-&gt;format_date($row['user_last_visit']) : $_CLASS['core_user']-&gt;lang['BOT_NEVER'],
+					'L_STATUS'		=&gt; ($row['user_status'] == STATUS_ACTIVE) ? $_CLASS['core_user']-&gt;lang['DEACTIVATE'] : $_CLASS['core_user']-&gt;lang['ACTIVATE'],
+				));
+			}
+			
+			$_CLASS['core_db']-&gt;free_result($result);
+			
+			$_CLASS['core_display']-&gt;display(false, 'admin/users/bots.html');
+		break;
+
+		case 'disabled':
+		case 'unactivated':
+			if ($_REQUEST['mode'] == 'unactivated')
+			{
+				$status = STATUS_PENDING;
+				$template = 'admin/users/unactivated.html';
+				$link = 'users&amp;mode=unactivated';
+			}
+			else
+			{
+				$status = STATUS_DISABLED;
+				$template = 'admin/users/disabled.html';
+				$link = 'users&amp;mode=disabled';
+			}
+$status = STATUS_DISABLED;
+			$start = get_variable('start', 'GET', false, 'integer');
+
+			$sql = 'SELECT user_id, username, user_regdate
+				FROM ' . USERS_TABLE . '
+					WHERE user_type = '.USER_NORMAL.'
+					AND user_status = '.$status;
+
+			$result = $_CLASS['core_db']-&gt;query_limit($sql, 20, $start);
+
+			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+			{
+				$_CLASS['core_template']-&gt;assign_vars_array('users_admin', array(
+						'user_id'		=&gt; $row['user_id'],
+						'user_name'		=&gt; $row['username'],
+						'registered'	=&gt; $_CLASS['core_user']-&gt;format_time($row['user_regdate']),
+						'link_profile'	=&gt; generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']),
+						'link_activate'	=&gt; generate_link('&amp;user_mode=activate&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+						'link_remove'	=&gt; generate_link('&amp;user_mode=remove&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+						'link_remind'	=&gt; generate_link('&amp;user_mode=remind&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+						'link_details'	=&gt; '',
+				));
+			}
+			$_CLASS['core_db']-&gt;free_result($result);
+
+			$sql = 'SELECT count(*) as count FROM ' . USERS_TABLE . '
+				WHERE user_type = '.USER_NORMAL.'
+				AND user_status = '.$status;
+		
+			$result = $_CLASS['core_db']-&gt;query($sql);
+			list($count) = $_CLASS['core_db']-&gt;fetch_row_num($result);
+			$_CLASS['core_db']-&gt;free_result($result);
+			
+			$pagination = generate_pagination($link, $count, 20, $start, true);
+			$_CLASS['core_template']-&gt;assign('USERS_PAGINATION', $pagination['formated']);
+
+			$_CLASS['core_display']-&gt;display(false, $template);
+		break;
+	}
+}
+
+$user_status = array(STATUS_PENDING, STATUS_DISABLED);
+$count = 0;
+
+// needed view more
+foreach ($user_status as $status)
+{
+	$sql = 'SELECT user_id, username, user_regdate
+		FROM ' . USERS_TABLE . '
+			WHERE user_type = '.USER_NORMAL.'
+			AND user_status = '.$status;
+
+	$limit = ($count) ? 10 : 20 - $count;
+	$result = $_CLASS['core_db']-&gt;query_limit($sql, $limit);
+
+	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	{
+		$type = ($status == STATUS_DISABLED) ? 'users_disabled' : 'users_unactivated';
+	
+		$_CLASS['core_template']-&gt;assign_vars_array($type, array(
+				'user_id'		=&gt; $row['user_id'],
+				'user_name'		=&gt; $row['username'],
+				'registered'	=&gt; $_CLASS['core_user']-&gt;format_time($row['user_regdate']),
+				'link_profile'	=&gt; generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']),
+				'link_activate'	=&gt; generate_link('&amp;user_mode=activate&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+				'link_remove'	=&gt; generate_link('&amp;user_mode=remove&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+				'link_remind'	=&gt; generate_link('&amp;user_mode=remind&amp;id=' . $row['user_id'], array('admin' =&gt; true)),
+				'link_details'	=&gt; '',
+		));
+		
+		$count ++;
+	}
+	$_CLASS['core_db']-&gt;free_result($result);
+}
+
 $_CLASS['core_display']-&gt;display(false, 'admin/users/index.html');
 
 ?&gt;
\ No newline at end of file

Added: trunk/images/add_user.png
===================================================================
(Binary files differ)


Property changes on: trunk/images/add_user.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/images/calender.png
===================================================================
(Binary files differ)


Property changes on: trunk/images/calender.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/images/calender_small.png
===================================================================
(Binary files differ)


Property changes on: trunk/images/calender_small.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/includes/auth/auth.php
===================================================================
--- trunk/includes/auth/auth.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/auth/auth.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -50,9 +50,9 @@
 		{
 			if (encode_password($user_password, $row['user_password_encoding']) == $row['user_password'])
 			{
-				if ($row['user_status'] == USER_DISABLE || $row['user_status'] == USER_UNACTIVATED)
+				if ($row['user_status'] != STATUS_ACTIVE)
 				{
-					$status =  ($row['user_type'] == USER_INACTIVE) ? 'ACTIVE_ERROR' : 'UNACTIVATED_ERROR';
+					$status =  ($row['user_status'] == STATUS_DISABLED) ? 'ACTIVE_ERROR' : 'UNACTIVATED_ERROR';
 				}
 
 				return (int) $row['user_id'];
@@ -111,16 +111,16 @@
 	{
 		global $_CLASS;
 
-		if (!$_CLASS['core_user']-&gt;is_admin || !$this-&gt;admin_auth() || !isset($this-&gt;_admin_permission[$section]))
+		if (!$_CLASS['core_user']-&gt;is_admin || !$this-&gt;admin_auth())
 		{
-			if (isset($this-&gt;_admin_permission['/all/']))
-			{
-				return true;
-			}
-
 			return false;
 		}
 
+		if (!isset($this-&gt;_admin_permission[$section]))
+		{
+			return isset($this-&gt;_admin_permission['/all/']) ?  true : false;
+		}
+
 		if ($option)
 		{
 			return isset($this-&gt;_admin_permission[$section][$option]) ? false : $this-&gt;_admin_permission[$section][$option];
@@ -178,7 +178,7 @@
 				{
 					$_CLASS['core_user']-&gt;login($result, $login_array['admin_login'], !empty($_POST['hidden']), !empty($_POST['auto_login']));
 
-					$login_array['redirect'] = generate_link(get_variable('redirect', 'POST', $login_array['redirect']), array('admin' =&gt; $data['admin_login']));	
+					$login_array['redirect'] = generate_link(get_variable('redirect', 'POST', $login_array['redirect']), array('admin' =&gt; $login_array['admin_login']));	
 
 					$_CLASS['core_display']-&gt;meta_refresh(5, $login_array['redirect']);
 					$message = (($login_array['success']) ? $_CLASS['core_user']-&gt;get_lang($login_array['success']) : $_CLASS['core_user']-&gt;lang['LOGIN_REDIRECT']) . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_PAGE'], '&lt;a href=&quot;' . $login_array['redirect'] . '&quot;&gt;', '&lt;/a&gt; ');
@@ -324,7 +324,7 @@
 
 					if (count($setup['users']))
 					{
-						$setup['users'] = user_get_id($setup['users']);
+						$setup['users'] = user_get_id($setup['users'], $null);
 					}
 
 					if (count($setup['groups']))
@@ -440,7 +440,7 @@
 				$group_auth_type = isset($auth_options['groups'][1][$row['group_id']]['core_status']) ? 1 : 0;
 				$group_list = ($auth_options['groups'][$group_auth_type][$row['group_id']]['core_status']) ? 'allowed_group_list' : 'disallowed_group_list';
 				
-				$$group_list .= '&lt;option' . (($group_auth_type == 1) ? ' style=&quot;color: #006699;&quot;' : '') . ' value=&quot;' . $row['group_id'] . '&quot;&gt;' . (($row['group_type'] == GROUP_SPECIAL) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
+				$$group_list .= '&lt;option' . (($group_auth_type == 1) ? ' style=&quot;color: #006699;&quot;' : '') . ' value=&quot;' . $row['group_id'] . '&quot;&gt;' . (isset($_CLASS['core_user']-&gt;lang['G_' . $row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
 				
 			}
 			$_CLASS['core_db']-&gt;free_result($result);
@@ -454,7 +454,7 @@
 
 		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
-			$group_list .= '&lt;option value=&quot;' . $row['group_id'] . '&quot;&gt;' . (($row['group_type'] == GROUP_SPECIAL) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
+			$group_list .= '&lt;option value=&quot;' . $row['group_id'] . '&quot;&gt;' . (isset($_CLASS['core_user']-&gt;lang['G_' . $row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
 		}
 		$_CLASS['core_db']-&gt;free_result($result);
 	

Added: trunk/includes/crons/session.php
===================================================================
--- trunk/includes/crons/session.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/crons/session.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,41 @@
+&lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
+$sql = 'UPDATE ' . USERS_TABLE. ' u, ' . SESSIONS_TABLE . ' s
+			SET u.user_last_visit = s.session_time
+			WHERE s.session_time &lt; ' . ($time - $_CORE_CONFIG['server']['session_length']) . '
+				AND s.session_user_id &lt;&gt; ' . ANONYMOUS .'
+				AND u.user_id = s.session_user_id';
+$_CLASS['core_db']-&gt;sql_query($sql);
+
+$sql = 'DELETE FROM ' . SESSIONS_AUTOLOGIN_TABLE . '
+			WHERE auto_login_time &lt; ' . ($time - 2592000);
+$_CLASS['core_db']-&gt;query($sql);
+
+$sql = 'DELETE FROM ' . SESSIONS_TABLE . '
+			WHERE session_time &lt; ' . ($time - $_CORE_CONFIG['server']['session_length']);
+$_CLASS['core_db']-&gt;query($sql);
+
+$_CLASS['core_db']-&gt;optimize_tables(SESSIONS_TABLE);
+
+?&gt;
\ No newline at end of file

Deleted: trunk/includes/forums/admin/admin_ban.php
===================================================================
--- trunk/includes/forums/admin/admin_ban.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/admin_ban.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,289 +0,0 @@
-&lt;?php
-// -------------------------------------------------------------
-//
-// $Id: admin_ban.php,v 1.11 2004/08/01 21:01:23 psotfx Exp $
-//
-// FILENAME  : admin_ban.php
-// STARTED   : Tue Jul 31, 2001
-// COPYRIGHT : &#169; 2001,2003 phpBB Group
-// WWW       : <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
-// LICENCE   : GPL vs2.0 [ see /docs/COPYING ]
-//
-// -------------------------------------------------------------
-
-// Do we have ban permissions?
-if (!$auth-&gt;acl_get('a_ban'))
-{
-	trigger_error($user-&gt;lang['NO_ADMIN']);
-}
-
-include('includes/forums/functions_user.'.$phpEx);
-
-// Mode setting
-$mode		= request_var('mode', '');
-$bansubmit	= (isset($_POST['bansubmit'])) ? true : false;
-$unbansubmit= (isset($_POST['unbansubmit'])) ? true : false;
-
-// Set some vars
-$current_time = time();
-
-// Start program
-if ($bansubmit)
-{
-	// Grab the list of entries
-	$ban			= request_var('ban', '');
-	$ban_len		= request_var('banlength', 0);
-	$ban_len_other	= request_var('banlengthother', '');
-	$ban_exclude	= request_var('banexclude', 0);
-	$ban_reason		= request_var('banreason', '');
-
-	user_ban($mode, $ban, $ban_len, $ban_len_other, $ban_exclude, $ban_reason);
-
-	trigger_error($user-&gt;lang['BAN_UPDATE_SUCESSFUL']);
-}
-else if ($unbansubmit)
-{
-	$ban = request_var('unban', '');
-
-	user_unban($mode, $ban);
-
-	trigger_error($user-&gt;lang['BAN_UPDATE_SUCESSFUL']);
-}
-
-//
-// Output relevant entry page
-//
-
-
-//
-// Ban length options
-//
-$ban_end_text = array(0 =&gt; $user-&gt;lang['PERMANENT'], 30 =&gt; $user-&gt;lang['30_MINS'], 60 =&gt; $user-&gt;lang['1_HOUR'], 360 =&gt; $user-&gt;lang['6_HOURS'], 1440 =&gt; $user-&gt;lang['1_DAY'], 10080 =&gt; $user-&gt;lang['7_DAYS'], 20160 =&gt; $user-&gt;lang['2_WEEKS'], 40320 =&gt; $user-&gt;lang['1_MONTH'], -1 =&gt; $user-&gt;lang['OTHER'] . ' -&gt; ');
-
-$ban_end_options = '';
-foreach ($ban_end_text as $length =&gt; $text)
-{
-	$ban_end_options .= '&lt;option value=&quot;' . $length . '&quot;&gt;' . $text . '&lt;/option&gt;';
-}
-
-// Title
-switch ($mode)
-{
-	case 'user':
-		$l_title = $user-&gt;lang['BAN_USERS'];
-		break;
-	case 'email':
-		$l_title = $user-&gt;lang['BAN_EMAILS'];
-		break;
-	case 'ip':
-		$l_title = $user-&gt;lang['BAN_IPS'];
-		break;
-}
-
-// Output page
-adm_page_header($l_title);
-
-?&gt;
-
-&lt;p&gt;&lt;?php echo $user-&gt;lang['BAN_EXPLAIN']; ?&gt;&lt;/p&gt;
-
-&lt;?php
-
-switch ($mode)
-{
-	case 'user':
-
-		$field = 'username';
-		$l_ban_title = $user-&gt;lang['BAN_USERS'];
-		$l_ban_explain = $user-&gt;lang['BAN_USERNAME_EXPLAIN'];
-		$l_ban_exclude_explain = $user-&gt;lang['BAN_USER_EXCLUDE_EXPLAIN'];
-		$l_unban_title = $user-&gt;lang['UNBAN_USERNAME'];
-		$l_unban_explain = $user-&gt;lang['UNBAN_USERNAME_EXPLAIN'];
-		$l_ban_cell = $user-&gt;lang['USERNAME'] . ': &lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;[ &lt;a href=&quot;' . getlink('Members_List'.$SID.'&amp;mode=searchuser&amp;form=banning&amp;field=ban').'&quot; onclick=&quot;window.open(\''.getlink('Members_List'.$SID.'&amp;mode=searchuser&amp;form=banning&amp;field=ban').&quot;', '_phpbbsearch', 'HEIGHT=500,resizable=yes,scrollbars=yes,WIDTH=740');return false;\&quot;&gt;&quot; . $user-&gt;lang['FIND_USERNAME'] .'&lt;/a&gt; ]&lt;/span&gt;';
-		$l_no_ban_cell = $user-&gt;lang['NO_BANNED_USERS'];
-
-		$sql = 'SELECT b.*, u.user_id, u.username
-			FROM ' . BANLIST_TABLE . ' b, ' . USERS_TABLE . ' u
-			WHERE (b.ban_end &gt;= ' . time() . '
-					OR b.ban_end = 0)
-				AND u.user_id = b.ban_userid
-				AND b.ban_userid &lt;&gt; 0
-				AND u.user_id &lt;&gt; ' . ANONYMOUS . '
-			ORDER BY u.user_id ASC';
-		break;
-
-	case 'ip':
-
-		$field = 'ban_ip';
-		$l_ban_title = $user-&gt;lang['BAN_IPS'];
-		$l_ban_explain = $user-&gt;lang['BAN_IP_EXPLAIN'];
-		$l_ban_exclude_explain = $user-&gt;lang['BAN_IP_EXCLUDE_EXPLAIN'];
-		$l_unban_title = $user-&gt;lang['UNBAN_IP'];
-		$l_unban_explain = $user-&gt;lang['UNBAN_IP_EXPLAIN'];
-		$l_ban_cell = $user-&gt;lang['IP_HOSTNAME'] . ':';
-		$l_no_ban_cell = $user-&gt;lang['NO_BANNED_IP'];
-
-		$sql = 'SELECT *
-			FROM ' . BANLIST_TABLE . '
-			WHERE (ban_end &gt;= ' . time() . &quot;
-					OR ban_end = 0)
-				AND ban_ip &lt;&gt; ''&quot;;
-		break;
-
-	case 'email':
-
-		$field = 'ban_email';
-		$l_ban_title = $user-&gt;lang['BAN_EMAILS'];
-		$l_ban_explain = $user-&gt;lang['BAN_EMAIL_EXPLAIN'];
-		$l_ban_exclude_explain = $user-&gt;lang['BAN_EMAIL_EXCLUDE_EXPLAIN'];
-		$l_unban_title = $user-&gt;lang['UNBAN_EMAIL'];
-		$l_unban_explain = $user-&gt;lang['UNBAN_EMAIL_EXPLAIN'];
-		$l_ban_cell = $user-&gt;lang['EMAIL_ADDRESS'] . ':';
-		$l_no_ban_cell = $user-&gt;lang['NO_BANNED_EMAIL'];
-
-		$sql = 'SELECT *
-			FROM ' . BANLIST_TABLE . '
-			WHERE (ban_end &gt;= ' . time() . &quot;
-					OR ban_end = 0)
-				AND ban_email &lt;&gt; ''&quot;;
-		break;
-}
-$result = $db-&gt;sql_query($sql);
-
-$banned_options = '';
-$ban_length = $ban_reasons = array();
-if ($row = $db-&gt;sql_fetchrow($result))
-{
-	do
-	{
-
-		$banned_options .=  '&lt;option' . (($row['ban_exclude']) ? ' class=&quot;sep&quot;' : '') . ' value=&quot;' . $row['ban_id'] . '&quot;&gt;' . $row[$field] . '&lt;/option&gt;';
-
-		$time_length = (!empty($row['ban_end'])) ? ($row['ban_end'] - $row['ban_start']) / 60 : 0;
-		$ban_length[$row['ban_id']] = (!empty($ban_end_text[$time_length])) ? $ban_end_text[$time_length] : $user-&gt;lang['OTHER'] . ' -&gt; ' . gmdate('Y-m-d', $row['ban_end']);
-
-		$ban_reasons[$row['ban_id']] = addslashes($row['ban_reason']);
-	}
-	while ($row = $db-&gt;sql_fetchrow($result));
-}
-$db-&gt;sql_freeresult($result);
-
-?&gt;
-
-&lt;h1&gt;&lt;?php echo $l_ban_title; ?&gt;&lt;/h1&gt;
-
-&lt;p&gt;&lt;?php echo $l_ban_explain; ?&gt;&lt;/p&gt;
-
-&lt;script language=&quot;Javascript&quot; type=&quot;text/javascript&quot;&gt;
-&lt;!--
-
-var ban_length = new Array();
-&lt;?php
-
-	if (sizeof($ban_length))
-	{
-		foreach ($ban_length as $ban_id =&gt; $length)
-		{
-			echo &quot;ban_length['$ban_id'] = \&quot;$length\&quot;;\n&quot;;
-		}
-	}
-
-?&gt;
-
-var ban_reason = new Array();
-&lt;?php
-
-	if (sizeof($ban_reasons))
-	{
-		foreach ($ban_reasons as $ban_id =&gt; $reason)
-		{
-			echo &quot;ban_reason['$ban_id'] = \&quot;$reason\&quot;;\n&quot;;
-		}
-	}
-?&gt;
-
-function display_details(option)
-{
-	document.forms[0].unbanreason.value = ban_reason[option];
-	document.forms[0].unbanlength.value = ban_length[option];
-}
-
-//--&gt;
-&lt;/script&gt;
-
-&lt;form name=&quot;banning&quot; method=&quot;post&quot; action=&quot;&lt;?php echo &quot;admin_ban.$phpEx$SID&amp;mode=$mode&quot;; ?&gt;&quot;&gt;&lt;table class=&quot;bg&quot; width=&quot;80%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot; align=&quot;center&quot;&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;&lt;?php echo $l_ban_title; ?&gt;&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $l_ban_cell; ?&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;textarea cols=&quot;40&quot; rows=&quot;3&quot; name=&quot;ban&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_LENGTH']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;banlength&quot;&gt;&lt;?php echo $ban_end_options; ?&gt;&lt;/select&gt;&nbsp; &lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;banlengthother&quot; maxlength=&quot;10&quot; size=&quot;10&quot; /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_EXCLUDE']; ?&gt;: &lt;br /&gt;&lt;span class=&quot;gensmall&quot;&gt;&lt;?php echo $l_ban_exclude_explain;;?&gt;&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;banexclude&quot; value=&quot;1&quot; /&gt; &lt;?php echo $user-&gt;lang['YES']; ?&gt; &nbsp; &lt;input type=&quot;radio&quot; name=&quot;banexclude&quot; value=&quot;0&quot; checked=&quot;checked&quot; /&gt; &lt;?php echo $user-&gt;lang['NO']; ?&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_REASON']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;banreason&quot; maxlength=&quot;255&quot; size=&quot;40&quot; /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;bansubmit&quot; value=&quot;&lt;?php echo $user-&gt;lang['SUBMIT']; ?&gt;&quot; class=&quot;btnmain&quot; /&gt;&nbsp; &lt;input type=&quot;reset&quot; value=&quot;&lt;?php echo $user-&gt;lang['RESET']; ?&gt;&quot; class=&quot;btnlite&quot; /&gt;&nbsp;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;/table&gt;
-
-&lt;h1&gt;&lt;?php echo $l_unban_title; ?&gt;&lt;/h1&gt;
-
-&lt;p&gt;&lt;?php echo $l_unban_explain; ?&gt;&lt;/p&gt;
-
-&lt;table class=&quot;bg&quot; width=&quot;80%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot; align=&quot;center&quot;&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;&lt;?php echo $l_unban_title; ?&gt;&lt;/th&gt;
-	&lt;/tr&gt;
-&lt;?php
-
-	if ($banned_options)
-	{
-
-?&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $l_ban_cell; ?&gt;: &lt;br /&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt; &lt;select name=&quot;unban[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot; onchange=&quot;display_details(this.options[this.selectedIndex].value)&quot;&gt;&lt;?php echo $banned_options; ?&gt;&lt;/select&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_REASON']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;row1&quot; style=&quot;border:0px&quot; type=&quot;text&quot; name=&quot;unbanreason&quot; size=&quot;40&quot; /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;45%&quot;&gt;&lt;?php echo $user-&gt;lang['BAN_LENGTH']; ?&gt;:&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;row1&quot; style=&quot;border:0px&quot; type=&quot;text&quot; name=&quot;unbanlength&quot; size=&quot;40&quot; /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;unbansubmit&quot; value=&quot;&lt;?php echo $user-&gt;lang['SUBMIT']; ?&gt;&quot; class=&quot;btnmain&quot; /&gt;&nbsp; &lt;input type=&quot;reset&quot; value=&quot;&lt;?php echo $user-&gt;lang['RESET']; ?&gt;&quot; class=&quot;btnlite&quot; /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;?php
-
-	}
-	else
-	{
-
-?&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row2&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;?php echo $l_no_ban_cell;  ?&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;?php
-
-	}
-
-?&gt;
-&lt;/table&gt;&lt;/form&gt;
-
-&lt;?php
-
-adm_page_footer();
-
-?&gt;
\ No newline at end of file

Modified: trunk/includes/forums/admin/admin_board.php
===================================================================
--- trunk/includes/forums/admin/admin_board.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/admin_board.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -81,14 +81,9 @@
 		'auth'	=&gt; 'a_defaults',
 		'title'	=&gt; 'BOARD_DEFAULTS',
 		'vars'	=&gt; array(
-			'default_lang'			=&gt; array('lang' =&gt; 'DEFAULT_LANGUAGE',		'type' =&gt; 'select', 'options' =&gt; 'language_select(\'{VALUE}\')', 'explain' =&gt; false),
-			'default_dateformat'	=&gt; array('lang' =&gt; 'DEFAULT_DATE_FORMAT',	'type' =&gt; 'text::255', 'explain' =&gt; true),
-			'board_timezone'		=&gt; array('lang' =&gt; 'SYSTEM_TIMEZONE',		'type' =&gt; 'select', 'options' =&gt; 'tz_select(\'{VALUE}\')', 'explain' =&gt; false),
-			'board_dst'				=&gt; array('lang' =&gt; 'SYSTEM_DST',			'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'allow_privmsg'			=&gt; array('lang' =&gt; 'BOARD_PM',				'type' =&gt; 'radio:yes_no', 'explain' =&gt; true),
 			'allow_topic_notify'	=&gt; array('lang' =&gt; 'ALLOW_TOPIC_NOTIFY',	'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'allow_forum_notify'	=&gt; array('lang' =&gt; 'ALLOW_FORUM_NOTIFY',	'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
-			//'allow_namechange'		=&gt; array('lang' =&gt; 'ALLOW_NAME_CHANGE',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'allow_attachments'		=&gt; array('lang' =&gt; 'ALLOW_ATTACHMENTS',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'allow_html'			=&gt; array('lang' =&gt; 'ALLOW_HTML',			'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'allow_html_tags'		=&gt; array('lang' =&gt; 'ALLOWED_TAGS',			'type' =&gt; 'text:30:255', 'explain' =&gt; true),
@@ -116,7 +111,6 @@
 			'allow_pm_attach'		=&gt; array('lang' =&gt; 'ALLOW_PM_ATTACHMENTS',	'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'auth_download_pm'		=&gt; array('lang' =&gt; 'ALLOW_DOWNLOAD_PM',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'allow_sig_pm'			=&gt; array('lang' =&gt; 'ALLOW_SIG_PM',			'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
-			//'enable_karma_pm'		=&gt; array('lang' =&gt; 'ENABLE_KARMA_PM',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'auth_report_pm'		=&gt; array('lang' =&gt; 'ALLOW_REPORT_PM',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'auth_quote_pm'			=&gt; array('lang' =&gt; 'ALLOW_QUOTE_PM',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),
 			'print_pm'				=&gt; array('lang' =&gt; 'ALLOW_PRINT_PM',		'type' =&gt; 'radio:yes_no', 'explain' =&gt; false),

Modified: trunk/includes/forums/admin/admin_forums.php
===================================================================
--- trunk/includes/forums/admin/admin_forums.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/admin_forums.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -29,12 +29,15 @@
 {
 	case 'add':
 		$acl = 'a_forumadd';
-		break;
+	break;
+
 	case 'delete':
 		$acl = 'a_forumdel';
-		break;
+	break;
+
 	default:
 		$acl = 'a_forum';
+	break;
 }
 
 if (!$_CLASS['auth']-&gt;acl_get($acl))
@@ -49,6 +52,11 @@
 	switch ($mode)
 	{
 		case 'delete':
+			if (!$forum_id)
+			{
+				trigger_error('NO_FORUM');
+			}
+
 			$action_subforums	= request_var('action_subforums', '');
 			$subforums_to_id	= request_var('subforums_to_id', 0);
 			$action_posts		= request_var('action_posts', '');
@@ -56,14 +64,18 @@
 
 			delete_forum($forum_id, $action_posts, $action_subforums, $posts_to_id, $subforums_to_id);
 
-			//
 			$_CLASS['auth']-&gt;acl_clear_prefetch();
 
 			$show_prev_info = false;
-			trigger_error($_CLASS['core_user']-&gt;lang['FORUM_DELETED']);
-			break;
+			trigger_error('FORUM_DELETED');
+		break;
 
 		case 'edit':
+			if (!$forum_id)
+			{
+				trigger_error('NO_FORUM');
+			}
+
 			$forum_data = array(
 				'forum_id'		=&gt;	$forum_id
 			);
@@ -97,7 +109,6 @@
 				'forum_password_confirm'=&gt; request_var('forum_password_confirm', '')
 			);
 
-
 			if ($forum_data['forum_rules'])
 			{
 				require_once($site_file_root.'includes/forums/message_parser.php');
@@ -333,7 +344,7 @@
 ?&gt;&lt;br /&gt;&lt;input type=&quot;radio&quot; name=&quot;action&quot; value=&quot;delete&quot; checked=&quot;checked&quot; /&gt; &lt;?php echo $_CLASS['core_user']-&gt;lang['DELETE_ALL_POSTS'];
 
 			$sql = 'SELECT forum_id
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE forum_type = ' . FORUM_POST . &quot;
 					AND forum_id &lt;&gt; $forum_id&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -580,7 +591,7 @@
 &lt;?php
 
 			$sql = 'SELECT forum_id
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE forum_type = ' . FORUM_POST . &quot;
 					AND forum_id &lt;&gt; $forum_id&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -635,7 +646,7 @@
 	case 'move_up':
 	case 'move_down':
 		$sql = 'SELECT parent_id, left_id, right_id
-			FROM ' . FORUMS_TABLE . &quot;
+			FROM ' . FORUMS_FORUMS_TABLE . &quot;
 			WHERE forum_id = $forum_id&quot;;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -650,7 +661,7 @@
 
 		// Get the adjacent forum
 		$sql = 'SELECT forum_id, forum_name, left_id, right_id
-			FROM ' . FORUMS_TABLE . &quot;
+			FROM ' . FORUMS_FORUMS_TABLE . &quot;
 			WHERE parent_id = $parent_id
 				AND &quot; . (($mode == 'move_up') ? &quot;right_id &lt; $right_id ORDER BY right_id DESC&quot; : &quot;left_id &gt; $left_id ORDER BY left_id ASC&quot;);
 		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1);
@@ -682,7 +693,7 @@
 
 		$forum_ids = array();
 		$sql = 'SELECT forum_id
-			FROM ' . FORUMS_TABLE . '
+			FROM ' . FORUMS_FORUMS_TABLE . '
 			WHERE left_id &gt; ' . $forum_info[$up_id]['left_id'] . '
 				AND right_id &lt; ' . $forum_info[$up_id]['right_id'];
 		$result = $_CLASS['core_db']-&gt;query($sql);
@@ -696,7 +707,7 @@
 		// Start transaction
 		$_CLASS['core_db']-&gt;transaction();
 
-		$sql = 'UPDATE ' . FORUMS_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 			SET left_id = left_id + ' . ($diff_up + 1) . ', right_id = right_id + ' . ($diff_up + 1) . '
 			WHERE left_id &gt; ' . $forum_info[$down_id]['left_id'] . '
 				AND right_id &lt; ' . $forum_info[$down_id]['right_id'];
@@ -704,18 +715,18 @@
 
 		if (count($forum_ids))
 		{
-			$sql = 'UPDATE ' . FORUMS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 				SET left_id = left_id - ' . ($diff_down + 1) . ', right_id = right_id - ' . ($diff_down + 1) . '
 				WHERE forum_id IN (' . implode(', ', $forum_ids) . ')';
 			$_CLASS['core_db']-&gt;query($sql);
 		}
 
-		$sql = 'UPDATE ' . FORUMS_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 			SET left_id = ' . $forum_info[$down_id]['left_id'] . ', right_id = ' . ($forum_info[$down_id]['left_id'] + $diff_up) . '
 			WHERE forum_id = ' . $up_id;
 		$_CLASS['core_db']-&gt;query($sql);
 
-		$sql = 'UPDATE ' . FORUMS_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 			SET left_id = ' . ($forum_info[$up_id]['right_id'] - $diff_down) . ', right_id = ' . $forum_info[$up_id]['right_id'] . '
 			WHERE forum_id = ' . $down_id;
 		$_CLASS['core_db']-&gt;query($sql);
@@ -731,11 +742,11 @@
 	case 'sync':
 		if (!$forum_id)
 		{
-			trigger_error($_CLASS['core_user']-&gt;lang['NO_FORUM']);
+			trigger_error('NO_FORUM');
 		}
 
 		$sql = &quot;SELECT forum_name
-			FROM &quot; . FORUMS_TABLE . &quot;
+			FROM &quot; . FORUMS_FORUMS_TABLE . &quot;
 			WHERE forum_id = $forum_id&quot;;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -805,7 +816,7 @@
 &lt;?php
 
 $sql = 'SELECT *
-	FROM ' . FORUMS_TABLE . &quot;
+	FROM ' . FORUMS_FORUMS_TABLE . &quot;
 	WHERE parent_id = $parent_id
 	ORDER BY left_id&quot;;
 $result = $_CLASS['core_db']-&gt;query($sql);
@@ -910,7 +921,7 @@
 	global $_CLASS;
 
 	$sql = 'SELECT *
-		FROM ' . FORUMS_TABLE . &quot;
+		FROM ' . FORUMS_FORUMS_TABLE . &quot;
 		WHERE forum_id = $forum_id&quot;;
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -982,7 +993,7 @@
 		if ($forum_data['parent_id'])
 		{
 			$sql = 'SELECT left_id, right_id
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE forum_id = ' . $forum_data['parent_id'];
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -992,12 +1003,12 @@
 			}
 			$_CLASS['core_db']-&gt;free_result($result);
 
-			$sql = 'UPDATE ' . FORUMS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 				SET left_id = left_id + 2, right_id = right_id + 2
 				WHERE left_id &gt; ' . $row['right_id'];
 			$_CLASS['core_db']-&gt;query($sql);
 
-			$sql = 'UPDATE ' . FORUMS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 				SET right_id = right_id + 2
 				WHERE ' . $row['left_id'] . ' BETWEEN left_id AND right_id';
 			$_CLASS['core_db']-&gt;query($sql);
@@ -1008,7 +1019,7 @@
 		else
 		{
 			$sql = 'SELECT MAX(right_id) AS right_id
-				FROM ' . FORUMS_TABLE;
+				FROM ' . FORUMS_FORUMS_TABLE;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
 			$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
@@ -1018,12 +1029,12 @@
 			$forum_data['right_id'] = $row['right_id'] + 2;
 		}
 
-		$sql = 'INSERT INTO ' . FORUMS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $forum_data);
+		$sql = 'INSERT INTO ' . FORUMS_FORUMS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $forum_data);
 		$_CLASS['core_db']-&gt;query($sql);
 		
 		$_CLASS['core_db']-&gt;transaction('commit');
 
-		$forum_data['forum_id'] = $_CLASS['core_db']-&gt;insert_id(FORUMS_TABLE, 'forum_id');
+		$forum_data['forum_id'] = $_CLASS['core_db']-&gt;insert_id(FORUMS_FORUMS_TABLE, 'forum_id');
 		add_log('admin', 'LOG_FORUM_ADD', $forum_data['forum_name']);
 	}
 	else
@@ -1069,7 +1080,7 @@
 		{
 			// the forum name has changed, clear the parents list of child forums
 
-			$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 				SET forum_parents = ''
 				WHERE left_id &gt; &quot; . $row['left_id'] . '
 					AND right_id &lt; ' . $row['right_id'];
@@ -1081,7 +1092,7 @@
 			return $errors;
 		}
 
-		$sql = 'UPDATE ' . FORUMS_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 			SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $forum_data) . '
 			WHERE forum_id = ' . $forum_data['forum_id'];
 		$_CLASS['core_db']-&gt;query($sql);
@@ -1105,14 +1116,14 @@
 	}
 
 	// Resync parents
-	$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 		SET right_id = right_id - $diff, forum_parents = ''
 		WHERE left_id &lt; &quot; . $from_data['right_id'] . &quot;
 			AND right_id &gt; &quot; . $from_data['right_id'];
 	$_CLASS['core_db']-&gt;query($sql);
 
 	// Resync righthand side of tree
-	$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 		SET left_id = left_id - $diff, right_id = right_id - $diff, forum_parents = ''
 		WHERE left_id &gt; &quot; . $from_data['right_id'];
 	$_CLASS['core_db']-&gt;query($sql);
@@ -1122,14 +1133,14 @@
 		$to_data = get_forum_info($to_id);
 
 		// Resync new parents
-		$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 			SET right_id = right_id + $diff, forum_parents = ''
 			WHERE &quot; . $to_data['right_id'] . ' BETWEEN left_id AND right_id
 				AND forum_id NOT IN (' . implode(', ', $moved_ids) . ')';
 		$_CLASS['core_db']-&gt;query($sql);
 
 		// Resync the righthand side of the tree
-		$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 			SET left_id = left_id + $diff, right_id = right_id + $diff, forum_parents = ''
 			WHERE left_id &gt; &quot; . $to_data['right_id'] . '
 				AND forum_id NOT IN (' . implode(', ', $moved_ids) . ')';
@@ -1149,7 +1160,7 @@
 	else
 	{
 		$sql = 'SELECT MAX(right_id) AS right_id
-			FROM ' . FORUMS_TABLE . '
+			FROM ' . FORUMS_FORUMS_TABLE . '
 			WHERE forum_id NOT IN (' . implode(', ', $moved_ids) . ')';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1159,7 +1170,7 @@
 		$diff = '+ ' . ($row['right_id'] - $from_data['left_id'] + 1);
 	}
 
-	$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 		SET left_id = left_id $diff, right_id = right_id $diff, forum_parents = ''
 		WHERE forum_id IN (&quot; . implode(', ', $moved_ids) . ')';
 	$_CLASS['core_db']-&gt;query($sql);
@@ -1203,10 +1214,14 @@
 
 	if ($action_posts == 'delete')
 	{
-		$_CLASS['core_db']-&gt;query('UPDATE '.FORUMS_TABLE.&quot; SET forum_status = '&quot;.ITEM_DELETING.&quot;' WHERE forum_id = $forum_id&quot;);
+		$_CLASS['core_db']-&gt;query('UPDATE '.FORUMS_FORUMS_TABLE.' SET forum_status = '.ITEM_DELETING.' WHERE forum_id = '.$forum_id);
 
 		$log_action_posts = 'POSTS';
-		$errors[] = delete_forum_content($forum_id);
+		
+		if ($delete_error = delete_forum_content($forum_id))
+		{
+			$errors[] = $delete_error;
+		}
 	}
 	elseif ($action_posts == 'move')
 	{
@@ -1219,7 +1234,7 @@
 			$log_action_posts = 'MOVE_POSTS';
 
 			$sql = 'SELECT forum_name 
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE forum_id = ' . $posts_to_id;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1256,11 +1271,14 @@
 		}
 		unset($rows);
 
-		$_CLASS['core_db']-&gt;query('UPDATE '.FORUMS_TABLE.&quot; SET forum_status = '&quot;.ITEM_DELETING.&quot;' WHERE forum_id  IN (&quot; . implode(', ', $forum_ids) . ')');
+		$_CLASS['core_db']-&gt;query('UPDATE '.FORUMS_FORUMS_TABLE.'  SET forum_status = '.ITEM_DELETING.' WHERE forum_id  IN (' . implode(', ', $forum_ids) . ')');
 
 		foreach ($forum_ids as $forum_id)
 		{
-			$errors[] = delete_forum_content($forum_id);
+			if ($delete_error = delete_forum_content($forum_id))
+			{
+				$errors[] = $delete_error;
+			}
 		}
 
 		if (count($errors))
@@ -1270,7 +1288,7 @@
 
 		$diff = count($forum_ids) * 2;
 
-		$sql = 'DELETE FROM ' . FORUMS_TABLE . '
+		$sql = 'DELETE FROM ' . FORUMS_FORUMS_TABLE . '
 			WHERE forum_id IN (' . implode(', ', $forum_ids) . ')';
 		$_CLASS['core_db']-&gt;query($sql);
 	}
@@ -1285,7 +1303,7 @@
 			$log_action_forums = 'MOVE_FORUMS';
 
 			$sql = 'SELECT forum_name 
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE forum_id = ' . $subforums_to_id;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1299,7 +1317,7 @@
 				unset($row);
 
 				$sql = 'SELECT forum_id
-					FROM ' . FORUMS_TABLE . &quot;
+					FROM ' . FORUMS_FORUMS_TABLE . &quot;
 					WHERE parent_id = $forum_id&quot;;
 				$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1309,13 +1327,13 @@
 				}
 				$_CLASS['core_db']-&gt;free_result($result);
 
-				$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+				$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 					SET parent_id = $subforums_to_id
 					WHERE parent_id = $forum_id&quot;;
 				$_CLASS['core_db']-&gt;query($sql);
 
 				$diff = 2;
-				$sql = 'DELETE FROM ' . FORUMS_TABLE . &quot;
+				$sql = 'DELETE FROM ' . FORUMS_FORUMS_TABLE . &quot;
 					WHERE forum_id = $forum_id&quot;;
 				$_CLASS['core_db']-&gt;query($sql);
 			}
@@ -1329,18 +1347,18 @@
 	else
 	{
 		$diff = 2;
-		$sql = 'DELETE FROM ' . FORUMS_TABLE . &quot;
+		$sql = 'DELETE FROM ' . FORUMS_FORUMS_TABLE . &quot;
 			WHERE forum_id = $forum_id&quot;;
 		$_CLASS['core_db']-&gt;query($sql);
 	}
 
 	// Resync tree
-	$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 		SET right_id = right_id - $diff
 		WHERE left_id &lt; $right_id AND right_id &gt; $right_id&quot;;
 	$_CLASS['core_db']-&gt;query($sql);
 
-	$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 		SET left_id = left_id - $diff, right_id = right_id - $diff
 		WHERE left_id &gt; $right_id&quot;;
 	$_CLASS['core_db']-&gt;query($sql);
@@ -1407,7 +1425,7 @@
 
 	$_CLASS['core_db']-&gt;transaction();
 
-	switch (SQL_LAYER)
+	switch ($_CLASS['core_db']-&gt;db_layer)
 	{
 // Needs updating and testing
 /*		case 'mysql4':
@@ -1469,7 +1487,7 @@
 		default:
 			// Select then delete all attachments
 			$sql = 'SELECT a.attach_id, a.physical_filename, a.thumbnail
-				FROM ' . POSTS_TABLE . ' p, ' . ATTACHMENTS_TABLE . &quot; a
+				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_ATTACHMENTS_TABLE . &quot; a
 				WHERE p.forum_id = $forum_id
 					AND a.in_message = 0
 					AND a.post_msg_id = p.post_id&quot;;
@@ -1481,6 +1499,7 @@
 				$attach_ids[] = $row['attach_id'];
 
 				phpbb_unlink($row['physical_filename'], 'file');
+
 				if ($row['thumbnail'])
 				{
 					phpbb_unlink($row['physical_filename'], 'thumbnail');
@@ -1491,71 +1510,68 @@
 			if (count($attach_ids))
 			{
 				$attach_id_list = implode(',', array_unique($attach_ids));
-				$_CLASS['core_db']-&gt;query('DELETE FROM ' . ATTACHMENTS_TABLE . &quot; WHERE attach_id IN ($attach_id_list)&quot;);
+				$_CLASS['core_db']-&gt;query('DELETE FROM ' . FORUMS_ATTACHMENTS_TABLE . &quot; WHERE attach_id IN ($attach_id_list)&quot;);
 				unset($attach_ids, $attach_id_list);
 			}
 
 			// Delete everything else and curse your DB for not offering multi-table deletion
 			$tables_ary = array(
 				'post_id'	=&gt;	array(
-					SEARCH_MATCH_TABLE,
-					REPORTS_TABLE,
+					FORUMS_SEARCH_MATCH_TABLE,
+					FORUMS_REPORTS_TABLE,
 				),
 				
 				'topic_id'	=&gt;	array(
-					BOOKMARKS_TABLE,
-					TOPICS_WATCH_TABLE,
-					TOPICS_TRACK_TABLE,
-					POLL_OPTIONS_TABLE,
-					POLL_VOTES_TABLE
+					FORUMS_BOOKMARKS_TABLE,
+					FORUMS_WATCH_TABLE,
+					FORUMS_TRACK_TABLE,
+					FORUMS_POLL_OPTIONS_TABLE,
+					FORUMS_POLL_VOTES_TABLE
 				)
 			);
 
 			foreach ($tables_ary as $field =&gt; $tables)
 			{
 				$start = 0;
-				$ids = array();
+				$id_array = array();
 
 				$sql = &quot;SELECT $field
-					FROM &quot; . POSTS_TABLE . '
+					FROM &quot; . FORUMS_POSTS_TABLE . '
 					WHERE forum_id = ' . $forum_id;
 				$result = $_CLASS['core_db']-&gt;query($sql);
 
 				while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 				{
-					$ids[] = $row[$field];
+					$id_array[] = $row[$field];
 				}
 				$_CLASS['core_db']-&gt;free_result($result);
 
-				if (!count($ids))
+				if (empty($id_array))
 				{
 					continue;
 				}
 
-				$id_list = implode(',', $ids);
-
 				foreach ($tables as $table)
 				{
-					$_CLASS['core_db']-&gt;query(&quot;DELETE FROM $table WHERE $field IN ($id_list)&quot;);
+					$_CLASS['core_db']-&gt;query(&quot;DELETE FROM $table WHERE $field IN (&quot;.implode(',', $id_array).')');
 				}
 			}
-			unset($ids, $id_list);
+			unset($id_array);
 
-			$table_ary = array(POSTS_TABLE, FORUMS_ACCESS_TABLE, FORUMS_TRACK_TABLE, FORUMS_WATCH_TABLE, TOPICS_TABLE, ACL_GROUPS_TABLE, ACL_USERS_TABLE, MODERATOR_TABLE, LOG_TABLE);
+			$table_ary = array(FORUMS_POSTS_TABLE, FORUMS_TRACK_TABLE, FORUMS_WATCH_TABLE, FORUMS_TOPICS_TABLE, FORUMS_ACL_TABLE, FORUMS_MODERATOR_TABLE, FORUMS_LOG_TABLE);
 
 			foreach ($table_ary as $table)
 			{
 				$_CLASS['core_db']-&gt;query(&quot;DELETE FROM $table WHERE forum_id = $forum_id&quot;);
 			}
-
-			// NEED to have this done at the end, maybe a cran
-			$tables = array_merge($tables_ary['post_id'], $tables_ary['topic_id'], $table_ary, array(ATTACHMENTS_TABLE));
-			$_CLASS['core_db']-&gt;optimize_tables($tables);
+		break;
 	}
 
 	$_CLASS['core_db']-&gt;transaction('commit');
 	
-	return array();
+	// NEED to have this done at the end, maybe a cran
+	$tables = array_unique(array_merge($tables_ary['post_id'], $tables_ary['topic_id'], $table_ary, array(FORUMS_ATTACHMENTS_TABLE)));
+	$_CLASS['core_db']-&gt;optimize_tables($tables);
 }
 
 function recalc_btree()
@@ -1563,7 +1579,7 @@
 	global $_CLASS;
 
 	$sql = 'SELECT forum_id, parent_id, left_id, right_id 
-		FROM ' . FORUMS_TABLE . '
+		FROM ' . FORUMS_FORUMS_TABLE . '
 		ORDER BY parent_id ASC';
 	$f_result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1572,23 +1588,23 @@
 		if ($forum_data['parent_id'])
 		{
 			$sql = 'SELECT left_id, right_id
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE forum_id = ' . $forum_data['parent_id'];
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
 			if (!$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 			{
-				$sql = 'UPDATE ' . FORUMS_TABLE . ' SET parent_id = 0 WHERE forum_id = ' . $forum_data['forum_id'];
+				$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . ' SET parent_id = 0 WHERE forum_id = ' . $forum_data['forum_id'];
 				$_CLASS['core_db']-&gt;query($sql);
 			}
 			$_CLASS['core_db']-&gt;free_result($result);
 
-			$sql = 'UPDATE ' . FORUMS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 				SET left_id = left_id + 2, right_id = right_id + 2
 				WHERE left_id &gt; ' . $row['right_id'];
 			$_CLASS['core_db']-&gt;query($sql);
 
-			$sql = 'UPDATE ' . FORUMS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 				SET right_id = right_id + 2
 				WHERE ' . $row['left_id'] . ' BETWEEN left_id AND right_id';
 			$_CLASS['core_db']-&gt;query($sql);
@@ -1599,7 +1615,7 @@
 		else
 		{
 			$sql = 'SELECT MAX(right_id) AS right_id
-				FROM ' . FORUMS_TABLE;
+				FROM ' . FORUMS_FORUMS_TABLE;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
 			$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
@@ -1609,7 +1625,7 @@
 			$forum_data['right_id'] = $row['right_id'] + 2;
 		}
 	
-		$sql = 'UPDATE ' . FORUMS_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 			SET left_id = ' . $forum_data['left_id'] . ', right_id = ' . $forum_data['right_id'] . '
 			WHERE forum_id = ' . $forum_data['forum_id'];
 		$_CLASS['core_db']-&gt;query($sql);

Modified: trunk/includes/forums/admin/admin_icons.php
===================================================================
--- trunk/includes/forums/admin/admin_icons.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/admin_icons.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -31,19 +31,20 @@
 // What are we working on?
 switch ($mode)
 {
-	case 'smilies':
-		$table = SMILIES_TABLE;
+/*	case 'smilies':
+		$table = FORUMS_SMILIES_TABLE;
 		$lang = 'SMILIES';
 		$fields = 'smiley';
 		$img_path = $config['smilies_path'];
-		break;
+	break;*/
 
-	case 'icons':
-		$table = ICONS_TABLE;
+	//case 'icons':
+	default:
+		$table = FORUMS_ICONS_TABLE;
 		$lang = 'ICONS';
 		$fields = 'icons';
 		$img_path = $config['icons_path'];
-		break;
+	break;
 }
 
 // Clear some arrays
@@ -96,9 +97,9 @@
 		$sql = &quot;SELECT * 
 			FROM $table 
 			ORDER BY {$fields}_order &quot; . (($id || $action == 'add') ? 'DESC' : 'ASC');
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+		$result = $_CLASS['core_db']-&gt;query($sql);
 
-		if ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+		if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
 			do
 			{
@@ -130,9 +131,9 @@
 					$order_list = '&lt;option value=&quot;' . ($row[$fields . '_order']) . '&quot;' . $selected . '&gt;' . sprintf($_CLASS['core_user']-&gt;lang['AFTER_' . $lang], ' -&gt; ' . htmlspecialchars($after_txt)) . '&lt;/option&gt;' . $order_list;
 				}
 			}
-			while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result));
+			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result));
 		}
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 
 		$order_list = '&lt;option value=&quot;1&quot;' . ((!isset($after)) ? ' selected=&quot;selected&quot;' : '') . '&gt;' . $_CLASS['core_user']-&gt;lang['FIRST'] . '&lt;/option&gt;' . $order_list;
 
@@ -312,12 +313,12 @@
 					$sql = &quot;UPDATE $table
 						SET &quot; . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $img_sql) . &quot; 
 						WHERE {$fields}_id = &quot; . $image_id[$image];
-					$_CLASS['core_db']-&gt;sql_query($sql);
+					$_CLASS['core_db']-&gt;query($sql);
 				}
 				else
 				{
 					$sql = &quot;INSERT INTO $table &quot; . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $img_sql);
-					$_CLASS['core_db']-&gt;sql_query($sql);
+					$_CLASS['core_db']-&gt;query($sql);
 				}
 
 				$update = FALSE;
@@ -326,7 +327,7 @@
 				{
 					$update = TRUE;
 
-					$result = $_CLASS['core_db']-&gt;sql_query(&quot;SELECT {$fields}_order 
+					$result = $_CLASS['core_db']-&gt;query(&quot;SELECT {$fields}_order 
 						FROM $table
 						WHERE {$fields}_id = &quot; . $image_id[$image]);
 					$order_old = $_CLASS['core_db']-&gt;sql_fetchfield($fields . '_order', 0, $result);
@@ -354,7 +355,7 @@
 					$sql = &quot;UPDATE $table
 						SET {$fields}_order = {$fields}_order $sign 1
 						WHERE $where&quot;;
-					$_CLASS['core_db']-&gt;sql_query($sql);
+					$_CLASS['core_db']-&gt;query($sql);
 				}
 			
 			}
@@ -385,7 +386,7 @@
 			// The user has already selected a smilies_pak file
 			if ($current == 'delete')
 			{
-				$_CLASS['core_db']-&gt;sql_query(&quot;TRUNCATE $table&quot;);
+				$_CLASS['core_db']-&gt;query(&quot;TRUNCATE $table&quot;);
 
 				switch ($mode)
 				{
@@ -394,9 +395,9 @@
 
 					case 'icons':
 						// Reset all icon_ids
-						$_CLASS['core_db']-&gt;sql_query('UPDATE ' . TOPICS_TABLE . ' 
+						$_CLASS['core_db']-&gt;query('UPDATE ' . TOPICS_TABLE . ' 
 							SET icon_id = 0');
-						$_CLASS['core_db']-&gt;sql_query('UPDATE ' . POSTS_TABLE . ' 
+						$_CLASS['core_db']-&gt;query('UPDATE ' . POSTS_TABLE . ' 
 							SET icon_id = 0');
 						break;
 				}
@@ -406,14 +407,14 @@
 				$cur_img = array();
 
 				$field_sql = ($mode == 'smilies') ? 'code' : 'icons_url';
-				$result = $_CLASS['core_db']-&gt;sql_query(&quot;SELECT $field_sql FROM $table&quot;);
+				$result = $_CLASS['core_db']-&gt;query(&quot;SELECT $field_sql FROM $table&quot;);
 
-				while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+				while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 				{
 					++$order;
 					$cur_img[$row[$field_sql]] = 1;
 				}
-				$_CLASS['core_db']-&gt;sql_freeresult($result);
+				$_CLASS['core_db']-&gt;free_result($result);
 			}
 
 			if (!($pak_ary = @file($img_path . '/' . $pak)))
@@ -458,7 +459,7 @@
 							));
 						}
 
-						$_CLASS['core_db']-&gt;sql_query(&quot;UPDATE $table SET &quot; . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $sql) . &quot; 
+						$_CLASS['core_db']-&gt;query(&quot;UPDATE $table SET &quot; . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $sql) . &quot; 
 							WHERE $field_sql = '&quot; . $_CLASS['core_db']-&gt;sql_escape($replace_sql) . &quot;'&quot;);
 					}
 					else
@@ -479,7 +480,7 @@
 								'emotion'	=&gt;	$emotion
 							));
 						}
-						$_CLASS['core_db']-&gt;sql_query(&quot;INSERT INTO $table &quot; . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql));
+						$_CLASS['core_db']-&gt;query(&quot;INSERT INTO $table &quot; . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql));
 					}
 
 				}
@@ -559,10 +560,10 @@
 		$sql = &quot;SELECT * 
 			FROM $table
 			ORDER BY {$fields}_order&quot;;
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		$pak = '';
-		while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
 			$pak .= &quot;'&quot; . addslashes($row[$fields . '_url']) . &quot;', &quot;;
 			$pak .= &quot;'&quot; . addslashes($row[$fields . '_height']) . &quot;', &quot;;
@@ -574,7 +575,7 @@
 			}
 			$pak .= &quot;\n&quot;;
 		}
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 
 		if ($pak != '')
 		{
@@ -593,7 +594,7 @@
 
 	case 'delete':
 
-		$_CLASS['core_db']-&gt;sql_query(&quot;DELETE FROM $table 
+		$_CLASS['core_db']-&gt;query(&quot;DELETE FROM $table 
 			WHERE {$fields}_id = $id&quot;);
 
 		switch ($mode)
@@ -603,10 +604,10 @@
 
 			case 'icons':
 				// Reset appropriate icon_ids
-				$_CLASS['core_db']-&gt;sql_query('UPDATE ' . TOPICS_TABLE . &quot; 
+				$_CLASS['core_db']-&gt;query('UPDATE ' . TOPICS_TABLE . &quot; 
 					SET icon_id = 0 
 					WHERE icon_id = $id&quot;);
-				$_CLASS['core_db']-&gt;sql_query('UPDATE ' . POSTS_TABLE . &quot; 
+				$_CLASS['core_db']-&gt;query('UPDATE ' . POSTS_TABLE . &quot; 
 					SET icon_id = 0 
 					WHERE icon_id = $id&quot;);
 				break;
@@ -625,7 +626,7 @@
 			$sql = 'UPDATE ' . $table . '
 				SET ' . $fields . &quot;_order = $order_total - &quot; . $fields . '_order
 				WHERE ' . $fields . &quot;_order IN ($image_order, &quot; . (($action == 'move_up') ? $image_order - 1 : $image_order + 1) . ')';
-			$_CLASS['core_db']-&gt;sql_query($sql);
+			$_CLASS['core_db']-&gt;query($sql);
 
 			$_CLASS['core_cache']-&gt;destroy('icons');
 
@@ -638,9 +639,9 @@
 		$sql = &quot;SELECT {$fields}_id AS order_id, {$fields}_order AS fields_order
 			FROM $table
 			ORDER BY {$fields}_order&quot;;
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+		$result = $_CLASS['core_db']-&gt;query($sql);
 
-		if ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+		if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
 			$order = 0;
 			do
@@ -648,14 +649,14 @@
 				++$order;
 				if ($row['fields_order'] != $order)
 				{
-					$_CLASS['core_db']-&gt;sql_query(&quot;UPDATE $table
+					$_CLASS['core_db']-&gt;query(&quot;UPDATE $table
 						SET {$fields}_order = $order
 						WHERE {$fields}_id = &quot; . $row['order_id']);
 				}
 			}
-			while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result));
+			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result));
 		}
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 
 		// Output the page
 		adm_page_header($_CLASS['core_user']-&gt;lang[$lang]);
@@ -707,11 +708,11 @@
 		$sql = &quot;SELECT * 
 			FROM $table
 			ORDER BY display_on_posting DESC, {$fields}_order ASC&quot;;
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+		$result = $_CLASS['core_db']-&gt;query($sql);
 		
 		$row_class = 'row1';
 
-		while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
 			if (!$spacer &amp;&amp; !$row['display_on_posting'])
 			{
@@ -744,7 +745,7 @@
 &lt;?php
 
 		}
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 
 ?&gt;
 		&lt;tr&gt;

Modified: trunk/includes/forums/admin/admin_permissions.php
===================================================================
--- trunk/includes/forums/admin/admin_permissions.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/admin_permissions.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -112,10 +112,12 @@
 {
 	$forum_id[$which_mode][] = 0;
 }
+
 $sql_forum_id = implode(', ', array_map('intval', $forum_id[$which_mode]));
 
 // Generate list of forum id's
 $s_forum_id = '';
+
 foreach ($forum_id as $forum_submode =&gt; $forum_submode_ids)
 {
 	foreach ($forum_submode_ids as $submode_forum_id)
@@ -229,17 +231,18 @@
 			$l_ug_list = '';
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 			{
-				$l_ug_list .= (($l_ug_list != '') ? ', ' : '') . ((isset($row['group_type']) &amp;&amp; $row['group_type'] == GROUP_SPECIAL) ? '&lt;span class=&quot;blue&quot;&gt;' . $_CLASS['core_user']-&gt;lang['G_' . $row['name']] . '&lt;/span&gt;' : $row['name']);
+				$l_ug_list .= (($l_ug_list != '') ? ', ' : '') . (($row['group_type'] == GROUP_SYSTEM) ? '&lt;span class=&quot;blue&quot;&gt;' . $_CLASS['core_user']-&gt;lang['G_' . $row['name']] . '&lt;/span&gt;' : $row['name']);
 			}
 			$_CLASS['core_db']-&gt;free_result($result);
 
-			foreach (array_keys($auth_settings) as $submode)
+			$auth_submode = array_keys($auth_settings);
+			foreach ($auth_submode as $sub_mode)
 			{
-				if (!in_array(0, $forum_id[$submode]))
+				if (!in_array(0, $forum_id[$sub_mode]))
 				{
 					// Grab the forum details if non-zero forum_id
 					$sql = 'SELECT forum_name  
-						FROM ' . FORUMS_TABLE . &quot;
+						FROM ' . FORUMS_FORUMS_TABLE . &quot;
 						WHERE forum_id IN ($sql_forum_id)&quot;;
 					$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -250,11 +253,11 @@
 					}
 					$_CLASS['core_db']-&gt;free_result($result);
 
-					add_log('admin', 'LOG_ACL_' . strtoupper($submode) . '_ADD', $l_forum_list, $l_ug_list);
+					add_log('admin', 'LOG_ACL_' . strtoupper($sub_mode) . '_ADD', $l_forum_list, $l_ug_list);
 				}
 				else
 				{
-					add_log('admin', 'LOG_ACL_' . strtoupper($submode) . '_ADD', $l_ug_list);
+					add_log('admin', 'LOG_ACL_' . strtoupper($sub_mode) . '_ADD', $l_ug_list);
 				}
 			}
 			unset($l_ug_list);
@@ -268,7 +271,7 @@
 	case 'delete':
 
 		$sql = &quot;SELECT auth_option_id
-			FROM &quot; . ACL_OPTIONS_TABLE . &quot;
+			FROM &quot; . FORUMS_ACL_OPTIONS_TABLE . &quot;
 			WHERE auth_option LIKE '{$sql_option_mode}_%'&quot;;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -297,7 +300,6 @@
 			cache_moderators();
 		}
 
-
 		// Logging ... first grab user or groupnames ...
 		$sql = ($ug_type == 'group') ? 'SELECT group_name as name, group_type FROM ' . GROUPS_TABLE . ' WHERE group_id' : 'SELECT username as name FROM ' . USERS_TABLE . ' WHERE user_id';
 		$sql .=  ' IN (' . implode(', ', array_map('intval', $ug_data)) . ')';
@@ -315,7 +317,7 @@
 		if (!in_array(0, $forum_id[$which_mode]))
 		{
 			$sql = 'SELECT forum_name  
-				FROM ' . FORUMS_TABLE . &quot;
+				FROM ' . FORUMS_FORUMS_TABLE . &quot;
 				WHERE forum_id IN ($sql_forum_id)&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -373,7 +375,7 @@
 		
 		if (!empty($sql['preset_name']) || $_POST['presetoption'] != -1)
 		{
-			$sql = ($_POST['presetoption'] == -1) ? 'INSERT INTO ' . ACL_PRESETS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql) : 'UPDATE ' . ACL_PRESETS_TABLE . ' SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $sql) . ' WHERE preset_id =' . intval($_POST['presetoption']);
+			$sql = ($_POST['presetoption'] == -1) ? 'INSERT INTO ' . FORUMS_ACL_PRESETS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql) : 'UPDATE ' . FORUMS_ACL_PRESETS_TABLE . ' SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $sql) . ' WHERE preset_id =' . intval($_POST['presetoption']);
 			$_CLASS['core_db']-&gt;query($sql);
 
 			add_log('admin', 'LOG_ACL_PRESET_ADD', $sql['preset_name']);
@@ -387,15 +389,15 @@
 		if (!empty($_POST['presetoption']))
 		{
 			$sql = &quot;SELECT preset_name 
-				FROM &quot; . ACL_PRESETS_TABLE . &quot; 
-				WHERE preset_id = &quot; . intval($_POST['presetoption']);
+				FROM &quot; . FORUMS_ACL_PRESETS_TABLE . &quot; 
+				WHERE preset_id = &quot; . (int) $_POST['presetoption'];
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
 			$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 			$_CLASS['core_db']-&gt;free_result($result);
 
-			$sql = &quot;DELETE FROM &quot; . ACL_PRESETS_TABLE . &quot; 
-				WHERE preset_id = &quot; . intval($_POST['presetoption']);
+			$sql = &quot;DELETE FROM &quot; . FORUMS_ACL_PRESETS_TABLE . &quot; 
+				WHERE preset_id = &quot; . (int) $_POST['presetoption'];
 			$_CLASS['core_db']-&gt;query($sql);
 
 			add_log('admin', 'LOG_ACL_PRESET_DEL', $row['preset_name']);
@@ -531,7 +533,7 @@
 				&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width:280px&quot; name=&quot;ug_data[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;&lt;?php
 			
 	$sql = &quot;SELECT u.user_id, u.username
-		FROM &quot; . USERS_TABLE . &quot; u, &quot; . ACL_TABLE . &quot; a, &quot; . ACL_OPTIONS_TABLE . &quot; o
+		FROM &quot; . USERS_TABLE . &quot; u, &quot; . FORUMS_ACL_TABLE . &quot; a, &quot; . FORUMS_ACL_OPTIONS_TABLE . &quot; o
 		WHERE o.auth_option LIKE '&quot; . $sql_option_mode . &quot;_%'
 			AND a.auth_option_id = o.auth_option_id
 			AND a.forum_id IN ($sql_forum_id)
@@ -561,7 +563,7 @@
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width:280px&quot; name=&quot;ug_data[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;&lt;?php 
 	
 	$sql = &quot;SELECT DISTINCT g.group_id, g.group_name, g.group_type 
-		FROM &quot; . GROUPS_TABLE . &quot; g, &quot; . ACL_TABLE . &quot; a, &quot; . ACL_OPTIONS_TABLE . &quot; o
+		FROM &quot; . GROUPS_TABLE . &quot; g, &quot; . FORUMS_ACL_TABLE . &quot; a, &quot; . FORUMS_ACL_OPTIONS_TABLE . &quot; o
 		WHERE o.auth_option LIKE '&quot; . $sql_option_mode . &quot;_%'
 			AND a.forum_id IN ($sql_forum_id)
 			AND a.auth_option_id = o.auth_option_id
@@ -572,7 +574,7 @@
 	$groups = '';
 	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
-		echo '&lt;option' . (($row['group_type'] == GROUP_SPECIAL) ? ' class=&quot;blue&quot;' : '') . ' value=&quot;' . $row['group_id'] . '&quot;&gt;' . (($row['group_type'] == GROUP_SPECIAL) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
+		echo '&lt;option' . (($row['group_type'] == GROUP_SYSTEM) ? ' class=&quot;blue&quot;' : '') . ' value=&quot;' . $row['group_id'] . '&quot;&gt;' . (isset($_CLASS['core_user']-&gt;lang['G_' . $row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
 	}
 	$_CLASS['core_db']-&gt;free_result($result);
 
@@ -613,7 +615,7 @@
 	$group_list = '';
 	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 	{
-		echo '&lt;option' . (($row['group_type'] == GROUP_SPECIAL) ? ' style=&quot;color: #006699;&quot;' : '') . ' value=&quot;' . $row['group_id'] . '&quot;&gt;' . (($row['group_type'] == GROUP_SPECIAL) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
+		echo '&lt;option' . (($row['group_type'] == GROUP_SYSTEM) ? ' style=&quot;color: #006699;&quot;' : '') . ' value=&quot;' . $row['group_id'] . '&quot;&gt;' . (isset($_CLASS['core_user']-&gt;lang['G_' . $row['group_name']]) ? $_CLASS['core_user']-&gt;lang['G_' . $row['group_name']] : $row['group_name']) . '&lt;/option&gt;';
 	}
 	$_CLASS['core_db']-&gt;free_result($result);
 		
@@ -654,7 +656,7 @@
 	if (!in_array(0, $forum_id[$which_mode]))
 	{
 		$sql = 'SELECT forum_id, forum_name, parent_id  
-			FROM ' . FORUMS_TABLE . &quot;
+			FROM ' . FORUMS_FORUMS_TABLE . &quot;
 			WHERE forum_id IN ($sql_forum_id)&quot;;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -680,25 +682,24 @@
 
 	// Grab relevant user or group information
 	$ug_ids = $l_ug_list = $ug_hidden = $l_no_error = '';
+// need some work ( array_mapping()) blaa blaa
 	switch ($ug_type)
 	{
 		case 'user':
-			// If we've just come from the usergroup form then user will actually
-			// be a username rather than a user_id, so act appropriately
 			$l_no_error = $_CLASS['core_user']-&gt;lang['NO_USER'];
 			$sql = 'SELECT user_id AS id, username AS name 
 				FROM ' . USERS_TABLE . ' 
 				WHERE ';
-			$sql .= ($submit == 'add_options') ? ' username IN (' . implode(', ', array_unique(preg_replace('#^[\s]*?(.*?)[\s]*?$#', &quot;'\\1'&quot;, explode(&quot;\n&quot;, $ug_data[0])))) . ')' : ' user_id ' . ((is_array($ug_data)) ? 'IN (' . implode(', ', $ug_data) . ')' : '= ' . $ug_data);
-			break;
+			$sql .= ($submit == 'add_options') ? &quot; username IN ('&quot; . implode(&quot;', '&quot;, $_CLASS['core_db']-&gt;escape_array(array_unique(explode(&quot;\n&quot;, modify_lines($ug_data[0], &quot;\n&quot;))))) . &quot;')&quot; : ' user_id ' . ((is_array($ug_data)) ? 'IN (' . implode(', ', array_map('intval', $ug_data)) . ')' : '= ' . (int) $ug_data);
+		break;
 
 		case 'group':
 			$l_no_error = $_CLASS['core_user']-&gt;lang['NO_GROUP'];
 			$sql = 'SELECT group_id AS id, group_name AS name, group_type  
 				FROM ' . GROUPS_TABLE . '
 				WHERE group_id';
-			$sql .= (is_array($ug_data)) ? ' IN (' . implode(', ', $ug_data) . ')' : ' = ' . $ug_data;
-			break;
+			$sql .= (is_array($ug_data)) ? ' IN (' . implode(', ', array_map('intval', $ug_data)) . ')' : ' = ' . (int) $ug_data;
+		break;
 	}
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -721,13 +722,11 @@
 
 	// Grab the list of options ... if we're in deps mode we want all options, 
 	// else we skip the master options
-	$sql_founder = ($_CLASS['core_user']-&gt;data['user_type'] == USER_FOUNDER) ? ' AND founder_only &lt;&gt; 1' : '';
 	$sql_limit_option = ($mode == 'deps') ? '' : &quot;AND auth_option &lt;&gt; '&quot; . $sql_option_mode . &quot;_'&quot;;
 	$sql = &quot;SELECT auth_option_id, auth_option
-		FROM &quot; . ACL_OPTIONS_TABLE . &quot;
+		FROM &quot; . FORUMS_ACL_OPTIONS_TABLE . &quot;
 		WHERE auth_option LIKE '&quot; . $sql_option_mode . &quot;_%' 
-			$sql_limit_option 
-			$sql_founder&quot;;
+			$sql_limit_option&quot;;
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
 	$auth_options = array();
@@ -751,7 +750,7 @@
 
 		 
 		$sql = &quot;SELECT o.auth_option, a.auth_setting
-					FROM &quot; . ACL_TABLE . &quot; a, &quot; . ACL_OPTIONS_TABLE . &quot; o 
+					FROM &quot; . FORUMS_ACL_TABLE . &quot; a, &quot; . FORUMS_ACL_OPTIONS_TABLE . &quot; o 
 					WHERE o.auth_option LIKE '&quot; . $sql_option_mode . &quot;_%' 
 						AND a.auth_option_id = o.auth_option_id AND a.forum_id = &quot; . $forum_data['parent_id'] . '
 						AND a.'.(($ug_type == 'group') ? 'group_id' : 'user_id').&quot; IN ($ug_ids)&quot;;
@@ -789,7 +788,7 @@
 
 	// Look for custom presets
 	$sql = &quot;SELECT preset_id, preset_name, preset_data  
-		FROM &quot; . ACL_PRESETS_TABLE . &quot; 
+		FROM &quot; . FORUMS_ACL_PRESETS_TABLE . &quot; 
 		WHERE preset_type = '&quot; . (($mode == 'deps') ? 'f' : $sql_option_mode) . &quot;' 
 		ORDER BY preset_id ASC&quot;;
 	$result = $_CLASS['core_db']-&gt;query($sql);
@@ -821,7 +820,7 @@
 		if ($which_mode == $mode)
 		{
 			$sql = 'SELECT o.auth_option, MIN(a.auth_setting) AS min_auth_setting 
-					FROM '.ACL_TABLE.' a, ' . ACL_OPTIONS_TABLE . &quot; o 
+					FROM '. FORUMS_ACL_TABLE .' a, ' . FORUMS_ACL_OPTIONS_TABLE . &quot; o 
 					WHERE o.auth_option LIKE '&quot; . $sql_option_mode . &quot;_%' 
 						AND a.auth_option_id = o.auth_option_id 
 						AND a.forum_id IN ($sql_forum_id) 

Modified: trunk/includes/forums/admin/links.php
===================================================================
--- trunk/includes/forums/admin/links.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/links.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -18,10 +18,7 @@
 	
 $module['DB']['SEARCH_INDEX'] 				= ($_CLASS['auth']-&gt;acl_get('a_search')) ? generate_link('Forums&amp;file=admin_search', array('admin' =&gt; true)) : false;
 
-$module['USER']['BOTS'] 					= ($_CLASS['auth']-&gt;acl_get('a_server')) ? generate_link('Forums&amp;file=admin_bots', array('admin' =&gt; true)) : false;
-$module['USER']['MANAGE_USERS']				= ($_CLASS['auth']-&gt;acl_gets('a_user', 'a_useradd', 'a_userdel')) ? generate_link('Forums&amp;file=admin_users', array('admin' =&gt; true)) : '';
 $module['USER']['RANKS']					= ($_CLASS['auth']-&gt;acl_get('a_ranks')) ? generate_link('Forums&amp;file=admin_ranks', array('admin' =&gt; true)) : '';
-$module['USER']['GROUP_MANAGE'] 			= ($_CLASS['auth']-&gt;acl_get('a_group')) ? generate_link('Forums&amp;file=admin_groups&amp;mode=manage', array('admin' =&gt; true)) : '';
 $module['USER']['DISALLOW']					= ($_CLASS['auth']-&gt;acl_get('a_names')) ? generate_link('Forums&amp;file=admin_disallow', array('admin' =&gt; true)) : '';
 
 $module['FORUM']['MANAGE']					= ($_CLASS['auth']-&gt;acl_gets('a_forum', 'a_forumadd', 'a_forumdel')) ? generate_link('Forums&amp;file=admin_forums', array('admin' =&gt; true)) : false;
@@ -48,7 +45,6 @@
 
 $module['POST']['ATTACHMENTS'] 				= ($_CLASS['auth']-&gt;acl_get('a_attach')) ? generate_link('Forums&amp;file=admin_attachments&amp;mode=ext_groups', array('admin' =&gt; true)) : '';
 $module['POST']['BBCODES']					= ($_CLASS['auth']-&gt;acl_get('a_bbcode')) ? generate_link('Forums&amp;file=admin_bbcodes', array('admin' =&gt; true)) : '';
-$module['POST']['SMILIES']					= ($_CLASS['auth']-&gt;acl_get('a_icons')) ? generate_link('Forums&amp;file=admin_icons&amp;mode=smilies', array('admin' =&gt; true)) : '';
 $module['POST']['ICONS']					= ($_CLASS['auth']-&gt;acl_get('a_icons')) ? generate_link('Forums&amp;file=admin_icons&amp;mode=icons', array('admin' =&gt; true)) : '';
 
 ?&gt;
\ No newline at end of file

Modified: trunk/includes/forums/admin/main.php
===================================================================
--- trunk/includes/forums/admin/main.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/admin/main.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -26,17 +26,6 @@
 
 switch ($action)
 {
-	case 'online':
-		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
-		{
-			trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
-		}
-
-		set_config('record_online_users', 1, true);
-		set_config('record_online_date', time(), true);
-		add_log('admin', 'LOG_RESET_ONLINE');
-		break;
-
 	case 'stats':
 		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
 		{
@@ -44,48 +33,41 @@
 		}
 
 		$sql = 'SELECT COUNT(post_id) AS stat 
-			FROM ' . POSTS_TABLE . '
+			FROM ' . FORUMS_POSTS_TABLE . '
 			WHERE post_approved = 1';
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+		$result = $_CLASS['core_db']-&gt;query($sql);
 
-		$row = $_CLASS['core_db']-&gt;sql_fetchrow($result);
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 		set_config('num_posts', (int) $row['stat'], true);
 
 		$sql = 'SELECT COUNT(topic_id) AS stat
-			FROM ' . TOPICS_TABLE . '
+			FROM ' . FORUMS_TOPICS_TABLE . '
 			WHERE topic_approved = 1';
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+		$result = $_CLASS['core_db']-&gt;query($sql);
 
-		$row = $_CLASS['core_db']-&gt;sql_fetchrow($result);
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+		$_CLASS['core_db']-&gt;free_result($result);
 		set_config('num_topics', (int) $row['stat'], true);
 
-		$sql = 'SELECT COUNT(user_id) AS stat
-			FROM ' . USERS_TABLE . '
-			WHERE user_type IN (' . USER_NORMAL . ',' . USER_FOUNDER . ')';
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
-
-		$row = $_CLASS['core_db']-&gt;sql_fetchrow($result);
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
-		set_config('num_users', (int) $row['stat'], true);
-
 		$sql = 'SELECT COUNT(attach_id) as stat
-			FROM ' . ATTACHMENTS_TABLE;
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+			FROM ' . FORUMS_ATTACHMENTS_TABLE;
+		$result = $_CLASS['core_db']-&gt;query($sql);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
+	
+		set_config('num_files', (int) $row['stat'], true);
+		$_CLASS['core_db']-&gt;free_result($result);
 
-		set_config('num_files', (int) $_CLASS['core_db']-&gt;sql_fetchfield('stat', 0, $result), true);
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
-
 		$sql = 'SELECT SUM(filesize) as stat
-			FROM ' . ATTACHMENTS_TABLE;
-		$result = $_CLASS['core_db']-&gt;sql_query($sql);
+			FROM ' . FORUMS_ATTACHMENTS_TABLE;
+		$result = $_CLASS['core_db']-&gt;query($sql);
+		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 
-		set_config('upload_dir_size', (int) $_CLASS['core_db']-&gt;sql_fetchfield('stat', 0, $result), true);
-		$_CLASS['core_db']-&gt;sql_freeresult($result);
+		set_config('upload_dir_size', (int) $row['stat'], true);
+		$_CLASS['core_db']-&gt;free_result($result);
 
 		add_log('admin', 'LOG_RESYNC_STATS');
-		break;
+	break;
 		
 	case 'user':
 		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
@@ -106,36 +88,26 @@
 		
 		if (!sizeof($forum_ary))
 		{
-			$_CLASS['core_db']-&gt;sql_query('UPDATE ' . USERS_TABLE . ' SET user_posts = 0');
+			$_CLASS['core_db']-&gt;query('UPDATE ' . USERS_TABLE . ' SET user_posts = 0');
 		}
 		else
 		{
 			$sql = 'SELECT COUNT(post_id) AS num_posts, poster_id
-				FROM ' . POSTS_TABLE . '
+				FROM ' . FORUMS_POSTS_TABLE . '
 				WHERE poster_id &lt;&gt; ' . ANONYMOUS . '
 					AND forum_id IN (' . implode(', ', $forum_ary) . ')
 				GROUP BY poster_id';
-			$result = $_CLASS['core_db']-&gt;sql_query($sql);
+			$result = $_CLASS['core_db']-&gt;query($sql);
 
-			while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
+			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 			{
-				$_CLASS['core_db']-&gt;sql_query('UPDATE ' . USERS_TABLE . &quot; SET user_posts = {$row['num_posts']} WHERE user_id = {$row['poster_id']}&quot;);
+				$_CLASS['core_db']-&gt;query('UPDATE ' . USERS_TABLE . &quot; SET user_posts = {$row['num_posts']} WHERE user_id = {$row['poster_id']}&quot;);
 			}
-			$_CLASS['core_db']-&gt;sql_freeresult($result);
+			$_CLASS['core_db']-&gt;free_result($result);
 		}
 
 		add_log('admin', 'LOG_RESYNC_POSTCOUNTS');
 		break;
-		
-	case 'date':
-		if (!$_CLASS['auth']-&gt;acl_get('a_defaults'))
-		{
-			trigger_error($_CLASS['core_user']-&gt;lang['NO_ADMIN']);
-		}
-
-		set_config('board_startdate', time() - 1);
-		add_log('admin', 'LOG_RESET_DATE');
-		break;
 }
 
 // Get forum statistics
@@ -146,7 +118,7 @@
 
 $start_date = $_CLASS['core_user']-&gt;format_date($config['board_startdate']);
 
-$boarddays = (time() - $config['board_startdate']) / 86400;
+$boarddays = (gmtime() - $config['board_startdate']) / 86400;
 
 $posts_per_day = sprintf('%.2f', $total_posts / $boarddays);
 $topics_per_day = sprintf('%.2f', $total_topics / $boarddays);

Modified: trunk/includes/forums/auth.php
===================================================================
--- trunk/includes/forums/auth.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/auth.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -34,7 +34,7 @@
 		if (is_null($this-&gt;acl_options = $_CLASS['core_cache']-&gt;get('acl_options')))
 		{
 			$sql = 'SELECT auth_option, is_global, is_local
-				FROM ' . ACL_OPTIONS_TABLE . '
+				FROM ' . FORUMS_ACL_OPTIONS_TABLE . '
 				ORDER BY auth_option_id';
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -257,7 +257,7 @@
 		$sql_opts = ($opts) ? (is_array($opts) ? ' AND ao.auth_option IN (' . implode(', ', preg_replace('#^[\s]*?(.*?)[\s]*?$#e', &quot;\&quot;'\&quot; . \$_CLASS['core_db']-&gt;escape('\\1') . \&quot;'\&quot;&quot;, $opts)) . ')' : &quot;AND ao.auth_option = '&quot;.$_CLASS['core_db']-&gt;escape($opts).&quot;'&quot;) : '';
 		$groups = $group_members = $hold_ary = array();
 
-		$sql = 'SELECT group_id, user_id FROM ' . USER_GROUP_TABLE .&quot; WHERE $sql_user AND user_status &lt;&gt; &quot;.STATUS_PENDING;
+		$sql = 'SELECT group_id, user_id FROM ' . USER_GROUP_TABLE .&quot; WHERE $sql_user AND member_status &lt;&gt; &quot;.STATUS_PENDING;
 // This is the why phpBB3 seems to be, the why they wanted it to act may have been the above.
 // atleast when you look at the coding....	
 		//$sql = 'SELECT group_id, user_id FROM ' . USERS_TABLE .' WHERE '.$sql_user;
@@ -274,7 +274,7 @@
 
 		// Sort by group_id since we want user setting to over right grp..  specific &gt; broad
 		$sql = 'SELECT ao.auth_option, a.user_id, a.group_id, a.forum_id, a.auth_setting
-					FROM ' . ACL_TABLE . ' a, ' . ACL_OPTIONS_TABLE . &quot; ao
+					FROM ' . FORUMS_ACL_TABLE . ' a, ' . FORUMS_ACL_OPTIONS_TABLE . &quot; ao
 					WHERE a.auth_option_id = ao.auth_option_id 
 						$sql_user $sql_forum $sql_opts
 						ORDER BY a.group_id&quot;;
@@ -331,7 +331,7 @@
 
 		// Grab group settings ... ACL_NO overrides ACL_YES so act appropriatley
 		$sql = 'SELECT a.group_id, ao.auth_option, a.forum_id, a.auth_setting
-			FROM ' . ACL_OPTIONS_TABLE . ' ao, ' . ACL_GROUPS_TABLE . ' a
+			FROM ' . FORUMS_ACL_OPTIONS_TABLE . ' ao, ' . FORUMS_ACL_GROUPS_TABLE . ' a
 			WHERE ao.auth_option_id = a.auth_option_id
 				' . (($sql_group) ? 'AND a.' . $sql_group : '') . &quot;
 				$sql_forum

Modified: trunk/includes/forums/bbcode.php
===================================================================
--- trunk/includes/forums/bbcode.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/bbcode.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -227,7 +227,7 @@
 			$rowset = array();
 
 			$sql = 'SELECT *
-				FROM ' . BBCODES_TABLE . &quot;
+				FROM ' . FORUMS_BBCODES_TABLE . &quot;
 				WHERE bbcode_id IN ($sql)&quot;;
 
 			$result = $_CLASS['core_db']-&gt;query($sql);

Modified: trunk/includes/forums/functions.php
===================================================================
--- trunk/includes/forums/functions.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/functions.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -23,12 +23,16 @@
 // 
 // -------------------------------------------------------------
 
+// Error messages just incase we can't get our configs
+$config_error = '&lt;center&gt;There is currently a problem with the site&lt;br/&gt;';
+$config_error .= 'Please try again later&lt;br /&gt;&lt;br /&gt;Error Code: DB3&lt;/center&gt;';
+
 if (is_null($config = $_CLASS['core_cache']-&gt;get('config')))
 {
 	$config = $cached_config = array();
 
 	$sql = 'SELECT config_name, config_value, is_dynamic
-		FROM ' . CONFIG_TABLE;
+		FROM ' . FORUMS_CONFIG_TABLE;
 			
 	if (!$result = $_CLASS['core_db']-&gt;query($sql))
 	{
@@ -53,33 +57,31 @@
 else
 {
 	$sql = 'SELECT config_name, config_value
-		FROM ' . CONFIG_TABLE . '
+		FROM ' . FORUMS_CONFIG_TABLE . '
 		WHERE is_dynamic = 1';
 	$result = $_CLASS['core_db']-&gt;query($sql);
 	
-	if (is_array($result))
+	if ($result = $_CLASS['core_db']-&gt;query($sql))
 	{
-		trigger_error($config_error, E_USER_ERROR);
+		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+		{
+			$config[$row['config_name']] = $row['config_value'];
+		}
 	}
-	
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-	{
-		$config[$row['config_name']] = $row['config_value'];
-	}
 }
 
 function set_config($config_name, $config_value, $is_dynamic = false)
 {
 	global $_CLASS, $config;
 
-	$sql = 'UPDATE ' . CONFIG_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_CONFIG_TABLE . &quot;
 		SET config_value = '&quot; . $_CLASS['core_db']-&gt;escape($config_value) . &quot;'
 		WHERE config_name = '&quot; . $_CLASS['core_db']-&gt;escape($config_name) . &quot;'&quot;;
 	$_CLASS['core_db']-&gt;query($sql);
 
 	if (!$_CLASS['core_db']-&gt;affected_rows() &amp;&amp; !isset($config[$config_name]))
 	{
-		$sql = 'INSERT INTO ' . CONFIG_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
+		$sql = 'INSERT INTO ' . FORUMS_CONFIG_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
 			'config_name'	=&gt; $config_name,
 			'config_value'	=&gt; $config_value,
 			'is_dynamic'	=&gt; ($is_dynamic) ? 1 : 0));
@@ -220,7 +222,7 @@
 		unset($bbcode);
 	}
 
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'S_FORUM_RULES'	=&gt; true,
 		'U_FORUM_RULES'	=&gt; $forum_data['forum_rules_link'],
 		'FORUM_RULES'   =&gt; $forum_data['forum_rules'])
@@ -262,7 +264,7 @@
 		)
 	);
 
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'FORUM_ID' 		=&gt; $forum_data['forum_id'],
 		'FORUM_NAME'	=&gt; $forum_data['forum_name'],
 		'FORUM_DESC'	=&gt; strip_tags($forum_data['forum_desc']))
@@ -283,7 +285,7 @@
 		if ($forum_data['forum_parents'] == '')
 		{
 			$sql = 'SELECT forum_id, forum_name, forum_type
-				FROM ' . FORUMS_TABLE . '
+				FROM ' . FORUMS_FORUMS_TABLE . '
 				WHERE left_id &lt; ' . $forum_data['left_id'] . '
 					AND right_id &gt; ' . $forum_data['right_id'] . '
 				ORDER BY left_id ASC';
@@ -297,7 +299,7 @@
 
 			$forum_data['forum_parents'] = serialize($forum_parents);
 
-			$sql = 'UPDATE ' . FORUMS_TABLE . &quot;
+			$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . &quot;
 				SET forum_parents = '&quot; . $_CLASS['core_db']-&gt;escape($forum_data['forum_parents']) . &quot;'
 				WHERE parent_id = &quot; . $forum_data['parent_id'];
 			$_CLASS['core_db']-&gt;query($sql);
@@ -331,7 +333,7 @@
 	}
 
 	$sql = 'SELECT *
-		FROM ' . MODERATOR_TABLE . &quot;
+		FROM ' . FORUMS_MODERATOR_TABLE . &quot;
 		WHERE display_on_index = 1
 			$forum_sql&quot;;
 	$result = $_CLASS['core_db']-&gt;query($sql);
@@ -418,7 +420,7 @@
 	}
 
 	$sql = 'SELECT forum_id, forum_name, parent_id, forum_type, left_id, right_id
-		FROM ' . FORUMS_TABLE . '
+		FROM ' . FORUMS_FORUMS_TABLE . '
 		ORDER BY left_id ASC';
 	$result = $_CLASS['core_db']-&gt;query($sql, 600);
 
@@ -489,7 +491,7 @@
 	}
 	$_CLASS['core_db']-&gt;free_result($result);
 
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'S_DISPLAY_JUMPBOX'	=&gt; $display_jumpbox,
 		'S_JUMPBOX_ACTION'	=&gt; $action)
 	);
@@ -621,7 +623,7 @@
 	switch ($mode)
 	{
 		case 'forum':
-			$forum_id = (is_array($forum_id)) ? array_map('intval', $forum_id) : array($forum_id);
+			$forum_id = is_array($forum_id) ? array_map('intval', $forum_id) : array($forum_id);
 
 			if ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['load_db_lastread'])
 			{
@@ -649,7 +651,7 @@
 				{
 					$sql = 'DELETE FROM ' . FORUMS_TRACK_TABLE . '
 						WHERE user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . '
-							AND forum_id IN (' . implode(', ', $delete_array) . ')';
+							AND forum_id IN (' . implode(', ', $delete_array) . ') AND  topic_id &lt;&gt; 0';
 					$_CLASS['core_db']-&gt;query($sql);
 				}
 				unset($delete_array);
@@ -659,44 +661,19 @@
 					$sql = 'UPDATE ' . FORUMS_TRACK_TABLE . &quot;
 						SET mark_time = $time 
 						WHERE user_id = &quot; . $_CLASS['core_user']-&gt;data['user_id'] . '
-							AND forum_id IN (' . implode(', ', $sql_update) . ')
+							AND forum_id IN (' . implode(', ', $update_array) . ')
 							AND topic_id = 0';
 					$_CLASS['core_db']-&gt;query($sql);
 				}
 
 				if ($sql_insert = array_diff($forum_id, $update_array))
 				{
-					$sql = '';
-
 					foreach ($sql_insert as $forum_id)
 					{
-						switch ($_CLASS['core_db']-&gt;db_layer)
-						{
-							case 'mysql':
-							
-								$sql .= (($sql != '') ? ', ' : '') . '(' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $time)&quot;;
-								$sql = 'VALUES ' . $sql;
-								break;
+						$sql = 'INSERT INTO ' . FORUMS_TRACK_TABLE . ' (user_id, forum_id, mark_time)
+							VALUES (' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $time)&quot;;
 
-							case 'mysql4':
-							case 'mssql':
-							case 'mysqli':
-							case 'sqlite':
-								$sql .= (($sql != '') ? ' UNION ALL ' : '') . ' SELECT ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $time&quot;;
-								break;
-
-							default:
-								$sql = 'INSERT INTO ' . FORUMS_TRACK_TABLE . ' (user_id, forum_id, mark_time)
-									VALUES (' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $time)&quot;;
-								$_CLASS['core_db']-&gt;query($sql);
-								$sql = '';
-						}
-
-						if ($sql)
-						{
-							$sql = 'INSERT INTO ' . FORUMS_TRACK_TABLE . &quot; (user_id, forum_id, mark_time) $sql&quot;;
-							$_CLASS['core_db']-&gt;query($sql);
-						}
+						$_CLASS['core_db']-&gt;query($sql);
 					}
 				}
 			}
@@ -719,15 +696,12 @@
 			settype($topic_id, 'integer');
 			settype($forum_id, 'integer');
 
-//if ($_CLASS['core_user']-&gt;is_user &amp;&amp; ($config['load_db_lastread'] || ($config['load_db_track'] &amp;&amp; $type == TRACK_POSTED)))
-// what is this $config['load_db_track'] ?
-
 			if ($_CLASS['core_user']-&gt;is_user &amp;&amp; $config['load_db_lastread'])
 			{
 				$sql = 'UPDATE ' . FORUMS_TRACK_TABLE . &quot;
 							SET forum_id = $forum_id, mark_time = $time
 								WHERE topic_id = $topic_id
-								AND user_id = {$_CLASS['core_user']-&gt;data['user_id']}&quot;;
+								AND user_id = &quot;.$_CLASS['core_user']-&gt;data['user_id'];
 
 				if (!$_CLASS['core_db']-&gt;query($sql) || !$_CLASS['core_db']-&gt;affected_rows())
 				{
@@ -741,8 +715,7 @@
 					$_CLASS['core_db']-&gt;query('INSERT INTO ' . FORUMS_TRACK_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql_ary));
 				}
 			}
-
-			if (!$config['load_db_lastread'])
+			else
 			{
 				$tracking = array();
 				if (isset($_COOKIE[$_CORE_CONFIG['server']['cookie_name'] . '_track']))
@@ -798,7 +771,7 @@
 	if (is_null($censors = $_CLASS['core_cache']-&gt;get('word_censors')))
 	{
 		$sql = 'SELECT word, replacement
-			FROM  ' . WORDS_TABLE;
+			FROM  ' . FORUMS_WORDS_TABLE;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		$censors = array();
@@ -825,7 +798,7 @@
 	if (is_null($icons = $_CLASS['core_cache']-&gt;get('icons')))
 	{
 		$sql = 'SELECT *
-			FROM ' . ICONS_TABLE . ' 
+			FROM ' . FORUMS_ICONS_TABLE . ' 
 			ORDER BY icons_order';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -855,7 +828,7 @@
 	if (is_null($ranks = $_CLASS['core_cache']-&gt;get('ranks')))
 	{
 		$sql = 'SELECT *
-			FROM ' . RANKS_TABLE . '
+			FROM ' . FORUMS_RANKS_TABLE . '
 			ORDER BY rank_min DESC';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -891,9 +864,7 @@
 {
 	global $_CLASS;
 
-	$extensions = $_CLASS['core_cache']-&gt;get('extensions');
-
-	if (is_null($extensions))
+	if (is_null($extensions = $_CLASS['core_cache']-&gt;get('extensions')))
 	{
 		// The rule is to only allow those extensions defined. ;)
 		$sql = 'SELECT e.extension, g.*
@@ -974,42 +945,6 @@
 	return (($config['cookie_secure']) ? '<A HREF="https://">https://</A>' : '<A HREF="http://">http://</A>') . preg_replace('#^/?(.*?)/?$#', '\1', trim($config['server_name'])) . (($config['server_port'] &lt;&gt; 80) ? ':' . trim($config['server_port']) : '') . (($path) ? '/' . $path : '');
 }
 
-// Redirects the user to another page then exits the script nicely
-function redirect($url)
-{
-	global $_CLASS, $config;
-
-	script_close();
-
-	// Make sure no &amp;'s are in, this will break the redirect
-	$url = str_replace('&amp;', '&amp;', $url);
-	
-	// Local redirect? If not, prepend the boards url
-	if (strpos($url, '://') === false &amp;&amp; $url{0} != '/')
-	{
-		$url = generate_board_url() . preg_replace('#^/?(.*?)/?$#', '/\1', trim($url));
-	}
-
-	// Redirect via an HTML form for PITA webservers
-	if (@preg_match('#Microsoft|WebSTAR|Xitami#', getenv('SERVER_SOFTWARE')))
-	{
-		header('Refresh: 0; URL=' . $url);
-		echo '&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=' . $url . '&quot;&gt;&lt;title&gt;Redirect&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div align=&quot;center&quot;&gt;' . sprintf($_CLASS['core_user']-&gt;lang['URL_REDIRECT'], '&lt;a href=&quot;' . $url . '&quot;&gt;', '&lt;/a&gt;') . '&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;';
-		exit;
-	}
-
-	// Behave as per HTTP/1.1 spec for others
-	header('Location: ' . $url);
-	exit;
-}
-
-// Build Confirm box
-// something is wrong with $check in this function
-function confirm_box($check, $title = '', $hidden = '', $html_body = 'confirm_body.html')
-{
-
-}
-
 // Generate forum login box
 function login_forum_box($forum_data)
 {
@@ -1064,9 +999,9 @@
 
 		$_CLASS['core_template']-&gt;assign('LOGIN_ERROR', $_CLASS['core_user']-&gt;lang['WRONG_PASSWORD']);
 	}
-	
+
 	page_header();
-	
+
 	$_CLASS['core_template']-&gt;display('modules/Forums/login_forum.html');
 
 	script_close();
@@ -1265,7 +1200,7 @@
 						$row['username'] = '&lt;b style=&quot;color:#' . $row['user_colour'] . '&quot;&gt;' . $row['username'] . '&lt;/b&gt;';
 					}
 
-					if ($row['user_allow_viewonline'] &amp;&amp; $row['session_viewonline'])
+					if ($row['user_allow_viewonline'] &amp;&amp; !$row['session_hidden'])
 					{
 						$user_online_link = $row['username'];
 						$logged_visible_online++;
@@ -1275,7 +1210,7 @@
 						$user_online_link = '&lt;i&gt;' . $row['username'] . '&lt;/i&gt;';
 						$logged_hidden_online++;
 					}
-
+// Fix this
 					if ($row['user_allow_viewonline'] || $_CLASS['auth']-&gt;acl_get('u_viewonline'))
 					{
 						$user_online_link = ($row['user_type'] &amp; USER_BOT) ? &quot;&lt;a href=\&quot;&quot; . generate_link('Members_List&amp;&amp;mode=viewprofile&amp;u=' . $row['user_id']) . '&quot;&gt;' . $user_online_link . '&lt;/a&gt;' : $user_online_link;
@@ -1389,7 +1324,7 @@
 
 	// The following assigns all _common_ variables that may be used at any point
 	// in a template.
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'LAST_VISIT_DATE' 			=&gt; sprintf($_CLASS['core_user']-&gt;lang['YOU_LAST_VISIT'], $s_last_visit),
 		'CURRENT_TIME'				=&gt; sprintf($_CLASS['core_user']-&gt;lang['CURRENT_TIME'], $_CLASS['core_user']-&gt;format_date(time(), false, true)),
 		'TOTAL_USERS_ONLINE' 		=&gt; $l_online_users,

Modified: trunk/includes/forums/functions_admin.php
===================================================================
--- trunk/includes/forums/functions_admin.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/functions_admin.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -32,7 +32,7 @@
 
 	// This query is identical to the jumpbox one
 	$sql = 'SELECT forum_id, parent_id, forum_name, forum_type, left_id, right_id
-		FROM ' . FORUMS_TABLE . '
+		FROM ' . FORUMS_FORUMS_TABLE . '
 		ORDER BY left_id ASC';
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -123,7 +123,7 @@
 		// This query is identical to the jumpbox one
 		$expire_time = ($no_cache) ? 0 : 120;
 		$sql = 'SELECT forum_id, parent_id, forum_name, forum_type, left_id, right_id
-			FROM ' . FORUMS_TABLE . '
+			FROM ' . FORUMS_FORUMS_TABLE . '
 			ORDER BY left_id ASC';
 		$result = $_CLASS['core_db']-&gt;query($sql, $expire_time);
 
@@ -172,8 +172,8 @@
 	$rows = array();
 
 	$sql = 'SELECT f2.*
-		FROM ' . FORUMS_TABLE . ' f1
-		LEFT JOIN ' . FORUMS_TABLE . &quot; f2 ON $condition
+		FROM ' . FORUMS_FORUMS_TABLE . ' f1
+		LEFT JOIN ' . FORUMS_FORUMS_TABLE . &quot; f2 ON $condition
 		WHERE f1.forum_id = $forum_id
 		ORDER BY f2.left_id &quot; . (($order == 'descending') ? 'ASC' : 'DESC');
 	$result = $_CLASS['core_db']-&gt;query($sql);
@@ -234,7 +234,7 @@
 	$forum_ids = array($forum_id);
 	$sql_where = (is_array($topic_ids)) ? 'IN (' . implode(', ', $topic_ids) . ')' : '= ' . $topic_ids;
 
-	$sql = 'DELETE FROM ' . TOPICS_TABLE . &quot;
+	$sql = 'DELETE FROM ' . FORUMS_TOPICS_TABLE . &quot;
 		WHERE topic_moved_id $sql_where
 			AND forum_id = &quot; . $forum_id;
 	$_CLASS['core_db']-&gt;query($sql);
@@ -242,7 +242,7 @@
 	if ($auto_sync)
 	{
 		$sql = 'SELECT DISTINCT forum_id
-			FROM ' . TOPICS_TABLE . '
+			FROM ' . FORUMS_TOPICS_TABLE . '
 			WHERE topic_id ' . $sql_where;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -253,7 +253,7 @@
 		$_CLASS['core_db']-&gt;free_result($result);
 	}
 	
-	$table_ary = array(TOPICS_TABLE, POSTS_TABLE, LOG_TABLE);
+	$table_ary = array(FORUMS_TOPICS_TABLE, FORUMS_POSTS_TABLE, FORUMS_LOG_TABLE);
 	foreach ($table_ary as $table)
 	{
 		$sql = &quot;UPDATE $table
@@ -285,7 +285,7 @@
 		$topic_ids = array($topic_id);
 
 		$sql = 'SELECT DISTINCT topic_id, forum_id
-			FROM ' . POSTS_TABLE . '
+			FROM ' . FORUMS_POSTS_TABLE . '
 			WHERE post_id IN (' . implode(', ', $post_ids) . ')';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -298,7 +298,7 @@
 	}
 
 	$sql = 'SELECT forum_id 
-		FROM ' . TOPICS_TABLE . ' 
+		FROM ' . FORUMS_TOPICS_TABLE . ' 
 		WHERE topic_id = ' . $topic_id;
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -308,12 +308,12 @@
 	}
 	$_CLASS['core_db']-&gt;free_result($result);
 
-	$sql = 'UPDATE ' . POSTS_TABLE . '
+	$sql = 'UPDATE ' . FORUMS_POSTS_TABLE . '
 		SET forum_id = ' . $row['forum_id'] . &quot;, topic_id = $topic_id
 		WHERE post_id IN (&quot; . implode(', ', $post_ids) . ')';
 	$_CLASS['core_db']-&gt;query($sql);
 
-	$sql = 'UPDATE ' . ATTACHMENTS_TABLE . &quot;
+	$sql = 'UPDATE ' . FORUMS_ATTACHMENTS_TABLE . &quot;
 		SET topic_id = $topic_id
 			AND in_message = 0
 		WHERE post_msg_id IN (&quot; . implode(', ', $post_ids) . ')';
@@ -349,7 +349,7 @@
 	);
 
 	$sql = 'SELECT topic_id, forum_id
-		FROM ' . TOPICS_TABLE . &quot;
+		FROM ' . FORUMS_TOPICS_TABLE . &quot;
 		WHERE $where_type &quot; . ((!is_array($where_ids)) ? &quot;= $where_ids&quot; : 'IN (' . implode(', ', $where_ids) . ')');
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -371,9 +371,9 @@
 
 	$sql_where = ' IN (' . implode(', ', $topic_ids) . ')';
 
-	$_CLASS['core_db']-&gt;sql_transaction('begin');
+	$_CLASS['core_db']-&gt;transaction();
 
-	$table_ary = array(TOPICS_TRACK_TABLE, POLL_VOTES_TABLE, POLL_OPTIONS_TABLE, TOPICS_WATCH_TABLE, TOPICS_TABLE);
+	$table_ary = array(FORUMS_TRACK_TABLE, FORUMS_POLL_VOTES_TABLE, FORUMS_POLL_OPTIONS_TABLE, FORUMS_WATCH_TABLE, FORUMS_TOPICS_TABLE);
 	foreach ($table_ary as $table)
 	{
 		$sql = &quot;DELETE FROM $table 
@@ -382,11 +382,11 @@
 	}
 	unset($table_ary);
 
-	$sql = 'DELETE FROM ' . TOPICS_TABLE . ' 
+	$sql = 'DELETE FROM ' . FORUMS_TOPICS_TABLE . ' 
 		WHERE topic_moved_id' . $sql_where;
 	$_CLASS['core_db']-&gt;query($sql);
 
-	$_CLASS['core_db']-&gt;sql_transaction('commit');
+	$_CLASS['core_db']-&gt;transaction('commit');
 
 	if ($auto_sync)
 	{
@@ -405,14 +405,16 @@
 	{
 		$where_ids = array_unique($where_ids);
 	}
+
 	if (empty($where_ids))
 	{
 		return false;
 	}
+
 	$post_ids = $topic_ids = $forum_ids = array();
 
 	$sql = 'SELECT post_id, topic_id, forum_id
-		FROM ' . POSTS_TABLE . &quot;
+		FROM ' . FORUMS_POSTS_TABLE . &quot;
 		WHERE $where_type &quot; . ((!is_array($where_ids)) ? &quot;= $where_ids&quot; : 'IN (' . implode(', ', $where_ids) . ')');
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -432,8 +434,7 @@
 
 	$_CLASS['core_db']-&gt;sql_transaction('begin');
 
-	$table_ary = array(POSTS_TABLE, RATINGS_TABLE, REPORTS_TABLE, SEARCH_MATCH_TABLE);
-	//$table_ary = array(POSTS_TABLE, REPORTS_TABLE, SEARCH_MATCH_TABLE);
+	$table_ary = array(FORUMS_POSTS_TABLE, FORUMS_REPORTS_TABLE, FORUMS_SEARCH_MATCH_TABLE);
 	
 	foreach ($table_ary as $table)
 	{
@@ -445,7 +446,7 @@
 
 	delete_attachments('post', $post_ids, false);
 
-	$_CLASS['core_db']-&gt;sql_transaction('commit');
+	$_CLASS['core_db']-&gt;transaction('commit');
 
 	if ($auto_sync)
 	{
@@ -483,7 +484,7 @@
 	if ($mode == 'attach' || $mode == 'user' || ($mode == 'topic' &amp;&amp; $resync))
 	{
 		$sql = 'SELECT post_msg_id as post_id, topic_id, physical_filename, thumbnail, filesize
-			FROM ' . ATTACHMENTS_TABLE . '
+			FROM ' . FORUMS_ATTACHMENTS_TABLE . '
 			WHERE ' . $sql_id . ' IN (' . implode(', ', $ids) . ')';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 			
@@ -499,7 +500,7 @@
 	if ($mode == 'post')
 	{
 		$sql = 'SELECT topic_id, physical_filename, thumbnail, filesize
-			FROM ' . ATTACHMENTS_TABLE . '
+			FROM ' . FORUMS_ATTACHMENTS_TABLE . '
 			WHERE post_msg_id IN (' . implode(', ', $ids) . ')
 				AND in_message = 0';
 		$result = $_CLASS['core_db']-&gt;query($sql);
@@ -513,8 +514,8 @@
 	}
 
 	// Delete attachments
-	$_CLASS['core_db']-&gt;query('DELETE FROM ' . ATTACHMENTS_TABLE . ' WHERE ' . $sql_id . ' IN (' . implode(', ', $ids) . ')');
-	$num_deleted = $_CLASS['core_db']-&gt;sql_affectedrows();
+	$_CLASS['core_db']-&gt;query('DELETE FROM ' . FORUMS_ATTACHMENTS_TABLE . ' WHERE ' . $sql_id . ' IN (' . implode(', ', $ids) . ')');
+	$num_deleted = $_CLASS['core_db']-&gt;affected_rows();
 
 	if (!$num_deleted)
 	{
@@ -536,6 +537,7 @@
 			phpbb_unlink($file_ary['filename'], 'thumbnail');
 		}
 	}
+
 	set_config('upload_dir_size', $config['upload_dir_size'] - $space_removed, true);
 	set_config('num_files', $config['num_files'] - $files_removed, true);
 
@@ -558,7 +560,7 @@
 	{
 		if ($mode == 'post' || $mode == 'topic')
 		{
-			$_CLASS['core_db']-&gt;query('UPDATE ' . POSTS_TABLE . ' 
+			$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_POSTS_TABLE . ' 
 				SET post_attachment = 0
 				WHERE post_id IN (' . implode(', ', $post_ids) . ')');
 		}
@@ -568,7 +570,7 @@
 			$remaining = array();
 
 			$sql = 'SELECT post_msg_id
-					FROM ' . ATTACHMENTS_TABLE . ' 
+					FROM ' . FORUMS_ATTACHMENTS_TABLE . ' 
 					WHERE post_msg_id IN (' . implode(', ', $post_ids) . ')
 						AND in_message = 0';
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -582,7 +584,7 @@
 			$unset_ids = array_diff($post_ids, $remaining);
 			if (sizeof($unset_ids))
 			{
-				$_CLASS['core_db']-&gt;query('UPDATE ' . POSTS_TABLE . ' 
+				$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_POSTS_TABLE . ' 
 					SET post_attachment = 0
 					WHERE post_id IN (' . implode(', ', $unset_ids) . ')');
 			}
@@ -590,7 +592,7 @@
 			$remaining = array();
 
 			$sql = 'SELECT post_msg_id
-					FROM ' . ATTACHMENTS_TABLE . ' 
+					FROM ' . FORUMS_ATTACHMENTS_TABLE . ' 
 					WHERE post_msg_id IN (' . implode(', ', $post_ids) . ')
 						AND in_message = 1';
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -604,7 +606,7 @@
 			$unset_ids = array_diff($post_ids, $remaining);
 			if (sizeof($unset_ids))
 			{
-				$_CLASS['core_db']-&gt;query('UPDATE ' . PRIVMSGS_TABLE . ' 
+				$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_PRIVMSGS_TABLE . ' 
 					SET message_attachment = 0
 					WHERE msg_id IN (' . implode(', ', $unset_ids) . ')');
 			}
@@ -616,7 +618,7 @@
 		// Update topic indicator
 		if ($mode == 'topic')
 		{
-			$_CLASS['core_db']-&gt;query('UPDATE ' . TOPICS_TABLE . '
+			$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_TOPICS_TABLE . '
 				SET topic_attachment = 0
 				WHERE topic_id IN (' . implode(', ', $topic_ids) . ')');
 		}
@@ -626,7 +628,7 @@
 			$remaining = array();
 
 			$sql = 'SELECT topic_id
-					FROM ' . ATTACHMENTS_TABLE . ' 
+					FROM ' . FORUMS_ATTACHMENTS_TABLE . ' 
 					WHERE topic_id IN (' . implode(', ', $topic_ids) . ')';
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -639,7 +641,7 @@
 			$unset_ids = array_diff($topic_ids, $remaining);
 			if (sizeof($unset_ids))
 			{
-				$_CLASS['core_db']-&gt;query('UPDATE ' . TOPICS_TABLE . ' 
+				$_CLASS['core_db']-&gt;query('UPDATE ' . FORUMS_TOPICS_TABLE . ' 
 					SET topic_attachment = 0
 					WHERE topic_id IN (' . implode(', ', $unset_ids) . ')');
 			}
@@ -658,18 +660,18 @@
 		case 'mysql4':
 		case 'mysqli':
 			$sql = 'DELETE t.*
-				FROM ' . TOPICS_TABLE . ' t, ' . TOPICS_TABLE . ' t2
+				FROM ' . FORUMS_TOPICS_TABLE . ' t, ' . FORUMS_TOPICS_TABLE . ' t2
 				WHERE t.topic_moved_id = t2.topic_id
-					AND t.topic_time &lt; ' . (time() - $max_age)
+					AND t.topic_time &lt; ' . (gmtime() - $max_age)
 				. $where;
 			$_CLASS['core_db']-&gt;query($sql);
 		break;
 	
 		default:
 			$sql = 'SELECT t.topic_id
-				FROM ' . TOPICS_TABLE . ' t, ' . TOPICS_TABLE . ' t2
+				FROM ' . FORUMS_TOPICS_TABLE . ' t, ' . FORUMS_TOPICS_TABLE . ' t2
 				WHERE t.topic_moved_id = t2.topic_id
-					AND t.topic_time &lt; ' . (time() - $max_age)
+					AND t.topic_time &lt; ' . (gmtime() - $max_age)
 				. $where;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			
@@ -681,7 +683,7 @@
 
 			if (sizeof($topic_ids))
 			{
-				$sql = 'DELETE FROM ' . TOPICS_TABLE . '
+				$sql = 'DELETE FROM ' . FORUMS_TOPICS_TABLE . '
 					WHERE topic_id IN (' . implode(',', $topic_ids) . ')';
 				$_CLASS['core_db']-&gt;query($sql);
 			}
@@ -777,8 +779,8 @@
 			{
 				case 'mysql4':
 				case 'mysqli':
-					$sql = 'DELETE FROM ' . TOPICS_TABLE . '
-						USING ' . TOPICS_TABLE . ' t1, ' . TOPICS_TABLE . &quot; t2
+					$sql = 'DELETE FROM ' . FORUMS_TOPICS_TABLE . '
+						USING ' . FORUMS_TOPICS_TABLE . ' t1, ' . FORUMS_TOPICS_TABLE . &quot; t2
 						WHERE t1.topic_moved_id = t2.topic_id
 							AND t1.forum_id = t2.forum_id&quot;;
 					$_CLASS['core_db']-&gt;query($sql);
@@ -786,7 +788,7 @@
 			
 				default:
 					$sql = 'SELECT t1.topic_id
-						FROM ' .TOPICS_TABLE . ' t1, ' . TOPICS_TABLE . &quot; t2
+						FROM ' .FORUMS_TOPICS_TABLE . ' t1, ' . FORUMS_TOPICS_TABLE . &quot; t2
 						WHERE t1.topic_moved_id = t2.topic_id
 							AND t1.forum_id = t2.forum_id&quot;;
 					$result = $_CLASS['core_db']-&gt;query($sql);
@@ -814,7 +816,7 @@
 			{
 				case 'mysql4':
 				case 'mysqli':
-					$sql = 'UPDATE ' . TOPICS_TABLE . ' t, ' . POSTS_TABLE . &quot; p
+					$sql = 'UPDATE ' . FORUMS_TOPICS_TABLE . ' t, ' . FORUMS_POSTS_TABLE . &quot; p
 						SET t.topic_approved = p.post_approved
 						$where_sql_and t.topic_first_post_id = p.post_id&quot;;
 					$_CLASS['core_db']-&gt;query($sql);
@@ -822,7 +824,7 @@
 			
 				default:
 					$sql = 'SELECT t.topic_id, p.post_approved
-						FROM ' . TOPICS_TABLE . ' t, ' . POSTS_TABLE . &quot; p
+						FROM ' . FORUMS_TOPICS_TABLE . ' t, ' . FORUMS_POSTS_TABLE . &quot; p
 						$where_sql_and p.post_id = t.topic_first_post_id
 							AND p.post_approved &lt;&gt; t.topic_approved&quot;;
 					$result = $_CLASS['core_db']-&gt;query($sql);
@@ -839,7 +841,7 @@
 						return;
 					}
 
-					$sql = 'UPDATE ' . TOPICS_TABLE . '
+					$sql = 'UPDATE ' . FORUMS_TOPICS_TABLE . '
 						SET topic_approved = 1 - topic_approved
 						WHERE topic_id IN (' . implode(', ', $topic_ids) . ')';
 					$_CLASS['core_db']-&gt;query($sql);
@@ -850,7 +852,7 @@
 			$post_ids = $post_reported = array();
 
 			$sql = 'SELECT p.post_id, p.post_reported
-				FROM ' . POSTS_TABLE . &quot; p
+				FROM ' . FORUMS_POSTS_TABLE . &quot; p
 				$where_sql
 				GROUP BY p.post_id, p.post_reported&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -864,7 +866,7 @@
 			}
 
 			$sql = 'SELECT DISTINCT(post_id)
-				FROM ' . REPORTS_TABLE . '
+				FROM ' . FORUMS_REPORTS_TABLE . '
 				WHERE post_id IN (' . implode(', ', $post_ids) . ')';
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -890,7 +892,7 @@
 
 			if (sizeof($post_ids))
 			{
-				$sql = 'UPDATE ' . POSTS_TABLE . '
+				$sql = 'UPDATE ' . FORUMS_POSTS_TABLE . '
 					SET post_reported = 1 - post_reported
 					WHERE post_id IN (' . implode(', ', $post_ids) . ')';
 				$_CLASS['core_db']-&gt;query($sql);
@@ -906,7 +908,7 @@
 			$topic_ids = $topic_reported = array();
 
 			$sql = 'SELECT DISTINCT(t.topic_id)
-				FROM ' . POSTS_TABLE . &quot; t
+				FROM ' . FORUMS_POSTS_TABLE . &quot; t
 				$where_sql_and t.post_reported = 1&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -915,7 +917,7 @@
 			}
 
 			$sql = 'SELECT t.topic_id, t.topic_reported
-				FROM ' . TOPICS_TABLE . &quot; t
+				FROM ' . FORUMS_TOPICS_TABLE . &quot; t
 				$where_sql&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -928,7 +930,7 @@
 
 			if (sizeof($topic_ids))
 			{
-				$sql = 'UPDATE ' . TOPICS_TABLE . '
+				$sql = 'UPDATE ' . FORUMS_TOPICS_TABLE . '
 					SET topic_reported = 1 - topic_reported
 					WHERE topic_id IN (' . implode(', ', $topic_ids) . ')';
 				$_CLASS['core_db']-&gt;query($sql);
@@ -939,7 +941,7 @@
 			$post_ids = $post_attachment = array();
 
 			$sql = 'SELECT p.post_id, p.post_attachment
-				FROM ' . POSTS_TABLE . &quot; p
+				FROM ' . FORUMS_POSTS_TABLE . &quot; p
 				$where_sql
 				GROUP BY p.post_id, p.post_attachment&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -953,7 +955,7 @@
 			}
 
 			$sql = 'SELECT DISTINCT(post_msg_id)
-				FROM ' . ATTACHMENTS_TABLE . '
+				FROM ' . FORUMS_ATTACHMENTS_TABLE . '
 				WHERE post_msg_id IN (' . implode(', ', $post_ids) . ')
 					AND in_message = 0';
 
@@ -980,7 +982,7 @@
 
 			if (sizeof($post_ids))
 			{
-				$sql = 'UPDATE ' . POSTS_TABLE . '
+				$sql = 'UPDATE ' . FORUMS_POSTS_TABLE . '
 					SET post_attachment = 1 - post_attachment
 					WHERE post_id IN (' . implode(', ', $post_ids) . ')';
 				$_CLASS['core_db']-&gt;query($sql);
@@ -996,7 +998,7 @@
 			$topic_ids = $topic_attachment = array();
 
 			$sql = 'SELECT DISTINCT(t.topic_id)
-				FROM ' . POSTS_TABLE . &quot; t
+				FROM ' . FORUMS_POSTS_TABLE . &quot; t
 				$where_sql_and t.post_attachment = 1&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -1005,7 +1007,7 @@
 			}
 
 			$sql = 'SELECT t.topic_id, t.topic_attachment
-				FROM ' . TOPICS_TABLE . &quot; t
+				FROM ' . FORUMS_TOPICS_TABLE . &quot; t
 				$where_sql&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -1018,7 +1020,7 @@
 
 			if (sizeof($topic_ids))
 			{
-				$sql = 'UPDATE ' . TOPICS_TABLE . '
+				$sql = 'UPDATE ' . FORUMS_TOPICS_TABLE . '
 					SET topic_attachment = 1 - topic_attachment
 					WHERE topic_id IN (' . implode(', ', $topic_ids) . ')';
 				$_CLASS['core_db']-&gt;query($sql);
@@ -1028,7 +1030,7 @@
 		case 'forum':
 			// 1: Get the list of all forums
 			$sql = 'SELECT f.*
-				FROM ' . FORUMS_TABLE . &quot; f
+				FROM ' . FORUMS_FORUMS_TABLE . &quot; f
 				$where_sql&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1055,7 +1057,7 @@
 
 			// 2: Get topic counts for each forum
 			$sql = 'SELECT forum_id, topic_approved, COUNT(topic_id) AS forum_topics
-				FROM ' . TOPICS_TABLE . '
+				FROM ' . FORUMS_TOPICS_TABLE . '
 				WHERE forum_id IN (' . implode(', ', $forum_ids) . ')
 				GROUP BY forum_id, topic_approved';
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1072,7 +1074,7 @@
 
 			// 3: Get post count and last_post_id for each forum
 			$sql = 'SELECT forum_id, COUNT(post_id) AS forum_posts, MAX(post_id) AS last_post_id
-				FROM ' . POSTS_TABLE . '
+				FROM ' . FORUMS_POSTS_TABLE . '
 				WHERE forum_id IN (' . implode(', ', $forum_ids) . ')
 					AND post_approved = 1
 				GROUP BY forum_id';
@@ -1091,7 +1093,7 @@
 			if (sizeof($post_ids))
 			{
 				$sql = 'SELECT p.post_id, p.poster_id, p.post_time, p.post_username, u.username
-					FROM ' . POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+					FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
 					WHERE p.post_id IN (' . implode(', ', $post_ids) . ')
 						AND p.poster_id = u.user_id';
 				$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1148,7 +1150,7 @@
 
 				if (sizeof($sql))
 				{
-					$sql = 'UPDATE ' . FORUMS_TABLE . '
+					$sql = 'UPDATE ' . FORUMS_FORUMS_TABLE . '
 						SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $sql) . '
 						WHERE forum_id = ' . $forum_id;
 					$_CLASS['core_db']-&gt;query($sql);
@@ -1160,7 +1162,7 @@
 			$topic_data = $post_ids = $approved_unapproved_ids = $resync_forums = $delete_topics = $delete_posts = array();
 
 			$sql = 'SELECT t.topic_id, t.forum_id, t.topic_approved, ' . (($sync_extra) ? 't.topic_attachment, t.topic_reported, ' : '') . 't.topic_poster, t.topic_time, t.topic_replies, t.topic_replies_real, t.topic_first_post_id, t.topic_first_poster_name, t.topic_last_post_id, t.topic_last_poster_id, t.topic_last_poster_name, t.topic_last_post_time
-				FROM ' . TOPICS_TABLE . &quot; t
+				FROM ' . FORUMS_TOPICS_TABLE . &quot; t
 				$where_sql&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1187,7 +1189,7 @@
 			// Use &quot;t&quot; as table alias because of the $where_sql clause
          // NOTE: 't.post_approved' in the GROUP BY is causing a major slowdown.
 			$sql = 'SELECT t.topic_id, t.post_approved, COUNT(t.post_id) AS total_posts, MIN(t.post_id) AS first_post_id, MAX(t.post_id) AS last_post_id
-				FROM ' . POSTS_TABLE . &quot; t
+				FROM ' . FORUMS_POSTS_TABLE . &quot; t
 				$where_sql
 				GROUP BY t.topic_id&quot;; //, t.post_approved&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1257,7 +1259,7 @@
 			}
 
 			$sql = 'SELECT p.post_id, p.topic_id, p.post_approved, p.poster_id, p.post_username, p.post_time, u.username
-				FROM ' . POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
 				WHERE p.post_id IN (' . implode(',', $post_ids) . ')
 					AND u.user_id = p.poster_id';
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1304,7 +1306,7 @@
 				// This routine assumes that post_reported values are correct
 				// if they are not, use sync('post_reported') first
 				$sql = 'SELECT t.topic_id, p.post_id
-					FROM ' . TOPICS_TABLE . ' t, ' . POSTS_TABLE . &quot; p
+					FROM ' . FORUMS_TOPICS_TABLE . ' t, ' . FORUMS_POSTS_TABLE . &quot; p
 					$where_sql_and p.topic_id = t.topic_id
 						AND p.post_reported = 1
 					GROUP BY t.topic_id&quot;;
@@ -1689,36 +1691,37 @@
 	$args = func_get_args();
 
 	$mode			= array_shift($args);
-	$reportee_id	= ($mode == 'user') ? intval(array_shift($args)) : '';
-	$forum_id		= ($mode == 'mod') ? intval(array_shift($args)) : '';
-	$topic_id		= ($mode == 'mod') ? intval(array_shift($args)) : '';
+	$reportee_id	= ($mode == 'user') ? (int) array_shift($args) : '';
+	$forum_id		= ($mode == 'mod') ? (int) array_shift($args) : '';
+	$topic_id		= ($mode == 'mod') ? (int) array_shift($args) : '';
 	$action			= array_shift($args);
-	$data			= (!sizeof($args)) ? '' : $_CLASS['core_db']-&gt;escape(serialize($args));
+	$data			= empty($args) ? '' : $_CLASS['core_db']-&gt;escape(serialize($args));
 
 	switch ($mode)
 	{
 		case 'admin':
-			$sql = 'INSERT INTO ' . LOG_TABLE . ' (log_type, user_id, log_ip, log_time, log_operation, log_data)
-				VALUES (' . LOG_ADMIN . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . time() . &quot;, '$action', '$data')&quot;;
-			break;
+			$sql = 'INSERT INTO ' . FORUMS_LOG_TABLE . ' (log_type, user_id, log_ip, log_time, log_operation, log_data)
+				VALUES (' . LOG_ADMIN . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . gmtime() . &quot;, '$action', '$data')&quot;;
+		break;
 		
 		case 'mod':
-			$sql = 'INSERT INTO ' . LOG_TABLE . ' (log_type, user_id, forum_id, topic_id, log_ip, log_time, log_operation, log_data)
-				VALUES (' . LOG_MOD . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $topic_id, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . time() . &quot;, '$action', '$data')&quot;;
-			break;
+			$sql = 'INSERT INTO ' . FORUMS_LOG_TABLE . ' (log_type, user_id, forum_id, topic_id, log_ip, log_time, log_operation, log_data)
+				VALUES (' . LOG_MOD . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $forum_id, $topic_id, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . gmtime() . &quot;, '$action', '$data')&quot;;
+		break;
 
 		case 'user':
-			$sql = 'INSERT INTO ' . LOG_TABLE . ' (log_type, user_id, reportee_id, log_ip, log_time, log_operation, log_data)
-				VALUES (' . LOG_USERS . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $reportee_id, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . time() . &quot;, '$action', '$data')&quot;;
-			break;
+			$sql = 'INSERT INTO ' . FORUMS_LOG_TABLE . ' (log_type, user_id, reportee_id, log_ip, log_time, log_operation, log_data)
+				VALUES (' . LOG_USERS . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, $reportee_id, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . gmtime() . &quot;, '$action', '$data')&quot;;
+		break;
 
 		case 'critical':
-			$sql = 'INSERT INTO ' . LOG_TABLE . ' (log_type, user_id, log_ip, log_time, log_operation, log_data)
-				VALUES (' . LOG_CRITICAL . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . time() . &quot;, '$action', '$data')&quot;;
-			break;
+			$sql = 'INSERT INTO ' . FORUMS_LOG_TABLE . ' (log_type, user_id, log_ip, log_time, log_operation, log_data)
+				VALUES (' . LOG_CRITICAL . ', ' . $_CLASS['core_user']-&gt;data['user_id'] . &quot;, '&quot;.$_CLASS['core_user']-&gt;ip.&quot;', &quot; . gmtime() . &quot;, '$action', '$data')&quot;;
+		break;
 		
 		default:
 			return;
+		break;
 	}
 
 	$_CLASS['core_db']-&gt;query($sql);
@@ -1770,7 +1773,7 @@
 	}
 
 	$sql = &quot;SELECT l.*, u.username
-		FROM &quot; . LOG_TABLE . &quot; l, &quot; . USERS_TABLE . &quot; u
+		FROM &quot; . FORUMS_LOG_TABLE . &quot; l, &quot; . USERS_TABLE . &quot; u
 		WHERE l.log_type = $log_type
 			AND u.user_id = l.user_id
 			&quot; . (($limit_days) ? &quot;AND l.log_time &gt;= $limit_days&quot; : '') . &quot;
@@ -1829,8 +1832,8 @@
 		// This query is not really needed if move_topics() updates the forum_id field, 
 		// altough it's also used to determine if the topic still exists in the database
 		$sql = 'SELECT topic_id, forum_id
-			FROM ' . TOPICS_TABLE . '
-			WHERE topic_id IN (' . implode(', ', array_map('intval', $topic_id_list)) . ')';
+			FROM ' . FORUMS_TOPICS_TABLE . '
+			WHERE topic_id IN (' . implode(', ', $topic_id_list) . ')';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -1856,7 +1859,7 @@
 	}
 
 	$sql = 'SELECT COUNT(l.log_id) AS total_entries
-		FROM ' . LOG_TABLE . &quot; l
+		FROM ' . FORUMS_LOG_TABLE . &quot; l
 		WHERE l.log_type = $log_type
 			AND l.log_time &gt;= $limit_days
 			$sql_forum&quot;;
@@ -1904,7 +1907,7 @@
 			}
 
 			$sql = 'SELECT auth_option_id, auth_option
-				FROM ' . ACL_OPTIONS_TABLE;
+				FROM ' . FORUMS_ACL_OPTIONS_TABLE;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -1917,7 +1920,7 @@
 			$id_field  = $ug_type . '_id';
 
 			$sql =  'SELECT o.auth_option_id, o.auth_option, a.forum_id, a.auth_setting
-						FROM ' . ACL_TABLE . ' a, ' . ACL_OPTIONS_TABLE . &quot; o
+						FROM ' . FORUMS_ACL_TABLE . ' a, ' . FORUMS_ACL_OPTIONS_TABLE . &quot; o
 							WHERE a.auth_option_id = o.auth_option_id $sql_forum
 							AND a.$id_field = $ug_id&quot;;
 
@@ -1964,7 +1967,7 @@
 				{
 					foreach ($update_option_ids as $setting =&gt; $option_ids)
 					{
-						$sql_ary['update'][] = 'UPDATE ' . ACL_TABLE . &quot; 
+						$sql_ary['update'][] = 'UPDATE ' . FORUMS_ACL_TABLE . &quot; 
 							SET auth_setting = $setting 
 							WHERE $id_field = $ug_id 
 								AND forum_id = $forum 
@@ -1974,7 +1977,7 @@
 
 				if (!empty($delete_option_ids))
 				{
-					$sql_ary['delete'][] = 'DELETE FROM '.ACL_TABLE .&quot;
+					$sql_ary['delete'][] = 'DELETE FROM '.FORUMS_ACL_TABLE .&quot;
 					WHERE $id_field = $ug_id
 						AND forum_id = $forum
 						AND auth_option_id IN (&quot; . implode(', ', $delete_option_ids) . ')';
@@ -2006,7 +2009,7 @@
 							default:
 								foreach ($sql_subary as $sql)
 								{
-									$sql = 'INSERT INTO '.ACL_TABLE.&quot; ($id_field, forum_id, auth_option_id, auth_setting) VALUES ($sql)&quot;;
+									$sql = 'INSERT INTO '.FORUMS_ACL_TABLE.&quot; ($id_field, forum_id, auth_option_id, auth_setting) VALUES ($sql)&quot;;
 									$_CLASS['core_db']-&gt;query($sql);
 								}
 								$sql = '';
@@ -2015,7 +2018,7 @@
 
 						if ($sql)
 						{
-							$sql = 'INSERT INTO '.ACL_TABLE.&quot; ($id_field, forum_id, auth_option_id, auth_setting) $sql&quot;;
+							$sql = 'INSERT INTO '.FORUMS_ACL_TABLE.&quot; ($id_field, forum_id, auth_option_id, auth_setting) $sql&quot;;
 							$_CLASS['core_db']-&gt;query($sql);
 						}
 					break;
@@ -2137,7 +2140,7 @@
 							$sql .= (($sql != '') ? ', ' : '') . &quot;('$option', &quot; . $type_sql[$type] . &quot;)&quot;;
 							break;
 							
-						case 'mysql4':
+						case 'mysql':
 						case 'mysqli':
 						case 'mssql':
 						case 'sqlite':

Modified: trunk/includes/forums/functions_display.php
===================================================================
--- trunk/includes/forums/functions_display.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/functions_display.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -60,7 +60,7 @@
 	}
 
 	$sql = &quot;SELECT f.* $lastread_select 
-		FROM &quot;. FORUMS_TABLE . &quot; f $sql_from
+		FROM &quot;. FORUMS_FORUMS_TABLE . &quot; f $sql_from
 		WHERE forum_status &lt;&gt; &quot;.ITEM_DELETING.&quot;
 		$sql_where
 		ORDER BY f.left_id&quot;;
@@ -328,11 +328,9 @@
 		);
 	}
 
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'U_MARK_FORUMS'		=&gt; generate_link('Forums&amp;file=viewforum&amp;f=' . $root_data['forum_id'] . '&amp;mark=Forums'), 
-
 		'S_HAS_SUBFORUM'	=&gt;	($visible_forums) ? true : false,
-
 		'L_SUBFORUM'		=&gt;	($visible_forums == 1) ? $_CLASS['core_user']-&gt;lang['SUBFORUM'] : $_CLASS['core_user']-&gt;lang['SUBFORUMS']
 	));
 
@@ -350,40 +348,6 @@
 	return $topic_author;
 }
 
-function topic_generate_pagination($replies, $url)
-{
-	global $config, $_CLASS;
-
-	if (($replies + 1) &gt; $config['posts_per_page'])
-	{
-		$total_pages = ceil(($replies + 1) / $config['posts_per_page']);
-		$pagination = '';
-	
-		$times = 1;
-		for ($j = 0; $j &lt; $replies + 1; $j += $config['posts_per_page'])
-		{
-			$pagination .= '&lt;a href=&quot;'.generate_link($url.'&amp;start='.$j).'&quot;&gt;'.$times.'&lt;/a&gt;';
-			if ($times == 1 &amp;&amp; $total_pages &gt; 4)
-			{
-				$pagination .= ' ... ';
-				$times = $total_pages - 3;
-				$j += ($total_pages - 4) * $config['posts_per_page'];
-			}
-			else if ($times &lt; $total_pages)
-			{
-				$pagination .= $_CLASS['core_user']-&gt;img['pagination_sep'];
-			}
-			$times++;
-		}
-	}
-	else
-	{
-		$pagination = '';
-	}
-
-	return $pagination;
-}
-
 function topic_status(&amp;$topic_row, $replies, $mark_time, &amp;$folder_img, &amp;$folder_alt, &amp;$topic_type)
 {
 	global $_CLASS, $config;

Modified: trunk/includes/forums/functions_posting.php
===================================================================
--- trunk/includes/forums/functions_posting.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/functions_posting.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -35,7 +35,7 @@
 	{
 		$sql = 'SELECT smiley_id
 			FROM ' . SMILIES_TABLE . '
-			WHERE display_on_posting = 0';
+			WHERE smiley_type = 0';
 		$result = $_CLASS['core_db']-&gt;query_limit($sql, 1, 0);
 
 		if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -51,18 +51,18 @@
 
 		$sql = 'SELECT *
 			FROM ' . SMILIES_TABLE .' 
-				WHERE display_on_posting ='.(($mode == 'inline') ? '1' : '0') . '
+				WHERE smiley_type ='.(($mode == 'inline') ? '1' : '0') . '
 					ORDER BY smiley_order';
 		$result = $_CLASS['core_db']-&gt;query($sql);
 	
 		while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 		{
 			$smiley[] = array(
-				'SMILEY_CODE' 	=&gt; $row['code'],
-				'SMILEY_IMG' 	=&gt; $row['smiley_url'],
+				'SMILEY_CODE' 	=&gt; $row['smiley_code'],
+				'SMILEY_IMG' 	=&gt; $row['smiley_src'],
 				'SMILEY_WIDTH'  =&gt; $row['smiley_width'],
 				'SMILEY_HEIGHT' =&gt; $row['smiley_height'],
-				'SMILEY_DESC'   =&gt; $row['emotion']
+				'SMILEY_DESC'   =&gt; $row['smiley_description']
 			);
 		}
 
@@ -74,7 +74,7 @@
 
 	if ($mode == 'inline')
 	{
-		$_CLASS['core_template']-&gt;assign(array(
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'S_SHOW_SMILEY_LINK' 	=&gt; ($display_link) ? true : false,
 			'U_MORE_SMILIES' 		=&gt; generate_link('Forums&amp;file=posting&amp;mode=smilies&amp;f='.$forum_id))
 		);
@@ -99,7 +99,7 @@
 	$update_sql = array();
 
 	$sql = 'SELECT MAX(p.post_id) as last_post_id
-		FROM ' . POSTS_TABLE . ' p, ' . TOPICS_TABLE . &quot; t
+		FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_TOPICS_TABLE . &quot; t
 		WHERE p.topic_id = t.topic_id
 			AND p.post_approved = 1
 			AND t.topic_approved = 1
@@ -111,7 +111,7 @@
 	if ((int) $row['last_post_id'])
 	{
 		$sql = 'SELECT p.post_id, p.poster_id, p.post_time, u.username, p.post_username
-			FROM ' . POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
 			WHERE p.poster_id = u.user_id
 				AND p.post_id = ' . $row['last_post_id'];
 		$result = $_CLASS['core_db']-&gt;query($sql);
@@ -568,7 +568,7 @@
 			$_CLASS['core_template']-&gt;assign_vars_array('topic_type', $array);
 		}
 
-		$_CLASS['core_template']-&gt;assign(array(
+		$_CLASS['core_template']-&gt;assign_array(array(
 			'S_TOPIC_TYPE_STICKY'	=&gt; ($_CLASS['auth']-&gt;acl_get('f_sticky', $forum_id)),
 			'S_TOPIC_TYPE_ANNOUNCE'	=&gt; ($_CLASS['auth']-&gt;acl_get('f_announce', $forum_id)))
 		);
@@ -581,15 +581,11 @@
 {
 	global $_CLASS, $config;
 		
-	$_CLASS['core_template']-&gt;assign(array(
-		'S_SHOW_ATTACH_BOX'	=&gt; true)
-	);
+	$_CLASS['core_template']-&gt;assign('S_SHOW_ATTACH_BOX', true);
 
 	if (sizeof($attachment_data))
 	{
-		$_CLASS['core_template']-&gt;assign(array(
-			'S_HAS_ATTACHMENTS'	=&gt; true)
-		);
+		$_CLASS['core_template']-&gt;assign('S_HAS_ATTACHMENTS', true);
 		
 		$count = 0;
 		foreach ($attachment_data as $attach_row)
@@ -619,7 +615,7 @@
 		}
 	}
 
-	$_CLASS['core_template']-&gt;assign(array(
+	$_CLASS['core_template']-&gt;assign_array(array(
 		'FILE_COMMENT'  =&gt; $filename_data['filecomment'],
 		'FILESIZE'		=&gt; $config['max_filesize'])
 	);
@@ -682,10 +678,7 @@
 	
 	if (sizeof($draftrows))
 	{
-		$_CLASS['core_template']-&gt;assign(array(
-				'S_SHOW_DRAFTS' =&gt; true,
-				'L_FORUM'		=&gt; $_CLASS['core_user']-&gt;lang['FORUM']
-			));
+		$_CLASS['core_template']-&gt;assign_array('S_SHOW_DRAFTS', true);
 
 		foreach ($draftrows as $draft)
 		{
@@ -740,7 +733,7 @@
 
 	// Go ahead and pull all data for this topic
 	$sql = 'SELECT u.username, u.user_id, p.post_id, p.post_username, p.post_subject, p.post_text, p.enable_smilies, p.bbcode_uid, p.bbcode_bitfield, p.post_time
-		FROM ' . POSTS_TABLE . ' p, ' . USERS_TABLE . &quot; u
+		FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . &quot; u
 		WHERE p.topic_id = $topic_id
 			AND p.poster_id = u.user_id
 			&quot; . ((!$_CLASS['auth']-&gt;acl_get('m_approve', $forum_id)) ? 'AND p.post_approved = 1' : '') . '

Modified: trunk/includes/forums/functions_privmsgs.php
===================================================================
--- trunk/includes/forums/functions_privmsgs.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/functions_privmsgs.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -124,7 +124,7 @@
 
 	// Get folder informations
 	$sql = 'SELECT folder_id, COUNT(msg_id) as num_messages, SUM(unread) as num_unread
-		FROM ' . PRIVMSGS_TO_TABLE . &quot;
+		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . &quot;
 		WHERE user_id = $user_id
 			AND folder_id &lt;&gt; &quot; . PRIVMSGS_NO_BOX . '
 		GROUP BY folder_id';
@@ -159,7 +159,7 @@
 
 	// Custom Folder
 	$sql = 'SELECT folder_id, folder_name, pm_count
-		FROM ' . PRIVMSGS_FOLDER_TABLE . &quot;
+		FROM ' . FORUMS_PRIVMSGS_FOLDER_TABLE . &quot;
 			WHERE user_id = $user_id&quot;;
 	$result = $_CLASS['core_db']-&gt;query($sql);
 			
@@ -202,7 +202,7 @@
 	{
 		// Delete old messages
 		$sql = 'SELECT t.msg_id
-			FROM ' . PRIVMSGS_TO_TABLE . ' t, ' . PRIVMSGS_TABLE . ' p
+			FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p
 			WHERE t.msg_id = p.msg_id
 				AND t.user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . '
 				AND t.folder_id = ' . PRIVMSGS_SENTBOX . '
@@ -282,7 +282,7 @@
 	if ($user_message_rules)
 	{
 		$sql = 'SELECT * 
-			FROM ' . PRIVMSGS_RULES_TABLE . &quot;
+			FROM ' . FORUMS_PRIVMSGS_RULES_TABLE . &quot;
 			WHERE user_id = $user_id&quot;;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -306,7 +306,7 @@
 
 	if ($release)
 	{
-		$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . ' 
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . ' 
 			SET folder_id = ' . PRIVMSGS_NO_BOX . '
 			WHERE folder_id = ' . PRIVMSGS_HOLD_BOX . &quot;
 				AND user_id = $user_id&quot;;
@@ -316,7 +316,7 @@
 	// Get those messages not yet placed into any box
 	// NOTE: Expand Group Information to all groups the user/author is in? 
 	$sql = 'SELECT t.*, p.*, u.username, u.group_id as author_in_group
-		FROM ' . PRIVMSGS_TO_TABLE . ' t, ' . PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . &quot; u
+		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . &quot; u
 		WHERE t.user_id = $user_id
 			AND p.author_id = u.user_id
 			AND t.folder_id = &quot; . PRIVMSGS_NO_BOX . '
@@ -419,7 +419,7 @@
 	// Set messages to Unread
 	if (sizeof($unread_ids))
 	{
-		$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . ' 
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . ' 
 			SET unread = 0
 			WHERE msg_id IN (' . implode(', ', $unread_ids) . &quot;)
 				AND user_id = $user_id
@@ -430,7 +430,7 @@
 	// mark messages as important
 	if (sizeof($important_ids))
 	{
-		$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . '
 			SET marked = !marked
 			WHERE folder_id = ' . PRIVMSGS_NO_BOX . &quot;
 				AND user_id = $user_id
@@ -447,7 +447,7 @@
 		$full_folder_action = ($_CLASS['core_user']-&gt;data['user_full_folder'] == FULL_FOLDER_NONE) ? ($config['full_folder_action'] - (FULL_FOLDER_NONE*(-1))) : $_CLASS['core_user']-&gt;data['user_full_folder'];
 
 		$sql = 'SELECT folder_id, pm_count 
-			FROM ' . PRIVMSGS_FOLDER_TABLE . '
+			FROM ' . FORUMS_PRIVMSGS_FOLDER_TABLE . '
 			WHERE folder_id IN (' . implode(', ', array_keys($move_into_folder)) . (($full_folder_action &gt;= 0) ? ', ' . $full_folder_action : '') . &quot;)
 				AND user_id = $user_id&quot;;
 		$result = $_CLASS['core_db']-&gt;query($sql);
@@ -461,7 +461,7 @@
 		if (in_array(PRIVMSGS_INBOX, array_keys($move_into_folder)))
 		{
 			$sql = 'SELECT folder_id, COUNT(msg_id) as num_messages
-				FROM ' . PRIVMSGS_TO_TABLE . &quot;
+				FROM ' . FORUMS_PRIVMSGS_TO_TABLE . &quot;
 				WHERE user_id = $user_id
 					AND folder_id = &quot; . PRIVMSGS_INBOX . &quot;
 				GROUP BY folder_id&quot;;
@@ -501,7 +501,7 @@
 			{
 				// Delete some messages ;)
 				$sql = 'SELECT t.msg_id
-					FROM ' . PRIVMSGS_TO_TABLE . ' t, ' . PRIVMSGS_TABLE . &quot; p
+					FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . &quot; p
 					WHERE t.msg_id = p.msg_id
 						AND t.user_id = $user_id
 						AND t.folder_id = $dest_folder
@@ -521,7 +521,7 @@
 		if ($full_folder_action == FULL_FOLDER_HOLD)
 		{
 			$num_not_moved += sizeof($msg_ary);
-			$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . '
 				SET folder_id = ' . PRIVMSGS_HOLD_BOX . '
 				WHERE folder_id = ' . PRIVMSGS_NO_BOX . &quot;
 					AND user_id = $user_id
@@ -530,7 +530,7 @@
 		}
 		else
 		{
-			$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . &quot; 
+			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . &quot; 
 				SET folder_id = $dest_folder, new = 0
 				WHERE folder_id = &quot; . PRIVMSGS_NO_BOX . &quot;
 					AND user_id = $user_id
@@ -540,7 +540,7 @@
 
 			if ($dest_folder != PRIVMSGS_INBOX)
 			{
-				$sql = 'UPDATE ' . PRIVMSGS_FOLDER_TABLE . '
+				$sql = 'UPDATE ' . FORUMS_PRIVMSGS_FOLDER_TABLE . '
 					SET pm_count = pm_count + ' . (int) $_CLASS['core_db']-&gt;sql_affectedrows() . &quot;
 					WHERE folder_id = $dest_folder
 						AND user_id = $user_id&quot;;
@@ -557,7 +557,7 @@
 	{
 		// Move from OUTBOX to SENTBOX
 		// We are not checking any full folder status here... SENTBOX is a special treatment (old messages get deleted)
-		$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . ' 
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . ' 
 			SET folder_id = ' . PRIVMSGS_SENTBOX . '
 			WHERE folder_id = ' . PRIVMSGS_OUTBOX . '
 				AND msg_id IN (' . implode(', ', array_keys($action_ary)) . ')';
@@ -601,7 +601,7 @@
 		if ($dest_folder != PRIVMSGS_INBOX)
 		{
 			$sql = 'SELECT folder_id, folder_name, pm_count
-				FROM ' . PRIVMSGS_FOLDER_TABLE . &quot;
+				FROM ' . FORUMS_PRIVMSGS_FOLDER_TABLE . &quot;
 				WHERE folder_id = $dest_folder
 					AND user_id = $user_id&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -622,7 +622,7 @@
 		else
 		{
 			$sql = 'SELECT COUNT(msg_id) as num_messages
-				FROM ' . PRIVMSGS_TO_TABLE . '
+				FROM ' . FORUMS_PRIVMSGS_TO_TABLE . '
 				WHERE folder_id = ' . PRIVMSGS_INBOX . &quot;
 					AND user_id = $user_id&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -634,7 +634,7 @@
 			}
 		}
 
-		$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . &quot;
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . &quot;
 			SET folder_id = $dest_folder
 			WHERE folder_id = $cur_folder_id
 				AND user_id = $user_id
@@ -647,7 +647,7 @@
 		{
 			if (!in_array($cur_folder_id, array(PRIVMSGS_INBOX, PRIVMSGS_OUTBOX, PRIVMSGS_SENTBOX)))
 			{
-				$sql = 'UPDATE ' . PRIVMSGS_FOLDER_TABLE . &quot;
+				$sql = 'UPDATE ' . FORUMS_PRIVMSGS_FOLDER_TABLE . &quot;
 					SET pm_count = pm_count - $num_moved
 					WHERE folder_id = $cur_folder_id
 						AND user_id = $user_id&quot;;
@@ -656,7 +656,7 @@
 
 			if ($dest_folder != PRIVMSGS_INBOX)
 			{
-				$sql = 'UPDATE ' . PRIVMSGS_FOLDER_TABLE . &quot;
+				$sql = 'UPDATE ' . FORUMS_PRIVMSGS_FOLDER_TABLE . &quot;
 					SET pm_count = pm_count + $num_moved
 					WHERE folder_id = $dest_folder
 						AND user_id = $user_id&quot;;
@@ -678,7 +678,7 @@
 
 	global $_CLASS;
 
-	$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . &quot; 
+	$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . &quot; 
 		SET unread = 0
 		WHERE msg_id = $msg_id
 			AND user_id = $user_id
@@ -709,7 +709,7 @@
 	{
 		case 'mark_important':
 
-			$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . &quot;
+			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . &quot;
 				SET marked = !marked
 				WHERE folder_id = $cur_folder_id
 					AND user_id = $user_id
@@ -798,7 +798,7 @@
 
 	// Get PM Informations for later deleting
 	$sql = 'SELECT msg_id, unread, new
-		FROM ' . PRIVMSGS_TO_TABLE . '
+		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . '
 		WHERE msg_id IN (' . implode(', ', array_map('intval', $msg_ids)) . &quot;)
 			AND folder_id = $folder_id
 			AND user_id = $user_id&quot;;
@@ -826,19 +826,19 @@
 	if ($folder_id == PRIVMSGS_OUTBOX)
 	{
 		// Remove PM from Outbox
-		$sql = 'DELETE FROM ' . PRIVMSGS_TO_TABLE . &quot;
+		$sql = 'DELETE FROM ' . FORUMS_PRIVMSGS_TO_TABLE . &quot;
 			WHERE user_id = $user_id AND folder_id = &quot; . PRIVMSGS_OUTBOX . '
 				AND msg_id IN (' . implode(', ', array_keys($delete_rows)) . ')';
 		$_CLASS['core_db']-&gt;query($sql);
 
 		// Update PM Information for safety
-		$sql = 'UPDATE ' . PRIVMSGS_TABLE . &quot; SET message_text = ''
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TABLE . &quot; SET message_text = ''
 			WHERE msg_id IN (&quot; . implode(', ', array_keys($delete_rows)) . ')';
 		$_CLASS['core_db']-&gt;query($sql);
 
 		// Set delete flag for those intended to receive the PM
 		// We do not remove the message actually, to retain some basic informations (sent time for example)
-		$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . '
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . '
 			SET deleted = 1
 			WHERE msg_id IN (' . implode(', ', array_keys($delete_rows)) . ')';
 		$_CLASS['core_db']-&gt;query($sql);
@@ -848,7 +848,7 @@
 	else
 	{
 		// Delete Private Message Informations
-		$sql = 'DELETE FROM ' . PRIVMSGS_TO_TABLE . &quot;
+		$sql = 'DELETE FROM ' . FORUMS_PRIVMSGS_TO_TABLE . &quot;
 			WHERE user_id = $user_id
 				AND folder_id = $folder_id
 				AND msg_id IN (&quot; . implode(', ', array_keys($delete_rows)) . ')';
@@ -859,7 +859,7 @@
 	// if folder id is user defined folder then decrease pm_count
 	if (!in_array($folder_id, array(PRIVMSGS_INBOX, PRIVMSGS_OUTBOX, PRIVMSGS_SENTBOX, PRIVMSGS_NO_BOX)))
 	{
-		$sql = 'UPDATE ' . PRIVMSGS_FOLDER_TABLE . &quot; 
+		$sql = 'UPDATE ' . FORUMS_PRIVMSGS_FOLDER_TABLE . &quot; 
 			SET pm_count = pm_count - $num_deleted 
 			WHERE folder_id = $folder_id&quot;;
 		$_CLASS['core_db']-&gt;query($sql);
@@ -880,7 +880,7 @@
 	
 	// Now we have to check which messages we can delete completely	
 	$sql = 'SELECT msg_id 
-		FROM ' . PRIVMSGS_TO_TABLE . '
+		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . '
 		WHERE msg_id IN (' . implode(', ', array_keys($delete_rows)) . ')';
 	$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -894,7 +894,7 @@
 
 	if ($delete_ids)
 	{
-		$sql = 'DELETE FROM ' . PRIVMSGS_TABLE . '
+		$sql = 'DELETE FROM ' . FORUMS_PRIVMSGS_TABLE . '
 			WHERE msg_id IN (' . $delete_ids . ')';
 		$_CLASS['core_db']-&gt;query($sql);
 	}
@@ -1151,7 +1151,7 @@
 			$root_level = ($data['reply_from_root_level']) ? $data['reply_from_root_level'] : $data['reply_from_msg_id']; 
 
 			// Set message_replied switch for this user
-			$sql = 'UPDATE ' . PRIVMSGS_TO_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TO_TABLE . '
 				SET replied = 1
 				WHERE user_id = ' . $_CLASS['core_user']-&gt;data['user_id'] . '
 					AND msg_id = ' . $data['reply_from_msg_id'];
@@ -1205,12 +1205,12 @@
 	{
 		if ($mode == 'post' || $mode == 'reply' || $mode == 'quote' || $mode == 'forward')
 		{
-			$_CLASS['core_db']-&gt;query('INSERT INTO ' . PRIVMSGS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql_data));
-			$data['msg_id'] = $_CLASS['core_db']-&gt;insert_id(PRIVMSGS_TABLE, 'msg_id');
+			$_CLASS['core_db']-&gt;query('INSERT INTO ' . FORUMS_PRIVMSGS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql_data));
+			$data['msg_id'] = $_CLASS['core_db']-&gt;insert_id(FORUMS_PRIVMSGS_TABLE, 'msg_id');
 		}
 		else if ($mode == 'edit')
 		{
-			$sql = 'UPDATE ' . PRIVMSGS_TABLE . ' 
+			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TABLE . ' 
 				SET message_edit_count = message_edit_count + 1, ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $sql_data) . ' 
 				WHERE msg_id = ' . $data['msg_id'];
 			$_CLASS['core_db']-&gt;query($sql);
@@ -1227,7 +1227,7 @@
 
 		foreach ($recipients as $user_id =&gt; $type)
 		{
-			$_CLASS['core_db']-&gt;query('INSERT INTO ' . PRIVMSGS_TO_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
+			$_CLASS['core_db']-&gt;query('INSERT INTO ' . FORUMS_PRIVMSGS_TO_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
 				'msg_id'	=&gt; $data['msg_id'],
 				'user_id'	=&gt; $user_id,
 				'author_id'	=&gt; $_CLASS['core_user']-&gt;data['user_id'],
@@ -1246,7 +1246,7 @@
 		// Put PM into outbox
 		if ($put_in_outbox)
 		{
-			$_CLASS['core_db']-&gt;query('INSERT INTO ' . PRIVMSGS_TO_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
+			$_CLASS['core_db']-&gt;query('INSERT INTO ' . FORUMS_PRIVMSGS_TO_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
 				'msg_id'	=&gt; (int) $data['msg_id'],
 				'user_id'	=&gt; (int) $_CLASS['core_user']-&gt;data['user_id'],
 				'author_id'	=&gt; (int) $_CLASS['core_user']-&gt;data['user_id'],
@@ -1311,7 +1311,7 @@
 		
 		if (sizeof($data['attachment_data']))
 		{
-			$sql = 'UPDATE ' . PRIVMSGS_TABLE . '
+			$sql = 'UPDATE ' . FORUMS_PRIVMSGS_TABLE . '
 				SET message_attachment = 1
 				WHERE msg_id = ' . $data['msg_id'];
 			$_CLASS['core_db']-&gt;query($sql);

Modified: trunk/includes/forums/message_parser.php
===================================================================
--- trunk/includes/forums/message_parser.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/forums/message_parser.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -128,7 +128,7 @@
 			$rowset = array();
 
 			$sql = 'SELECT bbcode_id, bbcode_tag, first_pass_match, first_pass_replace
-				FROM ' . BBCODES_TABLE;
+				FROM ' . FORUMS_BBCODES_TABLE;
 
 			$result = $_CLASS['core_db']-&gt;query($sql);
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
@@ -941,25 +941,10 @@
   	    {
 			// NOTE: obtain_* function? chaching the table contents?
 			
-			// For now setting the ttl to 10 minutes
-			switch ($_CLASS['core_db']-&gt;db_layer)
-			{
-				case 'mssql':
-				case 'mssql-odbc':
-					$sql = 'SELECT * 
-						FROM ' . SMILIES_TABLE . '
-						ORDER BY LEN(code) DESC';
-					break;
-	
-				// LENGTH supported by MySQL, IBM DB2, Oracle and Access for sure...
-				default:
-					$sql = 'SELECT * 
-						FROM ' . SMILIES_TABLE . '
-						ORDER BY LENGTH(code) DESC';
-					break;
-			}
-			$result = $_CLASS['core_db']-&gt;query($sql, 600);
 
+			$sql = 'SELECT * FROM ' . SMILIES_TABLE;
+			$result = $_CLASS['core_db']-&gt;query($sql);
+
 			if ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
 			{
 				$match = $replace = array();
@@ -967,8 +952,8 @@
 				do
 				{
 					// (assertion)
-					$match[] = '#(?&lt;=^|[\n ]|\.)' . preg_quote($row['code'], '#') . '#';
-					$replace[] = '&lt;!-- s' . $row['code'] . ' --&gt;&lt;img src=&quot;{SMILIES_PATH}/' . $row['smiley_url'] . '&quot; border=&quot;0&quot; alt=&quot;' . $row['emotion'] . '&quot; title=&quot;' . $row['emotion'] . '&quot; /&gt;&lt;!-- s' . $row['code'] . ' --&gt;';
+					$match[] = '#(?&lt;=^|[\n ]|\.)' . preg_quote($row['smiley_code'], '#') . '#';
+					$replace[] = '&lt;!-- s' . $row['smiley_code'] . ' --&gt;&lt;img src=&quot;{SMILIES_PATH}/' . $row['smiley_src'] . '&quot; border=&quot;0&quot; alt=&quot;' . $row['smiley_description'] . '&quot; title=&quot;' . $row['smiley_description'] . '&quot; /&gt;&lt;!-- s' . $row['smiley_code'] . ' --&gt;';
 				}
 				while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result));
 			}
@@ -1326,7 +1311,7 @@
 		if ($mode == 'edit')
 		{
 			$sql = 'SELECT w.word_id, w.word_text, m.title_match
-				FROM ' . SEARCH_WORD_TABLE . ' w, ' . SEARCH_MATCH_TABLE . &quot; m
+				FROM ' . FORUMS_SEARCH_WORD_TABLE . ' w, ' . FORUMS_SEARCH_MATCH_TABLE . &quot; m
 				WHERE m.post_id = $post_id 
 					AND w.word_id = m.word_id&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1362,7 +1347,7 @@
 		if (sizeof($unique_add_words))
 		{
 			$sql = 'SELECT word_id, word_text
-				FROM ' . SEARCH_WORD_TABLE . '
+				FROM ' . FORUMS_SEARCH_WORD_TABLE . '
 				WHERE word_text IN (' . implode(', ', preg_replace('#^(.*)$#', '\'$1\'', $unique_add_words)) . &quot;)&quot;;
 			$result = $_CLASS['core_db']-&gt;query($sql);
 
@@ -1381,7 +1366,7 @@
 				switch ($_CLASS['core_db']-&gt;db_layer)
 				{
 					case 'mysql':
-						$sql = 'INSERT INTO ' . SEARCH_WORD_TABLE . ' (word_text)
+						$sql = 'INSERT INTO ' . FORUMS_SEARCH_WORD_TABLE . ' (word_text)
 							VALUES ' . implode(', ', preg_replace('#^(.*)$#', '(\'$1\')',  $new_words));
 						$_CLASS['core_db']-&gt;query($sql);
 						break;
@@ -1390,14 +1375,14 @@
 					case 'mysqli':
 					case 'mssql':
 					case 'sqlite':
-						$sql = 'INSERT INTO ' . SEARCH_WORD_TABLE . ' (word_text) ' . implode(' UNION ALL ', preg_replace('#^(.*)$#', &quot;SELECT '\$1'&quot;,  $new_words));
+						$sql = 'INSERT INTO ' . FORUMS_SEARCH_WORD_TABLE . ' (word_text) ' . implode(' UNION ALL ', preg_replace('#^(.*)$#', &quot;SELECT '\$1'&quot;,  $new_words));
 						$_CLASS['core_db']-&gt;query($sql);
 						break;
 
 					default:
 						foreach ($new_words as $word)
 						{
-							$sql = 'INSERT INTO ' . SEARCH_WORD_TABLE . &quot; (word_text)
+							$sql = 'INSERT INTO ' . FORUMS_SEARCH_WORD_TABLE . &quot; (word_text)
 								VALUES ('$word')&quot;;
 							$_CLASS['core_db']-&gt;query($sql);
 						}
@@ -1419,7 +1404,7 @@
 					$sql_in[] = $cur_words[$word_in][$word];
 				}
 
-				$sql = 'DELETE FROM ' . SEARCH_MATCH_TABLE . ' 
+				$sql = 'DELETE FROM ' . FORUMS_SEARCH_MATCH_TABLE . ' 
 					WHERE word_id IN (' . implode(', ', $sql_in) . ') 
 						AND post_id = ' . intval($post_id) . &quot; 
 						AND title_match = $title_match&quot;;
@@ -1434,9 +1419,9 @@
 
 			if (sizeof($word_ary))
 			{
-				$sql = 'INSERT INTO ' . SEARCH_MATCH_TABLE . &quot; (post_id, word_id, title_match) 
+				$sql = 'INSERT INTO ' . FORUMS_SEARCH_MATCH_TABLE . &quot; (post_id, word_id, title_match) 
 					SELECT $post_id, word_id, $title_match 
-					FROM &quot; . SEARCH_WORD_TABLE . ' 
+					FROM &quot; . FORUMS_SEARCH_WORD_TABLE . ' 
 					WHERE word_text IN (' . implode(', ', preg_replace('#^(.*)$#', '\'$1\'', $word_ary)) . ')';
 				$_CLASS['core_db']-&gt;query($sql);
 			}
@@ -1466,7 +1451,7 @@
 
 		// Remove common (&gt; 60% of posts ) words
 		$sql = 'SELECT SUM(forum_posts) AS total_posts 
-			FROM ' . FORUMS_TABLE;
+			FROM ' . FORUMS_FORUMS_TABLE;
 		$result = $_CLASS['core_db']-&gt;query($sql);
 
 		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
@@ -1475,7 +1460,7 @@
 		if ($row['total_posts'] &gt;= 100)
 		{
 			$sql = 'SELECT word_id
-				FROM ' . SEARCH_MATCH_TABLE . '
+				FROM ' . FORUMS_SEARCH_MATCH_TABLE . '
 				GROUP BY word_id
 				HAVING COUNT(word_id) &gt; ' . floor($row['total_posts'] * 0.6);
 			$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1491,12 +1476,12 @@
 
 				$sql_in = implode(', ', $sql_in);
 
-				$sql = 'UPDATE ' . SEARCH_WORD_TABLE . &quot;
+				$sql = 'UPDATE ' . FORUMS_SEARCH_WORD_TABLE . &quot;
 					SET word_common = 1
 					WHERE word_id IN ($sql_in)&quot;;
 				$_CLASS['core_db']-&gt;query($sql);
 
-				$sql = 'DELETE FROM ' . SEARCH_MATCH_TABLE . &quot;
+				$sql = 'DELETE FROM ' . FORUMS_SEARCH_MATCH_TABLE . &quot;
 					WHERE word_id IN ($sql_in)&quot;;
 				$_CLASS['core_db']-&gt;query($sql);
 				unset($sql_in);
@@ -1506,8 +1491,8 @@
 
 		// Remove words with no matches ... this is a potentially nasty query
 		$sql = 'SELECT w.word_id
-			FROM ' . SEARCH_WORD_TABLE . ' w
-			LEFT JOIN ' . SEARCH_MATCH_TABLE . ' m ON w.word_id = m.word_id
+			FROM ' . FORUMS_SEARCH_WORD_TABLE . ' w
+			LEFT JOIN ' . FORUMS_SEARCH_MATCH_TABLE . ' m ON w.word_id = m.word_id
 				WHERE w.word_common = 0 AND m.word_id IS NULL
 			GROUP BY m.word_id';
 		$result = $_CLASS['core_db']-&gt;query($sql);
@@ -1521,7 +1506,7 @@
 			}
 			while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result));
 
-			$sql = 'DELETE FROM ' . SEARCH_WORD_TABLE . '
+			$sql = 'DELETE FROM ' . FORUMS_SEARCH_WORD_TABLE . '
 				WHERE word_id IN (' . implode(', ', $sql_in) . ')';
 			$_CLASS['core_db']-&gt;query($sql);
 			unset($sql_in);

Modified: trunk/includes/functions.php
===================================================================
--- trunk/includes/functions.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/functions.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -433,8 +433,8 @@
 			$end = min($total_pages, $current_page + 2);
 			$start = ($end &gt; $total_pages - 2) ? $total_pages - 4 : $current_page - 2;
 
-			$display['array'][] = array('page' =&gt; 1, 'link' =&gt; generate_link($base_url, $admin_link), 'seperator' =&gt; 'after');
-			$display['formated'] = sprintf($wrapper['first'], generate_link($base_url, $admin_link), 1);
+			$display['array'][] = array('page' =&gt; 1, 'link' =&gt; generate_link($base_url, array('admin' =&gt; $admin_link)), 'seperator' =&gt; 'after');
+			$display['formated'] = sprintf($wrapper['first'], generate_link($base_url, array('admin' =&gt; $admin_link)), 1);
 		}
 	}
 	else
@@ -448,13 +448,13 @@
 		$display['array'][] = array('page' =&gt; $i, 'link' =&gt; generate_link($base_url.'&amp;start='.(($i - 1) * $per_page)), 'seperator' =&gt; false);
 		
 		$this_wrapper = ($current_page == $i) ? $wrapper['current'] : $wrapper['normal'];
-		$display['formated'] .= sprintf($this_wrapper, generate_link($base_url.'&amp;start='.(($i - 1) * $per_page)), $i);
+		$display['formated'] .= sprintf($this_wrapper, generate_link($base_url.'&amp;start='.(($i - 1) * $per_page), array('admin' =&gt; $admin_link)), $i);
 	}
 
 	if ($end != $total_pages)
 	{
-		$display['array'][] = array('page' =&gt; $total_pages, 'link' =&gt; generate_link($base_url.'&amp;start='.(($total_pages - 1) * $per_page), $admin_link), 'seperator' =&gt; 'before');
-		$display['formated'] .= sprintf($wrapper['last'], generate_link($base_url.'&amp;start='.(($total_pages - 1)  * $per_page), $admin_link), $total_pages);
+		$display['array'][] = array('page' =&gt; $total_pages, 'link' =&gt; generate_link($base_url.'&amp;start='.(($total_pages - 1) * $per_page), array('admin' =&gt; $admin_link)), 'seperator' =&gt; 'before');
+		$display['formated'] .= sprintf($wrapper['last'], generate_link($base_url.'&amp;start='.(($total_pages - 1)  * $per_page), array('admin' =&gt; $admin_link)), $total_pages);
 	}
 
 	return $display;
@@ -514,8 +514,9 @@
 	$sql = 'UPDATE ' . CORE_CONFIG_TABLE . &quot; SET config_value = '&quot;.$_CLASS['core_db']-&gt;escape($value) . &quot;'
 		WHERE config_section = '&quot; . $_CLASS['core_db']-&gt;escape($section) . &quot;'
 			AND config_name = '&quot;. $_CLASS['core_db']-&gt;escape($name) .&quot;'&quot;;
+	$result = $_CLASS['core_db']-&gt;query($sql);
 
-	if ($auto_add &amp;&amp; (!$_CLASS['core_db']-&gt;query($sql) || !$_CLASS['core_db']-&gt;affected_rows()))
+	if ($auto_add &amp;&amp; (!$result || !$_CLASS['core_db']-&gt;affected_rows()))
 	{
 		$sql_array = array(
 			'config_section'=&gt; (string) $section,

Modified: trunk/includes/functions_user.php
===================================================================
--- trunk/includes/functions_user.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/functions_user.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -21,63 +21,74 @@
 $Id$
 */
 
-function user_get_id($username, &amp;$difference)
+function check_user_id(&amp;$user_id, $bypass = false)
 {
-	global $_CLASS;
+	// should we just return false, if this array map is different from the one sent
 
-	$difference = array();
+	$user_id = array_map('intval', $user_id);
+	$user_id = array_unique($user_id);
 
-	$username = is_array($username) ? $username : array($username);
+	// array map should make 0 values for notint values
+	if (($key = array_search(0, $user_id)) === false)
+	{
+		unset($user_id[$key]);
+	}
 
-	$data = array('user_id' =&gt; array(), 'username' =&gt; array());
+// make bypass an array maybe, along with protected id. would be better if you want to extend this
+	if ($bypass)
+	{
+		// You shouldn'y do anything to guest
+		if (($key = array_search(1, $user_id)) === false)
+		{
+			unset($user_id[$key]);
+		}
+	
+		// First admin is always specail
+		if (($key = array_search(2, $user_id)) === false)
+		{
+			unset($user_id[$key]);
+		}
+	}
 
-	$sql = 'SELECT user_id, username
-				FROM ' . USERS_TABLE . &quot; 
-				WHERE username IN ('&quot; . implode(&quot;' ,'&quot;, $_CLASS['core_db']-&gt;escape_array($username)) . &quot;')&quot;;
-	$result = $_CLASS['core_db']-&gt;query($sql);
-
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	if (empty($user_id))
 	{
-		$data['user_id'][] = $row['user_id'];
-		$data['username'][] = $row['username'];
+		return false;
 	}
-	$_CLASS['core_db']-&gt;free_result($result);
-
-	$difference = array_diff($username, $data['username']);
-
-	return $data['user_id'];
+	
+	return $user_id;
 }
 
-function user_get_name($user_id, &amp;$difference)
+function user_add($data)
 {
-	global $_CLASS;
+	global $_CLASS, $_CORE_CONFIG;
 
-	$difference = array();
+	$default_data = array(
+		'user_allow_viewonline' =&gt; 1,
+		'user_allow_viewemail' =&gt; 1,
+		'user_allow_massemail' =&gt; 1,
+		'user_new_privmsg' =&gt; 0,
+		'user_allow_pm' =&gt; 1,
+		'user_allow_email' =&gt; 1,
+	);
 
-	$user_id = array_map('intval', is_array($user_id) ? $user_id : array($user_id));
+	$data = array_merge($default_data, $data);
 
-	if (empty($user_id))
-	{
-		return;
-	}
+// add a required array here, then find feilds that are not in the data array
+	$_CLASS['core_db']-&gt;transaction();
 
-	$data = array('user_id' =&gt; array(), 'username' =&gt; array());
+	$sql = 'INSERT INTO ' . USERS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $data);
+	$_CLASS['core_db']-&gt;query($sql);
 
-	$sql = 'SELECT user_id, username
-				FROM ' . USERS_TABLE . ' 
-				WHERE user_id IN (' . implode(', ', $user_id) . ')';
-	$result = $_CLASS['core_db']-&gt;query($sql);
+	$user_id = $_CLASS['core_db']-&gt;insert_id(USERS_TABLE, 'user_id');
+				
+	$sql = 'INSERT INTO ' . USER_GROUP_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
+		'group_id'		=&gt; (int) $data['user_group'],
+		'member_user_id'=&gt; (int) $user_id,
+		'member_status'	=&gt; $data['user_status']
+	);
+	$_CLASS['core_db']-&gt;query($sql);
 
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-	{
-		$data['user_id'][] = $row['user_id'];
-		$data['username'][] = $row['username'];
-	}
-	$_CLASS['core_db']-&gt;free_result($result);
-
-	$difference = array_diff($user_id, $data['user_id']);
-
-	return $data['username'];
+	$_CLASS['core_db']-&gt;transaction('commit');
 }
 
 function user_activate($user_id)
@@ -97,27 +108,51 @@
 			AND user_type &lt;&gt;' . USER_GUEST;
 
 	$_CLASS['core_db']-&gt;query($sql);
+
+	$sql = 'UPDATE ' . USER_GROUP_TABLE . '
+		SET member_status = ' . STATUS_ACTIVE . '
+			WHERE user_id  IN (' . implode(', ', $user_id) . ')';
+			//AND group_id =' .; get default group/s then add update, also update all group where the status is disabled
+
+	$_CLASS['core_db']-&gt;query($sql);
 	
 	set_core_config('user', 'num_users', $_CORE_CONFIG['user']['num_users'] + count($user_id));
 }
 
+function user_activate_reminder($user_id)
+{
+
+}
+
 function user_disable($user_id)
 {
 	global $_CLASS, $_CORE_CONFIG;
 
-	$user_id = array_map('intval', is_array($user_id) ? $user_id : array($user_id));
+	$user_id = is_array($user_id) ? $user_id : array($user_id);
 
-	if (empty($user_id))
+	if (check_user_id($user_id) == false)
 	{
 		return;
 	}
+
 // hook here -- maybe ?
+
+	// disabled the user first
 	$sql = 'UPDATE ' . USERS_TABLE . '
 		SET user_status = ' . STATUS_DISABLED . '
 			WHERE user_id  IN (' . implode(', ', $user_id) . ')
 			AND user_type &lt;&gt;' . USER_GUEST;
 	$_CLASS['core_db']-&gt;query($sql);
 
+	// Now we disable the user in his active groups
+	//	( note disable is not uses for group removal, the entry is just deleted )
+// should also remove all pending groups
+	$sql = 'UPDATE ' . USER_GROUP_TABLE . '
+		SET member_status = ' . STATUS_DISABLED . '
+			WHERE user_id  IN (' . implode(', ', $user_id) . ')
+			AND member_status = ' . STATUS_ACTIVE;
+	$_CLASS['core_db']-&gt;query($sql);
+
 	if (in_array($_CORE_CONFIG['user']['newest_user_id'], $user_id))
 	{
 		$sql = 'SELECT user_id, username FROM ' . USERS_TABLE . '
@@ -137,29 +172,17 @@
 	$_CLASS['core_cache']-&gt;destroy('core_config');
 }
 
-function user_activate_reminder($user_id)
+function user_delete($user_id, $quick = false)
 {
 	global $_CLASS;
 
-	$user_id = array_map('intval', is_array($user_id) ? $user_id : array($user_id));
+	$user_id = is_array($user_id) ? $user_id : array($user_id);
 
-	if (empty($user_id))
+	if (check_user_id($user_id) == false)
 	{
 		return;
 	}
-// hook here -- maybe ?
-	$sql = 'UPDATE ' . USERS_TABLE . '
-		SET user_status = ' . STATUS_ACTIVE . '
-			WHERE user_id  IN (' . implode(', ', $user_id) . ')
-			AND user_type =' . USER_NORMAL;
-
-	$_CLASS['core_db']-&gt;query($sql);
-}
 
-function user_delete($user_id, $quick = false)
-{
-	global $_CLASS;
-
 	if ($quick)
 	{
 		$sql = &quot;DELETE FROM USERS_TABLE
@@ -168,18 +191,12 @@
 		
 		return;
 	}
-	$user_id = array_map('intval', is_array($user_id) ? $user_id : array($user_id));
 
 // Maybe we should make this a cron
 // and just set the user type to deleted or something
 	set_time_limit(0);
 	ignore_user_abort(true);
 
-	if (empty($user_id))
-	{
-		return;
-	}
-
 	// We disable users first to make sure things go right
 	user_disable($user_id);
 
@@ -237,6 +254,65 @@
 	$_CLASS['core_db']-&gt;optimize_tables($optimize_array);
 }
 
+function user_get_id($username, &amp;$difference)
+{
+	global $_CLASS;
+
+	$difference = array();
+
+	$username = is_array($username) ? $username : array($username);
+
+	$data = array('user_id' =&gt; array(), 'username' =&gt; array());
+
+	$sql = 'SELECT user_id, username
+				FROM ' . USERS_TABLE . &quot; 
+				WHERE username IN ('&quot; . implode(&quot;' ,'&quot;, $_CLASS['core_db']-&gt;escape_array($username)) . &quot;')&quot;;
+	$result = $_CLASS['core_db']-&gt;query($sql);
+
+	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	{
+		$data['user_id'][] = $row['user_id'];
+		$data['username'][] = $row['username'];
+	}
+	$_CLASS['core_db']-&gt;free_result($result);
+
+	$difference = array_diff($username, $data['username']);
+
+	return $data['user_id'];
+}
+
+function user_get_name($user_id, &amp;$difference)
+{
+	global $_CLASS;
+
+	$difference = array();
+
+	$user_id = array_map('intval', is_array($user_id) ? $user_id : array($user_id));
+
+	if (empty($user_id))
+	{
+		return;
+	}
+
+	$data = array('user_id' =&gt; array(), 'username' =&gt; array());
+
+	$sql = 'SELECT user_id, username
+				FROM ' . USERS_TABLE . ' 
+				WHERE user_id IN (' . implode(', ', $user_id) . ')';
+	$result = $_CLASS['core_db']-&gt;query($sql);
+
+	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
+	{
+		$data['user_id'][] = $row['user_id'];
+		$data['username'][] = $row['username'];
+	}
+	$_CLASS['core_db']-&gt;free_result($result);
+
+	$difference = array_diff($user_id, $data['user_id']);
+
+	return $data['username'];
+}
+
 function groups_user_remove($group_id, $user_id)
 {
 	global $_CLASS;
@@ -245,13 +321,17 @@
 	$user_ids = is_array($user_id) ? $user_id : array($user_id);
 
 	$group_id = array_map('intval', $group_id);
-	$user_id = array_map('intval', $user_id);
 
-	if (empty($group_id) || empty($user_id))
+	if (check_user_id($user_id) == false)
 	{
 		return;
 	}
 
+	if (empty($group_id))
+	{
+		return;
+	}
+
 	$sql = 'SELECT user_id FROM ' . USERS_TABLE . ' 
 				WHERE group_id IN (' . implode(', ', $group_id) . ')
 				AND user_id IN (' . implode(', ', $user_id) . ')';
@@ -341,4 +421,42 @@
 	$result = $_CLASS['core_db']-&gt;query($sql);
 }
 
+function validate_username($username)
+{
+	global $_CORE_CONFIG, $_CLASS;
+
+	$username = strtolower($username);
+
+	if (strtolower($_CLASS['core_user']-&gt;data['username']) == $username)
+	{
+		return 'USERNAME_TAKEN';
+	}
+
+	$length = mb_strlen($username);
+
+	if ($length &gt; $_CORE_CONFIG['user']['max_name_chars'] || $length &lt; $_CORE_CONFIG['user']['min_name_chars'])
+	{
+		return 'INVALID_LENGHT';
+	}
+
+	if (!preg_match('#^' . $_CORE_CONFIG['user']['allow_name_chars'] . '$#i', $username))
+	{
+		return 'INVALID_CHARS';
+	}
+
+	$sql = 'SELECT COUNT(*) as count
+		FROM ' . USERS_TABLE . &quot;
+		WHERE LOWER(username) = '&quot; . $_CLASS['core_db']-&gt;escape($username) . &quot;'&quot;;
+	$result = $_CLASS['core_db']-&gt;query($sql);
+	list($count) = $_CLASS['core_db']-&gt;fetch_row_num($result);
+	$_CLASS['core_db']-&gt;free_result($result);
+
+	if ($count)
+	{
+		return 'USERNAME_TAKEN';
+	}
+	
+	return true;
+}
+
 ?&gt;
\ No newline at end of file

Modified: trunk/includes/session.php
===================================================================
--- trunk/includes/session.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/session.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -175,7 +175,7 @@
 			'session_start'		=&gt; (int) $this-&gt;time,
 			'session_time'		=&gt; (int) $this-&gt;time,
 			'session_browser'	=&gt; (string) $this-&gt;browser,
-			'session_page'		=&gt; (string) $this-&gt;page,
+			'session_page'		=&gt; (string) $this-&gt;page, // need to be added back
 			'session_url'		=&gt; (string) $this-&gt;url,
 			'session_ip'		=&gt; (string) $this-&gt;ip,
 			'session_user_type'	=&gt; (int) $this-&gt;data['user_type'],
@@ -221,73 +221,124 @@
 
 		$data_array = array(
 			'user_id'				=&gt; (int) $this-&gt;data['user_id'],
-			'auto_login_browser'	=&gt; (string) $this-&gt;browser,
-			'auto_login_code'		=&gt; $code,
-			'auto_login_time'		=&gt; (int) $this-&gt;time,
+			'auto_login_code'		=&gt; (string) $code,
+			'auto_login_browser'	=&gt; $this-&gt;browser,
+			'auto_login_time'		=&gt; $this-&gt;time,
 		);
 		
 		$_CLASS['core_db']-&gt;query('INSERT INTO ' . SESSIONS_AUTOLOGIN_TABLE . ' '.	$_CLASS['core_db']-&gt;sql_build_array('INSERT', $data_array));
 	
-		$this-&gt;set_cookie('ali', $this-&gt;data['user_id'], $this-&gt;time + 31536000);
-		$this-&gt;set_cookie('alc', $code, $this-&gt;time + 31536000);
+		$this-&gt;set_cookie('ali', $this-&gt;data['user_id'], $this-&gt;time + 2592000);
+		$this-&gt;set_cookie('alc', $code, $this-&gt;time + 2592000);
 	}
 
 	function autologin_retrieve($user_id, $code)
 	{
 		global $_CLASS;
-		
-		$sql = 'SELECT *
-			FROM ' . SESSIONS_AUTOLOGIN_TABLE . &quot; 
-			WHERE user_id = $user_id
-			AND auto_login_code = '&quot; . $_CLASS['core_db']-&gt;escape($code) . &quot;'&quot;;
-				
+
+		settype($user_id, 'int');
+
+		$sql = 'SELECT * FROM ' . SESSIONS_AUTOLOGIN_TABLE . &quot; 
+					WHERE user_id = $user_id
+					AND auto_login_code = '&quot; . $_CLASS['core_db']-&gt;escape($code) . &quot;'&quot;;
+
 		$result = $_CLASS['core_db']-&gt;query($sql);
 		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 
-		// This is about all you can validate other than the code, and user_id
-		return ($row &amp;&amp; $row['auto_login_browser'] == $this-&gt;browser) ? $user_id : false;
+		$return = false;
+
+		// This is about all we can validate other than the code, and user_id
+		if ($row &amp;&amp; $row['auto_login_browser'] == $this-&gt;browser)
+		{
+			$return = $user_id;
+			
+			$new_code = function_exists('sha1') ? sha1(uniqid(mt_rand(), true)) : md5(uniqid(mt_rand(), true));
+
+			$data_array = array(
+				'auto_login_code'		=&gt; (string) $new_code,
+				'auto_login_time'		=&gt; (int) $this-&gt;time,
+			);
+		
+			$sql = 'UPDATE ' . SESSIONS_AUTOLOGIN_TABLE . '	SET ' . $_CLASS['core_db']-&gt;sql_build_array('UPDATE', $data_array) . &quot;
+						WHERE user_id = $user_id
+						AND auto_login_code = '&quot; . $_CLASS['core_db']-&gt;escape($code) . &quot;'&quot;;
+			$_CLASS['core_db']-&gt;sql_query($sql);
+
+			// need to update both the code and the user_id,
+			// since user_id cookie has an expiry time
+			$this-&gt;set_cookie('alc', $new_code, $this-&gt;time + 2592000);
+			$this-&gt;set_cookie('ali', $user_id, $this-&gt;time + 2592000);
+		}
+
+		return $return;
 	}
 
-	function session_destroy($session_id = false, $remove_cookie = true)
+	function autologin_destroy($user_id, $code)
 	{
 		global $_CLASS;
+		
+		$sql = 'DELETE FROM ' . SESSIONS_AUTOLOGIN_TABLE . &quot; 
+			WHERE user_id = $user_id
+			AND auto_login_code = '&quot; . $_CLASS['core_db']-&gt;escape($code) . &quot;'&quot;;
+				
+		$_CLASS['core_db']-&gt;query($sql);
+	}
 
+	function session_destroy($session_id = false, $logout = true)
+	{
+		global $_CLASS;
+
 		if (!$session_id)
 		{
 			$session_id = $this-&gt;data['session_id'];
 			
-			if ($remove_cookie)
-			{
-				$this-&gt;set_cookie('sid', '', $this-&gt;time - 31536000);
-			}
+			$this-&gt;set_cookie('sid', '', $this-&gt;time - 31536000);
+		}
 
-			if ($this-&gt;data['session_time'])
-			{
-				$sql = 'UPDATE ' . USERS_TABLE . '
-					SET user_last_visit = ' . $this-&gt;data['session_time'] . '
-					WHERE user_id = ' . $this-&gt;data['user_id'];
-				$_CLASS['core_db']-&gt;query($sql);
-			}
+		if ($logout)
+		{
+			
 		}
-		
+
 		$sql = 'DELETE FROM ' . SESSIONS_TABLE . &quot;
 			WHERE session_id = '&quot; . $_CLASS['core_db']-&gt;escape($session_id).&quot;'&quot;;
 
 		$_CLASS['core_db']-&gt;query($sql);
+
+		$_CLASS['core_db']-&gt;optimize_tables(SESSIONS_TABLE);
 	}
 
 	function gc($time)
 	{
 // Add auto login cleaning
-// Move to cron
+// Move to cron		
+
 		global $_CORE_CONFIG, $_CLASS;
 
+/*
+		// keep the next query less demanding
 		$sql = 'DELETE FROM ' . SESSIONS_TABLE . '
-			WHERE session_time &lt; ' . ($time - $_CORE_CONFIG['server']['session_length']);
+			WHERE session_user_id = ' . ANONYMOUS . '
+			AND session_time &lt; ' . ($time - $_CORE_CONFIG['server']['session_length']);
+		$_CLASS['core_db']-&gt;query($sql);
+*/
 
-		$result = $_CLASS['core_db']-&gt;query($sql);
+		$sql = 'UPDATE ' . USERS_TABLE. ' u, ' . SESSIONS_TABLE . ' s
+					SET u.user_last_visit = s.session_time
+					WHERE s.session_time &lt; ' . ($time - $_CORE_CONFIG['server']['session_length']) . '
+						AND s.session_user_id &lt;&gt; ' . ANONYMOUS .'
+						AND u.user_id = s.session_user_id';
+		$_CLASS['core_db']-&gt;sql_query($sql);
 
+		$sql = 'DELETE FROM ' . SESSIONS_AUTOLOGIN_TABLE . '
+					WHERE auto_login_time &lt; ' . ($time - 2592000);
+		$_CLASS['core_db']-&gt;query($sql);
+
+		$sql = 'DELETE FROM ' . SESSIONS_TABLE . '
+					WHERE session_time &lt; ' . ($time - $_CORE_CONFIG['server']['session_length']);
+		$_CLASS['core_db']-&gt;query($sql);
+		
 		$_CLASS['core_db']-&gt;optimize_tables(SESSIONS_TABLE);
 	}
 

Modified: trunk/includes/system.php
===================================================================
--- trunk/includes/system.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/system.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -17,6 +17,8 @@
 ||  of the GNU General Public License version 2					||
 ||																||
 ||**************************************************************||
+
+$Id$
 */
 
 function confirmation_image($code = false, $size = false)

Modified: trunk/includes/templates/admin/blocks/edit.html
===================================================================
--- trunk/includes/templates/admin/blocks/edit.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/blocks/edit.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,11 +1,12 @@
 &lt;!-- DISPLAY_HEADER --&gt;
 
-&lt;style type=&quot;text/css&quot;&gt;@import url(java/jscalendar/skins/aqua/theme.css);&lt;/style&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/calendar_stripped.js&quot;&gt;&lt;/script&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/lang/calendar-en.js&quot;&gt;&lt;/script&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/calendar-setup.js&quot;&gt;&lt;/script&gt;
+&lt;style type=&quot;text/css&quot;&gt;@import url(javascript/jscalendar/skins/aqua/theme.css);&lt;/style&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/calendar.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/calendar-setup.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/lang/calendar-en.js&quot;&gt;&lt;/script&gt;
 
 { $A_TABLE_OPEN }
+
 &lt;form action=&quot;{ $B_ACTION }&quot; method=&quot;post&quot;&gt;
 	&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 		&lt;tbody&gt;
@@ -32,8 +33,7 @@
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_STARTS }: &lt;/b&gt;&lt;/td&gt;
 				&lt;td class=&quot;row2&quot; &gt;
 					&lt;input class=&quot;post&quot; id=&quot;b_time&quot; name=&quot;b_time&quot; size=&quot;35&quot; maxlength=&quot;100&quot; value=&quot;{ $B_STARTS }&quot; type=&quot;text&quot; /&gt;
-					&lt;img src=&quot;java/jscalendar/calendar.png&quot; style=&quot;cursor: pointer;&quot; id=&quot;time_trigger&quot; /&gt;
-					&lt;!-- IF { $B_STARTS } --&gt;   Currently Set:  { $B_STARTS }&lt;!-- ENDIF --&gt;
+					&lt;img src=&quot;images/calender_small.png&quot; style=&quot;cursor: pointer;&quot; id=&quot;time_trigger&quot; /&gt;
 				&lt;/td&gt;
 				&lt;td class=&quot;row1&quot; align=&quot;center&quot; rowspan=&quot;2&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;Current Server Time:&lt;/b&gt;&lt;br/&gt;{ $B_CURRENT_TIME } &lt;/td&gt;
 			&lt;/tr&gt;
@@ -41,8 +41,7 @@
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_EXPIRES }: &lt;/b&gt;&lt;/td&gt;
 				&lt;td class=&quot;row2&quot;&gt;
 					&lt;input class=&quot;post&quot; id=&quot;b_expires&quot; name=&quot;b_expires&quot; size=&quot;35&quot; maxlength=&quot;100&quot; value=&quot;{ $B_EXPIRES }&quot; type=&quot;text&quot; /&gt;
-					&lt;img src=&quot;java/jscalendar/calendar.png&quot; style=&quot;cursor: pointer;&quot;  id=&quot;expires_trigger&quot; /&gt;
-					&lt;!-- IF { $B_EXPIRES } --&gt;    Currently Set:  { $B_EXPIRES }&lt;!-- ENDIF --&gt;
+					&lt;img src=&quot;images/calender_small.png&quot; style=&quot;cursor: pointer;&quot;  id=&quot;expires_trigger&quot; /&gt;
 				&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;!-- IF { $B_POSITION } --&gt;

Modified: trunk/includes/templates/admin/blocks/index.html
===================================================================
--- trunk/includes/templates/admin/blocks/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/blocks/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,12 +1,13 @@
 &lt;!-- DISPLAY_HEADER --&gt;
 
 { $A_TABLE_OPEN }
+
 &lt;table border=&quot;0&quot; class=&quot;tablebg&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 	&lt;tbody&gt;
 		&lt;tr&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FILE }'&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FILE }&quot;&gt;{ $L_BLOCK_REGULAR }&lt;/a&gt;&lt;/td&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FEED }'&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FEED }&quot;&gt;{ $L_BLOCK_FEED }&lt;/a&gt;&lt;/td&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_HTML }'&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_HTML }&quot;&gt;{ $L_BLOCK_HTML }&lt;/a&gt;&lt;/td&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FILE }'; return false;&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FILE }&quot;&gt;{ $L_BLOCK_REGULAR }&lt;/a&gt;&lt;/td&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FEED }'; return false;&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FEED }&quot;&gt;{ $L_BLOCK_FEED }&lt;/a&gt;&lt;/td&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_HTML }'; return false;&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_HTML }&quot;&gt;{ $L_BLOCK_HTML }&lt;/a&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 	&lt;/tbody&gt;
 &lt;/table&gt;
@@ -14,11 +15,11 @@
 &lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
     &lt;tbody&gt;
 		&lt;tr&gt;
-			&lt;th width=&quot;25%&quot; align=&quot;center&quot;&gt;{ $L_TITLE }&lt;/b&gt;&lt;/th&gt;
-			&lt;th colspan=&quot;2&quot;&gt;{ $L_WEIGHT }&lt;/th&gt;
-			&lt;th&gt;{ $L_TYPE }&lt;/td&gt;
-			&lt;th&gt;{ $L_ACTIVE }&lt;/th&gt;
-			&lt;th colspan=&quot;2&quot;&gt;{ $L_OPTIONS }&lt;/th&gt;
+			&lt;th align=&quot;center&quot; width=&quot;25%&quot;&gt;{ $L_TITLE }&lt;/b&gt;&lt;/th&gt;
+			&lt;th align=&quot;center&quot; colspan=&quot;2&quot;&gt;{ $L_ORDER }&lt;/th&gt;
+			&lt;th align=&quot;center&quot;&gt;{ $L_TYPE }&lt;/td&gt;
+			&lt;th align=&quot;center&quot;&gt;{ $L_ACTIVE }&lt;/th&gt;
+			&lt;th align=&quot;center&quot; colspan=&quot;2&quot;&gt;{ $L_OPTIONS }&lt;/th&gt;
 		&lt;/tr&gt;
 		&lt;!-- IF isset({ $left_admin_blocks }) --&gt;
     	&lt;tr&gt;
@@ -30,24 +31,24 @@
 		&lt;!-- ENDIF --&gt;
 		&lt;!-- LOOP $left_admin_blocks --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $left_admin_blocks:EDIT_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $left_admin_blocks:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $left_admin_blocks:EDIT_LINK }&quot;&gt;{ $left_admin_blocks:TITLE }&lt;/a&gt;
 				&lt;!-- IF { $left_admin_blocks:ERROR } --&gt;&lt;br/&gt;&lt;span style=&quot;font-size: 90%; color: red;&quot;&gt;{ $left_admin_blocks:ERROR }&lt;/span&gt;&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot; &gt;
-				&lt;!-- IF { $left_admin_blocks:WEIGHT_UP } --&gt;
-				&lt;a href=&quot;{ $left_admin_blocks:WEIGHT_MOVE_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $left_admin_blocks:WEIGHT_MOVE_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $left_admin_blocks:ORDER_UP } --&gt;
+				&lt;a href=&quot;{ $left_admin_blocks:LINK_ORDER_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $left_admin_blocks:LINK_ORDER_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
-				&lt;!-- IF { $left_admin_blocks:WEIGHT_DOWN } --&gt;
-				&lt;a href=&quot;{ $left_admin_blocks:WEIGHT_MOVE_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $left_admin_blocks:WEIGHT_MOVE_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $left_admin_blocks:ORDER_DOWN } --&gt;
+				&lt;a href=&quot;{ $left_admin_blocks:LINK_ORDER_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $left_admin_blocks:LINK_ORDER_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;{ $left_admin_blocks:TYPE }&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $left_admin_blocks:ACTIVE_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $left_admin_blocks:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $left_admin_blocks:ACTIVE_LINK }&quot;&gt;{ $left_admin_blocks:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
@@ -73,24 +74,24 @@
 		&lt;!-- ENDIF --&gt;
 		&lt;!-- LOOP $centertop_admin_blocks --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centertop_admin_blocks:EDIT_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centertop_admin_blocks:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $centertop_admin_blocks:EDIT_LINK }&quot;&gt;{ $centertop_admin_blocks:TITLE }&lt;/a&gt;
 				&lt;!-- IF { $centertop_admin_blocks:ERROR } --&gt;&lt;br/&gt;&lt;span style=&quot;font-size: 90%; color: red;&quot;&gt;{ $centertop_admin_blocks:ERROR }&lt;/span&gt;&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot; &gt;
-				&lt;!-- IF { $centertop_admin_blocks:WEIGHT_UP } --&gt;
-				&lt;a href=&quot;{ $centertop_admin_blocks:WEIGHT_MOVE_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $centertop_admin_blocks:WEIGHT_MOVE_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $centertop_admin_blocks:ORDER_UP } --&gt;
+				&lt;a href=&quot;{ $centertop_admin_blocks:LINK_ORDER_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $centertop_admin_blocks:LINK_ORDER_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
-				&lt;!-- IF { $centertop_admin_blocks:WEIGHT_DOWN } --&gt;
-				&lt;a href=&quot;{ $centertop_admin_blocks:WEIGHT_MOVE_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $centertop_admin_blocks:WEIGHT_MOVE_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $centertop_admin_blocks:ORDER_DOWN } --&gt;
+				&lt;a href=&quot;{ $centertop_admin_blocks:LINK_ORDER_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $centertop_admin_blocks:LINK_ORDER_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;{ $centertop_admin_blocks:TYPE }&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centertop_admin_blocks:ACTIVE_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centertop_admin_blocks:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $centertop_admin_blocks:ACTIVE_LINK }&quot;&gt;{ $centertop_admin_blocks:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			
@@ -117,24 +118,24 @@
 		&lt;!-- ENDIF --&gt;
 		&lt;!-- LOOP $centerbottom_admin_blocks --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centerbottom_admin_blocks:EDIT_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centerbottom_admin_blocks:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $centerbottom_admin_blocks:EDIT_LINK }&quot;&gt;{ $centerbottom_admin_blocks:TITLE }&lt;/a&gt;
 				&lt;!-- IF { $centerbottom_admin_blocks:ERROR } --&gt;&lt;br/&gt;&lt;span style=&quot;font-size: 90%; color: red;&quot;&gt;{ $centerbottom_admin_blocks:ERROR }&lt;/span&gt;&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot; &gt;
-				&lt;!-- IF { $centerbottom_admin_blocks:WEIGHT_UP } --&gt;
-				&lt;a href=&quot;{ $centerbottom_admin_blocks:WEIGHT_MOVE_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $centerbottom_admin_blocks:WEIGHT_MOVE_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $centerbottom_admin_blocks:ORDER_UP } --&gt;
+				&lt;a href=&quot;{ $centerbottom_admin_blocks:LINK_ORDER_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $centerbottom_admin_blocks:LINK_ORDER_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
-				&lt;!-- IF { $centerbottom_admin_blocks:WEIGHT_DOWN } --&gt;
-				&lt;a href=&quot;{ $centerbottom_admin_blocks:WEIGHT_MOVE_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $centerbottom_admin_blocks:WEIGHT_MOVE_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $centerbottom_admin_blocks:ORDER_DOWN } --&gt;
+				&lt;a href=&quot;{ $centerbottom_admin_blocks:LINK_ORDER_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $centerbottom_admin_blocks:LINK_ORDER_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;{ $centerbottom_admin_blocks:TYPE }&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centerbottom_admin_blocks:ACTIVE_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $centerbottom_admin_blocks:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $centerbottom_admin_blocks:ACTIVE_LINK }&quot;&gt;{ $right_admin_blocks:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
@@ -159,24 +160,24 @@
 		&lt;!-- ENDIF --&gt;
 		&lt;!-- LOOP $right_admin_blocks --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $right_admin_blocks:EDIT_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $right_admin_blocks:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $right_admin_blocks:EDIT_LINK }&quot;&gt;{ $right_admin_blocks:TITLE }&lt;/a&gt;
 				&lt;!-- IF { $right_admin_blocks:ERROR } --&gt;&lt;br/&gt;&lt;span style=&quot;font-size: 90%; color: red;&quot;&gt;{ $right_admin_blocks:ERROR }&lt;/span&gt;&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot; &gt;
-				&lt;!-- IF { $right_admin_blocks:WEIGHT_UP } --&gt;
-				&lt;a href=&quot;{ $right_admin_blocks:WEIGHT_MOVE_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $right_admin_blocks:WEIGHT_MOVE_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $right_admin_blocks:ORDER_UP } --&gt;
+				&lt;a href=&quot;{ $right_admin_blocks:LINK_ORDER_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $right_admin_blocks:LINK_ORDER_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
-				&lt;!-- IF { $right_admin_blocks:WEIGHT_DOWN } --&gt;
-				&lt;a href=&quot;{ $right_admin_blocks:WEIGHT_MOVE_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $right_admin_blocks:WEIGHT_MOVE_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $right_admin_blocks:ORDER_DOWN } --&gt;
+				&lt;a href=&quot;{ $right_admin_blocks:LINK_ORDER_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $right_admin_blocks:LINK_ORDER_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;{ $right_admin_blocks:TYPE }&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $right_admin_blocks:ACTIVE_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $right_admin_blocks:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $right_admin_blocks:ACTIVE_LINK }&quot;&gt;{ $right_admin_blocks:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
@@ -199,9 +200,9 @@
 &lt;table border=&quot;0&quot; class=&quot;tablebg&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 	&lt;tbody&gt;
 		&lt;tr&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FILE }'&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FILE }&quot;&gt;{ $L_BLOCK_REGULAR }&lt;/a&gt;&lt;/td&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FEED }'&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FEED }&quot;&gt;{ $L_BLOCK_FEED }&lt;/a&gt;&lt;/td&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_HTML }'&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_HTML }&quot;&gt;{ $L_BLOCK_HTML }&lt;/a&gt;&lt;/td&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FILE }'; return false;&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FILE }&quot;&gt;{ $L_BLOCK_REGULAR }&lt;/a&gt;&lt;/td&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_FEED }'; return false;&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_FEED }&quot;&gt;{ $L_BLOCK_FEED }&lt;/a&gt;&lt;/td&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $N_BLOCK_HTML }'; return false;&quot;&gt;&lt;a href=&quot;{ $N_BLOCK_HTML }&quot;&gt;{ $L_BLOCK_HTML }&lt;/a&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 	&lt;/tbody&gt;
 &lt;/table&gt;

Modified: trunk/includes/templates/admin/index.html
===================================================================
--- trunk/includes/templates/admin/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,3 +1,5 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
 { $A_TABLE_OPEN }
 
 &lt;table border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
@@ -126,70 +128,94 @@
     &lt;/tbody&gt;
 &lt;/table&gt;
 &lt;br/&gt;
-&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
     &lt;tbody&gt;
 		&lt;tr&gt;
-			&lt;th colspan=&quot;3&quot; align=&quot;center&quot;&gt;&lt;b&gt;Inactive Users&lt;/b&gt;&lt;/th&gt;
+			&lt;th colspan=&quot;6&quot; align=&quot;center&quot;&gt;{ $L_INACTIVE_USERS }&lt;/th&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt;
-			&lt;td colspan=&quot;3&quot; class=&quot;row2&quot;&gt;&lt;/td&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt;
-			&lt;th width=&quot;20%&quot; height=&quot;25&quot; nowrap=&quot;nowrap&quot;&gt;Username&lt;/th&gt;
-			&lt;th width=&quot;45%&quot;&gt;Options&lt;/th&gt;
-			&lt;th width=&quot;5%&quot; nowrap=&quot;nowrap&quot;&gt;Options&lt;/th&gt;
+			&lt;th width=&quot;20px&quot;&gt;&lt;/th&gt;
+			&lt;th&gt;{ $L_USERNAME }&lt;/th&gt;
+			&lt;th&gt;{ $L_REGISTED }&lt;/th&gt;
+			&lt;th colspan=&quot;3&quot; &gt;{ $L_OPTIONS }&lt;/th&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt;
-			&lt;td colspan=&quot;3&quot; class=&quot;row2&quot;&gt;{ $L_DISABLED_USERS }&lt;/td&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;{ $L_UNACTIVATED_USERS }&lt;/td&gt;
 		&lt;/tr&gt;
-		&lt;!-- LOOP $users_disabled --&gt;
+		&lt;!-- LOOP $users_unactivated --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot;&gt;
-				&lt;a href=&quot;{ $users_disabled:link_profile }&quot;&gt;{ $users_disabled:user_name }&lt;/a&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;input name=&quot;mark_id[]&quot; value=&quot;{ $users_unactivated:user_id }&quot; type=&quot;checkbox&quot;&gt;
 			&lt;/td&gt;
-			&lt;td class=&quot;row1&quot;&gt;
-				{ $users_disabled:user_name }
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_profile }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_profile }&quot;&gt;{ $users_unactivated:user_name }&lt;/a&gt;
 			&lt;/td&gt;
-			&lt;td class=&quot;row1&quot;&gt;
-				{ $users_disabled:user_name }
+			&lt;td width=&quot;150&quot; class=&quot;row1&quot; align=&quot;center&quot;&gt;
+				{ $users_unactivated:registered }
 			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_activate }&quot;&gt;{ $L_ACTIVATE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_remove }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_remove }&quot;&gt;{ $L_REMOVE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_remind }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_remind }&quot;&gt;{ $L_REMIND }&lt;/a&gt; 
+			&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;spacer&quot; colspan=&quot;3&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
+			&lt;td class=&quot;spacer&quot; colspan=&quot;6&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;!-- LOOPELSE --&gt;
 		&lt;tr&gt;
-			&lt;td colspan=&quot;3&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
-				{ $L_NO_DISABLED_USERS }
+			&lt;td colspan=&quot;6&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
+				{ $L_NO_UNACTIVATED_USERS }
 			&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;!-- ENDLOOP --&gt;
 		&lt;tr&gt;
-			&lt;td colspan=&quot;3&quot; class=&quot;row2&quot;&gt;{ $L_UNACTIVATED_USERS }&lt;/td&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;{ $L_DISABLED_USERS }&lt;/td&gt;
 		&lt;/tr&gt;
-		&lt;!-- LOOP $users_unactivated --&gt;
+		&lt;!-- LOOP $users_disabled --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot;&gt;
-				&lt;a href=&quot;{ $users_unactivated:link_profile }&quot;&gt;{ $users_unactivated:user_name }&lt;/a&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;input name=&quot;mark_id[]&quot; value=&quot;{ $users_disabled:user_id }&quot; type=&quot;checkbox&quot;&gt;
 			&lt;/td&gt;
-			&lt;td class=&quot;row1&quot;&gt;
-				{ $users_unactivated:user_name }
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_profile }&quot;&gt;{ $users_disabled:user_name }&lt;/a&gt;
 			&lt;/td&gt;
-			&lt;td class=&quot;row1&quot;&gt;
-				{ $users_unactivated:user_name }
+			&lt;td width=&quot;150&quot; class=&quot;row1&quot; align=&quot;center&quot;&gt;
+				{ $users_disabled:registered }
 			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_disabled:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_activate }&quot;&gt;{ $L_ACTIVATE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_disabled:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_activate }&quot;&gt;{ $L_REMOVE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_disabled:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_activate }&quot;&gt;{ $L_VIEW_REASON }&lt;/a&gt; 
+			&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;spacer&quot; colspan=&quot;3&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
+			&lt;td class=&quot;spacer&quot; colspan=&quot;6&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;!-- LOOPELSE --&gt;
 		&lt;tr&gt;
-			&lt;td colspan=&quot;3&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
-				{ $L_NO_UNACTIVATED_USERS }
+			&lt;td colspan=&quot;6&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
+				{ $L_NO_DISABLED_USERS }
 			&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;!-- ENDLOOP --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;cat&quot; align=&quot;right&quot;&gt;&lt;select name=&quot;mark_option&quot;&gt;&lt;option value=&quot;activate&quot;&gt;{ $L_ACTIVATE }&lt;/option&gt;&lt;option value=&quot;remove&quot;&gt;{ $L_REMOVE }&lt;/option&gt;&lt;/select&gt;&nbsp;&lt;input class=&quot;bottom&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; type=&quot;submit&quot;&gt;&nbsp;&lt;/td&gt;
+		&lt;/tr&gt;
     &lt;/tbody&gt;
 &lt;/table&gt;
 
-{ $A_TABLE_CLOSE }
\ No newline at end of file
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Modified: trunk/includes/templates/admin/messages/edit.html
===================================================================
--- trunk/includes/templates/admin/messages/edit.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/messages/edit.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,14 +1,14 @@
 &lt;!-- DISPLAY_HEADER --&gt;
 
-&lt;style type=&quot;text/css&quot;&gt;@import url(java/jscalendar/skins/aqua/theme.css);&lt;/style&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/calendar_stripped.js&quot;&gt;&lt;/script&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/lang/calendar-en.js&quot;&gt;&lt;/script&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/calendar-setup.js&quot;&gt;&lt;/script&gt;
+&lt;style type=&quot;text/css&quot;&gt;@import url(javascript/jscalendar/skins/aqua/theme.css);&lt;/style&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/calendar.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/calendar-setup.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/lang/calendar-en.js&quot;&gt;&lt;/script&gt;
 
 { $A_TABLE_OPEN }
 
 &lt;form action=&quot;{ $B_ACTION }&quot; name=&quot;message&quot; method=&quot;post&quot;&gt;
-	&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+	&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 		&lt;tbody&gt;
 			&lt;!-- IF { $B_ERROR } --&gt;
 			&lt;tr&gt; 
@@ -43,8 +43,7 @@
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_STARTS }: &lt;/b&gt;&lt;/td&gt;
 				&lt;td class=&quot;row2&quot; &gt;
 					&lt;input class=&quot;post&quot; id=&quot;time&quot; name=&quot;time&quot; size=&quot;35&quot; maxlength=&quot;100&quot; value=&quot;{ $B_STARTS }&quot; type=&quot;text&quot;&gt;
-					&lt;img src=&quot;java/jscalendar/calendar.png&quot; style=&quot;cursor: pointer;&quot; id=&quot;time_trigger&quot;/&gt;
-					&lt;!-- IF { $B_STARTS } --&gt;   Currently Set:  { $B_STARTS }&lt;!-- ENDIF --&gt;
+					&lt;img src=&quot;images/calender_small.png&quot; style=&quot;cursor: pointer;&quot; id=&quot;time_trigger&quot;/&gt;
 				&lt;/td&gt;
 				&lt;td class=&quot;row1&quot; align=&quot;center&quot; rowspan=&quot;2&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;Current Server Time:&lt;br/&gt;{ $B_CURRENT_TIME }: &lt;/b&gt;&lt;/td&gt;
 			&lt;/tr&gt;
@@ -52,14 +51,13 @@
 				&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_EXPIRES }: &lt;/b&gt;&lt;/td&gt;
 				&lt;td class=&quot;row2&quot;&gt;
 					&lt;input class=&quot;post&quot; id=&quot;expires&quot; name=&quot;expires&quot; size=&quot;35&quot; maxlength=&quot;100&quot; value=&quot;{ $B_EXPIRES }&quot; type=&quot;text&quot; /&gt;
-					&lt;img src=&quot;java/jscalendar/calendar.png&quot; style=&quot;cursor: pointer;&quot;  id=&quot;expires_trigger&quot; /&gt;
-					&lt;!-- IF { $B_EXPIRES } --&gt;    Currently Set:  { $B_EXPIRES }&lt;!-- ENDIF --&gt;
+					&lt;img src=&quot;images/calender_small.png&quot; style=&quot;cursor: pointer;&quot;  id=&quot;expires_trigger&quot; /&gt;
 				&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;tr&gt; 
 				&lt;td class=&quot;row1&quot; valign=&quot;top&quot; &gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_MESSAGE }: &lt;/b&gt;&lt;/td&gt;
-				&lt;td class=&quot;row2&quot; colspan=&quot;2&quot;&gt;&lt;div id=&quot;message_preview&quot; style=&quot;display: none; padding:5&quot;&gt;&lt;/div&gt;
-				&lt;textarea name=&quot;content&quot; id=&quot;content&quot; editor_enabled=&quot;true&quot; style=&quot;width:90%; height:400px; display: ;&quot; cols=&quot;63&quot; rows=&quot;15&quot;&gt;{ $B_CONTENT }&lt;/textarea&gt;&lt;br /&gt;&lt;br /&gt;&lt;/td&gt;
+				&lt;td class=&quot;row2&quot; colspan=&quot;2&quot;&gt;&lt;div id=&quot;message_preview&quot; style=&quot;display: none; padding:5px&quot;&gt;&lt;/div&gt;
+				&lt;textarea name=&quot;content&quot; id=&quot;content&quot; editor_enabled=&quot;true&quot; style=&quot;width:90%; height:400px;&quot; cols=&quot;63&quot; rows=&quot;15&quot;&gt;{ $B_CONTENT }&lt;/textarea&gt;&lt;br /&gt;&lt;br /&gt;&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;tr&gt;
 				&lt;td class=&quot;cat&quot; colspan=&quot;3&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;

Modified: trunk/includes/templates/admin/messages/index.html
===================================================================
--- trunk/includes/templates/admin/messages/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/messages/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -5,8 +5,8 @@
 &lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
     &lt;tbody&gt;
 		&lt;tr&gt;
-			&lt;th align=&quot;center&quot;&gt;{$L_TITLE}&lt;/th&gt;
-			&lt;th align=&quot;center&quot; colspan=&quot;2&quot;&gt;{ $L_POSITION }&lt;/th&gt;
+			&lt;th align=&quot;center&quot; width=&quot;25%&quot;&gt;{$L_TITLE}&lt;/th&gt;
+			&lt;th align=&quot;center&quot; colspan=&quot;2&quot;&gt;{ $L_ORDER }&lt;/th&gt;
 			&lt;th align=&quot;center&quot;&gt;{ $L_STATUS }&lt;/th&gt;
 			&lt;th align=&quot;center&quot;&gt;{ $L_FUNCTIONS }&lt;/th&gt;
 		&lt;/tr&gt;
@@ -19,24 +19,24 @@
 		&lt;/tr&gt;
 	&lt;!-- LOOP $top_admin_messages --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $top_admin_messages:EDIT_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $top_admin_messages:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $top_admin_messages:EDIT_LINK }&quot; title=&quot;{ $L_EDIT }&quot;&gt;{ $top_admin_messages:TITLE }&lt;/a&gt;&lt;br /&gt;
 				&lt;!-- IF { $top_admin_messages:STARTS } --&gt;&lt;br /&gt;&lt;b&gt;{ $L_STARTS }: &lt;/b&gt;{ $top_admin_messages:STARTS }&lt;!-- ENDIF --&gt;
 				&lt;!-- IF { $top_admin_messages:EXPIRES } --&gt;&lt;br /&gt;&lt;b&gt;{ $L_EXPIRES }: &lt;/b&gt;{ $top_admin_messages:EXPIRES }&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot; &gt;
-				&lt;!-- IF { $top_admin_messages:WEIGHT_UP } --&gt;
-				&lt;a href=&quot;{ $top_admin_messages:WEIGHT_MOVE_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $top_admin_messages:WEIGHT_MOVE_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $top_admin_messages:ORDER_UP } --&gt;
+				&lt;a href=&quot;{ $top_admin_messages:LINK_ORDER_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $top_admin_messages:LINK_ORDER_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
-				&lt;!-- IF { $top_admin_messages:WEIGHT_DOWN } --&gt;
-				&lt;a href=&quot;{ $top_admin_messages:WEIGHT_MOVE_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $top_admin_messages:WEIGHT_MOVE_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $top_admin_messages:ORDER_DOWN } --&gt;
+				&lt;a href=&quot;{ $top_admin_messages:LINK_ORDER_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $top_admin_messages:LINK_ORDER_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $top_admin_messages:ACTIVE_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $top_admin_messages:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $top_admin_messages:ACTIVE_LINK }&quot;&gt;{ $top_admin_messages:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
@@ -51,7 +51,7 @@
 		&lt;tr&gt;
 			&lt;td class=&quot;spacer&quot; colspan=&quot;8&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-	&lt;!-- ENDLOOP --&gt;
+	&lt;!-- ENDLOOP $top_admin_messages --&gt;
 	&lt;!-- ENDIF --&gt;
 
 	&lt;!-- IF isset({ $bottom_admin_messages }) --&gt;
@@ -63,24 +63,24 @@
 		&lt;/tr&gt;
 	&lt;!-- LOOP $bottom_admin_messages --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $bottom_admin_messages:EDIT_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $bottom_admin_messages:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $bottom_admin_messages:EDIT_LINK }&quot; title=&quot;{ $L_EDIT }&quot;&gt;{ $bottom_admin_messages:TITLE }&lt;/a&gt;&lt;br /&gt;
 				&lt;!-- IF { $bottom_admin_messages:STARTS } --&gt;&lt;br /&gt;&lt;b&gt;{ $L_STARTS }: &lt;/b&gt;{ $bottom_admin_messages:STARTS }&lt;!-- ENDIF --&gt;
 				&lt;!-- IF { $bottom_admin_messages:EXPIRES } --&gt;&lt;br /&gt;&lt;b&gt;{ $L_EXPIRES }: &lt;/b&gt;{ $bottom_admin_messages:EXPIRES }&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot; &gt;
-				&lt;!-- IF { $bottom_admin_messages:WEIGHT_UP } --&gt;
-				&lt;a href=&quot;{ $bottom_admin_messages:WEIGHT_MOVE_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $bottom_admin_messages:WEIGHT_MOVE_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $bottom_admin_messages:ORDER_UP } --&gt;
+				&lt;a href=&quot;{ $bottom_admin_messages:LINK_ORDER_UP }&quot;&gt;&lt;img src=&quot;images/1uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $bottom_admin_messages:LINK_ORDER_TOP }&quot;&gt;&lt;img src=&quot;images/2uparrow.png&quot; alt=&quot;{ $L_MOVE_UP }&quot; title=&quot;{ $L_MOVE_UP }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
-				&lt;!-- IF { $bottom_admin_messages:WEIGHT_DOWN } --&gt;
-				&lt;a href=&quot;{ $bottom_admin_messages:WEIGHT_MOVE_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
-				&lt;a href=&quot;{ $bottom_admin_messages:WEIGHT_MOVE_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
+				&lt;!-- IF { $bottom_admin_messages:ORDER_DOWN } --&gt;
+				&lt;a href=&quot;{ $bottom_admin_messages:LINK_ORDER_DOWN }&quot;&gt;&lt;img src=&quot;images/1downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&nbsp;
+				&lt;a href=&quot;{ $bottom_admin_messages:LINK_ORDER_BOTTOM }&quot;&gt;&lt;img src=&quot;images/2downarrow.png&quot; alt=&quot;{ $L_MOVE_DOWN }&quot; title=&quot;{ $L_MOVE_DOWN }&quot; border=&quot;0&quot;&gt;&lt;/a&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $bottom_admin_messages:ACTIVE_LINK }'&quot;&gt;
+			&lt;td class=&quot;row1&quot; align=&quot;center&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $bottom_admin_messages:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $bottom_admin_messages:ACTIVE_LINK }&quot;&gt;{ $bottom_admin_messages:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;
@@ -95,7 +95,7 @@
 		&lt;tr&gt;
 			&lt;td class=&quot;spacer&quot; colspan=&quot;8&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-	&lt;!-- ENDLOOP --&gt;
+	&lt;!-- ENDLOOP $bottom_admin_messages --&gt;
 	&lt;!-- ENDIF --&gt;
 	 		  &lt;tr&gt;
 			&lt;td class=&quot;cat&quot; colspan=&quot;8&quot;&gt;

Modified: trunk/includes/templates/admin/modules/index.html
===================================================================
--- trunk/includes/templates/admin/modules/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/modules/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,3 +1,5 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
 { $A_TABLE_OPEN }
 
 &lt;table class=&quot;tablebg&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
@@ -25,11 +27,11 @@
 				&lt;!-- IF { $normal_modules:ERROR } --&gt;&lt;br/&gt;&lt;span style=&quot;font-size: 90%; color: red;&quot;&gt;{ $normal_modules:ERROR }&lt;/span&gt;&lt;!-- ENDIF --&gt;
 			&lt;/td&gt;
 			&lt;!-- IF { $normal_modules:ACTIVE } --&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $normal_modules:ACTIVE_LINK }'&quot;&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row2&quot; onmouseover=&quot;this.className='row1'&quot; onmouseout=&quot;this.className='row2'&quot; onclick=&quot;location.href='{ $normal_modules:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $normal_modules:ACTIVE_LINK }&quot;&gt;{ $normal_modules:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;!-- ELSE --&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row2&quot; onmouseover=&quot;this.className='row1'&quot; onmouseout=&quot;this.className='row2'&quot; onclick=&quot;location.href='{ $normal_modules:ACTIVE_LINK }'&quot;&gt;
+			&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $normal_modules:ACTIVE_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $normal_modules:ACTIVE_LINK }&quot;&gt;{ $normal_modules:CHANGE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;!-- ENDIF --&gt;
@@ -64,7 +66,7 @@
 		&lt;/tr&gt;
 		&lt;!-- LOOP $system_modules --&gt;
 		&lt;tr&gt;
-			&lt;td colspan=&quot;3&quot; height=&quot;24&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $system_modules:EDIT_LINK }'&quot;&gt;
+			&lt;td colspan=&quot;3&quot; height=&quot;24&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $system_modules:EDIT_LINK }'; return false;&quot;&gt;
 				&lt;a href=&quot;{ $system_modules:EDIT_LINK }&quot;&gt;{ $system_modules:TITLE }&lt;/a&gt;
 			&lt;/td&gt;
 			&lt;!-- IF { $S_ADMIN_AUTH_LINK } --&gt;
@@ -81,4 +83,6 @@
 	&lt;/tbody&gt;
 &lt;/table&gt;
 
-{ $A_TABLE_CLOSE }
\ No newline at end of file
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Deleted: trunk/includes/templates/admin/system/bots.html
===================================================================
--- trunk/includes/templates/admin/system/bots.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/system/bots.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,18 +0,0 @@
-&lt;table class=&quot;tablebg&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot;&gt;
-	&lt;tr&gt;
-		&lt;th nowrap=&quot;nowrap&quot;&gt;Bot name&lt;/th&gt;
-		&lt;th nowrap=&quot;nowrap&quot;&gt;Last visit&lt;/th&gt;
-		&lt;th colspan=&quot;3&quot; nowrap=&quot;nowrap&quot;&gt;Options&lt;/th&gt;
-
-	&lt;/tr&gt;
-	{ section name=admin_bots_loop loop=$admin_bots }
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;25%&quot;&gt;{ $admin_bots[admin_bots_loop].NAME }&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;15%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;{ $admin_bots[admin_bots_loop].LAST_VISIT }&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;1%&quot;align=&quot;center&quot;&gt;&nbsp;&lt;a href=&quot;{ $admin_bots[admin_bots_loop].STATUS_LINK }&quot;&gt;{ $admin_bots[admin_bots_loop].STATUS }&lt;/a&gt;&nbsp;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;1%&quot; align=&quot;center&quot;&gt;&nbsp;&lt;a href=&quot;{ $admin_bots[admin_bots_loop].LAST_VISIT }&quot;&gt;Edit&lt;/a&gt;&nbsp;&lt;/td&gt;
-
-		&lt;td class=&quot;row1&quot; width=&quot;1%&quot; align=&quot;center&quot;&gt;&nbsp;&lt;a href=&quot;{ $admin_bots[admin_bots_loop].DELETE_LINK }&quot;&gt;Delete&lt;/a&gt;&nbsp;&lt;/td&gt;
-	&lt;/tr&gt;
-	{ /section }
-&lt;/table&gt;
\ No newline at end of file

Modified: trunk/includes/templates/admin/system/index.html
===================================================================
--- trunk/includes/templates/admin/system/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/system/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,248 +1,250 @@
-&lt;style type=&quot;text/css&quot;&gt;@import url(java/jscalendar/skins/aqua/theme.css);&lt;/style&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/calendar_stripped.js&quot;&gt;&lt;/script&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/lang/calendar-en.js&quot;&gt;&lt;/script&gt;
-&lt;script type=&quot;text/javascript&quot; src=&quot;java/jscalendar/calendar-setup.js&quot;&gt;&lt;/script&gt;
+&lt;!-- DISPLAY_HEADER --&gt;
 
+&lt;style type=&quot;text/css&quot;&gt;@import url(javascript/jscalendar/skins/aqua/theme.css);&lt;/style&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/calendar.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/calendar-setup.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; src=&quot;javascript/jscalendar/lang/calendar-en.js&quot;&gt;&lt;/script&gt;
+
 { $A_TABLE_OPEN }
 
-&lt;table class=&quot;tablebg&quot; style=&quot;width:100%&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
-	&lt;tr&gt;
-&lt;!-- LOOP $a_options --&gt;
-	&lt;th width=&quot;25%&quot;&gt;&lt;!-- IF { $a_options:ACTIVE } --&gt;{ $a_options:LANG }&lt;!-- ELSE --&gt;&lt;a href=&quot;{ $a_options:LINK }&quot;&gt;&lt;b&gt;{ $a_options:LANG }&lt;/b&gt;&lt;/a&gt;&lt;!-- ENDIF --&gt;&lt;/th&gt;
-&lt;!-- ENDLOOP --&gt;
-	&lt;/tr&gt;
-&lt;/table&gt;
-&lt;table cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
-	&lt;tr&gt;
-		&lt;td&gt;&lt;/th&gt;
-	&lt;/tr&gt;
-&lt;/table&gt;
-&lt;form action=&quot;{ $ACTION }&quot; method=&quot;post&quot;&gt;
-&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
-	&lt;tbody&gt;
-	&lt;!-- IF { $A_OPTION } == 'site' --&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;{ $L_SITE }&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SITE_NAME }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_name&quot; value=&quot;{ $SITE_NAME }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SITE_URL }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_url&quot; value=&quot;{ $SITE_URL }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SITE_LOGO }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_logo&quot; value=&quot;{ $SITE_LOGO }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SLOGAN }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;slogan&quot; value=&quot;{ $SLOGAN }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_START_DATE }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;startdate&quot; value=&quot;{ $START_DATE }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_LINK_OPTIMIZATION }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;link_optimization&quot; value=&quot;1&quot; &lt;!-- IF { $LINK_OPTIMIZATION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; { $L_YES }&nbsp;&nbsp;&lt;input name=&quot;link_optimization&quot; value=&quot;0&quot; &lt;!-- IF !{ $LINK_OPTIMIZATION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
 
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_DEFAULT_THEME }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;
-			&lt;select name=&quot;default_theme&quot;&gt;
-			&lt;!-- LOOP $site_theme --&gt;
-				&lt;option value=&quot;{ $site_theme:FILE }&quot; &lt;!-- IF { $site_theme:FILE } == { $DEFAULT_THEME } --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt; { $site_theme:NAME }&lt;/option&gt;
-			&lt;!-- ENDLOOP --&gt;
-			&lt;/select&gt;
-		&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-	&lt;td class=&quot;row1&quot; width=&quot;50%&quot; valign=&quot;top&quot;&gt;&lt;b&gt;{ $L_FOOTER_MESSAGE }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;
-		&lt;textarea name=&quot;foot1&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $FOOTER_FIRST }&lt;/textarea&gt;&lt;br /&gt;&lt;br /&gt;
-		&lt;textarea name=&quot;foot2&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $FOOTER_SECOND }&lt;/textarea&gt;
-	&lt;/tr&gt;
-&lt;!-- ELSEIF { $A_OPTION } == 'system' --&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;{ $L_MAINTENANCE }&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_MAINTENANCE }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;maintenance&quot; value=&quot;1&quot; &lt;!-- IF { $MAINTENANCE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; { $L_YES }&nbsp;&nbsp;&lt;input name=&quot;maintenance&quot; value=&quot;0&quot; &lt;!-- IF !{ $MAINTENANCE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;br /&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_MAINTENANCE_START }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;
-		&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; id=&quot;maintenance_start&quot; name=&quot;maintenance_start&quot; value=&quot;{ $MAINTENANCE_START }&quot; type=&quot;text&quot;&gt;
-			&lt;img src=&quot;java/jscalendar/calendar.png&quot; style=&quot;cursor: pointer;&quot; id=&quot;time_trigger&quot; /&gt;
-			
-		&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot; valign=&quot;top&quot;&gt;&lt;b&gt;{ $L_MAINTENANCE_TEXT }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;br /&gt;&lt;textarea name=&quot;maintenance_text&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $MAINTENANCE_MSG }&lt;/textarea&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_DEBUGGING }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;error_options&quot;&gt;&lt;option value=&quot;0&quot;&lt;!-- IF { $ERROR } == '0' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;None&lt;/option&gt;&lt;option value=&quot;1&quot;&lt;!-- IF { $ERROR } == '1' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;On page&lt;/option&gt;&lt;option value=&quot;2&quot;&lt;!-- IF { $ERROR } == '2' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Debug Screen&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;Server Settings&lt;/th&gt;
-	&lt;/tr&gt;
 
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Domain Name: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;The domain name this board runs from&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_domain&quot; value=&quot;{ $SITE_DOMAIN }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
+&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+	&lt;tbody&gt;
+		&lt;tr&gt;
+		&lt;!-- IF { $SYSTEM_MODE } == 'site' --&gt;
+			&lt;td width=&quot;50%&quot; class=&quot;row2&quot; align=&quot;center&quot;&gt;{ $L_SITE_SETTINGS }&lt;/td&gt;
+			&lt;td width=&quot;50%&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_SYSTEM }'; return false;&quot; align=&quot;center&quot;&gt;&lt;a href=&quot;{ $LINK_SYSTEM }&quot;&gt;{ $L_SYSTEM_SETTINGS }&lt;/a&gt;&lt;/td&gt;
+		&lt;!-- ELSE --&gt;
+			&lt;td width=&quot;50%&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_SITE }'; return false;&quot; align=&quot;center&quot;&gt;&lt;a href=&quot;{ $LINK_SITE }&quot;&gt;{ $L_SITE_SETTINGS }&lt;/a&gt;&lt;/td&gt;
+			&lt;td width=&quot;50%&quot; class=&quot;row2&quot; align=&quot;center&quot;&gt;{ $L_SYSTEM_SETTINGS }&lt;/td&gt;
+		&lt;!-- ENDIF --&gt;
+		&lt;/tr&gt;
+	&lt;/tbody&gt;
+&lt;/table&gt;
 
+&lt;div style=&quot;padding: 3px&quot;&gt;&lt;/div&gt;
 
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Server Port: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;The port your server is running on, usually 80, only change if different&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;5&quot; maxlength=&quot;5&quot; name=&quot;site_port&quot; value=&quot;{ $SITE_PORT }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
+&lt;form action=&quot;{ $ACTION }&quot; method=&quot;post&quot;&gt;
+	&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+		&lt;tbody&gt;
+		&lt;!-- IF { $SYSTEM_MODE } == 'site' --&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;2&quot;&gt;{ $L_SITE }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SITE_NAME }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_name&quot; value=&quot;{ $SITE_NAME }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_SITE_URL }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_url&quot; value=&quot;{ $SITE_URL }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_START_DATE }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;startdate&quot; value=&quot;{ $START_DATE }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_LINK_OPTIMIZATION }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;link_optimization&quot; value=&quot;1&quot; &lt;!-- IF { $LINK_OPTIMIZATION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; { $L_YES }&nbsp;&nbsp;&lt;input name=&quot;link_optimization&quot; value=&quot;0&quot; &lt;!-- IF !{ $LINK_OPTIMIZATION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+	
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_DEFAULT_THEME }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;
+				&lt;select name=&quot;default_theme&quot;&gt;
+				&lt;!-- LOOP $site_theme --&gt;
+					&lt;option value=&quot;{ $site_theme:FILE }&quot; &lt;!-- IF { $site_theme:FILE } == { $DEFAULT_THEME } --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt; { $site_theme:NAME }&lt;/option&gt;
+				&lt;!-- ENDLOOP --&gt;
+				&lt;/select&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;50%&quot; valign=&quot;top&quot;&gt;&lt;b&gt;{ $L_FOOTER_MESSAGE }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;
+			&lt;textarea name=&quot;foot1&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $FOOTER_FIRST }&lt;/textarea&gt;&lt;br /&gt;&lt;br /&gt;
+			&lt;textarea name=&quot;foot2&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $FOOTER_SECOND }&lt;/textarea&gt;
+		&lt;/tr&gt;
+	&lt;!-- ELSEIF { $SYSTEM_MODE } == 'system' --&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;2&quot;&gt;{ $L_MAINTENANCE }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_MAINTENANCE }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;maintenance&quot; value=&quot;1&quot; &lt;!-- IF { $MAINTENANCE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; { $L_YES }&nbsp;&nbsp;&lt;input name=&quot;maintenance&quot; value=&quot;0&quot; &lt;!-- IF !{ $MAINTENANCE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;br /&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_MAINTENANCE_START }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;
+			&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; id=&quot;maintenance_start&quot; name=&quot;maintenance_start&quot; value=&quot;{ $MAINTENANCE_START }&quot; type=&quot;text&quot;&gt;
+				&lt;img src=&quot;java/jscalendar/calendar.png&quot; style=&quot;cursor: pointer;&quot; id=&quot;time_trigger&quot; /&gt;
+				
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot; valign=&quot;top&quot;&gt;&lt;b&gt;{ $L_MAINTENANCE_TEXT }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;br /&gt;&lt;textarea name=&quot;maintenance_text&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $MAINTENANCE_MSG }&lt;/textarea&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_DEBUGGING }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;error_options&quot;&gt;&lt;option value=&quot;0&quot;&lt;!-- IF { $ERROR } == '0' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;None&lt;/option&gt;&lt;option value=&quot;1&quot;&lt;!-- IF { $ERROR } == '1' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;On page&lt;/option&gt;&lt;option value=&quot;2&quot;&lt;!-- IF { $ERROR } == '2' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Debug Screen&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;2&quot;&gt;Server Settings&lt;/th&gt;
+		&lt;/tr&gt;
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Domain Name: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;The domain name this board runs from&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;40&quot; maxlength=&quot;255&quot; name=&quot;site_domain&quot; value=&quot;{ $SITE_DOMAIN }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Server Port: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;The port your server is running on, usually 80, only change if different&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;5&quot; maxlength=&quot;5&quot; name=&quot;site_port&quot; value=&quot;{ $SITE_PORT }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Script path: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Site located relative to the domain name&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;site_path&quot; value=&quot;{ $SITE_PATH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Session IP validation: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Determines how much of the users IP is used to validate a session; All compares the complete address, A.B.C the first x.x.x, A.B the first x.x, None disables checking.&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;ip_check&quot; value=&quot;4&quot; &lt;!-- IF { $IP_CHECK } == 4  --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;type=&quot;radio&quot;&gt; All&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;3&quot; &lt;!-- IF { $IP_CHECK } == 3 --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B.C&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;2&quot; &lt;!-- IF { $IP_CHECK } == 2 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;0&quot; &lt;!-- IF { $IP_CHECK } == 0 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; None&nbsp;&nbsp;&lt;/td&gt;
+	
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Limit system load: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;If the 1 minute system load exceeds this value the board will go offline, 1.0 equals ~100% utilisation of one processor. This only functions on UNIX based servers.&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;limit_load&quot; value=&quot;{ $LIMIT_LOAD }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Limit sessions: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;If the number of sessions exceeds this value within a one minute period the board will go offline. Set to 0 for unlimited sessions.&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;limit_sessions&quot; value=&quot;{ $LIMIT_SESSIONS }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Session length: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Sessions will expire after this time, in seconds.&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;5&quot; maxlength=&quot;5&quot; name=&quot;session_length&quot; value=&quot;{ $SESSION_LENGTH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Session Autologin length: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Session Autologin will expire after this time, in seconds.&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;5&quot; maxlength=&quot;5&quot; name=&quot;session_length&quot; value=&quot;{ $SESSION_LENGTH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;2&quot;&gt;{ $L_COOKIE_SETTINGS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;2&quot; class=&quot;row1&quot;&gt;{ $L_COOKIE_SETTINGS_EXPLAIN }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_DOMAIN }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;cookie_domain&quot; value=&quot;{ $COOKIE_DOMAIN }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_NAME }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;16&quot; name=&quot;cookie_name&quot; value=&quot;{ $COOKIE_NAME }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_PATH }: &lt;/b&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;cookie_path&quot; value=&quot;{ $COOKIE_PATH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_SECURE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COOKIE_SECURE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;cookie_secure&quot; value=&quot;0&quot; &lt;!-- IF !{ $COOKIE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Disabled&nbsp;&nbsp;&lt;input name=&quot;cookie_secure&quot; value=&quot;1&quot; &lt;!-- IF { $COOKIE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Enabled&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;script type=&quot;text/javascript&quot;&gt;
+			  Calendar.setup(
+				{
+				  inputField  : &quot;maintenance_start&quot;,
+				  button      : &quot;time_trigger&quot;
+				}
+			  );
+		&lt;/script&gt;
+	&lt;!-- ELSEIF { $SYSTEM_MODE } == 'users' --&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;2&quot;&gt;{ $L_USER_OPTIONS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ACC_ACTIVATION }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ACC_ACTIVATION_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;
+			&lt;!-- LOOP $A_ACC_OPTION --&gt;
+				&lt;input name=&quot;require_activation&quot; value=&quot;{$A_ACC_OPTION:OPTION}&quot; &lt;!-- IF { $A_ACC_OPTION:OPTION } == { $ACTIVATION_OPTION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; {$A_ACC_OPTION:LANG}&nbsp;&nbsp;
+			&lt;!-- ENDLOOP --&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ENABLE_COPPA }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ENABLE_COPPA_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;coppa_enable&quot; value=&quot;1&quot; &lt;!-- IF { $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;coppa_enable&quot; value=&quot;0&quot; &lt;!-- IF !{ $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_FAX }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;25&quot; maxlength=&quot;100&quot; name=&quot;coppa_fax&quot; value=&quot;{ $COPPA_FAX }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_MAIL }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COPPA_MAIL_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;textarea name=&quot;coppa_mail&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $COPPA_MAIL }&lt;/textarea&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_VISUAL_CONFIRM }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_VISUAL_CONFIRM_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+	
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;enable_confirm&quot; value=&quot;1&quot; &lt;!-- IF { $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;enable_confirm&quot; value=&quot;0&quot; &lt;!-- IF !{ $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_REG_LIMIT }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_REG_LIMIT_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;max_reg_attempts&quot; value=&quot;{ $MAX_REG_ATTEMPTS }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_name_chars&quot; value=&quot;{ $MIN_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_name_chars&quot; value=&quot;{ $MAX_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;allow_name_chars&quot;&gt;&lt;option value=&quot;.*&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '.*' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Any character&lt;/option&gt;&lt;option value=&quot;[\w]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric only&lt;/option&gt;&lt;option value=&quot;[\w_\+\. \-\[\]]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w_\+\. \-\[\]]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric and spacers&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+	
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_PASSWORD_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_pass_chars&quot; value=&quot;{ $MIN_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_pass_chars&quot; value=&quot;{ $MAX_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
+		&lt;/tr&gt;
+	
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;pass_complex&quot;&gt;&lt;option value=&quot;.*&quot;&gt;No requirements&lt;/option&gt;&lt;option value=&quot;[a-zA-Z]&quot;&gt;Must be mixed case&lt;/option&gt;&lt;option value=&quot;[a-zA-Z0-9]&quot;&gt;Must contain alphanumerics&lt;/option&gt;&lt;option value=&quot;[a-zA-Z\W]&quot;&gt;Must contain symbols&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_FORCE_PASS_CHANGE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_FORCE_PASS_CHANGE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;chg_passforce&quot; value=&quot;{ $CHG_PASSFORCE }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+	
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_EMAIL_REUSE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ALLOW_EMAIL_REUSE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_NAME_CHANGE }: &lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_namechange&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_namechange&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
+		&lt;/tr&gt;
+	&lt;!-- ENDIF --&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input name=&quot;submit&quot; value=&quot;Submit&quot; class=&quot;btnmain&quot; type=&quot;submit&quot;&gt;&nbsp;&nbsp;&lt;input value=&quot;Reset&quot; class=&quot;button&quot; type=&quot;reset&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/form&gt;
 
+{ $A_TABLE_CLOSE }
 
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Script path: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Site located relative to the domain name&lt;/span&gt;&lt;/td&gt;
-
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;site_path&quot; value=&quot;{ $SITE_PATH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-
-
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Session IP validation: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Determines how much of the users IP is used to validate a session; All compares the complete address, A.B.C the first x.x.x, A.B the first x.x, None disables checking.&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;ip_check&quot; value=&quot;4&quot; &lt;!-- IF { $IP_CHECK } == 4  --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;type=&quot;radio&quot;&gt; All&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;3&quot; &lt;!-- IF { $IP_CHECK } == 3 --&gt;checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B.C&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;2&quot; &lt;!-- IF { $IP_CHECK } == 2 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; A.B&nbsp;&nbsp;&lt;input name=&quot;ip_check&quot; value=&quot;0&quot; &lt;!-- IF { $IP_CHECK } == 0 --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; None&nbsp;&nbsp;&lt;/td&gt;
-
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Validate browser: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Enables browser validation for each session inproving security.&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;browser_check&quot; value=&quot;1&quot; &lt;!-- IF { $BROWSER_CHECK } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;type=&quot;radio&quot;&gt;Yes&nbsp;&nbsp;&lt;input name=&quot;browser_check&quot; value=&quot;0&quot; &lt;!-- IF !{ $BROWSER_CHECK } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Limit system load: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;If the 1 minute system load exceeds this value the board will go offline, 1.0 equals ~100% utilisation of one processor. This only functions on UNIX based servers.&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;limit_load&quot; value=&quot;{ $LIMIT_LOAD }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Limit sessions: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;If the number of sessions exceeds this value within a one minute period the board will go offline. Set to 0 for unlimited sessions.&lt;/span&gt;&lt;/td&gt;
-
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;limit_sessions&quot; value=&quot;{ $LIMIT_SESSIONS }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;Session length: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;Sessions will expire after this time, in seconds.&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;5&quot; maxlength=&quot;5&quot; name=&quot;session_length&quot; value=&quot;{ $SESSION_LENGTH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;{ $L_COOKIE_SETTINGS }&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td colspan=&quot;2&quot; class=&quot;row1&quot;&gt;{ $L_COOKIE_SETTINGS_EXPLAIN }&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_DOMAIN }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;cookie_domain&quot; value=&quot;{ $COOKIE_DOMAIN }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-
-
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_NAME }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;16&quot; name=&quot;cookie_name&quot; value=&quot;{ $COOKIE_NAME }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-
-
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_PATH }: &lt;/b&gt;&lt;/td&gt;
-
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; maxlength=&quot;255&quot; name=&quot;cookie_path&quot; value=&quot;{ $COOKIE_PATH }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-
-
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COOKIE_SECURE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COOKIE_SECURE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;cookie_secure&quot; value=&quot;0&quot; &lt;!-- IF !{ $COOKIE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Disabled&nbsp;&nbsp;&lt;input name=&quot;cookie_secure&quot; value=&quot;1&quot; &lt;!-- IF { $COOKIE_SECURE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;Enabled&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;script type=&quot;text/javascript&quot;&gt;
-		  Calendar.setup(
-			{
-			  inputField  : &quot;maintenance_start&quot;,
-			  button      : &quot;time_trigger&quot;
-			}
-		  );
-	&lt;/script&gt;
-&lt;!-- ELSEIF { $A_OPTION } == 'users' --&gt;
-	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;{ $L_USER_OPTIONS }&lt;/th&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ACC_ACTIVATION }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ACC_ACTIVATION_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-
-		&lt;td class=&quot;row2&quot;&gt;
-		&lt;!-- LOOP $A_ACC_OPTION --&gt;
-			&lt;input name=&quot;require_activation&quot; value=&quot;{$A_ACC_OPTION:OPTION}&quot; &lt;!-- IF { $A_ACC_OPTION:OPTION } == { $ACTIVATION_OPTION } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt; {$A_ACC_OPTION:LANG}&nbsp;&nbsp;
-		&lt;!-- ENDLOOP --&gt;
-		&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ENABLE_COPPA }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ENABLE_COPPA_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;coppa_enable&quot; value=&quot;1&quot; &lt;!-- IF { $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;coppa_enable&quot; value=&quot;0&quot; &lt;!-- IF !{ $COPPA_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_FAX }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;25&quot; maxlength=&quot;100&quot; name=&quot;coppa_fax&quot; value=&quot;{ $COPPA_FAX }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_COPPA_MAIL }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_COPPA_MAIL_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;textarea name=&quot;coppa_mail&quot; rows=&quot;5&quot; cols=&quot;40&quot;&gt;{ $COPPA_MAIL }&lt;/textarea&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_VISUAL_CONFIRM }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_VISUAL_CONFIRM_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;enable_confirm&quot; value=&quot;1&quot; &lt;!-- IF { $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;enable_confirm&quot; value=&quot;0&quot; &lt;!-- IF !{ $CONFIRM_ENABLE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;{ $L_NO }&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_REG_LIMIT }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_REG_LIMIT_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;4&quot; maxlength=&quot;4&quot; name=&quot;max_reg_attempts&quot; value=&quot;{ $MAX_REG_ATTEMPTS }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_name_chars&quot; value=&quot;{ $MIN_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_name_chars&quot; value=&quot;{ $MAX_NAME_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_USERNAME_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;allow_name_chars&quot;&gt;&lt;option value=&quot;.*&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '.*' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Any character&lt;/option&gt;&lt;option value=&quot;[\w]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric only&lt;/option&gt;&lt;option value=&quot;[\w_\+\. \-\[\]]+&quot; &lt;!-- IF { $ALLOW_NAME_CHARS } == '[\w_\+\. \-\[\]]+' --&gt; selected=&quot;selected&quot; &lt;!-- ENDIF --&gt;&gt;Alphanumeric and spacers&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_LENGTH }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_PASSWORD_LENGTH_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;min_pass_chars&quot; value=&quot;{ $MIN_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Min&nbsp;&nbsp;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;max_pass_chars&quot; value=&quot;{ $MAX_PASS_CHARS }&quot; type=&quot;text&quot;&gt; Max&lt;/td&gt;
-	&lt;/tr&gt;
-
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_PASSWORD_CHARS }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_USERNAME_CHARS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;pass_complex&quot;&gt;&lt;option value=&quot;.*&quot;&gt;No requirements&lt;/option&gt;&lt;option value=&quot;[a-zA-Z]&quot;&gt;Must be mixed case&lt;/option&gt;&lt;option value=&quot;[a-zA-Z0-9]&quot;&gt;Must contain alphanumerics&lt;/option&gt;&lt;option value=&quot;[a-zA-Z\W]&quot;&gt;Must contain symbols&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_FORCE_PASS_CHANGE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_FORCE_PASS_CHANGE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; size=&quot;3&quot; maxlength=&quot;3&quot; name=&quot;chg_passforce&quot; value=&quot;{ $CHG_PASSFORCE }&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_EMAIL_REUSE }: &lt;/b&gt;&lt;br&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $L_ALLOW_EMAIL_REUSE_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_emailreuse&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_EMAILREUSE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
-	&lt;/tr&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;50%&quot;&gt;&lt;b&gt;{ $L_ALLOW_NAME_CHANGE }: &lt;/b&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;allow_namechange&quot; value=&quot;1&quot; &lt;!-- IF { $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt;  type=&quot;radio&quot;&gt;{ $L_YES }&nbsp;&nbsp;&lt;input name=&quot;allow_namechange&quot; value=&quot;0&quot; &lt;!-- IF !{ $ALLOW_NAMECHANGE } --&gt; checked=&quot;checked&quot; &lt;!-- ENDIF --&gt; type=&quot;radio&quot;&gt;No&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;!-- ENDIF --&gt;
-	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input name=&quot;submit&quot; value=&quot;Submit&quot; class=&quot;btnmain&quot; type=&quot;submit&quot;&gt;&nbsp;&nbsp;&lt;input value=&quot;Reset&quot; class=&quot;button&quot; type=&quot;reset&quot;&gt;&lt;/td&gt;
-	&lt;/tr&gt;
-&lt;/tbody&gt;
-&lt;/table&gt;
-&lt;/form&gt;
-
-{ $A_TABLE_CLOSE }
\ No newline at end of file
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Added: trunk/includes/templates/admin/users/bots.html
===================================================================
--- trunk/includes/templates/admin/users/bots.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/users/bots.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,28 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
+{ $A_TABLE_OPEN }
+
+&lt;!-- INCLUDE admin/users/header.html --&gt;
+
+&lt;table class=&quot;tablebg&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; border=&quot;0&quot;&gt;
+	&lt;tr&gt;
+		&lt;th nowrap=&quot;nowrap&quot;&gt;Bot name&lt;/th&gt;
+		&lt;th nowrap=&quot;nowrap&quot;&gt;Last visit&lt;/th&gt;
+		&lt;th colspan=&quot;3&quot; nowrap=&quot;nowrap&quot;&gt;Options&lt;/th&gt;
+
+	&lt;/tr&gt;
+	&lt;!-- LOOP $admin_bots --&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;25%&quot;&gt;{ $admin_bots:NAME }&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;15%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;{ $admin_bots:LAST_VISIT }&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;1%&quot;align=&quot;center&quot;&gt;&nbsp;&lt;a href=&quot;{ $admin_bots:LINK_STATUS }&quot;&gt;{ $admin_bots:L_STATUS }&lt;/a&gt;&nbsp;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;1%&quot; align=&quot;center&quot;&gt;&nbsp;&lt;a href=&quot;{ $admin_bots:LINK_EDIT }&quot;&gt;{ $L_EDIT }&lt;/a&gt;&nbsp;&lt;/td&gt;
+
+		&lt;td class=&quot;row1&quot; width=&quot;1%&quot; align=&quot;center&quot;&gt;&nbsp;&lt;a href=&quot;{ $admin_bots:LINK_DELETE }&quot;&gt;{ $L_DELETE }&lt;/a&gt;&nbsp;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;!-- ENDLOOP $admin_bots --&gt;
+&lt;/table&gt;
+
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Added: trunk/includes/templates/admin/users/header.html
===================================================================
--- trunk/includes/templates/admin/users/header.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/users/header.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,82 @@
+&lt;table border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+	&lt;tbody&gt;
+		&lt;tr&gt;
+			&lt;td width=&quot;80%&quot; valign=&quot;top&quot;&gt;
+				&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+					&lt;tbody&gt;
+						&lt;tr&gt;
+							&lt;th colspan=&quot;4&quot; align=&quot;center&quot;&gt;&lt;b&gt;System Info&lt;/b&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr class=&quot;row1&quot;&gt;
+							&lt;td width=&quot;20%&quot;&gt;
+								{ $L_TOTAL_USERS }
+							&lt;/td&gt;
+							&lt;td&gt;
+								{ $COUNT_USERS }
+							&lt;/td&gt;
+							&lt;td width=&quot;20%&quot;&gt;
+								{ $L_TOTAL_BOTS }
+							&lt;/td&gt;
+							&lt;td&gt;
+								{ $COUNT_BOTS }
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr class=&quot;row1&quot;&gt;
+							&lt;td width=&quot;20%&quot;&gt;
+								{ $L_TOTAL_USERS }
+							&lt;/td&gt;
+							&lt;td&gt;
+								{ $COUNT_USERS }
+							&lt;/td&gt;
+							&lt;td width=&quot;20%&quot;&gt;
+								{ $L_TOTAL_BOTS }
+							&lt;/td&gt;
+							&lt;td&gt;
+								{ $COUNT_BOTS }
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr class=&quot;row1&quot;&gt;
+							&lt;td colspan=&quot;4&quot;&gt;
+								&lt;img src=&quot;images/add_user.png&quot; alt=&quot;{ $L_ADD_USER }&quot; title=&quot;{ $L_ADD_USER }&quot; border=&quot;0&quot;&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+					&lt;/tbody&gt;
+				&lt;/table&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;20%&quot; valign=&quot;top&quot;&gt;
+				&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+					&lt;tbody&gt;
+						&lt;tr&gt;
+							&lt;th width=&quot;25%&quot; align=&quot;center&quot;&gt;&lt;b&gt;Options&lt;/b&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_USER_INDEX }'; return false;&quot;&gt;
+								&lt;a href=&quot;{ $LINK_USER_INDEX }&quot; title=&quot;{ $L_USERS_INDEX }&quot;&gt;{ $L_USERS_INDEX }&lt;/a&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_BOTS }'; return false;&quot;&gt;
+								&lt;a href=&quot;{ $LINK_VIEW_BOTS }&quot; title=&quot;{ $L_VIEW_BOTS }&quot;&gt;{ $L_VIEW_BOTS }&lt;/a&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_VIEW_DISABLED }'; return false;&quot;&gt;
+								&lt;a href=&quot;{ $LINK_VIEW_DISABLED }&quot; title=&quot;{ $L_VIEW_DISABLED }&quot;&gt;{ $L_VIEW_DISABLED }&lt;/a&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_VIEW_UNACTIVATED }'; return false;&quot;&gt;
+								&lt;a href=&quot;{ $LINK_VIEW_UNACTIVATED }&quot; title=&quot;{ $L_VIEW_UNACTIVATED }&quot;&gt;{ $L_VIEW_UNACTIVATED }&lt;/a&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $LINK_ADD_USER }'; return false;&quot;&gt;
+								&lt;a href=&quot;{ $LINK_ADD_USER }&quot; title=&quot;{ $L_VIEW_BOTS }&quot;&gt;{ $L_VIEW_BOTS }&lt;/a&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+					&lt;/tbody&gt;
+				&lt;/table&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+    &lt;/tbody&gt;
+&lt;/table&gt;
\ No newline at end of file

Added: trunk/includes/templates/admin/users/index.html
===================================================================
--- trunk/includes/templates/admin/users/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/users/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,96 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
+{ $A_TABLE_OPEN }
+
+&lt;!-- INCLUDE admin/users/header.html --&gt;
+
+&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+    &lt;tbody&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;6&quot; align=&quot;center&quot;&gt;{ $L_INACTIVE_USERS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;th width=&quot;20px&quot;&gt;&lt;/th&gt;
+			&lt;th&gt;{ $L_USERNAME }&lt;/th&gt;
+			&lt;th&gt;{ $L_REGISTED }&lt;/th&gt;
+			&lt;th colspan=&quot;3&quot; &gt;{ $L_OPTIONS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;{ $L_UNACTIVATED_USERS }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- LOOP $users_unactivated --&gt;
+		&lt;tr&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;input name=&quot;mark_id[]&quot; value=&quot;{ $users_unactivated:user_id }&quot; type=&quot;checkbox&quot;&gt;
+			&lt;/td&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_profile }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_profile }&quot;&gt;{ $users_unactivated:user_name }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;150&quot; class=&quot;row1&quot; align=&quot;center&quot;&gt;
+				{ $users_unactivated:registered }
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_activate }&quot;&gt;{ $L_ACTIVATE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_remove }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_remove }&quot;&gt;{ $L_REMOVE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_unactivated:link_remind }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_unactivated:link_remind }&quot;&gt;{ $L_REMIND }&lt;/a&gt; 
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;spacer&quot; colspan=&quot;6&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- LOOPELSE --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
+				{ $L_NO_UNACTIVATED_USERS }
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- ENDLOOP --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;{ $L_DISABLED_USERS }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- LOOP $users_disabled --&gt;
+		&lt;tr&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;input name=&quot;mark_id[]&quot; value=&quot;{ $users_disabled:user_id }&quot; type=&quot;checkbox&quot;&gt;
+			&lt;/td&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_profile }&quot;&gt;{ $users_disabled:user_name }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;150&quot; class=&quot;row1&quot; align=&quot;center&quot;&gt;
+				{ $users_disabled:registered }
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_disabled:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_activate }&quot;&gt;{ $L_ACTIVATE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_disabled:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_activate }&quot;&gt;{ $L_REMOVE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot;  onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_disabled:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_disabled:link_activate }&quot;&gt;{ $L_VIEW_REASON }&lt;/a&gt; 
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;spacer&quot; colspan=&quot;6&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- LOOPELSE --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
+				{ $L_NO_DISABLED_USERS }
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- ENDLOOP --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;cat&quot; align=&quot;right&quot;&gt;&lt;select name=&quot;mark_option&quot;&gt;&lt;option value=&quot;activate&quot;&gt;{ $L_ACTIVATE }&lt;/option&gt;&lt;option value=&quot;remove&quot;&gt;{ $L_REMOVE }&lt;/option&gt;&lt;/select&gt;&nbsp;&lt;input class=&quot;bottom&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; type=&quot;submit&quot;&gt;&nbsp;&lt;/td&gt;
+		&lt;/tr&gt;
+    &lt;/tbody&gt;
+&lt;/table&gt;
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Added: trunk/includes/templates/admin/users/unactivated.html
===================================================================
--- trunk/includes/templates/admin/users/unactivated.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/admin/users/unactivated.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,69 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
+{ $A_TABLE_OPEN }
+
+&lt;!-- INCLUDE admin/users/header.html --&gt;
+
+&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+    &lt;tbody&gt;
+		&lt;tr&gt;
+			&lt;th colspan=&quot;6&quot; align=&quot;center&quot;&gt;{ $L_INACTIVE_USERS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;th width=&quot;20px&quot;&gt;&lt;/th&gt;
+			&lt;th&gt;{ $L_USERNAME }&lt;/th&gt;
+			&lt;th&gt;{ $L_REGISTED }&lt;/th&gt;
+			&lt;th colspan=&quot;3&quot; &gt;{ $L_OPTIONS }&lt;/th&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;row2&quot;&gt;{ $L_UNACTIVATED_USERS }&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- LOOP $users_admin --&gt;
+		&lt;tr&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot;&gt;
+				&lt;input name=&quot;mark_id[]&quot; value=&quot;{ $users_admin:user_id }&quot; type=&quot;checkbox&quot;&gt;
+			&lt;/td&gt;
+			&lt;td height=&quot;25&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_admin:link_profile }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_admin:link_profile }&quot;&gt;{ $users_admin:user_name }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;150&quot; class=&quot;row1&quot; align=&quot;center&quot;&gt;
+				{ $users_admin:registered }
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_admin:link_activate }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_admin:link_activate }&quot;&gt;{ $L_ACTIVATE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_admin:link_remove }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_admin:link_remove }&quot;&gt;{ $L_REMOVE }&lt;/a&gt;
+			&lt;/td&gt;
+			&lt;td width=&quot;60&quot; align=&quot;center&quot; class=&quot;row1&quot; onmouseover=&quot;this.className='row2'&quot; onmouseout=&quot;this.className='row1'&quot; onclick=&quot;location.href='{ $users_admin:link_remind }'; return false;&quot;&gt;
+				&lt;a href=&quot;{ $users_admin:link_remind }&quot;&gt;{ $L_REMIND }&lt;/a&gt; 
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+			&lt;td class=&quot;spacer&quot; colspan=&quot;6&quot; height=&quot;7&quot;&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- LOOPELSE --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;
+				{ $L_NO_UNACTIVATED_USERS }
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- ENDLOOP --&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;6&quot; class=&quot;cat&quot; align=&quot;right&quot;&gt;&lt;select name=&quot;mark_option&quot;&gt;&lt;option value=&quot;activate&quot;&gt;{ $L_ACTIVATE }&lt;/option&gt;&lt;option value=&quot;remove&quot;&gt;{ $L_REMOVE }&lt;/option&gt;&lt;option value=&quot;remind&quot;&gt;{ $L_REMIND }&lt;/option&gt;&lt;/select&gt;&nbsp;&lt;input class=&quot;bottom&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; type=&quot;submit&quot;&gt;&nbsp;&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- IF { $USERS_PAGINATION } --&gt;
+		&lt;tr class=&quot;row2&quot;&gt;
+			&lt;td style=&quot;padding: 5px;&quot; valign=&quot;middle&quot; colspan=&quot;6&quot;&gt;
+				&lt;div&gt;{ $USERS_PAGINATION }&lt;/div&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;!-- ENDIF --&gt;
+    &lt;/tbody&gt;
+&lt;/table&gt;
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Added: trunk/includes/templates/confirmation.html
===================================================================
--- trunk/includes/templates/confirmation.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/confirmation.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,24 @@
+&lt;!-- DISPLAY_HEADER --&gt;
+
+{ $A_TABLE_OPEN }
+
+&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
+	&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
+		&lt;tbody&gt;
+			&lt;tr&gt;
+				&lt;td class=&quot;row1&quot; colspan=&quot;4&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;
+					{ $MESSAGE }{ $HIDDEN_FIELDS }
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td class=&quot;row1&quot; colspan=&quot;4&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;
+					&lt;input class=&quot;button&quot; name=&quot;confirm&quot; value=&quot;Submit&quot; type=&quot;submit&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;button&quot; value=&quot;{ $L_CANCEL }&quot; name=&quot;cancel&quot; type=&quot;submit&quot; /&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/form&gt;
+
+{ $A_TABLE_CLOSE }
+
+&lt;!-- DISPLAY_FOOTER --&gt;
\ No newline at end of file

Modified: trunk/includes/templates/login_admin.html
===================================================================
--- trunk/includes/templates/login_admin.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/login_admin.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -63,64 +63,78 @@
 form { margin: 0px; padding: 0px; border: 0px; }
 input { font-weight: normal; background-color: #FAFAFA; border-style: solid; border-width: 1px; border-color: #ccc; color: black; font-family: Verdana, serif; font-size: 100%; }
 select { color: black; background-color: white; font-family: Verdana, serif; font-size: 100%; font-weight: normal; border-color: black; border-style: solid; border-width: 1px; }
-.post { background-color: white; border-style: solid; border-width: 1px; border-color: #ccc;}
+.post { background-color: white; border-style: solid; border-width: 1px; border-color: #ccc;}
+
 --&gt;
 &lt;/style&gt;
 
 &lt;body&gt;
 
-&lt;div id=&quot;container&quot;&gt;&lt;div id=&quot;wrapper&quot;&gt;
-&lt;form action=&quot;{$S_LOGIN_ACTION}&quot; method=&quot;post&quot;&gt;
-	&lt;table align=&quot;center&quot; class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
-		&lt;tr&gt; 
-			&lt;th align=&quot;center&quot;&gt;Login Info&lt;/th&gt;
-		&lt;/tr&gt;
-		&lt;!-- IF { $LOGIN_EXPLAIN } --&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $LOGIN_EXPLAIN }&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;!-- ENDIF --&gt;
-		&lt;tr&gt; 
-			&lt;td class=&quot;row2&quot;&gt;
-			&lt;table width=&quot;100%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot;&gt;
-				&lt;!-- IF { $LOGIN_ERROR } --&gt;
+&lt;div id=&quot;container&quot;&gt;
+	&lt;div id=&quot;wrapper&quot;&gt;
+		&lt;form action=&quot;{$S_LOGIN_ACTION}&quot; method=&quot;post&quot;&gt;
+			&lt;table align=&quot;center&quot; class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
+				&lt;tr&gt; 
+					&lt;th align=&quot;center&quot;&gt;Login Info&lt;/th&gt;
+				&lt;/tr&gt;
+				&lt;!-- IF { $LOGIN_EXPLAIN } --&gt;
 				&lt;tr&gt;
-					&lt;td class=&quot;gensmall&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;span class=&quot;error&quot;&gt;{$LOGIN_ERROR}&lt;/span&gt;&lt;/td&gt;
+					&lt;td class=&quot;row1&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $LOGIN_EXPLAIN }&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;!-- ENDIF --&gt;
 				&lt;tr&gt; 
-					&lt;td valign=&quot;top&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_USERNAME}:&lt;/b&gt;&lt;/td&gt;
-					&lt;td&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;username&quot; size=&quot;25&quot; maxlength=&quot;40&quot; value=&quot;{$USERNAME}&quot; tabindex=&quot;1&quot; /&gt;&lt;/td&gt;
+					&lt;td class=&quot;row2&quot;&gt;
+					&lt;table width=&quot;100%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot;&gt;
+						&lt;!-- IF { $LOGIN_ERROR } --&gt;
+						&lt;tr&gt;
+							&lt;td class=&quot;gensmall&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;span class=&quot;error&quot;&gt;{$LOGIN_ERROR}&lt;/span&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;!-- ENDIF --&gt;
+						&lt;tr&gt; 
+							&lt;td valign=&quot;top&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_USERNAME}:&lt;/b&gt;&lt;/td&gt;
+							&lt;td&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;username&quot; size=&quot;25&quot; maxlength=&quot;40&quot; value=&quot;{$USERNAME}&quot; tabindex=&quot;1&quot; /&gt;&lt;br /&gt;&lt;a class=&quot;gensmall&quot; href=&quot;{$U_REGISTER}&quot;&gt;{$L_REGISTER}&lt;/a&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt; 
+							&lt;td valign=&quot;top&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_PASSWORD}:&lt;/b&gt;&lt;/td&gt;
+							&lt;td&gt;
+								&lt;input class=&quot;post&quot; type=&quot;password&quot; name=&quot;password&quot; size=&quot;25&quot; maxlength=&quot;25&quot; tabindex=&quot;2&quot; /&gt;
+								&lt;!-- IF { $U_SEND_PASSWORD } --&gt;&lt;br /&gt;&lt;a class=&quot;gensmall&quot; href=&quot;{ $U_SEND_PASSWORD }&quot;&gt;{ $L_FORGOT_PASS }&lt;/a&gt;&lt;!-- ENDIF --&gt;
+								&lt;!-- IF { $U_RESEND_ACTIVATION } --&gt;&lt;br /&gt;&lt;a class=&quot;gensmall&quot; href=&quot;{ $U_RESEND_ACTIVATION }&quot;&gt;{ $L_RESEND_ACTIVATION }&lt;/a&gt;&lt;!-- ENDIF --&gt;
+							 &lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;!-- IF { $S_DISPLAY_FULL_LOGIN } --&gt;
+						&lt;tr&gt; 
+							&lt;td&gt;&nbsp;&lt;/td&gt;
+							&lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;autologin&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{$L_LOG_ME_IN}&lt;/span&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td&gt;&nbsp;&lt;/td&gt;
+							&lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;viewonline&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{$L_HIDE_ME}&lt;/span&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;!-- ENDIF --&gt;
+					&lt;/table&gt;
+					&lt;/td&gt;
 				&lt;/tr&gt;
+				&lt;!-- IF { $U_CONFIRM_IMAGE } --&gt;
 				&lt;tr&gt; 
-					&lt;td valign=&quot;top&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_PASSWORD}:&lt;/b&gt;&lt;/td&gt;
-					&lt;td&gt;
-						&lt;input class=&quot;post&quot; type=&quot;password&quot; name=&quot;password&quot; size=&quot;25&quot; maxlength=&quot;25&quot; tabindex=&quot;2&quot; /&gt;
-						&lt;!-- IF { $U_SEND_PASSWORD } --&gt;&lt;br /&gt;&lt;a class=&quot;gensmall&quot; href=&quot;{ $U_SEND_PASSWORD }&quot;&gt;{ $L_FORGOT_PASS }&lt;/a&gt;&lt;!-- ENDIF --&gt;
-					 &lt;/td&gt;
+					&lt;th  align=&quot;center&quot;&gt;{ $L_CONFIRMATION_CODE }&lt;/th&gt;
 				&lt;/tr&gt;
+				&lt;tr&gt; 
+					&lt;td align=&quot;center&quot; class=&quot;row1&quot;&gt;&lt;span class=&quot;gensmall&quot;&gt;Enter the code exactly as you see it in the image&lt;br/&gt;&lt;b&gt;This is case sensitive&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td align=&quot;center&quot; class=&quot;row2&quot;&gt;{ $U_CONFIRM_IMAGE }&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td align=&quot;center&quot; class=&quot;row1&quot;&gt;&lt;input class=&quot;post&quot; name=&quot;confirm_code&quot; size=&quot;10&quot; maxlength=&quot;6&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;!-- ENDIF --&gt;
+				&lt;tr&gt; 
+					&lt;th colspan=&quot;2&quot; align=&quot;center&quot;&gt;{$S_HIDDEN_FIELDS}&lt;input type=&quot;submit&quot; name=&quot;login&quot; class=&quot;button&quot; value=&quot;{$L_LOGIN}&quot; tabindex=&quot;3&quot; /&gt;&lt;/td&gt;
+				&lt;/tr&gt;
 			&lt;/table&gt;
-			&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;!-- IF { $U_CONFIRM_IMAGE } --&gt;
-		&lt;tr&gt; 
-			&lt;th  align=&quot;center&quot;&gt;{ $L_CONFIRMATION_CODE }&lt;/th&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt; 
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot;&gt;&lt;span class=&quot;gensmall&quot;&gt;Enter the code exactly as you see it in the image&lt;br/&gt;&lt;b&gt;This is case sensitive&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row2&quot;&gt;{ $U_CONFIRM_IMAGE }&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;tr&gt;
-			&lt;td align=&quot;center&quot; class=&quot;row1&quot;&gt;&lt;input class=&quot;post&quot; name=&quot;confirm_code&quot; size=&quot;10&quot; maxlength=&quot;6&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;!-- ENDIF --&gt;
-		&lt;tr&gt; 
-			&lt;th colspan=&quot;2&quot; align=&quot;center&quot;&gt;{$S_HIDDEN_FIELDS}&lt;input type=&quot;submit&quot; name=&quot;login&quot; class=&quot;button&quot; value=&quot;{$L_LOGIN}&quot; tabindex=&quot;3&quot; /&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-	&lt;/table&gt;
-&lt;/form&gt;
-&lt;/div&gt;&lt;/div&gt;
+		&lt;/form&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
 
-&lt;body&gt;
\ No newline at end of file
+&lt;/body&gt;
\ No newline at end of file

Modified: trunk/includes/templates/login_body.html
===================================================================
--- trunk/includes/templates/login_body.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/login_body.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -13,8 +13,8 @@
 	&lt;tr&gt;
 		&lt;td class=&quot;row1&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;span class=&quot;gensmall&quot;&gt;{ $LOGIN_EXPLAIN }&lt;/td&gt;
 		&lt;td class=&quot;row1&quot; valign=&quot;top&quot; rowspan=&quot;&lt;!-- IF { $U_CONFIRM_IMAGE } --&gt;7&lt;!-- ELSE --&gt;3&lt;!-- ENDIF --&gt;&quot;&gt;
-					&lt;input type=&quot;checkbox&quot; name=&quot;autologin&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_LOG_ME_IN }&lt;/span&gt;&lt;br/&gt;
-					&lt;input type=&quot;checkbox&quot; name=&quot;viewonline&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_HIDE_ME }&lt;/span&gt;
+					&lt;input type=&quot;checkbox&quot; name=&quot;auto_login&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_LOG_ME_IN }&lt;/span&gt;&lt;br/&gt;
+					&lt;input type=&quot;checkbox&quot; name=&quot;hidden&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_HIDE_ME }&lt;/span&gt;
 		&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
@@ -23,8 +23,8 @@
 				&lt;td class=&quot;row1&quot; class=&quot;gensmall&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;span class=&quot;error&quot;&gt;{ $LOGIN_ERROR }&lt;/span&gt;&lt;/td&gt;
 				&lt;!-- IF !{ $LOGIN_EXPLAIN } --&gt;
 				&lt;td class=&quot;row1&quot; valign=&quot;top&quot; rowspan=&quot;&lt;!-- IF { $U_CONFIRM_IMAGE } --&gt;7&lt;!-- ELSE --&gt;3&lt;!-- ENDIF --&gt;&quot;&gt;
-					&lt;input type=&quot;checkbox&quot; name=&quot;autologin&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_LOG_ME_IN }&lt;/span&gt;&lt;br/&gt;
-					&lt;input type=&quot;checkbox&quot; name=&quot;viewonline&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_HIDE_ME }&lt;/span&gt;
+					&lt;input type=&quot;checkbox&quot; name=&quot;auto_login&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_LOG_ME_IN }&lt;/span&gt;&lt;br/&gt;
+					&lt;input type=&quot;checkbox&quot; name=&quot;hidden&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_HIDE_ME }&lt;/span&gt;
 				&lt;/td&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/tr&gt;
@@ -34,8 +34,8 @@
 				&lt;td&gt;&lt;input class=&quot;post&quot; type=&quot;text&quot; name=&quot;username&quot; size=&quot;25&quot; maxlength=&quot;40&quot; value=&quot;{ $USERNAME }&quot; tabindex=&quot;1&quot; /&gt;&lt;br /&gt;&lt;a class=&quot;gensmall&quot; href=&quot;{ $U_REGISTER }&quot;&gt;{ $L_REGISTER }&lt;/a&gt;&lt;/td&gt;
 				&lt;!-- IF !{ $LOGIN_ERROR } &amp;&amp; !{ $LOGIN_EXPLAIN } --&gt;
 				&lt;td class=&quot;row1&quot; valign=&quot;top&quot; rowspan=&quot;&lt;!-- IF { $U_CONFIRM_IMAGE } --&gt;6&lt;!-- ELSE --&gt;2&lt;!-- ENDIF --&gt;&quot;&gt;
-					&lt;input type=&quot;checkbox&quot; name=&quot;autologin&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_LOG_ME_IN }&lt;/span&gt;&lt;br/&gt;
-					&lt;input type=&quot;checkbox&quot; name=&quot;viewonline&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_HIDE_ME }&lt;/span&gt;
+					&lt;input type=&quot;checkbox&quot; name=&quot;auto_login&quot; tabindex=&quot;4&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_LOG_ME_IN }&lt;/span&gt;&lt;br/&gt;
+					&lt;input type=&quot;checkbox&quot; name=&quot;hidden&quot; tabindex=&quot;5&quot; /&gt; &lt;span class=&quot;gensmall&quot;&gt;{ $L_HIDE_ME }&lt;/span&gt;
 				&lt;/td&gt;
 				&lt;!-- ENDIF --&gt;
 			&lt;/tr&gt;
@@ -67,11 +67,11 @@
 				&lt;td colspan=&quot;2&quot; align=&quot;center&quot; class=&quot;row2&quot;&gt;{ $U_CONFIRM_IMAGE }&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;tr&gt;
-				&lt;td colspan=&quot;2&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;&lt;input class=&quot;post&quot; name=&quot;confirm_code&quot; size=&quot;10&quot; maxlength=&quot;6&quot; type=&quot;text&quot;&gt;&lt;/td&gt;
+				&lt;td colspan=&quot;2&quot; align=&quot;center&quot; class=&quot;row1&quot;&gt;&lt;input class=&quot;post&quot; name=&quot;confirm_code&quot; size=&quot;10&quot; maxlength=&quot;6&quot; type=&quot;text&quot; tabindex=&quot;3&quot;&gt;&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;!-- ENDIF --&gt;
 	&lt;tr&gt; 
-		&lt;td class=&quot;cat&quot; colspan=&quot;3&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input type=&quot;submit&quot; name=&quot;login&quot; class=&quot;btnmain&quot; value=&quot;{ $L_LOGIN }&quot; tabindex=&quot;3&quot; /&gt;&lt;/td&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;3&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input type=&quot;submit&quot; name=&quot;login&quot; class=&quot;button&quot; value=&quot;{ $L_LOGIN }&quot; tabindex=&quot;4&quot;/&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 &lt;/table&gt;&lt;/form&gt;
 

Modified: trunk/includes/templates/login_body_full.html
===================================================================
--- trunk/includes/templates/login_body_full.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/login_body_full.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -69,7 +69,6 @@
 &lt;/style&gt;
 
 &lt;body&gt;
-&lt;style type=&quot;text/css&quot;&gt;
 
 &lt;div id=&quot;container&quot;&gt;
 	&lt;div id=&quot;wrapper&quot;&gt;
@@ -138,4 +137,4 @@
 	&lt;/div&gt;
 &lt;/div&gt;
 
-&lt;body&gt;
\ No newline at end of file
+&lt;/body&gt;
\ No newline at end of file

Added: trunk/includes/templates/message.html
===================================================================
--- trunk/includes/templates/message.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/message.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,22 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+&lt;head&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
+&lt;title&gt;Error&lt;/title&gt;
+&lt;/head&gt;
+&lt;body style=&quot;background: url(/bg.gif);&quot;&gt;
+
+&lt;table style=&quot;position: absolute; left: 25%; top: 25%;&quot;&gt;
+	&lt;tr&gt;
+		&lt;td&gt;
+			&lt;img src=&quot;/paladin.png&quot; /&gt;
+		&lt;/td&gt;
+		&lt;td valign=&quot;top&quot;&gt;
+			{ $MESSAGE_TEXT }
+		&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;
+
+
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Modified: trunk/includes/templates/modules/Control_Panel/ucp_agreement.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_agreement.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Control_Panel/ucp_agreement.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -6,13 +6,15 @@
 
 &lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
 	&lt;tr&gt;
-		&lt;th height=&quot;25&quot;&gt;{ $SITENAME } - { $L_REGISTRATION }&lt;/th&gt;
+		&lt;th height=&quot;25&quot;&gt;{ $L_REGISTRATION }&lt;/th&gt;
 	&lt;/tr&gt;
 	&lt;tr&gt;
 		&lt;td class=&quot;row1&quot;&gt;
+		{ $S_HIDDEN_FIELDS }
 		&lt;!-- IF { $S_SHOW_COPPA } --&gt;
 			&lt;div align=&quot;center&quot;&gt;
-				&lt;br /&gt;{ $L_COPPA_BIRTHDAY }&lt;br /&gt;&lt;br /&gt;&lt;a href=&quot;{ $U_COPPA_NO }&quot;&gt;{ $L_COPPA_NO }&lt;/a&gt; :: &lt;a href=&quot;{ $U_COPPA_YES }&quot;&gt;{ $L_COPPA_YES }&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;
+				&lt;br /&gt;{ $L_COPPA_BIRTHDAY }&lt;br /&gt;&lt;br /&gt;
+				&lt;a href=&quot;{ $U_COPPA_NO }&quot;&gt;{ $L_COPPA_NO }&lt;/a&gt; :: &lt;a href=&quot;{ $U_COPPA_YES }&quot;&gt;{ $L_COPPA_YES }&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;
 			&lt;/div&gt;
 		&lt;!-- ELSE --&gt;
 			&lt;div style=&quot;padding: 10px&quot; class=&quot;genmed&quot;&gt;&lt;br /&gt;{ $L_TERMS_OF_USE_CONTENT }&lt;br /&gt;&lt;br /&gt;&lt;/div&gt;

Modified: trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Control_Panel/ucp_groups_membership.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -2,73 +2,67 @@
 
 &lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
 	&lt;tr&gt;
-		&lt;th colspan=&quot;3&quot;&gt;{ $L_USERGROUPS }&lt;/th&gt;
+		&lt;th colspan=&quot;2&quot;&gt;{ $L_USERGROUPS }&lt;/th&gt;
 	&lt;/tr&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row3&quot; colspan=&quot;3&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;{ $L_GROUPS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
+		&lt;td class=&quot;row3&quot; colspan=&quot;2&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;{ $L_GROUPS_EXPLAIN }&lt;/span&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 
 	&lt;tr&gt;
-		&lt;th colspan=&quot;2&quot;&gt;{ $L_GROUP_DETAILS }&lt;/td&gt;
+		&lt;th colspan=&quot;1&quot;&gt;{ $L_GROUP_DETAILS }&lt;/td&gt;
 		&lt;th&gt;{ $L_MARK }&lt;/td&gt;
 	&lt;/tr&gt;
 
-	&lt;!-- LOOP $leader --&gt;
-	&lt;!-- IF !({ $leader:#LOOP_INDEX }) --&gt;
+	&lt;!-- IF isset({ $leader }) --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row3&quot; colspan=&quot;3&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{ $L_GROUP_LEADER }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row3&quot; colspan=&quot;2&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{ $L_GROUP_LEADER }&lt;/b&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
+	&lt;!-- LOOP $leader --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $S_CHANGE_DEFAULT } --&gt;&lt;input type=&quot;radio&quot; name=&quot;default&quot;&lt;!-- IF { $leader:S_GROUP_DEFAULT } --&gt; checked=&quot;checked&quot;&lt;!-- ENDIF --&gt; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{ $leader:U_VIEW_GROUP }&quot;&gt;{ $leader:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $leader:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $leader:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF !{ $leader:GROUP_SPECIAL } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;mark[{ $leader:GROUP_ID }]&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $leader:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDLOOP --&gt;
-	
-	&lt;!-- LOOP $member --&gt;
-	&lt;!-- IF !({ $member:#LOOP_INDEX }) --&gt;
+
+	&lt;!-- IF isset({ $member }) --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row3&quot; colspan=&quot;3&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{ $L_GROUP_MEMBER }&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row3&quot; colspan=&quot;2&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{ $L_GROUP_MEMBER }&lt;/b&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
+	&lt;!-- LOOP $member --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $S_CHANGE_DEFAULT } --&gt;&lt;input type=&quot;radio&quot; name=&quot;default&quot;&lt;!-- IF { $member:S_GROUP_DEFAULT } --&gt; checked=&quot;checked&quot;&lt;!-- ENDIF --&gt; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{ $member:U_VIEW_GROUP }&quot;&gt;{ $member:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $member:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $member:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF !{ $member:GROUP_SPECIAL } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;mark[{ $member:GROUP_ID }]&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $member:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDLOOP --&gt;
 	
-	&lt;!-- LOOP $pending --&gt;
-	&lt;!-- IF !({ $pending:#LOOP_INDEX }) --&gt;
+	&lt;!-- IF isset({ $pending }) --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row3&quot; colspan=&quot;3&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_GROUP_PENDING}&lt;/b&gt;&lt;/td&gt;
+		&lt;td class=&quot;row3&quot; colspan=&quot;2&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_GROUP_PENDING}&lt;/b&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
+	&lt;!-- LOOP $pending --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&nbsp;&lt;/td&gt;
 		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{ $pending:U_VIEW_GROUP }&quot;&gt;{ $pending:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $pending:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $pending:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF !{ $pending:GROUP_SPECIAL } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;mark[{ $pending:GROUP_ID }]&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $pending:GROUP_RESIGN } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 	&lt;!-- ENDLOOP --&gt;
 	
+	&lt;!-- IF isset({ $nonmember }) --&gt;
+	&lt;tr&gt;
+		&lt;td class=&quot;row3&quot; colspan=&quot;3&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_GROUP_NONMEMBER}&lt;/b&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;!-- ENDIF --&gt;
 	&lt;!-- LOOP $nonmember --&gt;
-	&lt;!-- IF !({ $nonmember:#LOOP_INDEX }) --&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row3&quot; colspan=&quot;3&quot;&gt;&lt;b class=&quot;gensmall&quot;&gt;{$L_GROUP_NONMEMBER}&lt;/b&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;!-- ENDIF --&gt;
-		&lt;tr&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&nbsp;&lt;/td&gt;
-			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{$nonmember:U_VIEW_GROUP}&quot;&gt;{ $nonmember:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $nonmember:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $nonmember:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-			&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF !{ $nonmember:GROUP_SPECIAL } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;mark[{$nonmember:GROUP_ID}]&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
-		&lt;/tr&gt;
-		&lt;!-- ENDLOOP --&gt;
-
 	&lt;tr&gt;
+		&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;&lt;a href=&quot;{$nonmember:U_VIEW_GROUP}&quot;&gt;{ $nonmember:GROUP_NAME }&lt;/a&gt;&lt;/b&gt;&lt;!-- IF { $nonmember:GROUP_DESC } --&gt;&lt;p class=&quot;forumdesc&quot;&gt;{ $nonmember:GROUP_DESC }&lt;/p&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;6%&quot; align=&quot;center&quot; nowrap=&quot;nowrap&quot;&gt;&lt;!-- IF { $nonmember:GROUP_APPLY } --&gt;&lt;input type=&quot;checkbox&quot; name=&quot;group_id[]&quot; value=&quot;{ $member:GROUP_ID }&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;!-- ENDLOOP --&gt;
+	&lt;tr&gt;
 		&lt;td class=&quot;cat&quot; colspan=&quot;3&quot;&gt;&lt;/div&gt;&lt;div style=&quot;float:right&quot;&gt;&lt;span class=&quot;genmed&quot;&gt;Select: &lt;/span&gt;&lt;select name=&quot;mode&quot;&gt;&lt;option value=&quot;join&quot;&gt;Join marked&lt;/option&gt;&lt;option value=&quot;resign&quot;&gt;Resign marked&lt;/option&gt;&lt;option value=&quot;demote&quot;&gt;Demote marked&lt;/option&gt;&lt;/select&gt;&nbsp;&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{$L_SUBMIT}&quot; /&gt;&nbsp;&lt;/div&gt;&lt;/td&gt;
 	&lt;/tr&gt;
-
 &lt;/table&gt;
 
 &lt;!-- INCLUDE modules/Control_Panel/ucp_footer.html --&gt;
\ No newline at end of file

Modified: trunk/includes/templates/modules/Control_Panel/ucp_posting_body.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_posting_body.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Control_Panel/ucp_posting_body.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,5 +1,4 @@
 &lt;!-- INCLUDE modules/Control_Panel/ucp_header.html --&gt;
-
 &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;
 &lt;!--
 
@@ -40,7 +39,7 @@
 
 //--&gt;
 &lt;/script&gt;
-&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;java/editor.js&quot;&gt;&lt;/script&gt;
+&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;javascript/editor.js&quot;&gt;&lt;/script&gt;
 
 &lt;form action=&quot;{ $S_POST_ACTION }&quot; method=&quot;post&quot; name=&quot;post&quot; { $S_FORM_ENCTYPE }&gt;
 
@@ -288,7 +287,7 @@
 	&lt;!-- IF { $S_SHOW_ATTACH_BOX } --&gt;&lt;!-- INCLUDE modules/Control_Panel/ucp_posting_attach_body.html --&gt;&lt;!-- ENDIF --&gt;
 
 	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;bottom&quot; type=&quot;submit&quot; tabindex=&quot;5&quot; name=&quot;preview&quot; value=&quot;{ $L_PREVIEW }&quot; /&gt;&nbsp; &lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; accesskey=&quot;s&quot; tabindex=&quot;6&quot; name=&quot;post&quot; value=&quot;{$L_SUBMIT}&quot; /&gt;&lt;!-- IF { $S_SAVE_ALLOWED } --&gt;&nbsp; &lt;input class=&quot;bottom&quot; type=&quot;submit&quot; accesskey=&quot;k&quot; tabindex=&quot;8&quot; name=&quot;save&quot; value=&quot;{$L_SAVE}&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;!-- IF { $S_HAS_DRAFTS } --&gt;&nbsp; &lt;input class=&quot;bottom&quot; type=&quot;submit&quot; accesskey=&quot;d&quot; tabindex=&quot;9&quot; name=&quot;load&quot; value=&quot;{$L_LOAD}&quot; /&gt;&lt;!-- ENDIF --&gt;&nbsp; &lt;input class=&quot;bottom&quot; type=&quot;submit&quot; accesskey=&quot;c&quot; tabindex=&quot;7&quot; name=&quot;cancel&quot; value=&quot;{ $L_CANCEL }&quot; /&gt;&lt;/td&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;button&quot; type=&quot;submit&quot; tabindex=&quot;5&quot; name=&quot;preview&quot; value=&quot;{ $L_PREVIEW }&quot; /&gt;&nbsp; &lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; accesskey=&quot;s&quot; tabindex=&quot;6&quot; name=&quot;post&quot; value=&quot;{$L_SUBMIT}&quot; /&gt;&lt;!-- IF { $S_SAVE_ALLOWED } --&gt;&nbsp; &lt;input class=&quot;bottom&quot; type=&quot;submit&quot; accesskey=&quot;k&quot; tabindex=&quot;8&quot; name=&quot;save&quot; value=&quot;{$L_SAVE}&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;!-- IF { $S_HAS_DRAFTS } --&gt;&nbsp; &lt;input class=&quot;bottom&quot; type=&quot;submit&quot; accesskey=&quot;d&quot; tabindex=&quot;9&quot; name=&quot;load&quot; value=&quot;{$L_LOAD}&quot; /&gt;&lt;!-- ENDIF --&gt;&nbsp; &lt;input class=&quot;button&quot; type=&quot;submit&quot; accesskey=&quot;c&quot; tabindex=&quot;7&quot; name=&quot;cancel&quot; value=&quot;{ $L_CANCEL }&quot; /&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 &lt;/table&gt;
 &lt;/form&gt;

Modified: trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Control_Panel/ucp_profile_avatar.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -37,7 +37,7 @@
 		&lt;td class=&quot;row1&quot; width=&quot;35%&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_AVATAR_GALLERY }: &lt;/b&gt;&lt;/td&gt;
 		&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;btnlite&quot; type=&quot;submit&quot; name=&quot;display_gallery&quot; value=&quot;{ $L_DISPLAY_GALLERY }&quot; /&gt;&lt;/td&gt;
 	&lt;/tr&gt;
-	&lt;!-- ENDIF --&gt;&lt;!-- IF { $S_DISPLAY_GALLERY } --&gt;
+	&lt;!-- ENDIF --&gt;&lt;!-- IF isset({ $S_DISPLAY_GALLERY }) --&gt;
 	&lt;tr&gt; 
 		&lt;th colspan=&quot;2&quot;&gt;{ $L_AVATAR_GALLERY }&lt;/th&gt;
 	&lt;/tr&gt;
@@ -60,7 +60,7 @@
 	&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;&nbsp;&nbsp;&lt;!-- IF { $S_DISPLAY_GALLERY } --&gt;&lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;cancel&quot; value=&quot;{ $L_CANCEL }&quot; /&gt;&lt;!-- ELSE --&gt;&lt;input class=&quot;btnlite&quot; type=&quot;reset&quot; value=&quot;{ $L_RESET }&quot; name=&quot;reset&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;&nbsp;&nbsp;&lt;!-- IF isset({ $S_DISPLAY_GALLERY }) --&gt;&lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;cancel&quot; value=&quot;{ $L_CANCEL }&quot; /&gt;&lt;!-- ELSE --&gt;&lt;input class=&quot;button&quot; type=&quot;reset&quot; value=&quot;{ $L_RESET }&quot; name=&quot;reset&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 &lt;/table&gt;
 

Modified: trunk/includes/templates/modules/Control_Panel/ucp_profile_signature.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_profile_signature.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Control_Panel/ucp_profile_signature.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -41,7 +41,7 @@
 
 //--&gt;
 &lt;/script&gt;
-&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;java/editor.js&quot;&gt;&lt;/script&gt;
+&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;javascript/editor.js&quot;&gt;&lt;/script&gt;
 
 &lt;table class=&quot;tablebg&quot; width=&quot;100%&quot; cellspacing=&quot;1&quot;&gt;
 	&lt;tr&gt;
@@ -169,7 +169,7 @@
 	&lt;/tr&gt;
 	&lt;!-- ENDIF --&gt;
 	&lt;tr&gt;
-		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;btnlite&quot; type=&quot;submit&quot; name=&quot;preview&quot; value=&quot;{ $L_PREVIEW }&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;btnlite&quot; type=&quot;reset&quot; value=&quot;{ $L_RESET }&quot; name=&quot;reset&quot; /&gt;&lt;/td&gt;
+		&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;preview&quot; value=&quot;{ $L_PREVIEW }&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;button&quot; type=&quot;reset&quot; value=&quot;{ $L_RESET }&quot; name=&quot;reset&quot; /&gt;&lt;/td&gt;
 	&lt;/tr&gt;
 &lt;/table&gt;
 

Modified: trunk/includes/templates/modules/Control_Panel/ucp_register.html
===================================================================
--- trunk/includes/templates/modules/Control_Panel/ucp_register.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Control_Panel/ucp_register.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -44,17 +44,19 @@
 		&lt;/tr&gt;
 		&lt;tr&gt; 
 			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_CONFIRM_PASSWORD }: &lt;/b&gt;&lt;/td&gt;
-			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;password&quot; name=&quot;password_confirm&quot; size=&quot;25&quot; maxlength=&quot;100&quot; value=&quot;{ $PASSWORD_CONFIRM }&quot; /&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input class=&quot;post&quot; type=&quot;password&quot; name=&quot;password_confirm&quot; size=&quot;25&quot; maxlength=&quot;100&quot; value=&quot;&quot; /&gt;&lt;/td&gt;
 		&lt;/tr&gt;
+		&lt;!--
 		&lt;tr&gt; 
 			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_LANGUAGE }: &lt;/b&gt;&lt;/td&gt;
 			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;lang&quot; onchange=&quot;javascript:change_language(this.value);&quot;&gt;{ $S_LANG_OPTIONS }&lt;/select&gt;&lt;/td&gt;
 		&lt;/tr&gt;
+		--&gt;
 		&lt;tr&gt; 
 			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_TIMEZONE }: &lt;/b&gt;&lt;/td&gt;
 			&lt;td class=&quot;row2&quot;&gt;&lt;select name=&quot;tz&quot;&gt;{ $S_TZ_OPTIONS }&lt;/select&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-		&lt;!-- IF { $S_CONFIRM_CODE } --&gt;
+		&lt;!-- IF { $CONFIRM_IMG } --&gt;
 		&lt;tr&gt; 
 			&lt;th colspan=&quot;2&quot; height=&quot;28&quot; valign=&quot;middle&quot;&gt;{ $L_CONFIRMATION }&lt;/th&gt;
 		&lt;/tr&gt;
@@ -77,7 +79,7 @@
 		&lt;/tr&gt;
 		&lt;!-- ENDIF --&gt;
 		&lt;tr&gt;
-			&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;btnmain&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;button&quot; type=&quot;reset&quot; value=&quot;{ $L_RESET }&quot; name=&quot;reset&quot; /&gt;&lt;/td&gt;
+			&lt;td class=&quot;cat&quot; colspan=&quot;2&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;{ $S_HIDDEN_FIELDS }&lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;{ $L_SUBMIT }&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;button&quot; type=&quot;reset&quot; value=&quot;{ $L_RESET }&quot; name=&quot;reset&quot; /&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 	&lt;/table&gt;
 &lt;/form&gt;

Modified: trunk/includes/templates/modules/Forums/faq_body.html
===================================================================
--- trunk/includes/templates/modules/Forums/faq_body.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Forums/faq_body.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,8 +1,8 @@
 &lt;!-- IF { $DISPLAY_STYLESHEET_LINK } --&gt;
-	&lt;!-- INCLUDE modules/Forums/simple_header.html --&gt;
+&lt;!-- INCLUDE modules/Forums/simple_header.html --&gt;
 &lt;!-- ELSE --&gt;
-	&lt;!-- DISPLAY_HEADER --&gt;
-	&lt;!-- INCLUDE modules/Forums/overall_header.html --&gt;
+&lt;!-- DISPLAY_HEADER --&gt;
+&lt;!-- INCLUDE modules/Forums/overall_header.html --&gt;
 &lt;!-- ENDIF --&gt;
 
 &lt;a name=&quot;Top&quot;&gt;&lt;/a&gt;

Modified: trunk/includes/templates/modules/Forums/overall_header.html
===================================================================
--- trunk/includes/templates/modules/Forums/overall_header.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Forums/overall_header.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -7,9 +7,9 @@
 	return false;
 }
 
+&lt;!-- IF isset({ $ON_PAGE }) --&gt;
 function jumpto()
 {
-
 	var page = prompt('{ $L_JUMP_PAGE }:', '{ $ON_PAGE }');
 	var perpage = '{ $PER_PAGE }';
 	var base_url = '{ $BASE_URL }';
@@ -19,7 +19,7 @@
 		document.location.href = base_url.replace('&amp;', '&amp;') + '&amp;start=' + ((page - 1) * perpage);
 	}
 }
-
+&lt;!-- ENDIF --&gt;
 //--&gt;
 &lt;/script&gt;
 

Modified: trunk/includes/templates/modules/Forums/posting_body.html
===================================================================
--- trunk/includes/templates/modules/Forums/posting_body.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Forums/posting_body.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -42,7 +42,7 @@
 
 //--&gt;
 &lt;/script&gt;
-&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;java/editor.js&quot;&gt;&lt;/script&gt;
+&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;javascript/editor.js&quot;&gt;&lt;/script&gt;
 
 &lt;!-- IF { $S_FORUM_RULES } --&gt;
 &lt;div class=&quot;forumrules&quot;&gt;

Modified: trunk/includes/templates/modules/Forums/viewforum_body.html
===================================================================
--- trunk/includes/templates/modules/Forums/viewforum_body.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Forums/viewforum_body.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -154,7 +154,7 @@
 		&lt;!-- IF { $S_TOPIC_ICONS } --&gt;
 		&lt;td class=&quot;row1&quot; width=&quot;25&quot; nowrap=&quot;nowrap&quot; align=&quot;center&quot;&gt;&lt;!-- IF { $topicrow:TOPIC_ICON_IMG } --&gt;&lt;img src=&quot;{ $T_ICONS_PATH }{ $topicrow:TOPIC_ICON_IMG }&quot; width=&quot;{ $topicrow:TOPIC_ICON_IMG_WIDTH }&quot; height=&quot;{ $topicrow:TOPIC_ICON_IMG_HEIGHT }&quot; alt=&quot;&quot; title=&quot;&quot; /&gt;&lt;!-- ENDIF --&gt;&lt;/td&gt;
 		&lt;!-- ENDIF --&gt;
-		&lt;td  width=&quot;100%&quot; class=&quot;row1&quot;&gt;
+		&lt;td class=&quot;row1&quot;&gt;
 			&lt;!-- IF { $topicrow:S_TOPIC_UNAPPROVED } --&gt;
 				&lt;a href=&quot;{ $topicrow:U_MCP_QUEUE }&quot;&gt;{ $UNAPPROVED_IMG }&lt;/a&gt;&nbsp;
 			&lt;!-- ENDIF --&gt;
@@ -166,10 +166,10 @@
 			&lt;p class=&quot;gensmall&quot;&gt; [ { $GOTO_PAGE_IMG }{ $L_GOTO_PAGE }: { $topicrow:PAGINATION } ] &lt;/p&gt;
 			&lt;!-- ENDIF --&gt;
 		&lt;/td&gt;
-		&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;&lt;p class=&quot;topicauthor&quot;&gt;{ $topicrow:TOPIC_AUTHOR }&lt;/p&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot; align=&quot;center&quot;&gt;&lt;p class=&quot;topicdetails&quot;&gt;{ $topicrow:REPLIES }&lt;/p&gt;&lt;/td&gt;
-		&lt;td class=&quot;row2&quot; align=&quot;center&quot;&gt;&lt;p class=&quot;topicdetails&quot;&gt;{ $topicrow:VIEWS }&lt;/p&gt;&lt;/td&gt;
-		&lt;td class=&quot;row1&quot; nowrap=&quot;nowrap&quot; align=&quot;center&quot;&gt;
+		&lt;td class=&quot;row2&quot; width=&quot;80&quot; align=&quot;center&quot;&gt;&lt;p class=&quot;topicauthor&quot;&gt;{ $topicrow:TOPIC_AUTHOR }&lt;/p&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;50&quot; align=&quot;center&quot;&gt;&lt;p class=&quot;topicdetails&quot;&gt;{ $topicrow:REPLIES }&lt;/p&gt;&lt;/td&gt;
+		&lt;td class=&quot;row2&quot; width=&quot;50&quot; align=&quot;center&quot;&gt;&lt;p class=&quot;topicdetails&quot;&gt;{ $topicrow:VIEWS }&lt;/p&gt;&lt;/td&gt;
+		&lt;td class=&quot;row1&quot; width=&quot;150&quot; nowrap=&quot;nowrap&quot; align=&quot;center&quot;&gt;
 			&lt;p class=&quot;topicdetails&quot;&gt;{ $topicrow:LAST_POST_TIME }&lt;/p&gt;
 			&lt;p class=&quot;topicdetails&quot;&gt;&lt;!-- IF { $topicrow:U_LAST_POST_AUTHOR } --&gt;&lt;a href=&quot;{ $topicrow:U_LAST_POST_AUTHOR }&quot;&gt;{ $topicrow:LAST_POST_AUTHOR }&lt;/a&gt;&lt;!-- ELSE --&gt;{ $topicrow:LAST_POST_AUTHOR }&lt;!-- ENDIF --&gt;
 			&lt;a href=&quot;{ $topicrow:U_LAST_POST }&quot;&gt;{ $topicrow:LAST_POST_IMG }&lt;/a&gt;

Modified: trunk/includes/templates/modules/Forums/viewtopic_body.html
===================================================================
--- trunk/includes/templates/modules/Forums/viewtopic_body.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Forums/viewtopic_body.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -14,7 +14,7 @@
 
 	&lt;br clear=&quot;all&quot; /&gt;
 	&lt;!-- ENDIF --&gt;
-	
+
 	&lt;h2&gt;&lt;a class=&quot;titles&quot; href=&quot;{ $U_VIEW_TOPIC }&quot;&gt;{ $TOPIC_TITLE }&lt;/a&gt;&lt;/h2&gt;
 
 	&lt;!-- IF { $MODERATORS } --&gt;
@@ -47,7 +47,7 @@
 					&lt;!-- IF { $U_EMAIL_TOPIC } --&gt;&lt;a href=&quot;{ $U_EMAIL_TOPIC }&quot; title=&quot;{ $L_EMAIL_TOPIC }&quot;&gt;{ $L_EMAIL_TOPIC }&lt;/a&gt;&lt;!-- IF { $U_BUMP_TOPIC } --&gt; | &lt;!-- ENDIF --&gt;&lt;!-- ENDIF --&gt;
 					&lt;!-- IF { $U_BUMP_TOPIC } --&gt;&lt;a href=&quot;{ $U_BUMP_TOPIC }&quot; title=&quot;{ $L_BUMP_TOPIC }&quot;&gt;{ $L_BUMP_TOPIC }&lt;/a&gt;&lt;!-- ENDIF --&gt;
 					&lt;/td&gt;
-					&lt;td class=&quot;nav&quot; align=&quot;right&quot; nowrap=&quot;nowrap&quot;&gt;&lt;a href=&quot;{ $U_VIEW_OLDER_TOPIC }&quot;&gt;{ $L_VIEW_PREVIOUS_TOPIC }&lt;/a&gt; | &lt;a href=&quot;{ $U_VIEW_UNREAD_POST }&quot;&gt;{ $L_VIEW_UNREAD_POST }&lt;/a&gt; | &lt;a href=&quot;{ $U_VIEW_NEWER_TOPIC }&quot;&gt;{ $L_VIEW_NEXT_TOPIC }&lt;/a&gt;&nbsp;&lt;/td&gt;
+					&lt;td class=&quot;nav&quot; align=&quot;right&quot; nowrap=&quot;nowrap&quot;&gt;&lt;a href=&quot;{ $U_VIEW_OLDER_TOPIC }&quot;&gt;{ $L_VIEW_PREVIOUS_TOPIC }&lt;/a&gt;&lt;!-- IF { $U_VIEW_UNREAD_POST } --&gt;| &lt;a href=&quot;{ $U_VIEW_UNREAD_POST }&quot;&gt;{ $L_VIEW_UNREAD_POST }&lt;/a&gt;&lt;!-- ENDIF --&gt; | &lt;a href=&quot;{ $U_VIEW_NEWER_TOPIC }&quot;&gt;{ $L_VIEW_NEXT_TOPIC }&lt;/a&gt;&nbsp;&lt;/td&gt;
 				&lt;/tr&gt;
 			&lt;/table&gt;&lt;/td&gt;
 		&lt;/tr&gt;

Modified: trunk/includes/templates/modules/Quick_Message/index.html
===================================================================
--- trunk/includes/templates/modules/Quick_Message/index.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/modules/Quick_Message/index.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -36,15 +36,16 @@
 		&lt;/tr&gt;
 		&lt;!-- LOOPELSE --&gt;
 			&lt;tr class=&quot;row2&quot;&gt;
-				&lt;td colspan=&quot;2&quot;&gt;
-					{ $ERROR }
+				&lt;td align=&quot;center&quot; colspan=&quot;2&quot;&gt;
+					{ $L_NO_POST }
 				&lt;/td&gt;
 			&lt;/tr&gt;
 		&lt;!-- ENDLOOP --&gt;
+
 		&lt;!-- IF { $Q_MESSAGE_PAGINATION } --&gt;
 		&lt;tr class=&quot;row2&quot;&gt;
 			&lt;td style=&quot;padding: 5px;&quot; valign=&quot;middle&quot; colspan=&quot;2&quot;&gt;
-				&lt;div style=&quot;padding-right: 5px; text-align: right;&quot; class=&quot;numbering&quot;&gt;[ &lt;!-- IF { $Q_MESSAGE_PREVIOUS_PAGE } --&gt;&lt;a href=&quot;{ $Q_MESSAGE_PREVIOUS_PAGE }&quot;&gt;{ $L_PREVIOUS }&lt;/a&gt;&nbsp;|&nbsp;&lt;!-- ENDIF --&gt; { $Q_MESSAGE_PAGINATION } &lt;!-- IF { $Q_MESSAGE_NEXT_PAGE } --&gt;&nbsp;|&nbsp;&lt;a href=&quot;{ $Q_MESSAGE_NEXT_PAGE }&quot;&gt;{ $L_NEXT }&lt;/a&gt;&lt;!-- ENDIF --&gt; ]&lt;/div&gt;
+				&lt;div style=&quot;padding-right: 5px; text-align: right;&quot;&gt;{ $Q_MESSAGE_PAGINATION }&lt;/div&gt;
 			&lt;/td&gt;
 		&lt;/tr&gt;
 		&lt;!-- ENDIF --&gt;

Modified: trunk/includes/templates/permission.html
===================================================================
--- trunk/includes/templates/permission.html	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/templates/permission.html	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,5 +1,6 @@
 { $A_TABLE_OPEN }
 &lt;form method=&quot;post&quot; action=&quot;&quot;&gt;
+&lt;!-- IF { $P_CURRENT_GROUPS } || { $P_DCURRENT_GROUPS } || { $P_CURRENT_USERS } || { $P_DCURRENT_USERS }--&gt;
 	&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 		&lt;tbody&gt;
 			&lt;!-- IF { $P_CURRENT_GROUPS } || { $P_DCURRENT_GROUPS } --&gt;
@@ -15,7 +16,7 @@
 					&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;
 						&lt;tbody&gt;
 							&lt;tr&gt;
-								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;dg_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_DCURRENT_GROUPS }&lt;/select&gt;&lt;/td&gt;
+								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;groups_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_DCURRENT_GROUPS }&lt;/select&gt;&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/tbody&gt;
 					&lt;/table&gt;
@@ -25,17 +26,17 @@
 						&lt;tbody&gt;
 
 							&lt;tr&gt;
-								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;g_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_CURRENT_GROUPS }&lt;/select&gt;&lt;/td&gt;
+								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;groups_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_CURRENT_GROUPS }&lt;/select&gt;&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/tbody&gt;
 					&lt;/table&gt;
 				&lt;/td&gt;
 			&lt;/tr&gt;
 			&lt;!-- ENDIF --&gt;
+			&lt;!-- IF { $P_CURRENT_USERS } || { $P_DCURRENT_USERS } --&gt;
 			&lt;tr&gt;
 				&lt;th colspan=&quot;2&quot;&gt;{ $L_USERS }&lt;/th&gt;
 			&lt;/tr&gt;
-			&lt;!-- IF { $P_CURRENT_USERS } || { $P_DCURRENT_USERS } --&gt;
 			&lt;tr&gt;
 				&lt;td  class=&quot;row1&quot; align=&quot;center&quot;&gt;{ $L_DISALLOWED }&lt;/td&gt;
 				&lt;td  class=&quot;row1&quot; align=&quot;center&quot;&gt;{ $L_ALLOWED }&lt;/ttd&gt;
@@ -45,7 +46,7 @@
 					&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;
 						&lt;tbody&gt;
 							&lt;tr&gt;
-								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;du_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_DCURRENT_USERS }&lt;/select&gt;&lt;/td&gt;
+								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;users_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_DCURRENT_USERS }&lt;/select&gt;&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/tbody&gt;
 					&lt;/table&gt;
@@ -54,7 +55,7 @@
 					&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;
 						&lt;tbody&gt;
 							&lt;tr&gt;
-								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;u_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_CURRENT_USERS }&lt;/select&gt;&lt;/td&gt;
+								&lt;td class=&quot;row1&quot; align=&quot;center&quot;&gt;&lt;select style=&quot;width: 280px;&quot; name=&quot;users_current[]&quot; multiple=&quot;multiple&quot; size=&quot;5&quot;&gt;{ $P_CURRENT_USERS }&lt;/select&gt;&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/tbody&gt;
 					&lt;/table&gt;
@@ -68,14 +69,12 @@
 			&lt;/tr&gt;
 		&lt;/tbody&gt;
 	&lt;/table&gt;
-
 	&lt;br/&gt;
-
+&lt;!-- ENDIF --&gt;
 	&lt;table class=&quot;tablebg&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;1&quot; width=&quot;100%&quot;&gt;
 		&lt;tbody&gt;
-
 			&lt;tr&gt;	
-				&lt;td&gt;
+				&lt;td colspan=&quot;2&quot;&gt;
 					&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;
 						&lt;tbody&gt;
 							&lt;tr&gt;
@@ -88,7 +87,7 @@
 						&lt;/tbody&gt;
 					&lt;/table&gt;
 				&lt;/td&gt;
-				&lt;td&gt;
+				&lt;td colspan=&quot;2&quot;&gt;
 					&lt;table class=&quot;tablebg&quot; align=&quot;center&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;
 						&lt;tbody&gt;
 							&lt;tr&gt;
@@ -101,8 +100,17 @@
 					&lt;/table&gt;
 				&lt;/td&gt;
 			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;th colspan=&quot;4&quot;&gt;{ $L_OPTIONS }&lt;/th&gt;
+			&lt;/tr&gt;
 			&lt;tr&gt;
-				&lt;td class=&quot;cat&quot; colspan=&quot;3&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;
+			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_ACCESS }&lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;auth_options[core_status]&quot; value=&quot;1&quot; checked=&quot;checked&quot; type=&quot;radio&quot;&gt;{ $L_ALLOWED }&nbsp;&nbsp;&lt;input name=&quot;auth_options[core_status]&quot; value=&quot;0&quot; type=&quot;radio&quot;&gt;{ $L_DENIED }&lt;/td&gt;
+			&lt;td class=&quot;row1&quot;&gt;&lt;b class=&quot;genmed&quot;&gt;{ $L_GROUP_ALLOWANCE }&lt;/b&gt;&lt;/td&gt;
+			&lt;td class=&quot;row2&quot;&gt;&lt;input name=&quot;auth_options[core_auth_type]&quot; value=&quot;1&quot; checked=&quot;checked&quot; type=&quot;radio&quot;&gt;{ $L_ONLY_DEFAULT }&nbsp;&nbsp;&lt;input name=&quot;auth_options[core_auth_type]&quot; value=&quot;0&quot; type=&quot;radio&quot;&gt;{ $L_ALL_MEMBERS }&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td class=&quot;cat&quot; colspan=&quot;4&quot; align=&quot;center&quot; height=&quot;28&quot;&gt;
 					&lt;input class=&quot;btnmain&quot; name=&quot;add&quot; value=&quot;Submit&quot; type=&quot;submit&quot; /&gt;&nbsp;&nbsp;&lt;input class=&quot;button&quot; value=&quot;Reset&quot; name=&quot;reset&quot; type=&quot;reset&quot; /&gt;
 				&lt;/td&gt;
 			&lt;/tr&gt;

Modified: trunk/includes/user.php
===================================================================
--- trunk/includes/user.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/includes/user.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -51,7 +51,7 @@
 		$this-&gt;browser = mb_substr((empty($_SERVER['HTTP_USER_AGENT']) ? getenv('HTTP_USER_AGENT') : $_SERVER['HTTP_USER_AGENT']), 0, 255);
 		$this-&gt;url	= empty($_SERVER['REQUEST_URI']) ? getenv('REQUEST_URI') : $_SERVER['REQUEST_URI'];
 		$this-&gt;ip	= empty($_SERVER['REMOTE_ADDR']) ? getenv('REMOTE_ADDR') : $_SERVER['REMOTE_ADDR'];
-		$this-&gt;time	= gmtime();
+		$this-&gt;time	= (int) gmtime();
 
 		if (($pos = mb_strpos($this-&gt;url, INDEX_PAGE.'?mod=')) !== false)
 		{
@@ -79,7 +79,7 @@
 
 	function format_time($gmtime, $format = false)
 	{
-		settype($gmtime, 'integer');
+		settype($gmtime, 'int');
 
 		if (!$gmtime)
 		{
@@ -105,6 +105,8 @@
 	function login($id = ANONYMOUS, $admin_login = false, $hidden = false, $auto_log = false)
 	{
 		global $_CLASS;
+
+		settype($id, 'int');
 
 		if ($bot = check_bot_status($this-&gt;browser, $this-&gt;ip))
 		{
@@ -123,7 +125,7 @@
 			script_close(false);
 		}
 
-		$result = $_CLASS['core_db']-&gt;query('SELECT * FROM ' . USERS_TABLE . ' WHERE user_id = '.$id);
+		$result = $_CLASS['core_db']-&gt;query('SELECT * FROM ' . USERS_TABLE . ' WHERE user_id = '. $id);
 		$this-&gt;data = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 		
@@ -143,23 +145,14 @@
 
 		load_class(false, 'core_auth', 'auth_db');
 		
-		if ($this-&gt;is_bot)
-		{
-			$this-&gt;data['session_admin'] = ADMIN_NOT_ADMIN;
-		}
-		else
+		$this-&gt;data['session_admin'] = ADMIN_NOT_ADMIN;
+
+		if (!$this-&gt;is_bot &amp;&amp; $_CLASS['core_auth']-&gt;admin_auth())
 		{
-			if ($_CLASS['core_auth']-&gt;admin_auth())
-			{
-				$this-&gt;data['session_admin'] = ($admin_login) ? ADMIN_IS_ADMIN : ADMIN_NOT_LOGGED;
-			}
-			else
-			{
-				$this-&gt;data['session_admin'] = ADMIN_NOT_ADMIN;
-			}
+			$this-&gt;data['session_admin'] = ($admin_login) ? ADMIN_IS_ADMIN : ADMIN_NOT_LOGGED;
 		}
 
-		$this-&gt;is_admin = ($this-&gt;data['session_admin'] == ADMIN_IS_ADMIN);
+		$this-&gt;is_admin = ($this-&gt;data['session_admin'] === ADMIN_IS_ADMIN);
 		$this-&gt;data['session_hidden'] = $hidden;
 
 		$this-&gt;session_create($auto_log);
@@ -169,8 +162,16 @@
 	{
 		global $_CLASS;
 
-		$this-&gt;session_destroy();
-// do last visit update here
+		if ($this-&gt;is_user)
+		{
+			$sql = 'UPDATE ' . USERS_TABLE . '
+				SET user_last_visit = ' . (int) $this-&gt;data['session_time'] . '
+				WHERE user_id = ' . (int) $this-&gt;data['user_id'];
+			$_CLASS['core_db']-&gt;query($sql);
+		}
+
+		$this-&gt;session_destroy(false, true);
+
 		$sql = 'SELECT *
 			FROM ' . USERS_TABLE . '
 			WHERE user_id = ' . ANONYMOUS;
@@ -365,12 +366,12 @@
 
 	function user_data_get($name, $default = false)
 	{
-		return (empty($this-&gt;data['user_data'][$name])) ? $default : $this-&gt;data['user_data'][$name];
+		return isset($this-&gt;data['user_data'][$name]) ? $this-&gt;data['user_data'][$name] : $default;
 	}
 
 	function user_data_kill($name)
 	{
-		if (empty($this-&gt;data['user_data'][$name]))
+		if (!isset($this-&gt;data['user_data'][$name]))
 		{
 			return;
 		}
@@ -381,10 +382,10 @@
 
 	function user_data_set($name, $value, $save = false)
 	{
-		/*if (!empty($this-&gt;data['user_data'][$name]) &amp;&amp; ($this-&gt;data['user_data'][$name] == $value))
+		if (isset($this-&gt;data['user_data'][$name]) &amp;&amp; ($this-&gt;data['user_data'][$name] == $value))
 		{
 			return;
-		}*/
+		}
 
 		$this-&gt;data['user_data'][$name] = $value;
 
@@ -393,17 +394,22 @@
 		}
 	}
 
-	function set_cookie($name, $cookiedata, $cookietime)
+	function set_cookie($name, $cookie_data, $cookie_time)
 	{
 		global $_CORE_CONFIG;
 
+		if ($_CORE_CONFIG['server']['cookie_name'])
+		{
+			$name = $_CORE_CONFIG['server']['cookie_name'] . '_' . $name;
+		}
+
 		if ($this-&gt;server_local)
 		{
-			setcookie($_CORE_CONFIG['server']['cookie_name'] . '_' . $name, $cookiedata, $cookietime, $_CORE_CONFIG['server']['cookie_path']);
+			setcookie($name, $cookie_data, $cookie_time, $_CORE_CONFIG['server']['cookie_path']);
 		}
 		else
 		{
-			setcookie($_CORE_CONFIG['server']['cookie_name'] . '_' . $name, $cookiedata, $cookietime, $_CORE_CONFIG['server']['cookie_path'], $_CORE_CONFIG['server']['cookie_domain'], $_CORE_CONFIG['server']['cookie_secure']);
+			setcookie($name, $cookie_data, $cookie_time, $_CORE_CONFIG['server']['cookie_path'], $_CORE_CONFIG['server']['cookie_domain'], $_CORE_CONFIG['server']['cookie_secure']);
 		}
 	}
 	

Modified: trunk/install/build_data.php
===================================================================
--- trunk/install/build_data.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/install/build_data.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -50,7 +50,7 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_username', '', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_password', '', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('email', 'smtp_host', '', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'allow_name_chars', '[\\w_\\+\\. \\-\\[\\]]+', 1)&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'allow_name_chars', '[\w_\+\. \-\[\]]+', 1)&quot;);
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'enable_confirm', '1', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'coppa_enable', '1', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('user', 'coppa_fax', '', 1)&quot;);
@@ -74,7 +74,6 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'limit_load', '0', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'limit_sessions', '0', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'ip_check', '4', 1)&quot;);
-$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'browser_check', '1', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'session_length', '3600', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('server', 'error_options', '0', 1)&quot;);
 
@@ -186,7 +185,6 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_search', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_email', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_rate', 1)&quot;);
-#$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_print', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_ignoreflood', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_postcount', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local) VALUES ('f_moderate', 1)&quot;);
@@ -205,7 +203,8 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_auth', 1, 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_ip', 1, 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_local, is_global) VALUES ('m_info', 1, 1)&quot;);
-
+
+// this should be replaced by beta
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_server', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('a_defaults', 1)&quot;);
@@ -277,44 +276,31 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_img', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth_options (auth_option, is_global) VALUES ('u_pm_flash', 1)&quot;);
 
+/*
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'u_%'&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'a_%'&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 1, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html')&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 2, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html')&quot;);
+*/
 
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'm_%';
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (user_id, forum_id, auth_option_id, auth_setting) SELECT 2, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'm_%';
-
-# ADMINISTRATOR group - admin and forum rights
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%';
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'a_%';
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 7, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html');
-
-# SUPER MODERATOR group - moderator rights
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 6, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chggrp', 'u_chgname');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 6, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'm_%';
-
+// ADMINISTRATOR group
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'u_%'&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'a_%'&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 1, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html')&quot;);
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 2, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option IN ('f_poll', 'f_announce', 'f_sticky', 'f_attach', 'f_html')&quot;);
+
+// SUPER MODERATOR group
+$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth (group_id, forum_id, auth_option_id, auth_setting) SELECT 6, 0, auth_option_id, 1 FROM &quot;.$install_prefix.&quot;forums_auth_options WHERE auth_option LIKE 'm_%'&quot;);
+
 # REGISTERED/REGISTERED COPPA groups - common forum rights
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chggrp', 'u_viewonline', 'u_chgname');
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_subscribe');
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 4, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_votechg', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_report', 'f_subscribe');
+
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 5, 0, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option LIKE 'u_%' AND auth_option NOT IN ('u_chgcensors', 'u_chggrp', 'u_viewonline', 'u_chgname');
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 5, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_subscribe');
 //$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 5, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_', 'f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_edit', 'f_delete', 'f_vote', 'f_votechg', 'f_download', 'f_bbsmiley_code', 'f_smilies', 'f_img', 'f_flash', 'f_sigs', 'f_search', 'f_email', 'f_print', 'f_postcount', 'f_report', 'f_subscribe');
 
-# GUESTS, INACTIVE, INACTIVE_COPPA group - basic rights
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 1, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 1, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 2, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 2, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 3, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 3, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read', 'f_post', 'f_reply', 'f_quote', 'f_bbsmiley_code', 'f_search', 'f_print');
-
-# BOTS - read/view only
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 8, 1, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read');
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_auth  (group_id, forum_id, auth_option_id, auth_setting) SELECT 8, 2, auth_option_id, 1 FROM phpbb_auth_options WHERE auth_option IN ('f_list', 'f_read');
-
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_attachments', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_bbsmiley_code', '1', 0)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_config (config_name, config_value, is_dynamic) VALUES ('allow_html', '1', 0)&quot;);
@@ -474,5 +460,4 @@
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;forums_modules (module_type, module_title, module_filename, module_order, module_enabled, module_subs, module_acl) VALUES ('mcp', 'QUEUE', 'queue', 2, 1, 'unapproved_topics\r\nunapproved_posts\r\nreports', 'acl_m_approve')&quot;);
 
 
-//$_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;quick_message (id, user_id, user_name, ip, message, time) VALUES (1, 0, 'Site', '', 'Lets do this !', &quot;.gmtime().&quot;)&quot;);
 ?&gt;
\ No newline at end of file

Modified: trunk/install/build_tables.php
===================================================================
--- trunk/install/build_tables.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/install/build_tables.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -224,92 +224,91 @@
 /*
 
 `user_unread_privmsg` tinyint(4) unsigned NOT NULL default '0',
-`user_newpasswd` varchar(40) NOT NULL default '',
-`user_viewemail` tinyint(1) NOT NULL default '0',
 */
 
 $_CLASS['core_db']-&gt;table_create('start', $install_prefix.'users');
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_id', 0, 16000000, 0, true);
+$_CLASS['core_db']-&gt;add_table_field_int('user_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
 $_CLASS['core_db']-&gt;add_table_field_char('username', 80);
 $_CLASS['core_db']-&gt;add_table_field_char('user_password', 40);
 $_CLASS['core_db']-&gt;add_table_field_char('user_password_encoding', 10);
+$_CLASS['core_db']-&gt;add_table_field_char('user_email', 100);
 $_CLASS['core_db']-&gt;add_table_field_int('user_type', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('group_id', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_int('user_rank', 0, 16000000);
+$_CLASS['core_db']-&gt;add_table_field_int('user_status', 0, 10);
+$_CLASS['core_db']-&gt;add_table_field_int('user_group', array('max' =&gt; 16000000));
 $_CLASS['core_db']-&gt;add_table_field_char('user_ip', 255);
-$_CLASS['core_db']-&gt;add_table_field_char('user_agent', 255);
-$_CLASS['core_db']-&gt;add_table_field_int('user_timezone', -43200 , 46800);
-$_CLASS['core_db']-&gt;add_table_field_int('user_dst', 0 , 1);
+$_CLASS['core_db']-&gt;add_table_field_char('user_agent', 255, null);
+$_CLASS['core_db']-&gt;add_table_field_char('user_birthday', 10, true);
+$_CLASS['core_db']-&gt;add_table_field_text('user_data', 6000, true);
 
-field_unix_time('user_regdate');
-$_CLASS['core_db']-&gt;add_table_field_text('user_permissions', 60000); // phpBBs rename user_forums_permissions
-$_CLASS['core_db']-&gt;add_table_field_char('user_email', 100);
-$_CLASS['core_db']-&gt;add_table_field_char('user_birthday', 10);
-$_CLASS['core_db']-&gt;add_table_field_text('user_data', 6000);
-field_unix_time('user_last_visit');
-field_unix_time('user_last_post_time');
-$_CLASS['core_db']-&gt;add_table_field_int('user_warnings', 0, 10000);
-$_CLASS['core_db']-&gt;add_table_field_char('user_lang', 10);
-$_CLASS['core_db']-&gt;add_table_field_char('user_theme', 60);
-$_CLASS['core_db']-&gt;add_table_field_int('user_rank', 0, 16000000);
-$_CLASS['core_db']-&gt;add_table_field_char('user_colour', 6);
-$_CLASS['core_db']-&gt;add_table_field_char('user_dateformat', 14);
-$_CLASS['core_db']-&gt;add_table_field_int('user_new_privmsg', 0, 1);
+$_CLASS['core_db']-&gt;add_table_field_char('user_act_key', 10, null);
+$_CLASS['core_db']-&gt;add_table_field_char('user_new_password', 40);
+$_CLASS['core_db']-&gt;add_table_field_char('user_new_password_encoding', 10);
 
-$_CLASS['core_db']-&gt;add_table_field_text('user_sig', 60000);
-$_CLASS['core_db']-&gt;add_table_field_char('user_from', 100);
-$_CLASS['core_db']-&gt;add_table_field_char('user_icq', 15);
-$_CLASS['core_db']-&gt;add_table_field_char('user_aim', 255);
-$_CLASS['core_db']-&gt;add_table_field_char('user_yim', 255);
-$_CLASS['core_db']-&gt;add_table_field_char('user_msnm', 255);
-$_CLASS['core_db']-&gt;add_table_field_char('user_jabber', 255);
-$_CLASS['core_db']-&gt;add_table_field_char('user_website', 255);
+field_unix_time('user_reg_date');
+field_unix_time('user_last_visit', true);
 
-$_CLASS['core_db']-&gt;add_table_field_char('user_interests', 255);
-$_CLASS['core_db']-&gt;add_table_field_char('user_occ', 255);
+$_CLASS['core_db']-&gt;add_table_field_int('user_dst',  array('max' =&gt; 1, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('user_lang', 10, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_time_format', 20, true);
+$_CLASS['core_db']-&gt;add_table_field_int('user_timezone', array('min' =&gt; -43200, 'max' =&gt; 46800, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_char('user_theme', 60, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_colour', 6, true);
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_message_limit', 0, 200);
-$_CLASS['core_db']-&gt;add_table_field_int('user_message_rules', 0, 1);
+$_CLASS['core_db']-&gt;add_table_field_int('user_allow_viewonline', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('user_allow_viewemail', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('user_allow_massemail', array('max' =&gt; 1));
 
+$_CLASS['core_db']-&gt;add_table_field_int('user_new_privmsg', array('max' =&gt; 1));
+
+$_CLASS['core_db']-&gt;add_table_field_text('user_sig', 60000, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_from', 100, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_icq', 15, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_aim', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_yim', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_msnm', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_jabber', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_website', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_interests', 255, true);
+$_CLASS['core_db']-&gt;add_table_field_char('user_occ', 255, true);
+
 // look at these
+$_CLASS['core_db']-&gt;add_table_field_int('user_message_limit', 0, 200);
+$_CLASS['core_db']-&gt;add_table_field_int('user_message_rules', 0, 1);
 $_CLASS['core_db']-&gt;add_table_field_int('user_full_folder', -10, 16000000, -3);
 $_CLASS['core_db']-&gt;add_table_field_int('user_attachsig', 0, 1, 1);
 ///
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_notify', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('user_notify_pm', 0, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('user_notify_type', 0, 200);
+$_CLASS['core_db']-&gt;add_table_field_int('user_notify', array('max' =&gt; 1));
+//$_CLASS['core_db']-&gt;add_table_field_int('user_notify_pm', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('user_notify_type', array('max' =&gt; 10));
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_allow_pm', 0, 1, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('user_allow_email', 0, 1, 1);
+$_CLASS['core_db']-&gt;add_table_field_int('user_allow_pm', array('max' =&gt; 1));
+$_CLASS['core_db']-&gt;add_table_field_int('user_allow_email', array('max' =&gt; 1));
 
 $_CLASS['core_db']-&gt;add_table_field_char('user_sig_bbcode_uid', 5);
-$_CLASS['core_db']-&gt;add_table_field_int('user_sig_bbcode_bitfield', 0, 1600);
+$_CLASS['core_db']-&gt;add_table_field_int('user_sig_bbcode_bitfield', array('max' =&gt; 1600));
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_topic_show_days', 0, 200);
+$_CLASS['core_db']-&gt;add_table_field_int('user_topic_show_days', array('max' =&gt; 200));
 $_CLASS['core_db']-&gt;add_table_field_char('user_topic_sortby_type', 1);
 $_CLASS['core_db']-&gt;add_table_field_char('user_topic_sortby_dir', 1);
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_post_show_days', 0, 200);
+$_CLASS['core_db']-&gt;add_table_field_int('user_post_show_days', array('max' =&gt; 200));
 $_CLASS['core_db']-&gt;add_table_field_char('user_post_sortby_type', 1);
 $_CLASS['core_db']-&gt;add_table_field_char('user_post_sortby_dir', 1);
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_posts', 16000000);
-field_unix_time('user_lastpost_time');
+$_CLASS['core_db']-&gt;add_table_field_int('user_posts', array('max' =&gt; 16000000));
+field_unix_time('user_last_post_time');
 
-$_CLASS['core_db']-&gt;add_table_field_int('user_allow_viewonline', 0, 1, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('user_allow_viewemail', 0, 1, 1);
-$_CLASS['core_db']-&gt;add_table_field_int('user_allow_massemail', 0, 1, 1);
+$_CLASS['core_db']-&gt;add_table_field_text('user_permissions', 60000); // phpBBs rename user_forums_permissions
 
-$_CLASS['core_db']-&gt;add_table_field_char('user_avatar', 200);
-$_CLASS['core_db']-&gt;add_table_field_int('user_avatar_type', 0, 10);
-$_CLASS['core_db']-&gt;add_table_field_int('user_avatar_width', 0, 100);
-$_CLASS['core_db']-&gt;add_table_field_int('user_avatar_height', 0, 100);
+// these can be null I think
+$_CLASS['core_db']-&gt;add_table_field_char('user_avatar', 200, null);
+$_CLASS['core_db']-&gt;add_table_field_int('user_avatar_type', array('max' =&gt; 10, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('user_avatar_width', array('max' =&gt; 100, 'null' =&gt; true));
+$_CLASS['core_db']-&gt;add_table_field_int('user_avatar_height', array('max' =&gt; 100, 'null' =&gt; true));
 
-$_CLASS['core_db']-&gt;add_table_field_char('user_act_key', 40);
-$_CLASS['core_db']-&gt;add_table_field_char('user_new_password', 40);
-$_CLASS['core_db']-&gt;add_table_field_char('user_new_password_encoding', 10);
+$_CLASS['core_db']-&gt;add_table_field_int('user_rank', array('max' =&gt; 16000000, 'null' =&gt; true));
 
 $_CLASS['core_db']-&gt;add_table_index('user_id', 'primary');
 $_CLASS['core_db']-&gt;add_table_index('username');

Added: trunk/install/installer.php
===================================================================
--- trunk/install/installer.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/install/installer.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -0,0 +1,24 @@
+&lt;?php
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
+
+$Id$
+*/
+
+?&gt;
\ No newline at end of file

Modified: trunk/modules/Control_Panel/index.php
===================================================================
--- trunk/modules/Control_Panel/index.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/modules/Control_Panel/index.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -29,7 +29,7 @@
 
 $ucp = new module();
 
-require($site_file_root.'includes/forums/functions_user.php');
+//require($site_file_root.'includes/forums/functions_user.php');
 
 //define the undefineds
 $_CLASS['core_template']-&gt;assign_array(array(

Modified: trunk/modules/Control_Panel/ucp/ucp_register.php
===================================================================
--- trunk/modules/Control_Panel/ucp/ucp_register.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/modules/Control_Panel/ucp/ucp_register.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -1,58 +1,54 @@
 &lt;?php
-// -------------------------------------------------------------
-//
-// $Id: ucp_register.php,v 1.28 2004/06/07 11:43:51 psotfx Exp $
-//
-// FILENAME  : ucp_register.php
-// STARTED   : Mon May 19, 2003
-// COPYRIGHT : &#169; 2003 phpBB Group
-// WWW       : <A HREF="http://www.phpbb.com/">http://www.phpbb.com/</A>
-// LICENCE   : GPL vs2.0 [ see /docs/COPYING ] 
-// 
-// -------------------------------------------------------------
+/*
+||**************************************************************||
+||  Viperal CMS &#194;&#169; :												||
+||**************************************************************||
+||																||
+||	Copyright (C) 2004, 2005									||
+||  By Ryan Marshall ( Viperal )								||
+||																||
+||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
+||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
+||																||
+||**************************************************************||
+||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
+||**************************************************************||
+||  Viperal CMS is released under the terms and conditions		||
+||  of the GNU General Public License version 2					||
+||																||
+||**************************************************************||
 
+$Id$
+*/
+
 class ucp_register extends module 
 {
 	function ucp_register($id, $mode)
 	{
 		global $site_file_root, $config, $_CLASS, $_CORE_CONFIG;
 		
-		$_CLASS['core_template']-&gt;assign('S_UCP_ACTION', generate_link('Control_Panel&amp;mode=register'));
-		
 		if ($_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_DISABLE)
 		{
 			trigger_error('UCP_REGISTER_DISABLE');
 		}
 
-		// Do not alter this first one to use request_var!
-		$confirm_id = request_var('confirm_id', '');
-		$coppa		= (isset($_REQUEST['coppa'])) ? !empty($_REQUEST['coppa']) : null;
-		$agreed		= (!empty($_POST['agreed'])) ? 1 : 0;
-		$submit		= (isset($_POST['submit'])) ? true : false;
-		$change_lang = request_var('change_lang', '');
-		$change_lang = (file_exists($site_file_root.'language/' . $change_lang . '/common.php')) ? $change_lang : '';
+		$_CLASS['core_template']-&gt;assign('S_UCP_ACTION', generate_link('Control_Panel&amp;mode=register'));
 
-		if ($change_lang)
-		{
-			$submit = false;
-			$lang = $change_lang;
-			$_CLASS['core_user']-&gt;lang_name = $lang = $change_lang;
-			$_CLASS['core_user']-&gt;lang_path = $site_file_root.'language/' . $lang . '/';
-			$_CLASS['core_user']-&gt;lang = array();
-			$_CLASS['core_user']-&gt;add_lang(array('common', 'ucp'));
-		}
-		
-		//$cp = new custom_profile();
+		$coppa		= isset($_REQUEST['coppa']) ? (int) $_REQUEST['coppa'] : null;
+		$submit		= isset($_POST['submit']);
 
-		$error = $data = $cp_data = $cp_error = array();
+		$error = $data = array();
+		$s_hidden_fields = '';
 
-		if (!$agreed)
+
+		if (!isset($_POST['agreed']))
 		{
 			if ($_CORE_CONFIG['user']['coppa_enable'] &amp;&amp; is_null($coppa))
 			{
 				$now = explode(':', gmdate('m:j:Y'));
-				$coppa_birthday = $_CLASS['core_user']-&gt;format_date(mktime(12, 0, 0, $now[0], $now[1] - 1, $now[2] - 13, 0)); 
 
+				$coppa_birthday = $_CLASS['core_user']-&gt;format_date(mktime(12, 0, 0, $now[0], $now[1], $now[2] - 13), 'D M d, Y'); 
+
 				$_CLASS['core_template']-&gt;assign_array(array(
 					'L_COPPA_NO'		=&gt; sprintf($_CLASS['core_user']-&gt;lang['UCP_COPPA_BEFORE'], $coppa_birthday),
 					'L_COPPA_YES'		=&gt; sprintf($_CLASS['core_user']-&gt;lang['UCP_COPPA_ON_AFTER'], $coppa_birthday),
@@ -61,292 +57,147 @@
 					'U_COPPA_YES'		=&gt; generate_link('Control_Panel&amp;mode=register&amp;coppa=1'), 
 
 					'S_SHOW_COPPA'		=&gt; true, 
+					'S_HIDDEN_FIELDS'	=&gt; $s_hidden_fields,
 					'S_REGISTER_ACTION'	=&gt; generate_link('Control_Panel&amp;mode=register'))
 				);
 			}
 			else
 			{
+				$s_hidden_fields .= '&lt;input type=&quot;hidden&quot; name=&quot;coppa&quot; value=&quot;' . $coppa . '&quot; /&gt;';
+
 				$_CLASS['core_template']-&gt;assign_array(array(
-					'S_SHOW_COPPA'		=&gt; false, 
-					'S_REGISTER_ACTION'	=&gt; generate_link('Control_Panel&amp;mode=register'))
-				);
+					'S_SHOW_COPPA'		=&gt; false,
+					'S_HIDDEN_FIELDS'	=&gt; $s_hidden_fields,
+					'S_REGISTER_ACTION'	=&gt; generate_link('Control_Panel&amp;mode=register')
+				));
 			}
-			
+
 			$this-&gt;display($_CLASS['core_user']-&gt;lang['REGISTER'], 'ucp_agreement.html');
 
 			script_close();
 		}
-		
-		$var_ary = array(
-			'username'			=&gt; (string) '',
-			'password_confirm'	=&gt; (string) '',
-			'new_password'		=&gt; (string) '',
-			'cur_password'		=&gt; (string) '',
-			'email'				=&gt; (string) '',
-			'email_confirm'		=&gt; (string) '',
-			'confirm_code'		=&gt; (string) '',
-			'lang'				=&gt; (string) $_CORE_CONFIG['global']['default_lang'],
-			'tz'				=&gt; (float) $_CORE_CONFIG['global']['default_timezone'],
-		);
 
-		// If we change the language inline, we do not want to display errors, but pre-fill already filled out values
-		if ($change_lang)
-		{
-			foreach ($var_ary as $var =&gt; $default)
-			{
-				$$var = request_var($var, $default);
-			}
-		}
-		
-		// Check and initialize some variables if needed
 		if ($submit)
 		{
-			foreach ($var_ary as $var =&gt; $default)
-			{
-				$data[$var] = request_var($var, $default);
-			}
+			require_once($site_file_root.'includes/functions_user.php');
 
-			$var_ary = array(
-				'username'			=&gt; array(
-					array('string', false, $_CORE_CONFIG['user']['min_name_chars'], $_CORE_CONFIG['user']['max_name_chars']),
-					array('username')),
-				'password_confirm'	=&gt; array('string', false, $_CORE_CONFIG['user']['min_pass_chars'], $_CORE_CONFIG['user']['max_pass_chars']), 
-				'new_password'		=&gt; array('string', false, $_CORE_CONFIG['user']['min_pass_chars'], $_CORE_CONFIG['user']['max_pass_chars']), 
-				'email'				=&gt; array(
-					array('string', false, 6, 60), 
-					array('email')),
-				'email_confirm'		=&gt; array('string', false, 6, 60), 
-				'confirm_code'		=&gt; array('string', !($_CORE_CONFIG['user']['enable_confirm']), 6, 6), 
-				'tz'				=&gt; array('num', false, -13, 13),
-				'lang'				=&gt; array('match', false, '#^[a-z_]{2,}$#i'),
-			);
+			$error = array();
 
-			$error = validate_data($data, $var_ary);
-			extract($data);
-			unset($data);
+			$username	= get_variable('username', 'POST', false);
+			$password	= get_variable('password', 'POST', false);
+			$email		= get_variable('email', 'POST', false);
+			
+			//when we add this make sure to confirm that it's one of the installed langs
+			$lang		= $_CORE_CONFIG['global']['default_lang'];
+			$tz			= get_variable('tz', 'POST', false);
 
-			// Replace &quot;error&quot; strings with their real, localised form
-			$error = preg_replace('#^([A-Z_]+)$#e', &quot;(!empty(\$_CLASS['core_user']-&gt;lang['\\1'])) ? \$_CLASS['core_user']-&gt;lang['\\1'] : '\\1'&quot;, $error);
+			if (strpos($username, &quot;\n&quot;))
+			{
+				die;
+			}
 
-			// validate custom profile fields
-			//$cp-&gt;submit_cp_field('register', $_CLASS['core_user']-&gt;get_iso_lang_id(), $cp_data, $error);
+			$username_validate = validate_username($username);
 
-			// Visual Confirmation handling
-			$wrong_confirm = false;
-			
-			if ($_CORE_CONFIG['user']['enable_confirm'])
+			if ($username_validate !== true)
 			{
-				$code = $_CLASS['core_user']-&gt;session_data_get('confirmation_code');
+				$error[] = $username_validate;
+			}
 
-				if (!$code || !$confirm_code || $code !== $confirm_code)
-				{
-					$error[] = $_CLASS['core_user']-&gt;lang['CONFIRM_CODE_WRONG'];
-					$wrong_confirm = true;
-				}
+			if (!$password || $password !== get_variable('password_confirm', 'POST', ''))
+			{
+				$error[] = 'PASSWORD_ERROR';
 			}
 
-			if (!sizeof($error))
+			if (!$email || $email !== get_variable('email_confirm', 'POST', ''))
 			{
-				if ($new_password != $password_confirm)
-				{
-					$error[] = 'NEW_PASSWORD_ERROR';
-				}
-				
-				if ($email != $email_confirm)
-				{
-					$error[] = 'NEW_EMAIL_ERROR';
-				}
+				$error[] = 'PASSWORD_ERROR';
 			}
-			
-			if (!sizeof($error))
+
+			if ($_CORE_CONFIG['user']['enable_confirm'])
 			{
-				$server_url = generate_board_url();
+				$confirmation_code = $_CLASS['core_user']-&gt;session_data_get('confirmation_code');
+				$confirm_code = trim(get_variable('confirm_code', 'POST', false));
 
-				// Which group by default?
-				$group_reg = ($coppa) ? 'REGISTERED_COPPA' : 'REGISTERED';
-				$group_inactive = ($coppa) ? 'INACTIVE_COPPA' : 'INACTIVE';
-				$group_name = ($_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_NONE) ? $group_reg : $group_inactive;
-
-				$sql = 'SELECT group_id
-					FROM ' . GROUPS_TABLE . &quot; 
-					WHERE group_name = '$group_name'
-						AND group_type = &quot; . GROUP_SPECIAL;
-				$result = $_CLASS['core_db']-&gt;query($sql);
-
-				if (!($row = $_CLASS['core_db']-&gt;sql_fetchrow($result)))
+				if (!$confirm_code || !$confirmation_code || $confirm_code != $confirmation_code)
 				{
-					trigger_error($_CLASS['core_user']-&gt;lang['NO_GROUP']);
+					$error[] = $_CLASS['core_user']-&gt;lang['CONFIRM_CODE_WRONG'];
 				}
-				$_CLASS['core_db']-&gt;sql_freeresult($result);
 
-				$group_id = $row['group_id'];
+				// we don't need this any more
+				$_CLASS['core_user']-&gt;user_data_kill('confirmation_code');
+			}
 
-				if (($coppa || 
-					$_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_SELF || 
-					$_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_ADMIN) &amp;&amp; $_CORE_CONFIG['email']['email_enable'])
+		//$error = preg_replace('#^([A-Z_]+)$#e', &quot;(!empty(\$_CLASS['core_user']-&gt;lang['\\1'])) ? \$_CLASS['core_user']-&gt;lang['\\1'] : '\\1'&quot;, $error);
+			if (empty($error))
+			{
+				// Tz need to be moved out of the lang file, only use it for languages
+				if (!$tz || !in_array($tz, $_CLASS['core_user']-&gt;lang['tz']['zones']))
 				{
-					$user_actkey = gen_rand_string(10);
-					$key_len = 54 - (strlen($server_url));
-					$key_len = ($key_len &gt; 6) ? $key_len : 6;
-					$user_actkey = substr($user_actkey, 0, $key_len);
-					$user_type = USER_INACTIVE;
+					$tz = null;
 				}
-				else
+	
+				$password = encode_password($password, $_CORE_CONFIG['user']['password_encoding']);
+	
+				if (!$password)
 				{
-					$user_type = USER_NORMAL;
-					$user_actkey = '';
+					//do some admin contact thing here
+					die('Try again later');
 				}
-
-				// Begin transaction ... should this screw up we can rollback
-				$_CLASS['core_db']-&gt;transaction();
-		
-				$sql_ary = array(
-					'username'			=&gt; $username, 
-					'user_password'		=&gt; md5($new_password),
-					'user_email'		=&gt; $email, 
-					'group_id'			=&gt; (int) $group_id, 
-					'user_timezone'		=&gt; (float) $tz,
-					'user_lang'			=&gt; $lang,
-					'user_allow_pm'		=&gt; 1,
-					'user_type'			=&gt; $user_type,
-					'user_actkey'		=&gt; $user_actkey, 
-					'user_ip'			=&gt; $_CLASS['core_user']-&gt;ip, 
-					'user_regdate'		=&gt; time(),
-				);
-
-				$sql = 'INSERT INTO ' . USERS_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $sql_ary);
-				$_CLASS['core_db']-&gt;query($sql);
-
-				$user_id = $_CLASS['core_db']-&gt;insert_id();
-
-				// Insert Custom Profile Fields
-				/*if (sizeof($cp_data))
+	
+				if ($coppa || $_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_SELF || $_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_ADMIN)
 				{
-					$cp_data['user_id'] = (int) $user_id;
-					$sql = 'INSERT INTO ' . PROFILE_DATA_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', $cp-&gt;build_insert_sql_array($cp_data));
-					$_CLASS['core_db']-&gt;query($sql);
-				}*/
-
-				// Place into appropriate group, either REGISTERED(_COPPA) or INACTIVE(_COPPA) depending on config
-				$sql = 'INSERT INTO ' . USER_GROUP_TABLE . ' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
-					'user_id'		=&gt; (int) $user_id,
-					'group_id'		=&gt; (int) $group_id,
-					'user_pending'	=&gt; 0)
-				);
-				$_CLASS['core_db']-&gt;query($sql);
-
-				$_CLASS['core_db']-&gt;transaction('commit');
-
-				if ($coppa &amp;&amp; $_CORE_CONFIG['email']['email_enable'])
-				{
-					$message = $_CLASS['core_user']-&gt;lang['ACCOUNT_COPPA'];
-					$email_template = 'coppa_welcome_inactive';
+					if (!$_CORE_CONFIG['email']['email_enable'])
+					{
+						//do some admin contact thing here
+						die('Try again later');
+					}
+	
+					$user_status = STATUS_PENDING;
+					$user_act_key = generate_string(10);
 				}
-				elseif ($_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_SELF &amp;&amp; $_CORE_CONFIG['email']['email_enable'])
-				{
-					$message = $_CLASS['core_user']-&gt;lang['ACCOUNT_INACTIVE'];
-					$email_template = 'user_welcome_inactive';
-				}
-				elseif ($_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_ADMIN &amp;&amp; $_CORE_CONFIG['email']['email_enable'])
-				{
-					$message = $_CLASS['core_user']-&gt;lang['ACCOUNT_INACTIVE_ADMIN'];
-					$email_template = 'admin_welcome_inactive';
-				}
 				else
 				{
-					$message = $_CLASS['core_user']-&gt;lang['ACCOUNT_ADDED'];
-					$email_template = 'user_welcome';
+					$user_status = STATUS_ACTIVE;
+					$user_act_key = null;
 				}
-
-				if ($_CORE_CONFIG['email']['email_enable'])
+	
+				if ($user_status === STATUS_ACTIVE)
 				{
-					require_once($site_file_root.'includes/forums/functions_messenger.php');
-
-					$messenger = new messenger(false);
-
-					$messenger-&gt;template($email_template, $lang);
-					
-					$messenger-&gt;replyto($config['board_contact']);
-					$messenger-&gt;to($email, $username);
-
-					$messenger-&gt;headers('X-AntiAbuse: Board servername - ' . $config['server_name']);
-					$messenger-&gt;headers('X-AntiAbuse: User_id - ' . $_CLASS['core_user']-&gt;data['user_id']);
-					$messenger-&gt;headers('X-AntiAbuse: Username - ' . $_CLASS['core_user']-&gt;data['username']);
-					$messenger-&gt;headers('X-AntiAbuse: User IP - ' . $_CLASS['core_user']-&gt;ip);
-
-					$messenger-&gt;assign_vars(array(
-						'SITENAME'		=&gt; $_CORE_CONFIG['global']['site_name'],
-						'WELCOME_MSG'   =&gt; sprintf($_CLASS['core_user']-&gt;lang['WELCOME_SUBJECT'], $_CORE_CONFIG['global']['site_name']),
-						'USERNAME'		=&gt; $username,
-						'PASSWORD'		=&gt; $password_confirm,
-						'EMAIL_SIG'		=&gt; str_replace('&lt;br /&gt;', &quot;\n&quot;, &quot;-- \n&quot; . $config['board_email_sig']),
-						'U_ACTIVATE'	=&gt; generate_link(&quot;Control_Panel&amp;mode=activate&amp;u=$user_id&amp;k=$user_actkey&quot;, array('sid' =&gt; false, 'full' =&gt; true))
-					));
-
-					if ($coppa)
-					{
-						$messenger-&gt;assign_vars(array(
-							'FAX_INFO'		=&gt; $_CORE_CONFIG['user']['coppa_fax'],
-							'MAIL_INFO'		=&gt; $_CORE_CONFIG['user']['coppa_mail'],
-							'EMAIL_ADDRESS' =&gt; $email,
-							'SITENAME'		=&gt; $_CORE_CONFIG['global']['site_name'])
-						);
-					}
-
-					$messenger-&gt;send(NOTIFY_EMAIL);
-
-					if ($_CORE_CONFIG['user']['require_activation'] == USER_ACTIVATION_ADMIN)
-					{
-						// Grab an array of user_id's with a_user permissions ... these users
-						// can activate a user
-						$admin_ary = $_CLASS['auth']-&gt;acl_get_list(false, 'a_user', false);
-
-						$sql = 'SELECT user_id, username, user_email, user_lang, user_jabber, user_notify_type
-							FROM ' . USERS_TABLE . ' 
-							WHERE user_id IN (' . implode(', ', $admin_ary[0]['a_user']) .')';
-						$result = $_CLASS['core_db']-&gt;query($sql);
-
-						while ($row = $_CLASS['core_db']-&gt;sql_fetchrow($result))
-						{
-							$messenger-&gt;template('admin_activate', $row['user_lang']);
-							$messenger-&gt;replyto($config['board_contact']);
-							$messenger-&gt;to($row['user_email'], $row['username']);
-							$messenger-&gt;im($row['user_jabber'], $row['username']);
-
-							$messenger-&gt;assign_vars(array(
-								'USERNAME'		=&gt; $username,
-								'EMAIL_SIG'		=&gt; str_replace('&lt;br /&gt;', &quot;\n&quot;, &quot;-- \n&quot; . $config['board_email_sig']),
-								'U_ACTIVATE'	=&gt; generate_link(&quot;Control_Panel&amp;mode=activate&amp;u=$user_id&amp;k=$user_actkey&quot;, array('sid' =&gt; false, 'full' =&gt; true))
-							));
-
-							$messenger-&gt;send($row['user_notify_type']);
-						}
-						$_CLASS['core_db']-&gt;sql_freeresult($result);
-					}
+					set_core_config('user', 'newest_user_id', $row['user_id'], false);
+					set_core_config('user', 'newest_username', $row['username'], false);
+					set_core_config('user', 'num_users', $_CORE_CONFIG['user']['num_users'] + 1, false);
 				}
+	
+				$data = array(
+					'username'		=&gt; $username,
+					'user_email'	=&gt; $email,
+// add an option so admin can set with group they added to
+					'user_group'	=&gt; ($coppa) ? 3 : 2,
+					'user_reg_date'	=&gt; gmtime(),
+					'user_timezone'	=&gt; $tz,
 
-				if ($user_type == USER_NORMAL || !$_CORE_CONFIG['email']['email_enable'])
-				{
-					set_config('newest_user_id', $user_id);
-					set_config('newest_username', $username);
-					set_config('num_users', $config['num_users'] + 1, true);
-				}
-				unset($data);
+					'user_password'			=&gt; $password,
+					'user_password_encoding'=&gt; $_CORE_CONFIG['user']['password_encoding'],
 
-				$message = $message . '&lt;br /&gt;&lt;br /&gt;' . sprintf($_CLASS['core_user']-&gt;lang['RETURN_INDEX'],  '&lt;a href=&quot;'. generate_link() .'&quot;&gt;', '&lt;/a&gt;');
-				trigger_error($message);
+					'user_lang'			=&gt; ($lang == $_CORE_CONFIG['global']['default_lang']) ? null :$lang ,
+					'user_type'			=&gt; USER_NORMAL,
+					'user_status'		=&gt; $user_status,
+					'user_act_key'		=&gt; $user_act_key,
+					'user_ip'			=&gt; $_CLASS['core_user']-&gt;ip,
+				);
+
+				user_add($data);
 			}
 		}
 
-		$s_hidden_fields = '&lt;input type=&quot;hidden&quot; name=&quot;agreed&quot; value=&quot;true&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;coppa&quot; value=&quot;' . $coppa . '&quot; /&gt;';
-		$s_hidden_fields .= '&lt;input type=&quot;hidden&quot; name=&quot;change_lang&quot; value=&quot;0&quot; /&gt;';
-		
+		$s_hidden_fields .= '&lt;input type=&quot;hidden&quot; name=&quot;coppa&quot; value=&quot;' . $coppa . '&quot; /&gt;';
+		$s_hidden_fields .= '&lt;input type=&quot;hidden&quot; name=&quot;agreed&quot; value=&quot;true&quot; /&gt;';
 		$confirm_image = '';
 		
 		// Visual Confirmation - Show images
 		if ($_CORE_CONFIG['user']['enable_confirm'])
 		{
-			if (!$change_lang)
+			if ($submit)
 			{
 				if ($_CORE_CONFIG['user']['max_reg_attempts'])
 				{
@@ -359,59 +210,48 @@
 
 					$_CLASS['core_user']-&gt;session_data_get('reg_attempts', ($attempts + 1));
 				}
-				
+
 				$_CLASS['core_user']-&gt;session_data_set('confirmation_code', generate_string(6));
 			}
 
 			$confirm_image = '&lt;img src=&quot;'.generate_link('system&amp;mode=confirmation_image').'&quot; alt=&quot;&quot; title=&quot;&quot; /&gt;';
 		}
 
-		// 
 		$l_reg_cond = '';
+
 		switch ($_CORE_CONFIG['user']['require_activation'])
 		{
 			case USER_ACTIVATION_SELF:
 				$l_reg_cond = $_CLASS['core_user']-&gt;lang['UCP_EMAIL_ACTIVATE'];
-				break;
+			break;
 
 			case USER_ACTIVATION_ADMIN:
 				$l_reg_cond = $_CLASS['core_user']-&gt;lang['UCP_ADMIN_ACTIVATE'];
-				break;
+			break;
 		}
 
 		$user_char_ary = array('.*' =&gt; 'USERNAME_CHARS_ANY', '[\w]+' =&gt; 'USERNAME_ALPHA_ONLY', '[\w_\+\. \-\[\]]+' =&gt; 'USERNAME_ALPHA_SPACERS');
 
-		$lang = (isset($lang)) ? $lang : $_CORE_CONFIG['global']['default_lang'];
-		$tz = (isset($tz)) ? $tz : $_CORE_CONFIG['global']['default_timezone'];
-
-		
 		$_CLASS['core_template']-&gt;assign(array(
-			'ERROR'						=&gt; (sizeof($error)) ? implode('&lt;br /&gt;', $error) : '', 
-			'USERNAME'					=&gt; (isset($username)) ? $username : '',
-			'PASSWORD'					=&gt; (isset($password)) ? $password : '',
-			'PASSWORD_CONFIRM'			=&gt; (isset($password_confirm)) ? $password_confirm : '',
-			'EMAIL'						=&gt; (isset($email)) ? $email : '',
-			'EMAIL_CONFIRM'				=&gt; (isset($email_confirm)) ? $email_confirm : '',
+			'ERROR'						=&gt; empty($error) ? false : implode('&lt;br /&gt;', $error), 
+			'USERNAME'					=&gt; isset($username) ? $username : '',
+			'PASSWORD'					=&gt; isset($password) ? $password : '',
+			'EMAIL'						=&gt; isset($email) ? $email : '',
+			'EMAIL_CONFIRM'				=&gt; isset($email_confirm) ? $email_confirm : '', // should remove this also maybe
 			'CONFIRM_IMG'				=&gt; $confirm_image,
 
 			'L_CONFIRM_EXPLAIN'			=&gt; sprintf($_CLASS['core_user']-&gt;lang['CONFIRM_EXPLAIN'], '&lt;a href=&quot;mailto:' . htmlentities($config['board_contact']) . '&quot;&gt;', '&lt;/a&gt;'), 
 			'L_ITEMS_REQUIRED'			=&gt; $l_reg_cond, 
-			'L_USERNAME_EXPLAIN'		=&gt; sprintf($_CLASS['core_user']-&gt;lang[$user_char_ary[str_replace('\\\\', '\\', $_CORE_CONFIG['user']['allow_name_chars'])] . '_EXPLAIN'], $_CORE_CONFIG['user']['min_name_chars'], $_CORE_CONFIG['user']['max_name_chars']),
+			'L_USERNAME_EXPLAIN'		=&gt; sprintf($_CLASS['core_user']-&gt;lang[$user_char_ary[$_CORE_CONFIG['user']['allow_name_chars']] . '_EXPLAIN'], $_CORE_CONFIG['user']['min_name_chars'], $_CORE_CONFIG['user']['max_name_chars']),
 			'L_NEW_PASSWORD_EXPLAIN'	=&gt; sprintf($_CLASS['core_user']-&gt;lang['NEW_PASSWORD_EXPLAIN'], $_CORE_CONFIG['user']['min_pass_chars'], $_CORE_CONFIG['user']['max_pass_chars']), 
 
-			'S_LANG_OPTIONS'	=&gt; language_select($lang), 
-			'S_TZ_OPTIONS'		=&gt; tz_select($tz),
-			'S_CONFIRM_CODE'	=&gt; ($_CORE_CONFIG['user']['enable_confirm']),
+			//'S_LANG_OPTIONS'	=&gt; language_select($lang), 
+			'S_TZ_OPTIONS'		=&gt; tz_select(isset($tz) ? $tz : $_CORE_CONFIG['global']['default_timezone']),
 			'S_COPPA'			=&gt; $coppa, 
 			'S_HIDDEN_FIELDS'	=&gt; $s_hidden_fields,
 			'S_UCP_ACTION'		=&gt; generate_link(&quot;Control_Panel&amp;mode=register&quot;))
 		);
 		
-		$_CLASS['core_user']-&gt;profile_fields = array();
-
-		// Generate profile fields -&gt; Template Block Variable profile_fields
-		//$cp-&gt;generate_profile_fields('register', $_CLASS['core_user']-&gt;get_iso_lang_id());
-		
 		$this-&gt;display($_CLASS['core_user']-&gt;lang['REGISTER'], 'ucp_register.html');
 	}
 }

Modified: trunk/modules/Quick_Message/index.php
===================================================================
--- trunk/modules/Quick_Message/index.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/modules/Quick_Message/index.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -21,6 +21,9 @@
 	define('QUICK_MESSAGE_TABLE', 'test_quick_message');
 }
 
+$_CLASS['core_user']-&gt;user_setup();
+$_CLASS['core_user']-&gt;add_lang();
+
 switch (get_variable('mode', 'GET', false))
 {
 	case 'add':
@@ -28,12 +31,8 @@
 		{
 			url_redirect(generate_link($_CLASS['core_user']-&gt;data['session_url']), false);
 		}
-	
-		$_CLASS['core_user']-&gt;user_setup();
-		$_CLASS['core_user']-&gt;add_lang();
 
 		$message = trim(get_variable('message', 'POST', false));
-		$_CORE_CONFIG['quick_message']['lastpost_check'] = 300;
 
 		if (!$message)
 		{
@@ -50,14 +49,14 @@
 		$message 	= htmlentities($message, ENT_QUOTES, 'UTF-8');
 
 	// use limit
-		$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM '.QUICK_MESSAGE_TABLE.&quot; WHERE message_text='&quot;.$_CLASS['core_db']-&gt;escape($message).&quot;' AND message_time &gt;= &quot;.($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['lastpost_check']));
+		$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM '.QUICK_MESSAGE_TABLE.&quot; WHERE message_text='&quot;.$_CLASS['core_db']-&gt;escape($message).&quot;' AND message_time &gt;= &quot;.($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['last_post_check']));
 		$count = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 		$_CLASS['core_db']-&gt;free_result($result);
 
 	// add a count check here so it admin ajustable
 		if ($count['count'] &gt; 0)
 		{
-			trigger_error(sprintf($_CLASS['core_user']-&gt;lang['SAME_MESSAGE'], $_CORE_CONFIG['quick_message']['lastpost_check'] / 60));
+			trigger_error(sprintf($_CLASS['core_user']-&gt;lang['SAME_MESSAGE'], $_CORE_CONFIG['quick_message']['last_post_check'] / 60));
 		}
 
 		$_CLASS['core_db']-&gt;free_result($result);
@@ -133,9 +132,6 @@
 	break;
 }
 
-$_CLASS['core_user']-&gt;user_setup();
-$_CLASS['core_user']-&gt;add_lang();
-
 $start = get_variable('start', 'GET', 0, 'integer');
 $limit = 20;
 
@@ -221,10 +217,13 @@
 $row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
 $_CLASS['core_db']-&gt;free_result($result);	
 
+$pagination = generate_pagination('Quick_Message', $row['total'], $limit, $start);
+
 $_CLASS['core_template']-&gt;assign_array(array(
-	'Q_MESSAGE_PAGINATION'	=&gt; generate_pagination('Quick_Message', $row['total'], $limit, $start, false, 'Q_MESSAGE_'),
-	'Q_PAGE_NUMBER'			=&gt; on_page($row['total'], $limit, $start),
-	'Q_TOTAL_MESSAGES'		=&gt; $row['total']
+	'Q_MESSAGE_PAGINATION'			=&gt; $pagination['formated'],
+	'Q_MESSAGE_PAGINATION_ARRAY'	=&gt; $pagination['array'],
+	'Q_PAGE_NUMBER'					=&gt; on_page($row['total'], $limit, $start),
+	'Q_TOTAL_MESSAGES'				=&gt; $row['total']
 ));
 
 $_CLASS['core_display']-&gt;display(false, 'modules/Quick_Message/index.html');

Modified: trunk/modules/Quick_Message/install.php
===================================================================
--- trunk/modules/Quick_Message/install.php	2005-08-19 01:49:31 UTC (rev 87)
+++ trunk/modules/Quick_Message/install.php	2005-08-22 15:55:13 UTC (rev 88)
@@ -33,6 +33,7 @@
 
 $_CLASS['core_db']-&gt;table_create('commit');
 
+// use set config ?
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('quick_message', 'anonymous_posting', '2', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('quick_message', 'delete_time', '300', 1)&quot;);
 $_CLASS['core_db']-&gt;query('INSERT INTO '.$install_prefix.&quot;config (config_section, config_name, config_value, config_cache) VALUES ('quick_message', 'height', '200', 1)&quot;);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000011.html">[Viperals-svncheckins] r87 - in trunk: admin admin/functions blocks includes includes/db includes/display install javascript modules modules/Control_Panel/ucp modules/Forums modules/Members_List
</A></li>
	<LI>Next message: <A HREF="000013.html">[Viperals-svncheckins] r89 - in trunk: blocks includes includes/db includes/forums includes/forums/admin javascript modules/Control_Panel/ucp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12">[ date ]</a>
              <a href="thread.html#12">[ thread ]</a>
              <a href="subject.html#12">[ subject ]</a>
              <a href="author.html#12">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">More information about the Viperals-svncheckins
mailing list</a><br>
</body></html>
