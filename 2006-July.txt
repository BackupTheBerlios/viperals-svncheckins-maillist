From viperal at mail.berlios.de  Mon Jul 24 03:47:42 2006
From: viperal at mail.berlios.de (viperal at BerliOS)
Date: Mon, 24 Jul 2006 03:47:42 +0200
Subject: [Viperals-svncheckins] r175 - in cms/trunk: admin admin/functions
	blocks includes includes/display includes/fonts
	includes/forums includes/templates includes/templates/admin/articles
	includes/templates/admin/blocks includes/templates/admin/users
	includes/templates/modules/control_panel
	includes/templates/modules/members_list
	includes/templates/modules/quick_message install javascript
	modules/articles modules/articles/admin modules/control_panel
	modules/control_panel/language/en
	modules/control_panel/modules modules/members_list
	modules/quick_message themes/viperal/template
Message-ID: <200607240147.k6O1lfsF026648@sheep.berlios.de>

Author: viperal
Date: 2006-07-24 03:47:19 +0200 (Mon, 24 Jul 2006)
New Revision: 175

Added:
   cms/trunk/javascript/message.js
Modified:
   cms/trunk/admin/blocks.php
   cms/trunk/admin/functions/block_functions.php
   cms/trunk/admin/index.php
   cms/trunk/admin/modules.php
   cms/trunk/admin/users.php
   cms/trunk/blocks/block-Quick_Message.php
   cms/trunk/includes/display/blocks.php
   cms/trunk/includes/display/template.php
   cms/trunk/includes/fonts/tomnr.gdf
   cms/trunk/includes/forums/functions_privmsgs.php
   cms/trunk/includes/forums/message_parser.php
   cms/trunk/includes/functions.php
   cms/trunk/includes/session.php
   cms/trunk/includes/templates/admin/articles/edit.html
   cms/trunk/includes/templates/admin/articles/index.html
   cms/trunk/includes/templates/admin/blocks/edit.html
   cms/trunk/includes/templates/admin/blocks/index.html
   cms/trunk/includes/templates/admin/users/bots.html
   cms/trunk/includes/templates/admin/users/header.html
   cms/trunk/includes/templates/login_admin.html
   cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html
   cms/trunk/includes/templates/modules/members_list/memberlist_body.html
   cms/trunk/includes/templates/modules/quick_message/index.html
   cms/trunk/includes/templates/permission.html
   cms/trunk/install/build_data.php
   cms/trunk/install/build_tables.php
   cms/trunk/javascript/editor.js
   cms/trunk/javascript/quick_messages.js
   cms/trunk/modules/articles/admin/index.php
   cms/trunk/modules/articles/configurator.php
   cms/trunk/modules/control_panel/index.php
   cms/trunk/modules/control_panel/language/en/index.php
   cms/trunk/modules/control_panel/modules/ucp_calender.php
   cms/trunk/modules/control_panel/modules/ucp_pm.php
   cms/trunk/modules/control_panel/modules/ucp_pm_compose.php
   cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php
   cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php
   cms/trunk/modules/control_panel/modules/ucp_prefs.php
   cms/trunk/modules/control_panel/modules/ucp_zebra.php
   cms/trunk/modules/members_list/index.php
   cms/trunk/modules/quick_message/ajax.php
   cms/trunk/modules/quick_message/configurator.php
   cms/trunk/modules/quick_message/index.php
   cms/trunk/themes/viperal/template/footer.html
Log:
Lets Get back on track

Modified: cms/trunk/admin/blocks.php
===================================================================
--- cms/trunk/admin/blocks.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/admin/blocks.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -28,7 +28,9 @@
 
 global $_CLASS;
 
+
 $_CLASS['core_user']->add_lang('admin/blocks.php');
+$message = false;
 
 function check_position($position, $redirect = true)
 {
@@ -55,33 +57,37 @@
 	{
 		switch ($_REQUEST['mode'])
 		{
+			case 'auth':
+				block_auth($id);
+			break;
+
+			case 'content_cache':
+				block_content_cache($id, $message);
+			break;
+
 			case 'change':
 				block_change($id);
 			break;
-	
+
+			case 'delete':
+				block_delete($id);
+			break;
+
+			case 'edit':
+				block_add($id);
+				script_close(false);
+			break;
+
 			case 'order':
 				block_order($id, get_variable('option', 'GET', false));
 			break;
 	
-			case 'delete':
-				block_delete($id);
-			break;
-	
 			case 'position':
 				if ($position = get_variable('option', 'GET', false, 'integer'))
 				{
 					blocks_change_position($position, $id);
 				}
 			break;
-
-			case 'edit':
-				block_add($id);
-				script_close(false);
-			break;
-
-			case 'auth':
-				block_auth($id);
-			break;
 		}
 	}
 
@@ -135,13 +141,14 @@
 	$_CLASS['core_template']->assign_vars_array($block_position[$block['block_position']].'_admin_blocks', array(
 			'ACTIVE'		=> $active,
 			'ACTIVE_LINK'	=> generate_link('blocks&amp;mode=change&amp;id='.$block['block_id'], array('admin' => true)),
-			'CHANGE'		=> ($active) ? $_CLASS['core_user']->lang['DEACTIVATE'] : $_CLASS['core_user']->lang['ACTIVATE'],
+			'CHANGE'		=> ($active) ? $_CLASS['core_user']->get_lang('DEACTIVATE') : $_CLASS['core_user']->get_lang('ACTIVATE'),
 			'ERROR'			=> ($error) ? $_CLASS['core_user']->get_lang($error) : false,
 
 			'EDIT_LINK'		=> generate_link('blocks&amp;mode=edit&amp;id='.$block['block_id'], array('admin' => true)),
 			'AUTH_LINK'		=> generate_link('blocks&amp;mode=auth&amp;id='.$block['block_id'], array('admin' => true)),
+			'CACHE_LINK'	=> ($block['block_type'] == BLOCKTYPE_FEED) ? generate_link('blocks&amp;mode=content_cache&amp;id='.$block['block_id'], array('admin' => true)) : false,
 
-			'DELETE_LINK' 	=> ($block['block_type'] != BLOCKTYPE_SYSTEM) ? generate_link('blocks&amp;mode=delete&amp;id='.$block['block_id'], array('admin' => true)) : '',
+			'DELETE_LINK' 	=> ($block['block_type'] != BLOCKTYPE_SYSTEM) ? generate_link('blocks&amp;mode=delete&amp;id='.$block['block_id'], array('admin' => true)) : false,
 			'TITLE'			=> $block['block_title'],
 			'TYPE'			=> $_CLASS['core_user']->get_lang('TYPE_'.$block['block_type']),
 
@@ -159,6 +166,7 @@
 }
 
 $_CLASS['core_template']->assign_array(array(
+	'SYSTEM_MESSAGE'	=> $message,
 	'L_BLOCK_REGULAR'	=> 'Add New Regular Block',
 	'L_BLOCK_HTML'		=> 'Add New HTML Block',
 	'L_BLOCK_FEED'		=> 'Add New Feed Block',
@@ -493,4 +501,33 @@
 	return $block_list;
 }
 
+function block_content_cache($id, &$message)
+{
+	global $_CLASS;
+	
+	$result = $_CLASS['core_db']->query('SELECT block_content, block_position, block_title, block_type FROM ' . CORE_BLOCKS_TABLE . ' WHERE block_id = '.$id);
+	$block = $_CLASS['core_db']->fetch_row_assoc($result);
+	$_CLASS['core_db']->free_result($result);
+
+	if (!$block)
+	{
+		trigger_error('BLOCK_NOT_FOUND');
+	}
+
+	if ($block['block_type'] != BLOCKTYPE_FEED)
+	{
+		trigger_error('BLOCK_NO_CACHE');
+	}
+
+	$message = $_CLASS['core_user']->get_lang('CACHE_REMOVED_FOR').' RSS Block<br/><i>'.$block['block_title'].'<i>';
+
+	if ($block['block_content'] !== '') // use !== ''
+	{
+		check_position($block['block_position']);
+	
+		$result = $_CLASS['core_db']->query('UPDATE ' . CORE_BLOCKS_TABLE . " SET block_content = '' WHERE block_id = $id");
+	
+		$_CLASS['core_cache']->destroy('blocks');
+	}
+}
 ?>
\ No newline at end of file

Modified: cms/trunk/admin/functions/block_functions.php
===================================================================
--- cms/trunk/admin/functions/block_functions.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/admin/functions/block_functions.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -61,7 +61,7 @@
 	
 	$_CLASS['core_display']->display_footer();
 }
-		
+
 function block_change($id)
 {
 	global $_CLASS;
@@ -83,6 +83,40 @@
 	$_CLASS['core_cache']->destroy('blocks');
 }
 
+function block_delete($id, $return_link = false)
+{
+	global $_CLASS;
+
+	$result = $_CLASS['core_db']->query('SELECT block_order, block_type, block_position FROM ' . CORE_BLOCKS_TABLE . ' WHERE block_id='.$id);
+	$block = $_CLASS['core_db']->fetch_row_assoc($result);
+	$_CLASS['core_db']->free_result($result);
+
+	if (!$block || ($block['block_type'] == BLOCKTYPE_SYSTEM))
+	{
+		trigger_error(($block) ? 'BLOCK_NOT_DELETABLE' : 'BLOCK_NOT_FOUND');
+	}
+
+	check_position($block['block_position']);
+
+	if (display_confirmation())
+	{
+		$_CLASS['core_db']->query('DELETE from ' . CORE_BLOCKS_TABLE . ' where block_id = '.$id);
+		$result = $_CLASS['core_db']->query('UPDATE ' . CORE_BLOCKS_TABLE . ' SET block_order = block_order-1 WHERE block_position='.$block['block_position'].' AND block_order > '.$block['block_order']);
+
+		$_CLASS['core_cache']->destroy('blocks');
+        
+		if ($return_link)
+		{
+			trigger_error('Block deleted<br/><a href="'.$return_link.'">Click here to return</a>');	        
+		}
+	}
+
+	if ($return_link)
+	{
+		redirect($return_link);
+	}
+}
+
 function block_order($id, $option)
 {
 	global $_CLASS;
@@ -160,38 +194,4 @@
 	}
 }
 
-function block_delete($id, $return_link = false)
-{
-	global $_CLASS;
-
-	$result = $_CLASS['core_db']->query('SELECT block_order, block_type, block_position FROM ' . CORE_BLOCKS_TABLE . ' WHERE block_id='.$id);
-	$block = $_CLASS['core_db']->fetch_row_assoc($result);
-	$_CLASS['core_db']->free_result($result);
-
-	if (!$block || ($block['block_type'] == BLOCKTYPE_SYSTEM))
-	{
-		trigger_error(($block) ? 'BLOCK_NOT_DELETABLE' : 'BLOCK_NOT_FOUND');
-	}
-
-	check_position($block['block_position']);
-
-	if (display_confirmation())
-	{
-		$_CLASS['core_db']->query('DELETE from ' . CORE_BLOCKS_TABLE . ' where block_id = '.$id);
-		$result = $_CLASS['core_db']->query('UPDATE ' . CORE_BLOCKS_TABLE . ' SET block_order = block_order-1 WHERE block_position='.$block['block_position'].' AND block_order > '.$block['block_order']);
-
-		$_CLASS['core_cache']->destroy('blocks');
-        
-		if ($return_link)
-		{
-			trigger_error('Block deleted<br/><a href="'.$return_link.'">Click here to return</a>');	        
-		}
-	}
-
-	if ($return_link)
-	{
-		redirect($return_link);
-	}
-}
-
 ?>
\ No newline at end of file

Modified: cms/trunk/admin/index.php
===================================================================
--- cms/trunk/admin/index.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/admin/index.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -56,7 +56,10 @@
 	{
 		while ($data = $_CLASS['core_rss']->get_rss_data())
 		{
-			$cms_news[] = $data;
+			if (!empty($data['title']))
+			{			
+				$cms_news[] = $data;
+			}
 		}
 	}
 
@@ -124,7 +127,7 @@
 			$_CLASS['core_template']->assign_vars_array($type, array(
 					'user_id'		=> $row['user_id'],
 					'user_name'		=> $row['username'],
-					'registered'	=> $_CLASS['core_user']->format_time($row['user_regdate']),
+					'registered'	=> $_CLASS['core_user']->format_time($row['user_reg_date']),
 					'link_profile'	=> generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']),
 					'link_activate'	=> generate_link('&amp;user_mode=activate&amp;id=' . $row['user_id'], array('admin' => true)),
 					'link_remove'	=> generate_link('&amp;user_mode=remove&amp;id=' . $row['user_id'], array('admin' => true)),

Modified: cms/trunk/admin/modules.php
===================================================================
--- cms/trunk/admin/modules.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/admin/modules.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -51,35 +51,62 @@
 		
 if (isset($_REQUEST['mode']))
 {
-	if ($id = get_variable('id', 'GET', false, 'int'))
-	{
-		switch ($_REQUEST['mode'])
+	if ($_REQUEST['mode'] === 'search') {
+		if (isset($_REQUEST['option']) && isset($_REQUEST['name']) && display_confirmation())
 		{
-			case 'search':
-				//$result = $_CLASS['core_db']->query('SELECT page_name, page_type FROM '. CORE_PAGES_TABLE .' WHERE page_type = '. PAGE_MODULE);
-				$result = $_CLASS['core_db']->query('SELECT page_name, page_type FROM '. CORE_PAGES_TABLE);
+			$name = urldecode($_REQUEST['name']);
+			switch ($_REQUEST['option'])
+			{
+				case 'add':
+					if (!file_exists(SITE_FILE_ROOT."modules/$name/index.php"))
+					{
+						break;
+					}
+					$sql = 'INSERT INTO '.CORE_PAGES_TABLE.' ' . $_CLASS['core_db']->sql_build_array('INSERT', array(
+						'page_name'		=> (string) $name,
+						'page_type'		=> PAGE_MODULE,
+						'page_status'	=> STATUS_PENDING,
+					));
+					$_CLASS['core_db']->query($sql);
+				break;
+			}
+		}
+		
+		//$result = $_CLASS['core_db']->query('SELECT page_name, page_type FROM '. CORE_PAGES_TABLE .' WHERE page_type = '. PAGE_MODULE);
+		$result = $_CLASS['core_db']->query('SELECT page_name, page_type FROM '. CORE_PAGES_TABLE);
 
-				$modules = array();
+		$modules = array();
 
-				while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
-				{
-					$modules[$row['page_name']] = $row;
-				}
-				$_CLASS['core_db']->free_result($result);
+		while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
+		{
+			$modules[$row['page_name']] = $row;
+		}
+		$_CLASS['core_db']->free_result($result);
 
-				$handle = opendir(SITE_FILE_ROOT.'modules');
+		$handle = opendir(SITE_FILE_ROOT.'modules');
 
-				while ($file = readdir($handle))
-				{
-					if (mb_strpos($file, '.') === false && empty($modules[$file]) && file_exists(SITE_FILE_ROOT."modules/$file/index.php"))
-					{
-						//$_CLASS['core_db']->query('INSERT INTO '. CORE_PAGES_TABLE . " (page_name, page_type, page_status, page_sides) VALUES ($file, 1, 1, 1)");
-						echo $file;
-					}
-				}
-				closedir($handle);
-			break;
-
+		while ($name = readdir($handle))
+		{
+			if (mb_strpos($name, '.') === false && empty($modules[$name]) && file_exists(SITE_FILE_ROOT."modules/$name/index.php"))
+			{
+				$_CLASS['core_template']->assign_vars_array('modules_search', array(
+					'TITLE'				=> mb_convert_case(preg_replace('/_/', ' ', $name), MB_CASE_TITLE),
+					'LINK_ADD'			=> generate_link('modules&amp;mode=search&amp;option=add&amp;name='.urlencode($name), array('admin' => true)),
+					'LINK_INSTALL'		=> generate_link('modules&amp;mode=search&amp;option=install&amp;name='.urlencode($name), array('admin' => true)),
+					'LINK_REMOVE'		=> generate_link('modules&amp;mode=search&amp;option=remove&amp;name='.urlencode($name), array('admin' => true)),
+				));
+				//$_CLASS['core_db']->query('INSERT INTO '. CORE_PAGES_TABLE . " (page_name, page_type, page_status, page_sides) VALUES ($file, 1, 1, 1)");
+				//echo $file;
+			}
+		}
+		closedir($handle);
+		
+		$_CLASS['core_display']->display(false, 'admin/modules/search.html');
+	}
+	elseif ($id = get_variable('id', 'GET', false, 'int'))
+	{
+		switch ($_REQUEST['mode'])
+		{
 			case 'change':
 				require_once SITE_FILE_ROOT.'admin/functions/page_functions.php';
 
@@ -123,6 +150,17 @@
 					}
 
 					$_CLASS['core_db']->query('UPDATE '.CORE_PAGES_TABLE.' set page_status = '.STATUS_DISABLED.' WHERE page_id = '.$id);
+
+					if ($page_configurer->admin)
+					{
+						$array = array(
+							'module_name'	=> (string) $module['page_name'],
+							'module_status'	=> STATUS_ACTIVE,
+							'module_type'	=> 0,
+						);
+
+						$_CLASS['core_db']->query('INSERT INTO ' . CORE_ADMIN_MODULES_TABLE . ' '. $_CLASS['core_db']->sql_build_array('INSERT', $array));
+					}
 				}
 			break;
 
@@ -163,6 +201,17 @@
 					}
 
 					$_CLASS['core_db']->query('UPDATE ' . CORE_PAGES_TABLE . ' set page_status = ' . STATUS_PENDING . ' WHERE page_id = '.$id);
+
+					if ($page_configurer->admin)
+					{
+						$array = array(
+							'module_name'	=> (string) $module['page_name'],
+							'module_status'	=> STATUS_ACTIVE,
+							'module_type'	=> 0,
+						);
+
+						$_CLASS['core_db']->query('DELETE FROM ' . CORE_ADMIN_MODULES_TABLE . "  WHERE module_name = '{$module['page_name']}'");
+					}
 				}
 			break;
 
@@ -213,7 +262,7 @@
 			'CHANGE'		=> ($active) ? $_CLASS['core_user']->lang['DEACTIVATE'] : $_CLASS['core_user']->lang['ACTIVATE'],
 			'ERROR'			=> '',
 			'INSTALLED'		=> $installed,
-			'TITLE'			=> ($module['page_title']) ? $module['page_title'] : $module['page_name'],
+			'TITLE'			=> ($module['page_title']) ? $module['page_title'] : mb_convert_case(preg_replace('/_/', ' ', $module['page_name']), MB_CASE_TITLE),
 
 			'LINK_ACTIVE'		=> generate_link('modules&amp;mode=change&amp;id='.$module['page_id'], array('admin' => true)),
 			'LINK_EDIT'			=> generate_link('modules&amp;mode=edit&amp;id='.$module['page_id'], array('admin' => true)),

Modified: cms/trunk/admin/users.php
===================================================================
--- cms/trunk/admin/users.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/admin/users.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -21,7 +21,7 @@
 $Id$
 */
 
-if (VIPERAL !== 'Admin') 
+if (VIPERAL !== 'Admin')
 {
 	die;
 }
@@ -49,6 +49,7 @@
 	'LINK_VIEW_BOTS'		=> generate_link('users&amp;mode=bots', array('admin' => true)),
 	'LINK_VIEW_DISABLED'	=> generate_link('users&amp;mode=disabled', array('admin' => true)),
 	'LINK_VIEW_UNACTIVATED'	=> generate_link('users&amp;mode=unactivated', array('admin' => true)),
+	'LINK_VIEW_USER'		=> generate_link('users&amp;mode=user', array('admin' => true)),
 ));
 
 $id = (int) get_variable('id', 'GET', false);
@@ -286,11 +287,13 @@
 					break;
 				}
 			}
+			$start = get_variable('start', 'GET', 0, 'integer');
+			$limit = 20;
 
 			$sql = 'SELECT user_id, username, user_status, user_last_visit 
 				FROM ' . CORE_USERS_TABLE . '
-				WHERE user_type = ' . USER_BOT . ' ORDER BY user_last_visit DESC';
-			$result = $_CLASS['core_db']->query($sql);
+				WHERE user_type = ' . USER_BOT . ' ORDER BY user_last_visit, user_id DESC';
+			$result = $_CLASS['core_db']->query_limit($sql, $limit, $start);
 
 			while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
 			{
@@ -306,8 +309,25 @@
 			}
 			$_CLASS['core_db']->free_result($result);
 
+			$result = $_CLASS['core_db']->query('SELECT COUNT(*) AS total from '.CORE_USERS_TABLE.' WHERE user_type = ' . USER_BOT);
+			$row = $_CLASS['core_db']->fetch_row_assoc($result);
+			$_CLASS['core_db']->free_result($result);	
+			
+			$pagination = generate_pagination('users&amp;mode=bots', $row['total'], $limit, $start, true);
+			
+			$_CLASS['core_template']->assign_array(array(
+				'ADMIN_USER_PAGINATION'			=> $pagination['formated'],
+				'ADMIN_USER_PAGINATION_ARRAY'	=> $pagination['array'],
+				'ADMIN_USER_PAGE_NUMBER'		=> on_page($row['total'], $limit, $start),
+				'ADMIN_USER_TOTAL_MESSAGES'		=> $row['total']
+			));
+
 			$_CLASS['core_display']->display(false, 'admin/users/bots.html');
 		break;
+	
+		case 'activate':
+		case 'delete':
+			$_REQUEST['option'] = $_REQUEST['mode'];
 
 		case 'disabled':
 		case 'unactivated':
@@ -320,7 +340,7 @@
 					WHERE user_id = '.$id;
 
 				$result = $_CLASS['core_db']->query($sql);
-				$row = $_CLASS['core_db']>fetch_row_assoc($result);
+				$row = $_CLASS['core_db']->fetch_row_assoc($result);
 				$_CLASS['core_db']->free_result($result);
 
 				if ($row['user_type'] != USER_NORMAL)
@@ -361,6 +381,10 @@
 				}
 			}
 
+			if (isset($_REQUEST['option']) && $_REQUEST['option'] === $_REQUEST['mode']) {
+				break;
+			}
+
 			if ($_REQUEST['mode'] == 'unactivated')
 			{
 				$status = STATUS_PENDING;
@@ -411,6 +435,89 @@
 
 			$_CLASS['core_display']->display(false, $template);
 		break;
+
+		case 'user':
+			if ($id && isset($_REQUEST['option']))
+			{
+				require_once SITE_FILE_ROOT.'includes/functions_user.php';
+
+				$sql = 'SELECT user_id, user_type, user_status
+					FROM ' . CORE_USERS_TABLE . ' 
+					WHERE user_id = '.$id;
+
+				$result = $_CLASS['core_db']->query($sql);
+				$row = $_CLASS['core_db']->fetch_row_assoc($result);
+				$_CLASS['core_db']->free_result($result);
+
+				if ($row['user_type'] != USER_NORMAL)
+				{
+					break;
+				}
+
+				switch ($_REQUEST['option'])
+				{
+					case 'activate':
+						if ($row['user_status'] != STATUS_ACTIVE)
+						{echo 'test';
+							user_activate($id);
+						}
+					break;
+
+					case 'deactivate':
+						if ($row['user_id'] != $_CLASS['core_user']->data['user_id'] && $row['user_status'] == STATUS_ACTIVE)
+						{
+							user_disable($id);
+						}
+					break;
+
+					case 'delete':
+						if ($row['user_id'] != $_CLASS['core_user']->data['user_id'] && display_confirmation())
+						{
+							user_delete($id);
+
+							trigger_error('BOT_DELETED');
+						}
+					break;
+				}
+			}
+
+			$start = get_variable('start', 'GET', 0, 'integer');
+			$limit = 20;
+
+			$sql = 'SELECT user_id, username, user_status, user_last_visit 
+				FROM ' . CORE_USERS_TABLE . '
+				WHERE user_type = ' . USER_NORMAL . ' ORDER BY username DESC';
+			$result = $_CLASS['core_db']->query_limit($sql, $limit, $start);
+
+			while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
+			{
+				$_CLASS['core_template']->assign_vars_array('admin_bots', array(
+					'ACTIVE'		=> ($row['user_status'] == STATUS_ACTIVE),
+					'NAME'			=> $row['username'],
+					'LINK_DELETE'	=> ($row['user_id'] != $_CLASS['core_user']->data['user_id']) ? generate_link('users&amp;mode=user&amp;option=delete&amp;id='.$row['user_id'], array('admin' => true)) : false,
+					'LINK_STATUS'	=> ($row['user_id'] != $_CLASS['core_user']->data['user_id']) ? generate_link('users&amp;mode=user&amp;option='.(($row['user_status'] == STATUS_ACTIVE) ? 'deactivate' :  'activate').'&amp;id='.$row['user_id'], array('admin' => true)) : false,
+					'LINK_EDIT'		=> generate_link('users&amp;mode=user&amp;options=edit&amp;id='.$row['user_id'], array('admin' => true)),
+					'LAST_VISIT'	=> ($row['user_last_visit']) ?  $_CLASS['core_user']->format_date($row['user_last_visit']) : $_CLASS['core_user']->lang['BOT_NEVER'],
+					'L_STATUS'		=> ($row['user_status'] == STATUS_ACTIVE) ? $_CLASS['core_user']->lang['DEACTIVATE'] : $_CLASS['core_user']->lang['ACTIVATE'],
+				));
+			}
+			$_CLASS['core_db']->free_result($result);
+
+			$result = $_CLASS['core_db']->query('SELECT COUNT(*) AS total from '.CORE_USERS_TABLE.' WHERE user_type = ' . USER_NORMAL);
+			$row = $_CLASS['core_db']->fetch_row_assoc($result);
+			$_CLASS['core_db']->free_result($result);	
+			
+			$pagination = generate_pagination('users&amp;mode=user', $row['total'], $limit, $start, true);
+			
+			$_CLASS['core_template']->assign_array(array(
+				'ADMIN_USER_PAGINATION'			=> $pagination['formated'],
+				'ADMIN_USER_PAGINATION_ARRAY'	=> $pagination['array'],
+				'ADMIN_USER_PAGE_NUMBER'		=> on_page($row['total'], $limit, $start),
+				'ADMIN_USER_TOTAL_MESSAGES'		=> $row['total']
+			));
+
+			$_CLASS['core_display']->display(false, 'admin/users/bots.html');
+		break;
 	}
 }
 
@@ -461,9 +568,9 @@
 				'user_name'		=> $row['username'],
 				'registered'	=> $_CLASS['core_user']->format_time($row['user_reg_date']),
 				'link_profile'	=> generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']),
-				'link_activate'	=> generate_link('&amp;user_mode=activate&amp;id=' . $row['user_id'], array('admin' => true)),
-				'link_remove'	=> generate_link('&amp;user_mode=remove&amp;id=' . $row['user_id'], array('admin' => true)),
-				'link_remind'	=> generate_link('&amp;user_mode=remind&amp;id=' . $row['user_id'], array('admin' => true)),
+				'link_activate'	=> generate_link('&amp;mode=activate&amp;id=' . $row['user_id'], array('admin' => true)),
+				'link_remove'	=> generate_link('&amp;mode=remove&amp;id=' . $row['user_id'], array('admin' => true)),
+				'link_remind'	=> generate_link('&amp;mode=remind&amp;id=' . $row['user_id'], array('admin' => true)),
 				'link_details'	=> '',
 		));
 	}

Modified: cms/trunk/blocks/block-Quick_Message.php
===================================================================
--- cms/trunk/blocks/block-Quick_Message.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/blocks/block-Quick_Message.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -39,6 +39,7 @@
 
 $this->content = '<div id="qm_block">'.qm_block_content().'</div>';
 
+$this->content .= '<script type="text/javascript" src="javascript/message.js"></script>';
 $this->content .= '<script type="text/javascript" src="javascript/quick_messages.js"></script><div align="center"><a href="'.generate_link('Quick_Message').'">Message History</a><br />';
 
 if (!$_CLASS['core_user']->is_user && !$_CORE_CONFIG['quick_message']['anonymous_posting'])

Modified: cms/trunk/includes/display/blocks.php
===================================================================
--- cms/trunk/includes/display/blocks.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/display/blocks.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -291,7 +291,7 @@
 		$postion = ($this->display_position === BLOCK_MESSAGE_TOP) ? 'top' : 'bottom';
 
 		$_CLASS['core_template']->assign_vars_array('message_block_'.$postion, array(
-				//'TITLE'		=> $_CLASS['core_user']->get_lang($this->block['block_title']),
+				//'title'		=> $_CLASS['core_user']->get_lang($this->block['block_title']),
 				'title'		=> $this->block['block_title'],
 				'collapsed'	=> check_collapsed_status('block_'.$this->block['block_id']),
 				'content'	=> $this->block['block_content'],
@@ -308,7 +308,7 @@
 		$position = ($this->display_position === BLOCK_RIGHT) ? 'right' : 'left';
 		
 		$_CLASS['core_template']->assign_vars_array('block_'.$position, array(
-			//'TITLE'		=> $_CLASS['core_user']->get_lang($this->block['block_title']),
+			//'title'		=> $_CLASS['core_user']->get_lang($this->block['block_title']),
 			'title'		=> $this->block['block_title'],
 			'content'	=> $this->content,
 			'collapsed'	=> check_collapsed_status('block_'.$this->block['block_id']),
@@ -375,7 +375,17 @@
 
 			while ($data = $_CLASS['core_rss']->get_rss_data())
 			{
-				$this->content .= '<a href="'.$data['link'].'" target="new">'.$data['title'].'</a><hr width="30%"/>';
+				if (!empty($data['title']))
+				{
+					if (empty($data['link']))
+					{
+						$this->content .= $data['title'].'<hr width="30%"/>';
+					}
+					else
+					{
+						$this->content .= '<a href="'.$data['link'].'" target="new">'.$data['title'].'</a><hr width="30%"/>';
+					}
+				}
 			}
 			
 			if (!empty($_CLASS['core_rss']->rss_info['link']))

Modified: cms/trunk/includes/display/template.php
===================================================================
--- cms/trunk/includes/display/template.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/display/template.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -393,14 +393,14 @@
 					$compile = false;
 				break;
 
+				case 'LINK':
+					$tag_blocks[0][$loop] = $this->_compile_tag_link($tag_blocks[2][$loop]);
+				break;
+
 				case 'DEFINE':
 					$tag_blocks[0][$loop] = $this->_compile_tag_define($tag_blocks[2][$loop]);
 				break;
 
-				case 'AREA':
-					//$tag_blocks[0][$loop] = $this->_compile_tag_area($tag_blocks[2][$loop]);
-				break;
-
 				default:
 					//$tag_blocks[0][$loop] = '<!-- '.$tag_blocks[1][$loop].' '.$tag_blocks[2][$loop].' -->';
 				break;

Modified: cms/trunk/includes/fonts/tomnr.gdf
===================================================================
(Binary files differ)

Modified: cms/trunk/includes/forums/functions_privmsgs.php
===================================================================
--- cms/trunk/includes/forums/functions_privmsgs.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/forums/functions_privmsgs.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -332,7 +332,7 @@
 	// Get those messages not yet placed into any box
 	// NOTE: Expand Group Information to all groups the user/author is in? 
 	$sql = 'SELECT t.*, p.*, u.username, u.user_group as author_in_group
-		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . " u
+		FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . CORE_USERS_TABLE . " u
 		WHERE t.user_id = $user_id
 			AND p.author_id = u.user_id
 			AND t.folder_id = " . PRIVMSGS_NO_BOX . '
@@ -594,7 +594,7 @@
 			$set_sql .= 'user_new_privmsg = user_new_privmsg - ' . $num_new;
 		}
 
-		$_CLASS['core_db']->query('UPDATE ' . USERS_TABLE . " SET $set_sql WHERE user_id = $user_id");
+		$_CLASS['core_db']->query('UPDATE ' . CORE_USERS_TABLE . " SET $set_sql WHERE user_id = $user_id");
 
 		$_CLASS['core_user']->data['user_new_privmsg'] -= $num_new;
 		$_CLASS['core_user']->data['user_unread_privmsg'] -= $num_unread;
@@ -724,7 +724,7 @@
 
 	if ($count)
 	{
-		$sql = 'UPDATE ' . USERS_TABLE . ' 
+		$sql = 'UPDATE ' . CORE_USERS_TABLE . ' 
 			SET user_unread_privmsg = user_unread_privmsg '.(($read) ? '+ ' : '- '). " $count
 			WHERE user_id = $user_id";
 		$_CLASS['core_db']->query($sql);
@@ -924,7 +924,7 @@
 			$set_sql .= 'user_new_privmsg = user_new_privmsg - ' . $num_new;
 		}
 		
-		$_CLASS['core_db']->query('UPDATE ' . USERS_TABLE . " SET $set_sql WHERE user_id = $user_id");
+		$_CLASS['core_db']->query('UPDATE ' . CORE_USERS_TABLE . " SET $set_sql WHERE user_id = $user_id");
 	}
 	
 	// Now we have to check which messages we can delete completely	
@@ -1002,7 +1002,7 @@
 		if (!empty($u))
 		{
 			$sql = 'SELECT user_id, username, user_colour 
-				FROM ' . USERS_TABLE . '
+				FROM ' . CORE_USERS_TABLE . '
 				WHERE user_id IN (' . implode(', ', $u) . ')
 					AND user_type = ' . USER_NORMAL;
 			$result = $_CLASS['core_db']->query($sql);
@@ -1289,7 +1289,7 @@
 			));
 		}
 
-		$sql = 'UPDATE ' . USERS_TABLE . ' 
+		$sql = 'UPDATE ' . CORE_USERS_TABLE . ' 
 			SET user_new_privmsg = user_new_privmsg + 1, user_unread_privmsg = user_unread_privmsg + 1
 			WHERE user_id IN (' . implode(', ', array_keys($recipients)) . ')';
 		$_CLASS['core_db']->query($sql);
@@ -1312,7 +1312,7 @@
 	// Set user last post time
 	if ($mode === 'reply' || $mode === 'quote' || $mode === 'forward' || $mode === 'post')
 	{
-		$sql = 'UPDATE ' . USERS_TABLE . "
+		$sql = 'UPDATE ' . CORE_USERS_TABLE . "
 			SET user_last_post_time = {$_CLASS['core_user']->time}
 			WHERE user_id = " . $_CLASS['core_user']->data['user_id'];
 		$_CLASS['core_db']->query($sql);
@@ -1414,7 +1414,7 @@
 	$recipient_list = implode(', ', array_unique(array_keys($recipients)));
 
 	$sql = 'SELECT user_id, username, user_email, user_lang, user_notify_pm, user_notify_type
-		FROM ' . USERS_TABLE . "
+		FROM ' . CORE_USERS_TABLE . "
 		WHERE user_id IN ($recipient_list)";
 	$result = $_CLASS['core_db']->query($sql);
 

Modified: cms/trunk/includes/forums/message_parser.php
===================================================================
--- cms/trunk/includes/forums/message_parser.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/forums/message_parser.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -931,7 +931,7 @@
 
   	    if (is_null($smiley = $_CLASS['core_cache']->get('smiley_parse')))
   	    {
-			$result = $_CLASS['core_db']->query('SELECT * FROM ' . SMILIES_TABLE .' ORDER BY LENGTH(smiley_code) DESC');
+			$result = $_CLASS['core_db']->query('SELECT * FROM ' . CORE_SMILIES_TABLE .' ORDER BY LENGTH(smiley_code) DESC');
 
 			$smiley = array();
 			

Modified: cms/trunk/includes/functions.php
===================================================================
--- cms/trunk/includes/functions.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/functions.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -55,7 +55,7 @@
 
 	foreach ($bots_array as $bot)
 	{
-		if ($bot['user_agent'] && mb_strpos($browser, $bot['user_agent']) === 0)
+		if ($bot['user_agent'] && mb_strpos(mb_strtolower($browser), mb_strtolower($bot['user_agent'])) === 0)
 		{
 			$is_bot = $bot['user_id'];
 		}
@@ -326,8 +326,8 @@
 
 	if (is_null($censors = $_CLASS['core_cache']->get('word_censors')))
 	{
-		$sql = 'SELECT word, replacement
-			FROM  ' . CORE_CENSOR_TABLE .' ORDER BY LENGTH(word) DESC';
+		$sql = 'SELECT word_match, word_replacement
+			FROM  ' . CORE_CENSOR_TABLE .' ORDER BY LENGTH(word_match) DESC';
 		$result = $_CLASS['core_db']->query($sql);
 
 		$censors = array();
@@ -432,7 +432,7 @@
 	if (!$base)
 	{
 		global $_CORE_CONFIG;
-
+//$_SERVER['HTTPS'];
 		$base = ($_CORE_CONFIG['server']['site_secure']) ? 'https://' : 'http://' ;
 		$base .= trim(isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : $_CORE_CONFIG['server']['site_domain']);
 		$base .= (($_CORE_CONFIG['server']['site_port'] && $_CORE_CONFIG['server']['site_port'] != 80) ? ':' . $_CORE_CONFIG['server']['site_port'] : '') . ($_CORE_CONFIG['server']['site_path']) ? $_CORE_CONFIG['server']['site_path'] : '/';

Modified: cms/trunk/includes/session.php
===================================================================
--- cms/trunk/includes/session.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/session.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -64,7 +64,7 @@
 			{
 				$valid  = true;
 
-				if ($this->data['session_browser'] != $this->browser)
+				if ($this->data['session_browser'] !== $this->browser)
 				{
 					$valid  = false;
 				}
@@ -73,7 +73,7 @@
 				{
 					$check_ip = implode('.', explode('.', $this->data['session_ip'], $_CORE_CONFIG['server']['ip_check']));
 					
-					if ($check_ip != substr($this->ip, 0, strlen($check_ip)))
+					if ($check_ip !== substr($this->ip, 0, strlen($check_ip)))
 					{
 						$valid  = false;
 					}

Modified: cms/trunk/includes/templates/admin/articles/edit.html
===================================================================
--- cms/trunk/includes/templates/admin/articles/edit.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/admin/articles/edit.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -5,7 +5,7 @@
 <script type="text/javascript" src="javascript/jscalendar/calendar-setup.js"></script>
 <script type="text/javascript" src="javascript/jscalendar/lang/calendar-en.js"></script>
 
-{ $A_TABLE_OPEN }
+{ $THEME_TABLE_OPEN }
 
 <form action="{ $B_ACTION }" name="message" method="post">
 	<table class="tablebg" align="center" cellpadding="4" cellspacing="1" width="100%">
@@ -72,7 +72,7 @@
 	</table>
 </form>
 
-{ $A_TABLE_CLOSE }
+{ $THEME_TABLE_CLOSE }
 
 <script type="text/javascript">
 

Modified: cms/trunk/includes/templates/admin/articles/index.html
===================================================================
--- cms/trunk/includes/templates/admin/articles/index.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/admin/articles/index.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-{ $A_TABLE_OPEN }
+{ $THEME_TABLE_OPEN }
 
 <table class="tablebg" border="0" cellpadding="4" cellspacing="1" width="100%">
     <tbody>
@@ -105,6 +105,6 @@
   </tbody>
 </table>
 
-{ $A_TABLE_CLOSE }
+{ $THEME_TABLE_CLOSE }
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/admin/blocks/edit.html
===================================================================
--- cms/trunk/includes/templates/admin/blocks/edit.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/admin/blocks/edit.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -75,7 +75,7 @@
 			<!-- ENDIF -->
 			<tr>
 				<td class="cat" colspan="3" align="center" height="28">
-					<input class="btnmain" name="submit" value="Submit" type="submit" />&nbsp;&nbsp;<input class="button" value="Reset" name="reset" type="reset" />
+					<input class="button" name="submit" value="Submit" type="submit" />&nbsp;&nbsp;<input class="button" value="Reset" name="reset" type="reset" />
 				</td>
 			</tr>
 		</tbody>

Modified: cms/trunk/includes/templates/admin/blocks/index.html
===================================================================
--- cms/trunk/includes/templates/admin/blocks/index.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/admin/blocks/index.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -1,7 +1,63 @@
 <!-- DISPLAY_HEADER -->
 
+<!-- just for testing will be it's own global thing later on -->
+<!-- IF { $SYSTEM_MESSAGE } -->
+
+<script language="javascript">
+	var message_array = new Array();
+
+	function message_hide(identifier) {
+	
+		var message = document.getElementById(identifier);
+		message.style.display = 'none';	
+		
+		window.clearInterval(message_array[identifier]);
+	}
+
+	function message_show(identifier) {
+	
+		var message = document.getElementById(identifier);
+		var message_table = document.getElementById(identifier + '_table');
+
+		message.style.display = '';	
+		message.style.left = (document.body.clientWidth - message_table.offsetWidth - 5) + 'px';
+
+		//alert(message_table.offsetWidth + ' | ' + document.body.clientWidth);
+
+		window.clearInterval(message_array[identifier]);
+		message_array['mesg1'] = window.setInterval("message_hide('mesg1')", 3000);
+	}
+
+	var message = document.createElement('div');
+	
+	message.id = 'mesg1';
+	message.style.position	= (is_gecko) ? 'fixed' : 'absolute';
+	message.style.top = '5px';
+	message.style.left = '5px';
+	message.style.zIndex = 1;
+	message.style.width = '100%';
+	message.style.display = 'none';	
+
+	message.onclick = function() {
+		message_hide('mesg1');
+	}
+
+	message.innerHTML = '<table id="mesg1_table" class="tablebg" border="0" cellpadding="4" cellspacing="1" >' +
+	'<tbody><tr><td class="row2" align="center"><font class="error"><b>System Message</b></font></td></tr>' +
+	'<tr><td class="row1" align="center">{ $SYSTEM_MESSAGE }</td></tr></tbody></table>';
+
+	message.style.cursor = 'pointer';
+	document.body.insertBefore(message, document.nextSibling);
+
+	message_array['mesg1'] = window.setInterval("message_show('mesg1')", 500);
+
+
+</script>
+<!-- ENDIF -->
+
 { $THEME_TABLE_OPEN }
 
+
 <table border="0" class="tablebg" cellpadding="4" cellspacing="1" width="100%">
 	<tbody>
 		<tr>
@@ -59,6 +115,9 @@
 			<!-- IF { $left_admin_blocks:DELETE_LINK } -->
 				| <a href="{ $left_admin_blocks:DELETE_LINK }">{ $L_DELETE }</a>
 			<!-- ENDIF -->
+			<!-- IF { $left_admin_blocks:CACHE_LINK } -->
+				| <a href="{ $left_admin_blocks:CACHE_LINK }">{ $L_CLEAR_CACHE }</a>
+			<!-- ENDIF -->
 			</td>
 		</tr>
 		<tr>
@@ -105,6 +164,9 @@
 			<!-- IF { $centertop_admin_blocks:DELETE_LINK } -->
 				| <a href="{ $centertop_admin_blocks:DELETE_LINK }">{ $L_DELETE }</a>
 			<!-- ENDIF -->
+			<!-- IF { $centertop_admin_blocks:CACHE_LINK } -->
+				| <a href="{ $centertop_admin_blocks:CACHE_LINK }">{ $L_CLEAR_CACHE }</a>
+			<!-- ENDIF -->
 			</td>
 		</tr>
 		<tr>
@@ -150,6 +212,9 @@
 			<!-- IF { $centerbottom_admin_blocks:DELETE_LINK } -->
 				| <a href="{ $centerbottom_admin_blocks:DELETE_LINK }">{ $L_DELETE }</a>
 			<!-- ENDIF -->
+			<!-- IF { $centerbottom_admin_blocks:CACHE_LINK } -->
+				| <a href="{ $centerbottom_admin_blocks:CACHE_LINK }">{ $L_CLEAR_CACHE }</a>
+			<!-- ENDIF -->
 			</td>
 		</tr>
 		<tr>
@@ -194,6 +259,9 @@
 			<!-- IF { $right_admin_blocks:DELETE_LINK } -->
 				| <a href="{ $right_admin_blocks:DELETE_LINK }">{ $L_DELETE }</a>
 			<!-- ENDIF -->
+			<!-- IF { $right_admin_blocks:CACHE_LINK } -->
+				| <a href="{ $right_admin_blocks:CACHE_LINK }">{ $L_CLEAR_CACHE }</a>
+			<!-- ENDIF -->
 			</td>
 		</tr>
 		<tr>

Modified: cms/trunk/includes/templates/admin/users/bots.html
===================================================================
--- cms/trunk/includes/templates/admin/users/bots.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/admin/users/bots.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -14,19 +14,43 @@
 	<tr>
 		<td class="row1" width="">{ $admin_bots:NAME }</td>
 		<td class="row1" width="200" align="center" nowrap="nowrap">{ $admin_bots:LAST_VISIT }</td>
+		<!-- IF { $admin_bots:LINK_STATUS } -->
 		<td width="80" align="center" class="row1" onmouseover="this.className='row2'" onmouseout="this.className='row1'" onclick="location.href='{ $admin_bots:LINK_STATUS }'; return false;">
 			<a href="{ $admin_bots:LINK_STATUS }">{ $admin_bots:L_STATUS }</a>
-		</td>
+		</td>
+		<!-- ELSE -->
+			<td width="80" align="center" class="row2">
+			</td>
+		<!-- ENDIF -->
+		<!-- IF { $admin_bots:LINK_EDIT } -->
 		<td width="80" align="center" class="row1" onmouseover="this.className='row2'" onmouseout="this.className='row1'" onclick="location.href='{ $admin_bots:LINK_EDIT }'; return false;">
 			<a href="{ $admin_bots:LINK_EDIT }">{ $L_EDIT }</a>
-		</td>
+		</td>
+		<!-- ELSE -->
+			<td width="80" align="center" class="row2">
+			</td>
+		<!-- ENDIF -->
+		<!-- IF { $admin_bots:LINK_DELETE } -->
 		<td width="80" align="center" class="row1" onmouseover="this.className='row2'" onmouseout="this.className='row1'" onclick="location.href='{ $admin_bots:LINK_DELETE }'; return false;">
 			<a href="{ $admin_bots:LINK_DELETE }">{ $L_DELETE }</a> 
 		</td>
+		<!-- ELSE -->
+			<td width="80" align="center" class="row2">
+			</td>
+		<!-- ENDIF -->
 	</tr>
 	<!-- ENDLOOP $admin_bots -->
 </table>
 
+<!-- IF { $ADMIN_USER_TOTAL_MESSAGES } -->
+<br/>
+<table class="tablebg" cellspacing="1" cellpadding="4" width="100%">
+		<tr class="row2">
+			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;{ $ADMIN_USER_PAGE_NUMBER } &nbsp;[ { $ADMIN_USER_TOTAL_MESSAGES } ]&nbsp;</td>
+			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><!-- IF { $ADMIN_USER_PAGINATION } --><b><a href="javascript:jumpto();">{ $L_GOTO_PAGE }</a> <!-- IF { $PREVIOUS_PAGE } --><a href="{ $PREVIOUS_PAGE }">{ $L_PREVIOUS }</a>&nbsp;&nbsp;<!-- ENDIF -->{ $ADMIN_USER_PAGINATION }<!-- IF { $NEXT_PAGE } -->&nbsp;&nbsp;<a href="{ $NEXT_PAGE }">{ $L_NEXT }</a><!-- ENDIF --></b><!-- ENDIF --></td>
+		</tr>
+</table>
+<!-- ENDIF -->
 { $THEME_TABLE_CLOSE }
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/admin/users/header.html
===================================================================
--- cms/trunk/includes/templates/admin/users/header.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/admin/users/header.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -61,6 +61,11 @@
 							</td>
 						</tr>
 						<tr>
+							<td align="center" class="row1" onmouseover="this.className='row2'" onmouseout="this.className='row1'" onclick="location.href='{ $LINK_VIEW_USER }'; return false;">
+								<a href="{ $LINK_VIEW_USER }" title="{ $L_VIEW_USER }">{ $L_VIEW_USER }</a>
+							</td>
+						</tr>
+						<tr>
 							<td align="center" class="row1" onmouseover="this.className='row2'" onmouseout="this.className='row1'" onclick="location.href='{ $LINK_VIEW_DISABLED }'; return false;">
 								<a href="{ $LINK_VIEW_DISABLED }" title="{ $L_VIEW_DISABLED }">{ $L_VIEW_DISABLED }</a>
 							</td>
@@ -75,7 +80,7 @@
 						</tr>
 						<tr>
 							<td align="center" class="row1" onmouseover="this.className='row2'" onmouseout="this.className='row1'" onclick="location.href='{ $LINK_ADD_USER }'; return false;">
-								<a href="{ $LINK_ADD_USER }" title="{ $L_VIEW_BOTS }">{ $L_ADD_USER }</a>
+								<a href="{ $LINK_ADD_USER }" title="{ $L_ADD_USER }">{ $L_ADD_USER }</a>
 							</td>
 						</tr>
 						<tr>

Modified: cms/trunk/includes/templates/login_admin.html
===================================================================
--- cms/trunk/includes/templates/login_admin.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/login_admin.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -129,7 +129,7 @@
 				</tr>
 				<!-- ENDIF -->
 				<tr> 
-					<th colspan="2" align="center">{$S_HIDDEN_FIELDS}<input type="submit" name="login" class="button" value="{$L_LOGIN}" tabindex="4" /></td>
+					<th colspan="2" align="center">{ $S_HIDDEN_FIELDS }<input type="submit" name="login" class="button" value="{ $L_LOGIN }" tabindex="4" /></td>
 				</tr>
 			</table>
 		</form>

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -59,7 +59,6 @@
 		<td valign="top"><table width="100%" cellspacing="5">
 			<tr>
 				<td>
-
 					<!-- IF { $S_MESSAGE_REPORTED } -->
 					<table width="100%" cellspacing="0">
 						<tr>

Modified: cms/trunk/includes/templates/modules/members_list/memberlist_body.html
===================================================================
--- cms/trunk/includes/templates/modules/members_list/memberlist_body.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/modules/members_list/memberlist_body.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -116,7 +116,7 @@
 
 		<tr>
 			<td class="cat" colspan="<!-- IF { $S_SEARCH_USER } -->9<!-- ELSE -->8<!-- ENDIF -->" align="center">
-			<!-- IF { $S_SEARCH_USER } --><input class="button" type="submit" value="{$L_SELECT_MARKED}" />
+			<!-- IF { $S_SEARCH_USER } --><input class="button" type="submit" value="{ $L_SELECT_MARKED }" />
 			<!-- ELSE --><span class="gensmall">{ $L_SELECT_SORT_METHOD }:</span>&nbsp;<select name="sk">{ $S_MODE_SELECT }</select>&nbsp; <span class="gensmall">{ $L_ORDER }</span>&nbsp;<select name="sd">{ $S_ORDER_SELECT }</select>&nbsp;
 			<input type="submit" name="submit" value="{ $L_SUBMIT }" class="button" /><!-- ENDIF --></td>
 		</tr>

Modified: cms/trunk/includes/templates/modules/quick_message/index.html
===================================================================
--- cms/trunk/includes/templates/modules/quick_message/index.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/modules/quick_message/index.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -42,10 +42,19 @@
 			</tr>
 		<!-- ENDLOOP $quick_message -->
 
-
 	</tbody>
 </table>
 
+<!-- IF { $Q_MESSAGE_TOTAL_MESSAGES } -->
+<br/>
+<table class="tablebg" cellspacing="1" cellpadding="4" width="100%">
+		<tr class="row2">
+			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;{ $Q_MESSAGE_PAGE_NUMBER } &nbsp;[ { $Q_MESSAGE_TOTAL_MESSAGES } ]&nbsp;</td>
+			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><!-- IF { $Q_MESSAGE_PAGINATION } --><b><a href="javascript:jumpto();">{ $L_GOTO_PAGE }</a> <!-- IF { $PREVIOUS_PAGE } --><a href="{ $PREVIOUS_PAGE }">{ $L_PREVIOUS }</a>&nbsp;&nbsp;<!-- ENDIF -->{ $Q_MESSAGE_PAGINATION }<!-- IF { $NEXT_PAGE } -->&nbsp;&nbsp;<a href="{ $NEXT_PAGE }">{ $L_NEXT }</a><!-- ENDIF --></b><!-- ENDIF --></td>
+		</tr>
+</table>
+<!-- ENDIF -->
+
 { $THEME_TABLE_CLOSE }
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/permission.html
===================================================================
--- cms/trunk/includes/templates/permission.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/includes/templates/permission.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -1,5 +1,7 @@
-{ $A_TABLE_OPEN }
+{ $THEME_TABLE_OPEN }
+
 <form method="post" action="">
+
 <!-- IF { $P_CURRENT_GROUPS } || { $P_DCURRENT_GROUPS } || { $P_CURRENT_USERS } || { $P_DCURRENT_USERS }-->
 	<table class="tablebg" border="0" cellpadding="0" cellspacing="1" width="100%">
 		<tbody>
@@ -117,6 +119,7 @@
 		</tbody>
 	</table>
 </form>
+
 <div style="padding: 3px"></div>
 
-{ $A_TABLE_CLOSE }
\ No newline at end of file
+{ $THEME_TABLE_CLOSE }
\ No newline at end of file

Modified: cms/trunk/install/build_data.php
===================================================================
--- cms/trunk/install/build_data.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/install/build_data.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -38,7 +38,7 @@
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'only_registered', '0', 'bool', 1)");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_dateformat', 'D M d, Y g:i a', 'string', 1)");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'default_timezone', '-5', 'float', 1)");
-$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'link_optimization', '1', 'bool', 1)");
+$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'link_optimization', '0', 'bool', 1)");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('global', 'index_page', 'contact', 'string', 1)");
 
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."config (config_section, config_name, config_value, config_type, config_cache) VALUES ('maintenance', 'active', '1', 'bool', 1)");
@@ -118,7 +118,7 @@
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."blocks (block_title, block_type, block_status, block_position, block_order, block_file) VALUES ('Theme Select', 0, 2, 2, 2, 'block-theme_select.php')");
 
 $content = $_CLASS['core_db']->escape('<div style="text-align:center">Hello and welcome</div>');
-$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."blocks (block_title, block_type, block_status, block_position, block_order, block_content) VALUES ('Welcome', 4, 2, 5, 4, '$content')");
+$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."blocks (block_title, block_type, block_status, block_position, block_order, block_content) VALUES ('Welcome', 4, 2, 6, 4, '$content')");
 
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."admin_modules (module_name, module_status, module_type) VALUES ('blocks', 2, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."admin_modules (module_name, module_status, module_type) VALUES ('groups', 2, 0)");
@@ -129,8 +129,9 @@
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."admin_modules (module_name, module_status, module_type) VALUES ('smiles', 2, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."admin_modules (module_name, module_status, module_type) VALUES ('users', 2, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."admin_modules (module_name, module_status, module_type) VALUES ('groups', 2, 0)");
+$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."admin_modules (module_name, module_status, module_type) VALUES ('forums', 2, 0)");
 
-$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."control_panel_modules (module_name, module_status, module_subs) VALUES ('main', 2, 'front\r\nsubscribed\r\nbookmarks,cfg_allow_bookmarks\r\ndrafts')");
+$_CLASS['core_db']->query('INSERT INTO '.$table_prefix."control_panel_modules (module_name, module_status, module_subs) VALUES ('main', 2, 'front\r\nsubscribed\r\nbookmarks\r\ndrafts')");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."control_panel_modules (module_name, module_status, module_subs) VALUES ('pm', 2, 'view_messages\r\ncompose\r\nunread\r\ndrafts\r\noptions')");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."control_panel_modules (module_name, module_status, module_subs) VALUES ('profile', 2,'profile_info\r\nreg_details\r\nsignature\r\navatar')");
 $_CLASS['core_db']->query('INSERT INTO '.$table_prefix."control_panel_modules (module_name, module_status, module_subs) VALUES ('prefs', 2, 'personal\r\nview\r\npost')");
@@ -190,11 +191,11 @@
 
 $_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (0, 2, 1, 'Anonymous', '', '', '', $time, '', 1, 0, 0, 0, 0, '$guest_data', 0, 0, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (1, 2, 4, 'admin', '21232f297a57a5a743894a0e4a801fc3', 'md5', '', $time, '', 'AA0000', 1, 1, 1, 1, 1, '$admin_data', 0, 0, 0)");
-$_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Googlebot', '', '', '', $time, '216.239.46.,64.68.8.,66.249.64.,66.249.71.', 'Googlebot/', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
+$_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Googlebot', '', '', '', $time, '216.239.46.,64.68.8.,66.249.64.,66.249.71.', 'Googlebot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'MSN', '', '', '', $time, '65.54.188.', 'msnbot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Yahoo', '', '', '', $time, '66.196.90.1', 'Yahoo! Slurp', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Alexa', '', '', '', $time, '66.28.250.,209.237.238.', 'ia_archiver', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
-$_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'NaverBot', '', '', '', $time, '218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
+$_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'NaverBot', '', '', '', $time, '222.122.194.,218.145.25.,61.78.61.,61.78.61.', 'NaverBot-', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
 $_CLASS['core_db']->query('INSERT INTO '.$user_prefix."users (user_type, user_status, user_group, username, user_password, user_password_encoding, user_email, user_reg_date, user_ip, user_agent, user_colour, user_allow_viewonline, user_allow_viewemail, user_allow_massemail, user_allow_pm, user_allow_email, user_data, user_new_privmsg, user_unread_privmsg, user_posts) VALUES (2, 2, 5, 'Jetbot', '', '', '', $time, '64.71.144.', 'Jetbot/', '9E8DA7', 1, 0, 0, 0, 0, '$bot_data', 0, 0, 0)");
 
 // Forums

Modified: cms/trunk/install/build_tables.php
===================================================================
--- cms/trunk/install/build_tables.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/install/build_tables.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -162,7 +162,7 @@
 $_CLASS['core_db']->add_table_field_int('module_id', array('max' => 16000000, 'auto_increment' => true));
 $_CLASS['core_db']->add_table_field_char('module_name', 100);
 $_CLASS['core_db']->add_table_field_char('module_title', 100, true);
-$_CLASS['core_db']->add_table_field_char('module_subs', 100, true);
+$_CLASS['core_db']->add_table_field_text('module_subs', 200, true);
 $_CLASS['core_db']->add_table_field_char('module_location', 200, true);
 //$_CLASS['core_db']->add_table_field_int('module_type', array('max' => 10));
 $_CLASS['core_db']->add_table_field_int('module_status', array('max' => 10));

Modified: cms/trunk/javascript/editor.js
===================================================================
--- cms/trunk/javascript/editor.js	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/javascript/editor.js	2006-07-24 01:47:19 UTC (rev 175)
@@ -103,13 +103,13 @@
 	document.forms[form_name].elements[text_name].focus();
 }
 
-function addquote(post_id, username) {
-
+function addquote(post_id, username)
+{
 	var message_name = 'message_' + post_id;
 	var theSelection = '';
 
 	var divarea = document.getElementById(message_name);
-	
+
 	// Get text selection - not only the post content :(
 	if (window.getSelection)
 	{

Added: cms/trunk/javascript/message.js
===================================================================
--- cms/trunk/javascript/message.js	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/javascript/message.js	2006-07-24 01:47:19 UTC (rev 175)
@@ -0,0 +1,55 @@
+// Message Code by Ryan Marshall ( viperal1 at gmail.com )
+
+var system_message_array = new Array();
+
+function system_message_hide(identifier)
+{
+	var message = document.getElementById(identifier);
+	message.style.display = 'none';	
+	
+	window.clearInterval(system_message_array[identifier]);
+}
+
+function system_message_show(identifier)
+{
+	var message = document.getElementById(identifier);
+	var message_table = document.getElementById(identifier + '_table');
+
+	message.style.display = '';	
+	message.style.left = (document.body.clientWidth - message_table.offsetWidth - 5) + 'px';
+
+	window.clearInterval(system_message_array[identifier]);
+	system_message_array[identifier] = window.setInterval("system_message_hide('" + identifier + "')", 3000);
+}
+
+function system_message_init(identifier, message_text)
+{
+	var message = document.getElementById(identifier);
+
+	if (!message)
+	{
+		var message = document.createElement('div');
+	}
+	
+	message.id = identifier;
+	message.style.position	= (is_gecko) ? 'fixed' : 'absolute';
+	message.style.top = '5px';
+	message.style.left = '5px';
+	message.style.zIndex = 1;
+	message.style.width = '100%';
+	message.style.display = 'none';	
+
+	message.onclick = function()
+	{
+		system_message_hide(identifier);
+	}
+
+	message.innerHTML = '<table id="' + identifier + '_table" class="tablebg" border="0" cellpadding="4" cellspacing="1" >' +
+	'<tbody><tr><td class="row2" align="center"><font class="error"><b>System Message</b></font></td></tr>' +
+	'<tr><td class="row1" align="center">'+ message_text + '</td></tr></tbody></table>';
+
+	message.style.cursor = 'pointer';
+	document.body.insertBefore(message, document.nextSibling);
+
+	system_message_array[identifier] = window.setInterval("system_message_show('" + identifier + "')", 500);
+}
\ No newline at end of file

Modified: cms/trunk/javascript/quick_messages.js
===================================================================
--- cms/trunk/javascript/quick_messages.js	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/javascript/quick_messages.js	2006-07-24 01:47:19 UTC (rev 175)
@@ -27,7 +27,8 @@
 
 	poster_name = (poster_name) ? 'poster_name=' + poster_name.value : '';
 
-	ajax.send('ajax.php?mod=Quick_Message&mode=ajax_add', poster_name + '&message=' + message.value);
+	ajax.send('ajax.php?mod=quick_message&mode=ajax_add', poster_name + '&message=' + message.value);
+	system_message_init('quickmessage', 'Quick Message Posted');
 
 	return false;
 }
@@ -47,5 +48,7 @@
 
 	ajax.onreadystatechange(onreadystatechange);
 
-	ajax.send('ajax.php?mod=Quick_Message&mode=ajax_refresh', null);
+	ajax.send('ajax.php?mod=quick_message&mode=ajax_refresh', null);
+
+	system_message_init('quickmessage', 'Quick Message Refresh Complete');
 }
\ No newline at end of file

Modified: cms/trunk/modules/articles/admin/index.php
===================================================================
--- cms/trunk/modules/articles/admin/index.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/articles/admin/index.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -27,9 +27,12 @@
 
 if (!defined('ARTICLES_TABLE'))
 {
+	global $table_prefix;
 	define('ARTICLES_TABLE', $table_prefix.'articles');
 }
 
+global $_CLASS;
+
 if (isset($_REQUEST['mode']))
 {
 	if ($id = get_variable('id', 'GET', false, 'int'))

Modified: cms/trunk/modules/articles/configurator.php
===================================================================
--- cms/trunk/modules/articles/configurator.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/articles/configurator.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -36,7 +36,8 @@
 class articles_configurator
 {
 	var $error = array();
-	
+	var $admin = true;
+
 	function install()
 	{
 		global $_CLASS;

Modified: cms/trunk/modules/control_panel/index.php
===================================================================
--- cms/trunk/modules/control_panel/index.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/index.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -87,6 +87,7 @@
 			$selected = ($row['module_name'] === $this->module);
 		
 			$module_lang = 'UCP_' . $row['module_title'];
+
 			$_CLASS['core_template']->assign_vars_array('ucp_section', array(
 				'L_TITLE'		=> isset($_CLASS['core_user']->lang[$module_lang]) ? $_CLASS['core_user']->lang[$module_lang] : mb_convert_case(str_replace('_', ' ',  ($row['module_name'])), MB_CASE_TITLE),
 				'S_SELECTED'	=> $selected, 
@@ -106,7 +107,9 @@
 		
 				foreach ($sub_modules as $sub_module)
 				{
-					if (!trim($sub_module))
+					$sub_module = trim($sub_module);
+				
+					if (!$sub_module)
 					{
 						continue;
 					}
@@ -114,9 +117,9 @@
 					$selected = ($this->mode && $sub_module === $this->mode) ? true : false;
 		
 					$module_lang = strtoupper('UCP_' . $row['module_name'] . '_' . $sub_module);
-		
+
 					$_CLASS['core_template']->assign_vars_array("ucp_subsection", array(
-						'L_TITLE'		=> (isset($_CLASS['core_user']->lang[$module_lang])) ? $_CLASS['core_user']->lang[$module_lang] : $module_lang,
+						'L_TITLE'		=> isset($_CLASS['core_user']->lang[$module_lang]) ? $_CLASS['core_user']->lang[$module_lang] : $module_lang,
 						'S_SELECTED'	=> $selected, 
 						'U_TITLE'		=> generate_link('control_panel&amp;i=' . $row['module_name'] . '&amp;mode=' . $sub_module)
 					));
@@ -153,7 +156,6 @@
 	{
 		global $_CLASS, $_CORE_CONFIG;
 
-		$_CLASS['core_user']->user_setup();
 		
 		/* Assign some basic template varibles */
 		$_CLASS['core_template']->assign_array(array(
@@ -164,7 +166,8 @@
 			'friends_online'		=> false,
 			'friends_offline' 		=> false,
 		));
-		
+
+		$_CLASS['core_user']->user_setup();
 		$_CLASS['core_user']->add_lang();
 
 		if (!$this->module && $this->mode)

Modified: cms/trunk/modules/control_panel/language/en/index.php
===================================================================
--- cms/trunk/modules/control_panel/language/en/index.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/language/en/index.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -285,8 +285,8 @@
 	'REPORT_PM'					=> 'Report PM',
 	'REPORT_PM_NOTIFY'			=> 'Send report notifications as PM',
 	'REPORT_PM_NOTIFY_EXPLAIN'	=> 'If enabled, notifications and status updates to new reports get send as PM instead of emailing them.',
-	'RETURN_FOLDER'				=> 'Click %1$sHere%2$s to return to folder',
-	'RETURN_UCP'				=> 'Click %sHere%s to return to the User Control Panel',
+	'RETURN_FOLDER'				=> '%1$sClick Here%2$s to return to folder',
+	'RETURN_UCP'				=> '%1$sClick Here%2$s to return to the User Control Panel',
 	'RULE_ADDED'				=> 'Rule successfully added',
 	'RULE_ALREADY_DEFINED'		=> 'This rule was defined previously',
 	'RULE_DELETED'				=> 'Rule successfully removed',
@@ -318,7 +318,7 @@
 	'UCP_AIM'					=> 'AOL Instant Messenger',
 	'UCP_ATTACHMENTS'			=> 'Attachments',
 	'UCP_CALENDER_DAY_VIEW'		=> 'Day Details',
-	'UCP_CALENDER_MANAGE'		=> 'Manage',
+	'UCP_CALENDER_ADD_EVENT'	=> 'Add Event',
 	'UCP_CALENDER_MONTH_VIEW'	=> 'Month View',
 	'UCP_COPPA_BEFORE'			=> 'Before %s',
 	'UCP_COPPA_ON_AFTER'		=> 'On or After %s',

Modified: cms/trunk/modules/control_panel/modules/ucp_calender.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_calender.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_calender.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -21,186 +21,181 @@
 $Id$
 */
 
-class ucp_calender extends module  
-{
-	var $error = array();
 
-	function ucp_calender($id, $mode)
-	{
-		global $_CLASS, $table_prefix, $site_file_root;
+$error = array();
 
-		if (!defined('CALENDER_TABLE'))
-		{
-			define('CALENDER_TABLE', $table_prefix.'calender');
-		}
+global $_CLASS, $table_prefix, $site_file_root;
 
-		$link = 'Control_Panel&amp;i='.$id;
-		
-		$day = get_variable('day', 'REQUEST', false, 'integer');
-		$month = get_variable('month', 'REQUEST', false, 'integer');
-		$year = get_variable('year', 'REQUEST', false, 'integer');
-		
-		load_class($site_file_root.'includes/display/calender.php', 'calender');
-		$_CLASS['calender']->table = CALENDER_TABLE;
-		$_CLASS['calender']->set_date($day, $month, $year);
-		
-		if (isset($_GET['mode']) && $_GET['mode'] === 'details')
-		{
-			$mode = 'details';
-		}
-		
-		switch ($mode)
-		{
-			case 'day_view':
-				$_CLASS['calender']->month_view($link);
-				$_CLASS['calender']->get_events_day($link);
+if (!defined('CALENDER_TABLE'))
+{
+	define('CALENDER_TABLE', $table_prefix.'calender');
+}
 
-				$day_flanks = $_CLASS['calender']->flank_days();
-				$month_flanks = $_CLASS['calender']->flank_months();
+$link = 'Control_Panel&amp;i='.$id;
 
-				$previous_day = generate_link($link.'&amp;mode=day_view&amp;year='.$day_flanks['previous_day']['year'].'&amp;month='.$day_flanks['previous_day']['month'].'&amp;day='.$day_flanks['previous_day']['day']);
-				$next_day = generate_link($link.'&amp;mode=day_view&amp;year='.$day_flanks['next_day']['year'].'&amp;month='.$day_flanks['next_day']['month'].'&amp;day='.$day_flanks['next_day']['day']);
-				$previous_month = generate_link($link.'&amp;mode=day_view&amp;year='.$month_flanks['previous_month']['year'].'&amp;month='.$month_flanks['previous_month']['month']);
-				$next_month = generate_link($link.'&amp;mode=day_view&amp;year='.$month_flanks['next_month']['year'].'&amp;month='.$month_flanks['next_month']['month']);
-				
-				$_CLASS['core_template']->assign_array(array(
-					'L_SUNDAY'				=> $_CLASS['core_user']->lang['datetime']['Sun'],
-					'L_MONDAY'				=> $_CLASS['core_user']->lang['datetime']['Mon'],
-					'L_TUESDAY'				=> $_CLASS['core_user']->lang['datetime']['Tue'],
-					'L_WEDNESDAY'			=> $_CLASS['core_user']->lang['datetime']['Wed'],
-					'L_THURSDAY'			=> $_CLASS['core_user']->lang['datetime']['Thu'],
-					'L_FRIDAY'				=> $_CLASS['core_user']->lang['datetime']['Fri'],
-					'L_SATURDAY'			=> $_CLASS['core_user']->lang['datetime']['Sat'],
-					'L_TODAY'				=> $_CLASS['core_user']->lang['datetime']['TODAY'],
-					'THIS_DAY'				=> date('F j, Y', mktime(0, 0, 0, $_CLASS['calender']->month, $_CLASS['calender']->day, $_CLASS['calender']->year)),
-					'PREVIOUS_DAY_LINK'		=> $previous_day,
-					'NEXT_DAY_LINK'			=> $next_day,
-				));
+$day = get_variable('day', 'REQUEST', false, 'integer');
+$month = get_variable('month', 'REQUEST', false, 'integer');
+$year = get_variable('year', 'REQUEST', false, 'integer');
 
-				$this->display($_CLASS['core_user']->lang['UCP_MAIN'], 'ucp_calender_day.html');
-			break;
-				
-			case 'add_event':
-				if (isset($_POST['submit']))
-				{
-					if ($this->add_event() !== false)
-					{
-						trigger_error('EVENT_ADDED');
-					}			
-				}
+load_class($site_file_root.'includes/display/calender.php', 'calender');
+$_CLASS['calender']->table = CALENDER_TABLE;
+$_CLASS['calender']->set_date($day, $month, $year);
 
-				$_CLASS['core_template']->assign_array(array(
-					'ERROR'			=> empty($this->error) ? '' : implode('<br/>', $this->error),
-					'S_UCP_ACTION'	=> generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"),
-				));
+if (isset($_GET['mode']) && $_GET['mode'] === 'details')
+{
+	$mode = 'details';
+}
 
-				$this->display($_CLASS['core_user']->lang['UCP_MAIN'], 'ucp_calender_add.html');
-			break;
-				
-			case 'details':
-			
-				$id = get_variable('id', 'GET', false, 'integer');
-				$data = false;
-				$data = $_CLASS['calender']->get_events_details($id);
-				
-				$_CLASS['core_template']->assign_array(array(
-					'CAL_TITLE'			=> $data['calender_title'],
-					'CAL_DESCRIPTION'	=> $data['calender_text'],
-					'CAL_START_TIME'	=> $_CLASS['core_user']->format_date($data['start_time']),
-					'CAL_END_TIME'		=> $_CLASS['core_user']->format_date($data['end_time']),
-				));
-			
-				$_CLASS['core_display']->display(false, 'modules/Control_Panel/ucp_calender_details.html');
-			break;
-			
-			//case 'month_view':
-			default:
-				$_CLASS['calender']->get_events_month($link);
-				$_CLASS['calender']->month_view($link);
+switch ($mode)
+{
+	case 'day_view':
+		$_CLASS['calender']->month_view($link);
+		$_CLASS['calender']->get_events_day($link);
 
-				$month_flanks = $_CLASS['calender']->flank_months();
+		$day_flanks = $_CLASS['calender']->flank_days();
+		$month_flanks = $_CLASS['calender']->flank_months();
 
-				$_CLASS['core_template']->assign_array(array(
-					'L_SUNDAY'				=> $_CLASS['core_user']->lang['datetime']['Sunday'],
-					'L_MONDAY'				=> $_CLASS['core_user']->lang['datetime']['Monday'],
-					'L_TUESDAY'				=> $_CLASS['core_user']->lang['datetime']['Tuesday'],
-					'L_WEDNESDAY'			=> $_CLASS['core_user']->lang['datetime']['Wednesday'],
-					'L_THURSDAY'			=> $_CLASS['core_user']->lang['datetime']['Thursday'],
-					'L_FRIDAY'				=> $_CLASS['core_user']->lang['datetime']['Friday'],
-					'L_SATURDAY'			=> $_CLASS['core_user']->lang['datetime']['Saturday'],
-					'L_TODAY'				=> $_CLASS['core_user']->lang['datetime']['TODAY'],
-					
-					'THIS_MONTH_NAME'		=> $_CLASS['core_user']->lang['datetime'][date('F', mktime(0, 0, 0, $_CLASS['calender']->month, 1, $_CLASS['calender']->year))],
-					'NEXT_MONTH_NAME'		=> $_CLASS['core_user']->lang['datetime'][date('F', mktime(0, 0, 0, $month_flanks['next_month']['month'], 1, $_CLASS['calender']->year))],
-					'PREVIOUS_MONTH_NAME'	=> $_CLASS['core_user']->lang['datetime'][date('F', mktime(0, 0, 0, $month_flanks['previous_month']['month'], 1, $_CLASS['calender']->year))],
-					'NEXT_MONTH_YEAR'		=> $month_flanks['next_month']['year'],
-					'PREVIOUS_MONTH_YEAR'	=> $month_flanks['previous_month']['year'],
-					'CURRENT_YEAR'			=> $_CLASS['calender']->year,
-					'PREVIOUS_MONTH'		=> generate_link($link.'&amp;mode=month_view&amp;year='.$month_flanks['previous_month']['year'].'&amp;month='.$month_flanks['previous_month']['month']),
-					'NEXT_MONTH'			=> generate_link($link.'&amp;mode=month_view&amp;year='.$month_flanks['next_month']['year'].'&amp;month='.$month_flanks['next_month']['month']),
-				));
+		$previous_day = generate_link($link.'&amp;mode=day_view&amp;year='.$day_flanks['previous_day']['year'].'&amp;month='.$day_flanks['previous_day']['month'].'&amp;day='.$day_flanks['previous_day']['day']);
+		$next_day = generate_link($link.'&amp;mode=day_view&amp;year='.$day_flanks['next_day']['year'].'&amp;month='.$day_flanks['next_day']['month'].'&amp;day='.$day_flanks['next_day']['day']);
+		$previous_month = generate_link($link.'&amp;mode=day_view&amp;year='.$month_flanks['previous_month']['year'].'&amp;month='.$month_flanks['previous_month']['month']);
+		$next_month = generate_link($link.'&amp;mode=day_view&amp;year='.$month_flanks['next_month']['year'].'&amp;month='.$month_flanks['next_month']['month']);
+		
+		$_CLASS['core_template']->assign_array(array(
+			'L_SUNDAY'				=> $_CLASS['core_user']->lang['datetime']['Sun'],
+			'L_MONDAY'				=> $_CLASS['core_user']->lang['datetime']['Mon'],
+			'L_TUESDAY'				=> $_CLASS['core_user']->lang['datetime']['Tue'],
+			'L_WEDNESDAY'			=> $_CLASS['core_user']->lang['datetime']['Wed'],
+			'L_THURSDAY'			=> $_CLASS['core_user']->lang['datetime']['Thu'],
+			'L_FRIDAY'				=> $_CLASS['core_user']->lang['datetime']['Fri'],
+			'L_SATURDAY'			=> $_CLASS['core_user']->lang['datetime']['Sat'],
+			'L_TODAY'				=> $_CLASS['core_user']->lang['datetime']['TODAY'],
+			'THIS_DAY'				=> date('F j, Y', mktime(0, 0, 0, $_CLASS['calender']->month, $_CLASS['calender']->day, $_CLASS['calender']->year)),
+			'PREVIOUS_DAY_LINK'		=> $previous_day,
+			'NEXT_DAY_LINK'			=> $next_day,
+		));
 
-				$this->display($_CLASS['core_user']->lang['UCP_MAIN'], 'ucp_calender_main.html');
-			break;	
-		}
-	}
-
-	function add_event()
-	{
-		global $_CLASS;
-
-		$data_array = array(
-			'calender_title'	=> mb_strtolower(htmlentities(get_variable('title', 'POST', ''), ENT_QUOTES, 'UTF-8')),
-			'calender_text'		=> strip_tags(get_variable('description', 'POST', false)),
-			'calender_notes'	=> strip_tags(get_variable('note', 'POST', false)),
-			'calender_starts'	=> get_variable('start', 'POST', false),
-			'calender_expires'	=> get_variable('end', 'POST', false),
-			//'recur'			=> false,
-		);
-
-		$this->error = array();
-
-		if (empty($data_array['calender_title']))
+		$_CLASS['core_display']->display(false, 'modules/control_panel/ucp_calender_day.html');
+	break;
+		
+	case 'add_event':
+		if (isset($_POST['submit']))
 		{
-			$this->error[] = $_CLASS['core_user']->get_lang('NO_TITLE');
+			if ($this->add_event() !== false)
+			{
+				trigger_error('EVENT_ADDED');
+			}			
 		}
 
-		$start_time = strtotime($data_array['calender_starts']);
+		$_CLASS['core_template']->assign_array(array(
+			'ERROR'			=> empty($error) ? '' : implode('<br/>', $error),
+			'S_UCP_ACTION'	=> generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"),
+		));
 
-		if (!$start_time || $start_time === -1)
-		{
-			$this->error[] = $_CLASS['core_user']->get_lang('ERROR_START_TIME');
-		}
-
-		$end_time = strtotime($data_array['calender_expires']);
-
-		if (!$end_time || $end_time === -1)
-		{
-			$this->error[] = $_CLASS['core_user']->get_lang('ERROR_END_TIME');
-		}
+		$this->display($_CLASS['core_user']->lang['UCP_MAIN'], 'ucp_calender_add.html');
+	break;
 		
-		if (empty($this->error) && $start_time > $end_time)
-		{
-			$this->error[] = $_CLASS['core_user']->get_lang('ERROR_');
-		}
+	case 'details':
+	
+		$id = get_variable('id', 'GET', false, 'integer');
+		$data = false;
+		$data = $_CLASS['calender']->get_events_details($id);
+		
+		$_CLASS['core_template']->assign_array(array(
+			'CAL_TITLE'			=> $data['calender_title'],
+			'CAL_DESCRIPTION'	=> $data['calender_text'],
+			'CAL_START_TIME'	=> $_CLASS['core_user']->format_date($data['start_time']),
+			'CAL_END_TIME'		=> $_CLASS['core_user']->format_date($data['end_time']),
+		));
+	
+		$_CLASS['core_display']->display(false, 'modules/Control_Panel/ucp_calender_details.html');
+	break;
+	
+	//case 'month_view':
+	default:
+		$_CLASS['calender']->get_events_month($link);
+		$_CLASS['calender']->month_view($link);
 
-		if (!empty($this->error))
-		{
-			return false;
-		}
+		$month_flanks = $_CLASS['calender']->flank_months();
 
-		//$duration = $start_time - $end_time;
-		//$start_time = $date = implode(''. explode(':', date('H:i', $start_time)));;
+		$_CLASS['core_template']->assign_array(array(
+			'L_SUNDAY'				=> $_CLASS['core_user']->lang['datetime']['Sunday'],
+			'L_MONDAY'				=> $_CLASS['core_user']->lang['datetime']['Monday'],
+			'L_TUESDAY'				=> $_CLASS['core_user']->lang['datetime']['Tuesday'],
+			'L_WEDNESDAY'			=> $_CLASS['core_user']->lang['datetime']['Wednesday'],
+			'L_THURSDAY'			=> $_CLASS['core_user']->lang['datetime']['Thursday'],
+			'L_FRIDAY'				=> $_CLASS['core_user']->lang['datetime']['Friday'],
+			'L_SATURDAY'			=> $_CLASS['core_user']->lang['datetime']['Saturday'],
+			'L_TODAY'				=> $_CLASS['core_user']->lang['datetime']['TODAY'],
+			
+			'THIS_MONTH_NAME'		=> $_CLASS['core_user']->lang['datetime'][date('F', mktime(0, 0, 0, $_CLASS['calender']->month, 1, $_CLASS['calender']->year))],
+			'NEXT_MONTH_NAME'		=> $_CLASS['core_user']->lang['datetime'][date('F', mktime(0, 0, 0, $month_flanks['next_month']['month'], 1, $_CLASS['calender']->year))],
+			'PREVIOUS_MONTH_NAME'	=> $_CLASS['core_user']->lang['datetime'][date('F', mktime(0, 0, 0, $month_flanks['previous_month']['month'], 1, $_CLASS['calender']->year))],
+			'NEXT_MONTH_YEAR'		=> $month_flanks['next_month']['year'],
+			'PREVIOUS_MONTH_YEAR'	=> $month_flanks['previous_month']['year'],
+			'CURRENT_YEAR'			=> $_CLASS['calender']->year,
+			'PREVIOUS_MONTH'		=> generate_link($link.'&amp;mode=month_view&amp;year='.$month_flanks['previous_month']['year'].'&amp;month='.$month_flanks['previous_month']['month']),
+			'NEXT_MONTH'			=> generate_link($link.'&amp;mode=month_view&amp;year='.$month_flanks['next_month']['year'].'&amp;month='.$month_flanks['next_month']['month']),
+		));
 
-		$data_array['calender_starts'] = $_CLASS['core_user']->time_convert($start_time, 'gmt');
-		$data_array['calender_expires'] = $_CLASS['core_user']->time_convert($end_time, 'gmt');
-		
-		$_CLASS['core_db']->query('INSERT INTO ' . CALENDER_TABLE .' ' . $_CLASS['core_db']->sql_build_array('INSERT', $data_array));
+		$_CLASS['core_display']->display(false, 'modules/control_panel/ucp_calender_main.html');
+	break;	
+}
 
-		$data_array['calender_id'] = $_CLASS['core_db']->insert_id(CALENDER_TABLE, 'calender_id');
-
-		return $data_array;
+function add_event()
+{
+	global $_CLASS;
+	
+	$data_array = array(
+		'calender_title'	=> mb_strtolower(htmlentities(get_variable('title', 'POST', ''), ENT_QUOTES, 'UTF-8')),
+		'calender_text'		=> strip_tags(get_variable('description', 'POST', false)),
+		'calender_notes'	=> strip_tags(get_variable('note', 'POST', false)),
+		'calender_starts'	=> get_variable('start', 'POST', false),
+		'calender_expires'	=> get_variable('end', 'POST', false),
+		//'recur'			=> false,
+	);
+	
+	$error = array();
+	
+	if (empty($data_array['calender_title']))
+	{
+		$error[] = $_CLASS['core_user']->get_lang('NO_TITLE');
 	}
+	
+	$start_time = strtotime($data_array['calender_starts']);
+	
+	if (!$start_time || $start_time === -1)
+	{
+		$error[] = $_CLASS['core_user']->get_lang('ERROR_START_TIME');
+	}
+	
+	$end_time = strtotime($data_array['calender_expires']);
+	
+	if (!$end_time || $end_time === -1)
+	{
+		$error[] = $_CLASS['core_user']->get_lang('ERROR_END_TIME');
+	}
+	
+	if (empty($error) && $start_time > $end_time)
+	{
+		$error[] = $_CLASS['core_user']->get_lang('ERROR_');
+	}
+	
+	if (!empty($error))
+	{
+		return false;
+	}
+	
+	//$duration = $start_time - $end_time;
+	//$start_time = $date = implode(''. explode(':', date('H:i', $start_time)));;
+	
+	$data_array['calender_starts'] = $_CLASS['core_user']->time_convert($start_time, 'gmt');
+	$data_array['calender_expires'] = $_CLASS['core_user']->time_convert($end_time, 'gmt');
+	
+	$_CLASS['core_db']->query('INSERT INTO ' . CALENDER_TABLE .' ' . $_CLASS['core_db']->sql_build_array('INSERT', $data_array));
+	
+	$data_array['calender_id'] = $_CLASS['core_db']->insert_id(CALENDER_TABLE, 'calender_id');
+	
+	return $data_array;
 }
 
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/control_panel/modules/ucp_pm.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_pm.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -85,8 +85,11 @@
 	$mode = (!$mode) ? get_variable('mode', 'REQUEST', 'view_messages') : $mode;
 }
 
-require(SITE_FILE_ROOT.'includes/forums/functions_privmsgs.php');
+$id = 'pm';
 
+require_once SITE_FILE_ROOT.'includes/forums/functions.php';
+require_once SITE_FILE_ROOT.'includes/forums/functions_privmsgs.php';
+
 $_CLASS['core_template']->assign_array(array( 
 	'L_TITLE'			=> $_CLASS['core_user']->lang['UCP_PM_' . strtoupper($mode)],
 	'S_UCP_ACTION'      => generate_link($this->link . ((isset($action)) ? "&amp;action=$action" : '')))
@@ -132,14 +135,15 @@
 	break;
 	
 	case 'options':
-		$sql = 'SELECT group_message_limit
-			FROM ' . GROUPS_TABLE . '
+		/*$sql = 'SELECT group_message_limit
+			FROM ' . CORE_GROUPS_TABLE . '
 			WHERE group_id = ' . $_CLASS['core_user']->data['user_group'];
 		$result = $_CLASS['core_db']->query($sql);
 
 		list($message_limit) = $_CLASS['core_db']->fetch_row_num($result);
-
 		$_CLASS['core_db']->free_result($result);
+*/
+		$message_limit = 10;
 		
 		(int) $_CLASS['core_user']->data['user_message_limit'] = (!$message_limit) ? $config['pm_max_msgs'] : $message_limit;
 		
@@ -291,7 +295,7 @@
 			}
 
 			$sql = 'SELECT t.*, p.*, u.*
-				FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . ' u
+				FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u
 				WHERE t.user_id = ' . $_CLASS['core_user']->data['user_id'] . "
 					AND p.author_id = u.user_id
 					AND t.folder_id = $folder_id
@@ -392,6 +396,7 @@
 	break;
 }
 
+/*
 function obtain_icons()
 {
 	global $_CLASS;
@@ -419,8 +424,9 @@
 	}
 
 	return $icons;
-}
+}*/
 
+/*
 function gen_sort_selects(&$limit_days, &$sort_by_text, &$sort_days, &$sort_key, &$sort_dir, &$s_limit_days, &$s_sort_key, &$s_sort_dir, &$u_sort_param)
 {
 	global $_CLASS;
@@ -454,6 +460,6 @@
 	$u_sort_param = "st=$sort_days&amp;sk=$sort_key&amp;sd=$sort_dir";
 
 	return;
-}
+}*/
 
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/control_panel/modules/ucp_pm_compose.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm_compose.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_pm_compose.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -13,6 +13,10 @@
 
 // * Called from ucp_pm with mode == 'compose'
 
+
+load_class(SITE_FILE_ROOT.'includes/forums/auth.php', 'forums_auth');
+$_CLASS['forums_auth']->acl($_CLASS['core_user']->data);
+
 function compose_pm($id, $mode, $action)
 {
 	global $_CLASS, $config;
@@ -39,12 +43,12 @@
 	));
 
 	// Grab only parameters needed here
-	$to_user_id     = request_var('u', 0);
-  	$to_group_id    = request_var('g', 0);
-	$msg_id			= request_var('p', 0);
-	$quote_post		= request_var('q', 0);
-	$draft_id		= request_var('d', 0);
-	$lastclick		= request_var('lastclick', 0);
+	$to_user_id     = get_variable('u', 'REQUEST', 0);
+  	$to_group_id    = get_variable('g', 'REQUEST', 0);
+	$msg_id			= get_variable('p', 'REQUEST', 0);
+	$quote_post		= get_variable('q', 'REQUEST', 0);
+	$draft_id		= get_variable('d', 'REQUEST', 0);
+	$lastclick		= get_variable('lastclick', 'REQUEST', 0);
 	$message_text = $subject = '';
 
 	// Do NOT use request_var or specialchars here
@@ -78,7 +82,7 @@
 		redirect($redirect);
 	}
 
-	if ($action == 'edit' && !$_CLASS['auth']->acl_get('u_pm_edit'))
+	if ($action == 'edit' && !$_CLASS['forums_auth']->acl_get('u_pm_edit'))
 	{
 		trigger_error('NO_AUTH_EDIT_MESSAGE');
 	}
@@ -91,7 +95,7 @@
 	{
 		case 'post':
 		
-			if (!$_CLASS['auth']->acl_get('u_sendpm'))
+			if (!$_CLASS['forums_auth']->acl_get('u_sendpm'))
 			{
 				trigger_error('NO_AUTH_SEND_MESSAGE');
 			}
@@ -105,7 +109,7 @@
 				trigger_error('NO_MESSAGE');
 			}
 
-			if (!$_CLASS['auth']->acl_get('u_sendpm'))
+			if (!$_CLASS['forums_auth']->acl_get('u_sendpm'))
 			{
 				trigger_error('NO_AUTH_SEND_MESSAGE');
 			}
@@ -113,7 +117,7 @@
 			if ($quote_post)
 			{
 				$sql = 'SELECT p.post_text as message_text, p.poster_id as author_id, p.post_time as message_time, p.bbcode_bitfield, p.bbcode_uid, p.enable_sig, p.enable_html, p.enable_smilies, p.enable_magic_url, t.topic_title as message_subject, u.username as quote_username
-					FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_TOPICS_TABLE . ' t, ' . USERS_TABLE . " u
+					FROM ' . FORUMS_POSTS_TABLE . ' p, ' . FORUMS_TOPICS_TABLE . ' t, ' . CORE_USERS_TABLE . " u
 					WHERE p.post_id = $msg_id
 						AND t.topic_id = p.topic_id
 						AND u.user_id = p.poster_id";
@@ -121,7 +125,7 @@
 			else
 			{
 				$sql = 'SELECT t.*, p.*, u.username as quote_username
-					FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . USERS_TABLE . ' u
+					FROM ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u
 					WHERE t.user_id = ' . $_CLASS['core_user']->data['user_id'] . "
 						AND p.author_id = u.user_id
 						AND t.msg_id = p.msg_id
@@ -145,7 +149,7 @@
 		break;
 
 		case 'delete':
-			if (!$_CLASS['auth']->acl_get('u_pm_delete'))
+			if (!$_CLASS['forums_auth']->acl_get('u_pm_delete'))
 			{
 				trigger_error('NO_AUTH_DELETE_MESSAGE');
 			}
@@ -307,16 +311,16 @@
 	
 	if (!in_array($action, array('quote', 'edit', 'delete', 'forward')))
 	{
-		$enable_sig		= ($config['allow_sig'] && $_CLASS['auth']->acl_get('u_sig') && $_CLASS['core_user']->optionget('attachsig'));
-		$enable_smilies = ($config['allow_smilies'] && $_CLASS['auth']->acl_get('u_pm_smilies') && $_CLASS['core_user']->optionget('smilies'));
-		$enable_bbcode	= ($config['allow_bbcode'] && $_CLASS['auth']->acl_get('u_pm_bbcode') && $_CLASS['core_user']->optionget('bbcode'));
+		$enable_sig		= ($config['allow_sig'] && $_CLASS['forums_auth']->acl_get('u_sig') && $_CLASS['core_user']->user_data_get('attachsig'));
+		$enable_smilies = ($config['allow_smilies'] && $_CLASS['forums_auth']->acl_get('u_pm_smilies') && $_CLASS['core_user']->user_data_get('smilies'));
+		$enable_bbcode	= ($config['allow_bbcode'] && $_CLASS['forums_auth']->acl_get('u_pm_bbcode') && $_CLASS['core_user']->user_data_get('bbcode'));
 		$enable_urls	= true;
 	}
 
 	$enable_magic_url = $drafts = false;
 
 	// User own some drafts?
-	if ($_CLASS['auth']->acl_get('u_savedrafts') && $action != 'delete')
+	if ($_CLASS['forums_auth']->acl_get('u_savedrafts') && $action != 'delete')
 	{
 		$sql = 'SELECT draft_id
 			FROM ' . FORUMS_DRAFTS_TABLE . '
@@ -339,11 +343,11 @@
 
 $config['auth_bbcode_pm'] = true;
 /*
-	$html_status	= ($config['allow_html'] && $config['auth_html_pm'] && $_CLASS['auth']->acl_get('u_pm_html'));
-	$bbcode_status	= ($config['allow_bbcode'] && $config['auth_bbcode_pm'] && $_CLASS['auth']->acl_get('u_pm_bbcode'));
-	$smilies_status	= ($config['allow_smilies'] && $config['auth_smilies_pm'] && $_CLASS['auth']->acl_get('u_pm_smilies'));
-	$img_status		= ($config['auth_img_pm'] && $_CLASS['auth']->acl_get('u_pm_img'));
-	$flash_status	= ($config['auth_flash_pm'] && $_CLASS['auth']->acl_get('u_pm_flash'));
+	$html_status	= ($config['allow_html'] && $config['auth_html_pm'] && $_CLASS['forums_auth']->acl_get('u_pm_html'));
+	$bbcode_status	= ($config['allow_bbcode'] && $config['auth_bbcode_pm'] && $_CLASS['forums_auth']->acl_get('u_pm_bbcode'));
+	$smilies_status	= ($config['allow_smilies'] && $config['auth_smilies_pm'] && $_CLASS['forums_auth']->acl_get('u_pm_smilies'));
+	$img_status		= ($config['auth_img_pm'] && $_CLASS['forums_auth']->acl_get('u_pm_img'));
+	$flash_status	= ($config['auth_flash_pm'] && $_CLASS['forums_auth']->acl_get('u_pm_flash'));
 */
 	$html_status	= ($config['allow_html'] && $config['auth_html_pm']);
 	$bbcode_status	= ($config['allow_bbcode'] && $config['auth_bbcode_pm']);
@@ -352,7 +356,7 @@
 	$flash_status	= ($config['auth_flash_pm']);
 
 	// Save Draft
-	if ($save && $_CLASS['auth']->acl_get('u_savedrafts'))
+	if ($save && $_CLASS['forums_auth']->acl_get('u_savedrafts'))
 	{
 		$subject = request_var('subject', '', true);
 		$subject = (!$subject && $action != 'post') ? $_CLASS['core_user']->lang['NEW_MESSAGE'] : $subject;
@@ -381,7 +385,7 @@
 	}
 
 	// Load Draft
-	if ($draft_id && $_CLASS['auth']->acl_get('u_savedrafts'))
+	if ($draft_id && $_CLASS['forums_auth']->acl_get('u_savedrafts'))
 	{
 		$sql = 'SELECT draft_subject, draft_message 
 			FROM ' . FORUMS_DRAFTS_TABLE . " 
@@ -452,7 +456,7 @@
 			$message_parser->bbcode_bitfield = $bbcode_bitfield;
 		}
 
-		if ($action != 'edit' && !$preview && !$refresh && $config['flood_interval'] && !$_CLASS['auth']->acl_get('u_ignoreflood'))
+		if ($action != 'edit' && !$preview && !$refresh && $config['flood_interval'] && !$_CLASS['forums_auth']->acl_get('u_ignoreflood'))
 		{
 			// Flood check
 			$last_post_time = $_CLASS['core_user']->data['user_last_post_time'];
@@ -645,7 +649,7 @@
 		if (isset($address_list['u']) && !empty($address_list['u']))
 		{
 			$result['u'] = $_CLASS['core_db']->query('SELECT user_id as id, username as name, user_colour as colour 
-				FROM ' . USERS_TABLE . ' 
+				FROM ' . CORE_USERS_TABLE . ' 
 				WHERE user_id IN (' . implode(', ', array_map('intval', array_keys($address_list['u']))) . ')');
 		}
 		
@@ -709,9 +713,9 @@
 		}
 	}
 
-	$html_checked		= isset($enable_html) ? !$enable_html : (($config['allow_html']) ? !$_CLASS['core_user']->optionget('html') : 1);
-	$bbcode_checked		= isset($enable_bbcode) ? !$enable_bbcode : (($config['allow_bbcode']) ? !$_CLASS['core_user']->optionget('bbcode') : 1);
-	$smilies_checked	= isset($enable_smilies) ? !$enable_smilies : (($config['allow_smilies']) ? !$_CLASS['core_user']->optionget('smilies') : 1);
+	$html_checked		= isset($enable_html) ? !$enable_html : (($config['allow_html']) ? !$_CLASS['core_user']->user_data_get('html') : 1);
+	$bbcode_checked		= isset($enable_bbcode) ? !$enable_bbcode : (($config['allow_bbcode']) ? !$_CLASS['core_user']->user_data_get('bbcode') : 1);
+	$smilies_checked	= isset($enable_smilies) ? !$enable_smilies : (($config['allow_smilies']) ? !$_CLASS['core_user']->user_data_get('smilies') : 1);
 	$urls_checked		= isset($enable_urls) ? !$enable_urls : 0;
 	$sig_checked		= $enable_sig;
 
@@ -746,7 +750,7 @@
 	$s_hidden_fields .= (isset($check_value)) ? '<input type="hidden" name="status_switch" value="' . $check_value . '" />' : '';
 	$s_hidden_fields .= ($draft_id || isset($_REQUEST['draft_loaded'])) ? '<input type="hidden" name="draft_loaded" value="' . ((isset($_REQUEST['draft_loaded'])) ? intval($_REQUEST['draft_loaded']) : $draft_id) . '" />' : '';
 
-	$form_enctype = (@ini_get('file_uploads') == '0' || strtolower(@ini_get('file_uploads')) == 'off' || @ini_get('file_uploads') == '0' || !$config['allow_pm_attach'] || !$_CLASS['auth']->acl_get('u_pm_attach')) ? '' : ' enctype="multipart/form-data"';
+	$form_enctype = (@ini_get('file_uploads') == '0' || strtolower(@ini_get('file_uploads')) == 'off' || @ini_get('file_uploads') == '0' || !$config['allow_pm_attach'] || !$_CLASS['forums_auth']->acl_get('u_pm_attach')) ? '' : ' enctype="multipart/form-data"';
 
 	// Start assigning vars for main posting page ...
 	$_CLASS['core_template']->assign_array(array(
@@ -774,11 +778,11 @@
 		'S_BBCODE_CHECKED' 		=> ($bbcode_checked) ? ' checked="checked"' : '',
 		'S_SMILIES_ALLOWED'		=> $smilies_status,
 		'S_SMILIES_CHECKED' 	=> ($smilies_checked) ? ' checked="checked"' : '',
-		'S_SIG_ALLOWED'			=> ($config['allow_sig'] && $_CLASS['auth']->acl_get('u_sig')),
+		'S_SIG_ALLOWED'			=> ($config['allow_sig'] && $_CLASS['forums_auth']->acl_get('u_sig')),
 		'S_SIGNATURE_CHECKED' 	=> ($sig_checked) ? ' checked="checked"' : '',
 		'S_MAGIC_URL_CHECKED' 	=> ($urls_checked) ? ' checked="checked"' : '',
-		'S_SAVE_ALLOWED'		=> $_CLASS['auth']->acl_get('u_savedrafts'),
-		'S_HAS_DRAFTS'			=> ($_CLASS['auth']->acl_get('u_savedrafts') && $drafts),
+		'S_SAVE_ALLOWED'		=> $_CLASS['forums_auth']->acl_get('u_savedrafts'),
+		'S_HAS_DRAFTS'			=> ($_CLASS['forums_auth']->acl_get('u_savedrafts') && $drafts),
 		'S_FORM_ENCTYPE'		=> $form_enctype,
 		
 		'S_POST_ACTION' 		=> generate_link($s_action),
@@ -787,7 +791,7 @@
 	);
 
 	// Attachment entry
-	if ($_CLASS['auth']->acl_get('u_pm_attach') && $config['allow_pm_attach'] && $form_enctype)
+	if ($_CLASS['forums_auth']->acl_get('u_pm_attach') && $config['allow_pm_attach'] && $form_enctype)
 	{
 		posting_gen_attachment_entry($attachment_data, $filename_data);
 	}

Modified: cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_pm_viewfolder.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -209,7 +209,7 @@
 
 	if ($type !== 'folder')
 	{
-		$folder_sql = ($type === 'unread') ? 't.msg_unread = 1' : 't.msg_new = 1';
+		$folder_sql = ($type === 'unread') ? 't.unread = 1' : 't.msg_new = 1';
 		$folder_id = PRIVMSGS_INBOX;
 	}
 	else

Modified: cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_pm_viewmessage.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -10,9 +10,13 @@
 // LICENCE   : GPL vs2.0 [ see /docs/COPYING ] 
 // 
 // -------------------------------------------------------------
+
+load_class(SITE_FILE_ROOT.'includes/forums/auth.php', 'forums_auth');
+$_CLASS['forums_auth']->acl($_CLASS['core_user']->data);
 	
-function view_message($id, $mode, $folder_id, $msg_id, $folder, &$message_row)
+function view_message($parent_class, $folder_id, $msg_id, $folder, &$message_row)
 {
+	///$id, $mode
 	global $_CLASS, $_CORE_CONFIG, $config;
 
 	$_CLASS['core_user']->add_lang('viewtopic');
@@ -145,7 +149,7 @@
 		$_CLASS['core_db']->query($sql);
 	}
 
-	$signature = ($message_row['enable_sig'] && $config['allow_sig'] && $_CLASS['core_user']->optionget('viewsigs')) ? $user_info['user_sig'] : '';
+	$signature = ($message_row['enable_sig'] && $config['allow_sig'] && $_CLASS['core_user']->user_data_get('viewsigs')) ? $user_info['user_sig'] : '';
 	
 	// End signature parsing, only if needed
 	if ($signature)
@@ -165,7 +169,7 @@
 		$signature = str_replace("\n", '<br />', censor_text($signature));
 	}
 
-	$url = 'Control_Panel&amp;i='.$id;
+	$url = 'Control_Panel&amp;i=pm';
 
 	$_CLASS['core_template']->assign_array(array(
 		'AUTHOR_NAME'		=> ($user_info['user_colour']) ? '<span style="color:#' . $user_info['user_colour'] . '">' . $user_info['username'] . '</span>' : $user_info['username'],
@@ -196,7 +200,7 @@
 
 		'U_MCP_REPORT'		=> generate_link('Forums&amp;file=mcp&amp;mode=pm_details&amp;p=' . $message_row['msg_id']),
 		'U_REPORT'			=> (false) ? generate_link('Forums&amp;file=report&amp;pm=' . $message_row['msg_id']) : '',
-		'U_INFO'			=> ($_CLASS['auth']->acl_get('m_') && ($message_row['message_reported'] || $message_row['forwarded'])) ? generate_link('Forums&amp;file=mcp&amp;mode=pm_details&amp;p=' . $message_row['msg_id']) : '',
+		'U_INFO'			=> ($_CLASS['forums_auth']->acl_get('m_') && ($message_row['message_reported'] || $message_row['forwarded'])) ? generate_link('Forums&amp;file=mcp&amp;mode=pm_details&amp;p=' . $message_row['msg_id']) : '',
 		'U_DELETE' 			=> generate_link("$url&amp;mode=compose&amp;action=delete&amp;f=$folder_id&amp;p=" . $message_row['msg_id']),
 		'U_AUTHOR_PROFILE' 	=> generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $author_id),
 		'U_EMAIL' 			=> $user_info['email'],
@@ -206,7 +210,7 @@
 		'U_PREVIOUS_PM'		=> generate_link("$url&amp;f=$folder_id&amp;p=" . $message_row['msg_id'] . "&amp;view=previous"),
 		'U_NEXT_PM'			=> generate_link("$url&amp;f=$folder_id&amp;p=" . $message_row['msg_id'] . "&amp;view=next"),
 
-		'S_MESSAGE_REPORTED'=> ($message_row['message_reported'] && $_CLASS['auth']->acl_get('m_')) ? true : false,
+		'S_MESSAGE_REPORTED'=> ($message_row['message_reported'] && $_CLASS['forums_auth']->acl_get('m_')) ? true : false,
 		'S_DISPLAY_NOTICE'	=> $display_notice && $message_row['message_attachment'],
 
 		'U_PRINT_PM'		=> generate_link("$url&amp;f=$folder_id&amp;p=" . $message_row['msg_id'] . "&amp;view=print"),
@@ -231,7 +235,7 @@
 
 	// Get History Messages (could be newer)
 	$sql = 'SELECT t.*, p.*, u.*
-		FROM ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . USERS_TABLE . ' u
+		FROM ' . FORUMS_PRIVMSGS_TABLE . ' p, ' . FORUMS_PRIVMSGS_TO_TABLE . ' t, ' . CORE_USERS_TABLE . ' u
 		WHERE t.msg_id = p.msg_id 
 			AND p.author_id = u.user_id
 			AND t.folder_id <> ' . PRIVMSGS_NO_BOX . "
@@ -384,7 +388,7 @@
 	if ($config['load_onlinetrack'])
 	{
 		$sql = 'SELECT MAX(session_hidden) AS session_hidden
-			FROM ' . SESSIONS_TABLE . " 
+			FROM ' . CORE_SESSIONS_TABLE . " 
 			WHERE session_user_id = $user_id
 			AND session_time < " . ($_CLASS['core_user']->time - $_CORE_CONFIG['server']['session_length']);
 		$result = $_CLASS['core_db']->query_limit($sql, 1);
@@ -399,7 +403,7 @@
 		$_CLASS['core_db']->free_result($result);
 	}
 
-	if ($user_row['user_avatar'] && $_CLASS['core_user']->optionget('viewavatars'))
+	if ($user_row['user_avatar'] && $_CLASS['core_user']->user_data_get('viewavatars'))
 	{
 		$avatar_img = '';
 

Modified: cms/trunk/modules/control_panel/modules/ucp_prefs.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_prefs.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_prefs.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -33,368 +33,365 @@
 // 
 // -------------------------------------------------------------
 
-class ucp_prefs extends module 
-{
-	function ucp_prefs($id, $mode)
-	{
-		global $config, $_CLASS, $site_file_root, $_CORE_CONFIG;
 
-		$submit = (isset($_POST['submit'])) ? true : false;
-		$error = $data = array();
-		$s_hidden_fields = '';
+global $config, $_CLASS, $site_file_root, $_CORE_CONFIG;
 
-		switch($mode)
-		{
-			case 'personal':
+$submit = (isset($_POST['submit'])) ? true : false;
+$error = $data = array();
+$s_hidden_fields = '';
+$mode = get_variable('mode', 'REQUEST', 'personal');
+$id = $this->module;
 
-				if ($submit)
-				{
-					$time_format	= get_variable('time_format', 'REQUEST', null);
-					$lang			= get_variable('lang', 'REQUEST', null);
-					$tz				= get_variable('tz', 'REQUEST', 0);
-					$dst			= get_variable('dst', 'REQUEST', null);
+switch($mode)
+{
+	case 'personal':
 
-					$theme 		= get_variable('theme', 'REQUEST', null);
+		if ($submit)
+		{
+			$time_format	= get_variable('time_format', 'REQUEST', null);
+			$lang			= get_variable('lang', 'REQUEST', null);
+			$tz				= get_variable('tz', 'REQUEST', 0);
+			$dst			= get_variable('dst', 'REQUEST', null);
 
-					$viewemail		= (bool) get_variable('viewemail', 'REQUEST', true, 'interger');
-					$massemail		= (bool) get_variable('massemail', 'REQUEST', false, 'interger');
-					$hideonline		= (bool) get_variable('hideonline', 'REQUEST', true, 'interger');
-					$notify_pm		= (bool) get_variable('notifypm', 'REQUEST', true, 'interger');
+			$theme 		= get_variable('theme', 'REQUEST', null);
 
-					$popuppm	= (bool) get_variable('popuppm', 'REQUEST', true, 'interger');
-					$allowpm	= (bool) get_variable('allowpm', 'REQUEST', true, 'interger');
-					//$report_pm_notify	= (bool) get_variable('report_pm_notify', 'REQUEST', true, 'interger');
+			$viewemail		= (bool) get_variable('viewemail', 'REQUEST', true, 'interger');
+			$massemail		= (bool) get_variable('massemail', 'REQUEST', false, 'interger');
+			$hideonline		= (bool) get_variable('hideonline', 'REQUEST', true, 'interger');
+			$notify_pm		= (bool) get_variable('notifypm', 'REQUEST', true, 'interger');
 
-					if (empty($error))
-					{
-						$_CLASS['core_user']->optionset('popuppm', $popuppm);
-						//$_CLASS['core_user']->optionset('report_pm_notify', $report_pm_notify);
-						
-						$sql_array = array(
-							'user_allow_pm'			=> $allowpm, 
-							'user_allow_viewemail'	=> $viewemail, 
-							'user_allow_massemail'	=> $massemail, 
-							'user_allow_viewonline'	=> ($_CLASS['forums_auth']->acl_get('u_hideonline')) ? !$hideonline : $_CLASS['core_user']->data['user_allow_viewonline'], 
-							//'user_notify_type'		=> $notifymethod, 
-							'user_notify_pm'		=> $notify_pm,
-							'user_data'				=> serialize($_CLASS['core_user']->data['user_data']), 
+			$popuppm	= (bool) get_variable('popuppm', 'REQUEST', true, 'interger');
+			$allowpm	= (bool) get_variable('allowpm', 'REQUEST', true, 'interger');
+			//$report_pm_notify	= (bool) get_variable('report_pm_notify', 'REQUEST', true, 'interger');
 
-							'user_dst'				=> $dst,
-							'user_time_format'		=> $time_format,
-							'user_lang'				=> $lang,
-							'user_timezone'			=> $tz * 3600,
-							'user_theme'			=> $theme,
-						);
+			if (empty($error))
+			{
+				$_CLASS['core_user']->user_data_set('popuppm', $popuppm);
+				//$_CLASS['core_user']->user_data_set('report_pm_notify', $report_pm_notify);
+				
+				$sql_array = array(
+					'user_allow_pm'			=> $allowpm, 
+					'user_allow_viewemail'	=> $viewemail, 
+					'user_allow_massemail'	=> $massemail, 
+					'user_allow_viewonline'	=> !$hideonline, 
+					//'user_notify_type'		=> $notifymethod, 
+					'user_notify_pm'		=> $notify_pm,
+					'user_data'				=> serialize($_CLASS['core_user']->data['user_data']), 
 
-						array_merge($_CLASS['core_user']->data, $sql_array);
+					'user_dst'				=> $dst,
+					'user_time_format'		=> $time_format,
+					'user_lang'				=> $lang,
+					'user_timezone'			=> $tz * 3600,
+					'user_theme'			=> $theme,
+				);
 
-						$sql = 'UPDATE ' . USERS_TABLE . ' 
-							SET ' . $_CLASS['core_db']->sql_build_array('UPDATE', $sql_array) . '
-							WHERE user_id = ' . $_CLASS['core_user']->data['user_id'];
-						$_CLASS['core_db']->sql_query($sql);
-						
-						if ($theme !== $_CLASS['core_display']->theme_name)
-						{
-							$_CLASS['core_user']->session_data_remove('user_theme');
-						}
-						
-						$_CLASS['core_display']->meta_refresh(3, generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"));
-						$message = $_CLASS['core_user']->lang['PREFERENCES_UPDATED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_UCP'], '<a href="'.generate_link("Control_Panel&amp;i=$id&amp;mode=$mode").'">', '</a>');
+				array_merge($_CLASS['core_user']->data, $sql_array);
 
-						trigger_error($message);
-					}
+				$sql = 'UPDATE ' . CORE_USERS_TABLE . ' 
+					SET ' . $_CLASS['core_db']->sql_build_array('UPDATE', $sql_array) . '
+					WHERE user_id = ' . $_CLASS['core_user']->data['user_id'];
+				$_CLASS['core_db']->sql_query($sql);
+				
+				if ($theme !== $_CLASS['core_display']->theme_name)
+				{
+					$_CLASS['core_user']->session_data_remove('user_theme');
 				}
+				
+				$_CLASS['core_display']->meta_refresh(3, generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"));
+				$message = $_CLASS['core_user']->lang['PREFERENCES_UPDATED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_UCP'], '<a href="'.generate_link("Control_Panel&amp;i=$id&amp;mode=$mode").'">', '</a>');
 
-				$allowpm = isset($allowpm) ? $allowpm : $_CLASS['core_user']->data['user_allow_pm'];
-				$dst = isset($dst) ? $dst : $_CLASS['core_user']->data['user_dst'];
-				$hideonline = isset($hideonline) ? $hideonline : !$_CLASS['core_user']->data['user_allow_viewonline'];
-				$massemail = isset($massemail) ? $massemail : $_CLASS['core_user']->data['user_allow_massemail'];
-				$notifypm = isset($notifypm) ? $notifypm : $_CLASS['core_user']->data['user_notify_pm'];
-				$popuppm = isset($popuppm) ? $popuppm : $_CLASS['core_user']->optionget('popuppm');
-				$viewemail = isset($viewemail) ? $viewemail : $_CLASS['core_user']->data['user_allow_viewemail'];
-				$report_pm_notify = isset($report_pm_notify) ? $report_pm_notify : $_CLASS['core_user']->optionget('report_pm_notify');
-				$notifymethod = isset($notifymethod) ? $notifymethod : $_CLASS['core_user']->data['user_notify_type'];
-				$dateformat = isset($dateformat) ? $dateformat : $_CLASS['core_user']->data['user_time_format'];
-				$lang = isset($lang) ? $lang : $_CLASS['core_user']->data['user_lang'];
-				$theme = isset($theme) ? $theme : $_CLASS['core_user']->data['user_theme'];
-				$tz = isset($tz) ? $tz * 3600 : $_CLASS['core_user']->data['user_timezone'] / 3600;
+				trigger_error($message);
+			}
+		}
 
-				$view_email_yes = ($viewemail) ? ' checked="checked"' : '';
-				$view_email_no = (!$viewemail) ? ' checked="checked"' : '';
-				$mass_email_yes = ($massemail) ? ' checked="checked"' : '';
-				$mass_email_no = (!$massemail) ? ' checked="checked"' : '';
-				$allow_pm_yes = ($allowpm) ? ' checked="checked"' : '';
-				$allow_pm_no = (!$allowpm) ? ' checked="checked"' : '';
-				$hide_online_yes = ($hideonline) ? ' checked="checked"' : '';
-				$hide_online_no = (!$hideonline) ? ' checked="checked"' : '';
-				$notify_pm_yes = ($notifypm) ? ' checked="checked"' : '';
-				$notify_pm_no = (!$notifypm) ? ' checked="checked"' : '';
-				$popup_pm_yes = ($popuppm) ? ' checked="checked"' : '';
-				$popup_pm_no = (!$popuppm) ? ' checked="checked"' : '';
-				$report_pm_notify_yes = ($report_pm_notify) ? ' checked="checked"' : '';
-				$report_pm_notify_no = (!$report_pm_notify) ? ' checked="checked"' : '';
-				$dst_yes = ($dst) ? ' checked="checked"' : '';
-				$dst_no = (!$dst) ? ' checked="checked"' : '';
+		$allowpm = isset($allowpm) ? $allowpm : $_CLASS['core_user']->data['user_allow_pm'];
+		$dst = isset($dst) ? $dst : $_CLASS['core_user']->data['user_dst'];
+		$hideonline = isset($hideonline) ? $hideonline : !$_CLASS['core_user']->data['user_allow_viewonline'];
+		$massemail = isset($massemail) ? $massemail : $_CLASS['core_user']->data['user_allow_massemail'];
+		$notifypm = isset($notifypm) ? $notifypm : $_CLASS['core_user']->data['user_notify_pm'];
+		$popuppm = isset($popuppm) ? $popuppm : $_CLASS['core_user']->user_data_get('popuppm');
+		$viewemail = isset($viewemail) ? $viewemail : $_CLASS['core_user']->data['user_allow_viewemail'];
+		$report_pm_notify = isset($report_pm_notify) ? $report_pm_notify : $_CLASS['core_user']->user_data_get('report_pm_notify');
+		$notifymethod = isset($notifymethod) ? $notifymethod : $_CLASS['core_user']->data['user_notify_type'];
+		$dateformat = isset($dateformat) ? $dateformat : $_CLASS['core_user']->data['user_time_format'];
+		$lang = isset($lang) ? $lang : $_CLASS['core_user']->data['user_lang'];
+		$theme = isset($theme) ? $theme : $_CLASS['core_user']->data['user_theme'];
+		$tz = isset($tz) ? $tz * 3600 : $_CLASS['core_user']->data['user_timezone'] / 3600;
 
+		$view_email_yes = ($viewemail) ? ' checked="checked"' : '';
+		$view_email_no = (!$viewemail) ? ' checked="checked"' : '';
+		$mass_email_yes = ($massemail) ? ' checked="checked"' : '';
+		$mass_email_no = (!$massemail) ? ' checked="checked"' : '';
+		$allow_pm_yes = ($allowpm) ? ' checked="checked"' : '';
+		$allow_pm_no = (!$allowpm) ? ' checked="checked"' : '';
+		$hide_online_yes = ($hideonline) ? ' checked="checked"' : '';
+		$hide_online_no = (!$hideonline) ? ' checked="checked"' : '';
+		$notify_pm_yes = ($notifypm) ? ' checked="checked"' : '';
+		$notify_pm_no = (!$notifypm) ? ' checked="checked"' : '';
+		$popup_pm_yes = ($popuppm) ? ' checked="checked"' : '';
+		$popup_pm_no = (!$popuppm) ? ' checked="checked"' : '';
+		$report_pm_notify_yes = ($report_pm_notify) ? ' checked="checked"' : '';
+		$report_pm_notify_no = (!$report_pm_notify) ? ' checked="checked"' : '';
+		$dst_yes = ($dst) ? ' checked="checked"' : '';
+		$dst_no = (!$dst) ? ' checked="checked"' : '';
 
 
-				$_CLASS['core_template']->assign_array(array( 
-					'ERROR'				=> (sizeof($error)) ? implode('<br />', $error) : '',
 
-					'VIEW_EMAIL_YES'	=> $view_email_yes, 
-					'VIEW_EMAIL_NO'		=> $view_email_no, 
-					'ADMIN_EMAIL_YES'	=> $mass_email_yes, 
-					'ADMIN_EMAIL_NO'	=> $mass_email_no, 
-					'HIDE_ONLINE_YES'	=> $hide_online_yes, 
-					'HIDE_ONLINE_NO'	=> $hide_online_no, 
-					'ALLOW_PM_YES'		=> $allow_pm_yes, 
-					'ALLOW_PM_NO'		=> $allow_pm_no, 
-					'NOTIFY_PM_YES'		=> $notify_pm_yes, 
-					'NOTIFY_PM_NO'		=> $notify_pm_no, 
-					'POPUP_PM_YES'		=> $popup_pm_yes, 
-					'POPUP_PM_NO'		=> $popup_pm_no,
-					'REPORT_PM_NO'		=> $report_pm_notify_no,
-					'REPORT_PM_YES'		=> $report_pm_notify_yes,
-					'DST_YES'			=> $dst_yes, 
-					'DST_NO'			=> $dst_no, 
-					'NOTIFY_EMAIL'		=> ($notifymethod == NOTIFY_EMAIL) ? 'checked="checked"' : '', 
-					'NOTIFY_IM'			=> ($notifymethod == NOTIFY_IM) ? 'checked="checked"' : '', 
-					'NOTIFY_BOTH'		=> ($notifymethod == NOTIFY_BOTH) ? 'checked="checked"' : '', 
+		$_CLASS['core_template']->assign_array(array( 
+			'ERROR'				=> (sizeof($error)) ? implode('<br />', $error) : '',
 
-					'DATE_FORMAT'		=> $dateformat, 
+			'VIEW_EMAIL_YES'	=> $view_email_yes, 
+			'VIEW_EMAIL_NO'		=> $view_email_no, 
+			'ADMIN_EMAIL_YES'	=> $mass_email_yes, 
+			'ADMIN_EMAIL_NO'	=> $mass_email_no, 
+			'HIDE_ONLINE_YES'	=> $hide_online_yes, 
+			'HIDE_ONLINE_NO'	=> $hide_online_no, 
+			'ALLOW_PM_YES'		=> $allow_pm_yes, 
+			'ALLOW_PM_NO'		=> $allow_pm_no, 
+			'NOTIFY_PM_YES'		=> $notify_pm_yes, 
+			'NOTIFY_PM_NO'		=> $notify_pm_no, 
+			'POPUP_PM_YES'		=> $popup_pm_yes, 
+			'POPUP_PM_NO'		=> $popup_pm_no,
+			'REPORT_PM_NO'		=> $report_pm_notify_no,
+			'REPORT_PM_YES'		=> $report_pm_notify_yes,
+			'DST_YES'			=> $dst_yes, 
+			'DST_NO'			=> $dst_no, 
+			'NOTIFY_EMAIL'		=> ($notifymethod == NOTIFY_EMAIL) ? 'checked="checked"' : '', 
+			'NOTIFY_IM'			=> ($notifymethod == NOTIFY_IM) ? 'checked="checked"' : '', 
+			'NOTIFY_BOTH'		=> ($notifymethod == NOTIFY_BOTH) ? 'checked="checked"' : '', 
 
-					'S_LANG_OPTIONS'	=> select_language($lang), 
-					'S_THEME_OPTIONS'	=> select_theme($theme, true),
-					'S_TZ_OPTIONS'		=> select_tz($tz, true),
-					'S_CAN_HIDE_ONLINE'	=> true, 
-					'S_SELECT_NOTIFY'	=> ($config['jab_enable'] && $_CLASS['core_user']->data['user_jabber'] && @extension_loaded('xml')) ? true : false)
-				);
-				break;
+			'DATE_FORMAT'		=> $dateformat, 
 
-			case 'view':
+			'S_LANG_OPTIONS'	=> select_language($lang), 
+			'S_THEME_OPTIONS'	=> select_theme($theme, true),
+			'S_TZ_OPTIONS'		=> select_tz($tz, true),
+			'S_CAN_HIDE_ONLINE'	=> true, 
+			'S_SELECT_NOTIFY'	=> ($config['jab_enable'] && $_CLASS['core_user']->data['user_jabber'] && @extension_loaded('xml')) ? true : false)
+		);
+		break;
 
-				if ($submit)
-				{
-					$topic_sk 	= get_variable('topic_sk', 'REQUEST', 't');
-					$topic_sd	= get_variable('topic_sd', 'REQUEST', 'd');
-					$topic_st	= get_variable('topic_st', 'REQUEST', 0, 'interger');
-					
-					$post_sk 	= get_variable('post_sk', 'REQUEST', 't');
-					$post_sd	= get_variable('post_sd', 'REQUEST', 'd');
-					$post_st	= get_variable('post_st', 'REQUEST', 0, 'interger');
-	
-					$images		= (bool) get_variable('images', 'REQUEST', true, 'interger');
-					$flash		= (bool) get_variable('flash', 'REQUEST', false, 'interger');
-					$smilies	= (bool) get_variable('smilies', 'REQUEST', true, 'interger');
-					$sigs		= (bool) get_variable('sigs', 'REQUEST', true, 'interger');
-					$avatars	= (bool) get_variable('avatars', 'REQUEST', true, 'interger');
-					$wordcensor	= (bool) get_variable('wordcensor', 'REQUEST', true, 'interger');
+	case 'view':
 
-					if (empty($error))
-					{
-						$_CLASS['core_user']->optionset('viewimg', $images);
-						$_CLASS['core_user']->optionset('viewflash', $flash);
-						$_CLASS['core_user']->optionset('viewsmilies', $smilies);
-						$_CLASS['core_user']->optionset('viewsigs', $sigs);
-						$_CLASS['core_user']->optionset('viewavatars', $avatars);
+		if ($submit)
+		{
+			$topic_sk 	= get_variable('topic_sk', 'REQUEST', 't');
+			$topic_sd	= get_variable('topic_sd', 'REQUEST', 'd');
+			$topic_st	= get_variable('topic_st', 'REQUEST', 0, 'interger');
+			
+			$post_sk 	= get_variable('post_sk', 'REQUEST', 't');
+			$post_sd	= get_variable('post_sd', 'REQUEST', 'd');
+			$post_st	= get_variable('post_st', 'REQUEST', 0, 'interger');
 
-						if ($_CLASS['forums_auth']->acl_get('u_chgcensors'))
-						{
-							$_CLASS['core_user']->optionset('viewcensors', $wordcensor);
-						}
+			$images		= (bool) get_variable('images', 'REQUEST', true, 'interger');
+			$flash		= (bool) get_variable('flash', 'REQUEST', false, 'interger');
+			$smilies	= (bool) get_variable('smilies', 'REQUEST', true, 'interger');
+			$sigs		= (bool) get_variable('sigs', 'REQUEST', true, 'interger');
+			$avatars	= (bool) get_variable('avatars', 'REQUEST', true, 'interger');
+			$wordcensor	= (bool) get_variable('wordcensor', 'REQUEST', true, 'interger');
 
-						$sql_ary = array(
-							'user_data'				=> serialize($_CLASS['core_user']->data['user_data']), 
-							'user_topic_sortby_type'=> $topic_sk,
-							'user_post_sortby_type'	=> $post_sk,
-							'user_topic_sortby_dir'	=> $topic_sd,
-							'user_post_sortby_dir'	=> $post_sd,
+			if (empty($error))
+			{
+				$_CLASS['core_user']->user_data_set('viewimg', $images);
+				$_CLASS['core_user']->user_data_set('viewflash', $flash);
+				$_CLASS['core_user']->user_data_set('viewsmilies', $smilies);
+				$_CLASS['core_user']->user_data_set('viewsigs', $sigs);
+				$_CLASS['core_user']->user_data_set('viewavatars', $avatars);
 
-							'user_topic_show_days'	=> $topic_st,
-							'user_post_show_days'	=> $post_st,
-						);
-
-						$sql = 'UPDATE ' . USERS_TABLE . ' 
-							SET ' . $_CLASS['core_db']->sql_build_array('UPDATE', $sql_ary) . '
-							WHERE user_id = ' . $_CLASS['core_user']->data['user_id'];
-						$_CLASS['core_db']->sql_query($sql);
-
-						$_CLASS['core_display']->meta_refresh(3, generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"));
-						$message = $_CLASS['core_user']->lang['PREFERENCES_UPDATED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_UCP'], '<a href="'.generate_link("Control_Panel&amp;i=$id&amp;mode=$mode").'">', '</a>');
-						trigger_error($message);
-					}
+				if ($_CLASS['forums_auth']->acl_get('u_chgcensors'))
+				{
+					$_CLASS['core_user']->user_data_set('viewcensors', $wordcensor);
 				}
 
-				$topic_sd = empty($_CLASS['core_user']->data['user_topic_sortby_dir']) ? 'd' : $_CLASS['core_user']->data['user_topic_sortby_dir'];
-				$topic_sk = empty($_CLASS['core_user']->data['user_tpic_sortby_type']) ? 't' : $_CLASS['core_user']->data['user_topic_sortby_type'];
-				$topic_st = empty($_CLASS['core_user']->data['user_topic_show_days']) ? 0 : $_CLASS['core_user']->data['user_topic_show_days'];
+				$sql_ary = array(
+					'user_data'				=> serialize($_CLASS['core_user']->data['user_data']), 
+					'user_topic_sortby_type'=> $topic_sk,
+					'user_post_sortby_type'	=> $post_sk,
+					'user_topic_sortby_dir'	=> $topic_sd,
+					'user_post_sortby_dir'	=> $post_sd,
 
-				$post_sd = empty($_CLASS['core_user']->data['user_post_sortby_dir']) ? 'd' : $_CLASS['core_user']->data['user_post_sortby_dir'];
-				$post_sk = empty($_CLASS['core_user']->data['user_post_sortby_type']) ? 't' : $_CLASS['core_user']->data['user_post_sortby_type'];
-				$post_st = empty($_CLASS['core_user']->data['user_post_show_days']) ? 0 : $_CLASS['core_user']->data['user_post_show_days'];
+					'user_topic_show_days'	=> $topic_st,
+					'user_post_show_days'	=> $post_st,
+				);
 
-				$sort_dir_text = array('a' => $_CLASS['core_user']->lang['ASCENDING'], 'd' => $_CLASS['core_user']->lang['DESCENDING']);
-				
-				// Topic ordering options
-				$limit_topic_days = array(0 => $_CLASS['core_user']->lang['ALL_TOPICS'], 1 => $_CLASS['core_user']->lang['1_DAY'], 7 => $_CLASS['core_user']->lang['7_DAYS'], 14 => $_CLASS['core_user']->lang['2_WEEKS'], 30 => $_CLASS['core_user']->lang['1_MONTH'], 90 => $_CLASS['core_user']->lang['3_MONTHS'], 180 => $_CLASS['core_user']->lang['6_MONTHS'], 364 => $_CLASS['core_user']->lang['1_YEAR']);
+				$sql = 'UPDATE ' . CORE_USERS_TABLE . ' 
+					SET ' . $_CLASS['core_db']->sql_build_array('UPDATE', $sql_ary) . '
+					WHERE user_id = ' . $_CLASS['core_user']->data['user_id'];
+				$_CLASS['core_db']->sql_query($sql);
 
-				$sort_by_topic_text = array('a' => $_CLASS['core_user']->lang['AUTHOR'], 't' => $_CLASS['core_user']->lang['POST_TIME'], 'r' => $_CLASS['core_user']->lang['REPLIES'], 's' => $_CLASS['core_user']->lang['SUBJECT'], 'v' => $_CLASS['core_user']->lang['VIEWS']);
-				$sort_by_topic_sql = array('a' => 't.topic_first_poster_name', 't' => 't.topic_last_post_time', 'r' => 't.topic_replies', 's' => 't.topic_title', 'v' => 't.topic_views');
+				$_CLASS['core_display']->meta_refresh(3, generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"));
+				$message = $_CLASS['core_user']->lang['PREFERENCES_UPDATED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_UCP'], '<a href="'.generate_link("Control_Panel&amp;i=$id&amp;mode=$mode").'">', '</a>');
+				trigger_error($message);
+			}
+		}
 
-				// Post ordering options
-				$limit_post_days = array(0 => $_CLASS['core_user']->lang['ALL_POSTS'], 1 => $_CLASS['core_user']->lang['1_DAY'], 7 => $_CLASS['core_user']->lang['7_DAYS'], 14 => $_CLASS['core_user']->lang['2_WEEKS'], 30 => $_CLASS['core_user']->lang['1_MONTH'], 90 => $_CLASS['core_user']->lang['3_MONTHS'], 180 => $_CLASS['core_user']->lang['6_MONTHS'], 364 => $_CLASS['core_user']->lang['1_YEAR']);
+		$topic_sd = empty($_CLASS['core_user']->data['user_topic_sortby_dir']) ? 'd' : $_CLASS['core_user']->data['user_topic_sortby_dir'];
+		$topic_sk = empty($_CLASS['core_user']->data['user_tpic_sortby_type']) ? 't' : $_CLASS['core_user']->data['user_topic_sortby_type'];
+		$topic_st = empty($_CLASS['core_user']->data['user_topic_show_days']) ? 0 : $_CLASS['core_user']->data['user_topic_show_days'];
 
-				$sort_by_post_text = array('a' => $_CLASS['core_user']->lang['AUTHOR'], 't' => $_CLASS['core_user']->lang['POST_TIME'], 's' => $_CLASS['core_user']->lang['SUBJECT']);
-				$sort_by_post_sql = array('a' => 'u.username', 't' => 'p.post_id', 's' => 'p.post_subject');
+		$post_sd = empty($_CLASS['core_user']->data['user_post_sortby_dir']) ? 'd' : $_CLASS['core_user']->data['user_post_sortby_dir'];
+		$post_sk = empty($_CLASS['core_user']->data['user_post_sortby_type']) ? 't' : $_CLASS['core_user']->data['user_post_sortby_type'];
+		$post_st = empty($_CLASS['core_user']->data['user_post_show_days']) ? 0 : $_CLASS['core_user']->data['user_post_show_days'];
 
-				foreach (array('topic', 'post') as $sort_option)
-				{
-					${'s_limit_' . $sort_option . '_days'} = '<select name="' . $sort_option . '_st">';
-					foreach (${'limit_' . $sort_option . '_days'} as $day => $text)
-					{
-						$selected = (${$sort_option . '_st'} == $day) ? ' selected="selected"' : '';
-						${'s_limit_' . $sort_option . '_days'} .= '<option value="' . $day . '"' . $selected . '>' . $text . '</option>';
-					}
-					${'s_limit_' . $sort_option . '_days'} .= '</select>';
+		$sort_dir_text = array('a' => $_CLASS['core_user']->lang['ASCENDING'], 'd' => $_CLASS['core_user']->lang['DESCENDING']);
+		
+		// Topic ordering options
+		$limit_topic_days = array(0 => $_CLASS['core_user']->lang['ALL_TOPICS'], 1 => $_CLASS['core_user']->lang['1_DAY'], 7 => $_CLASS['core_user']->lang['7_DAYS'], 14 => $_CLASS['core_user']->lang['2_WEEKS'], 30 => $_CLASS['core_user']->lang['1_MONTH'], 90 => $_CLASS['core_user']->lang['3_MONTHS'], 180 => $_CLASS['core_user']->lang['6_MONTHS'], 364 => $_CLASS['core_user']->lang['1_YEAR']);
 
-					${'s_sort_' . $sort_option . '_key'} = '<select name="' . $sort_option . '_sk">';
-					foreach (${'sort_by_' . $sort_option . '_text'} as $key => $text)
-					{
-						$selected = (${$sort_option . '_sk'} == $key) ? ' selected="selected"' : '';
-						${'s_sort_' . $sort_option . '_key'} .= '<option value="' . $key . '"' . $selected . '>' . $text . '</option>';
-					}
-					${'s_sort_' . $sort_option . '_key'} .= '</select>';
+		$sort_by_topic_text = array('a' => $_CLASS['core_user']->lang['AUTHOR'], 't' => $_CLASS['core_user']->lang['POST_TIME'], 'r' => $_CLASS['core_user']->lang['REPLIES'], 's' => $_CLASS['core_user']->lang['SUBJECT'], 'v' => $_CLASS['core_user']->lang['VIEWS']);
+		$sort_by_topic_sql = array('a' => 't.topic_first_poster_name', 't' => 't.topic_last_post_time', 'r' => 't.topic_replies', 's' => 't.topic_title', 'v' => 't.topic_views');
 
-					${'s_sort_' . $sort_option . '_dir'} = '<select name="' . $sort_option . '_sd">';
-					foreach ($sort_dir_text as $key => $value)
-					{
-						$selected = (${$sort_option . '_sd'} == $key) ? ' selected="selected"' : '';
-						${'s_sort_' . $sort_option . '_dir'} .= '<option value="' . $key . '"' . $selected . '>' . $value . '</option>';
-					}
-					${'s_sort_' . $sort_option . '_dir'} .= '</select>';
-				}
+		// Post ordering options
+		$limit_post_days = array(0 => $_CLASS['core_user']->lang['ALL_POSTS'], 1 => $_CLASS['core_user']->lang['1_DAY'], 7 => $_CLASS['core_user']->lang['7_DAYS'], 14 => $_CLASS['core_user']->lang['2_WEEKS'], 30 => $_CLASS['core_user']->lang['1_MONTH'], 90 => $_CLASS['core_user']->lang['3_MONTHS'], 180 => $_CLASS['core_user']->lang['6_MONTHS'], 364 => $_CLASS['core_user']->lang['1_YEAR']);
 
-				$images 	= $_CLASS['core_user']->optionget('viewimg');
-				$flash		= $_CLASS['core_user']->optionget('viewflash');
-				$smilies	= $_CLASS['core_user']->optionget('viewsmilies');
-				$sigs		= $_CLASS['core_user']->optionget('viewsigs');
-				$avatars	= $_CLASS['core_user']->optionget('viewavatars');
-				$wordcensor = $_CLASS['core_user']->optionget('viewcensors');
+		$sort_by_post_text = array('a' => $_CLASS['core_user']->lang['AUTHOR'], 't' => $_CLASS['core_user']->lang['POST_TIME'], 's' => $_CLASS['core_user']->lang['SUBJECT']);
+		$sort_by_post_sql = array('a' => 'u.username', 't' => 'p.post_id', 's' => 'p.post_subject');
 
-				$images_yes = ($images) ? ' checked="checked"' : '';
-				$images_no = (!$images) ? ' checked="checked"' : '';
-				$flash_yes = ($flash) ? ' checked="checked"' : '';
-				$flash_no = (!$flash) ? ' checked="checked"' : '';
-				$smilies_yes = ($smilies) ? ' checked="checked"' : '';
-				$smilies_no = (!$smilies) ? ' checked="checked"' : '';
-				$sigs_yes = ($sigs) ? ' checked="checked"' : '';
-				$sigs_no = (!$sigs) ? ' checked="checked"' : '';
-				$avatars_yes = ($avatars) ? ' checked="checked"' : '';
-				$avatars_no = (!$avatars) ? ' checked="checked"' : '';
-				$wordcensor_yes = ($wordcensor) ? ' checked="checked"' : '';
-				$wordcensor_no = (!$wordcensor) ? ' checked="checked"' : '';
+		foreach (array('topic', 'post') as $sort_option)
+		{
+			${'s_limit_' . $sort_option . '_days'} = '<select name="' . $sort_option . '_st">';
+			foreach (${'limit_' . $sort_option . '_days'} as $day => $text)
+			{
+				$selected = (${$sort_option . '_st'} == $day) ? ' selected="selected"' : '';
+				${'s_limit_' . $sort_option . '_days'} .= '<option value="' . $day . '"' . $selected . '>' . $text . '</option>';
+			}
+			${'s_limit_' . $sort_option . '_days'} .= '</select>';
 
-				$_CLASS['core_template']->assign_array(array( 
-					'ERROR'				=> empty($error) ? '' : implode('<br />', $error),
-					
-					'VIEW_IMAGES_YES'		=> $images_yes, 
-					'VIEW_IMAGES_NO'		=> $images_no, 
-					'VIEW_FLASH_YES'		=> $flash_yes, 
-					'VIEW_FLASH_NO'			=> $flash_no, 
-					'VIEW_SMILIES_YES'		=> $smilies_yes, 
-					'VIEW_SMILIES_NO'		=> $smilies_no, 
-					'VIEW_SIGS_YES'			=> $sigs_yes, 
-					'VIEW_SIGS_NO'			=> $sigs_no, 
-					'VIEW_AVATARS_YES'		=> $avatars_yes, 
-					'VIEW_AVATARS_NO'		=> $avatars_no,
-					'DISABLE_CENSORS_YES'	=> $wordcensor_yes, 
-					'DISABLE_CENSORS_NO'	=> $wordcensor_no,
+			${'s_sort_' . $sort_option . '_key'} = '<select name="' . $sort_option . '_sk">';
+			foreach (${'sort_by_' . $sort_option . '_text'} as $key => $text)
+			{
+				$selected = (${$sort_option . '_sk'} == $key) ? ' selected="selected"' : '';
+				${'s_sort_' . $sort_option . '_key'} .= '<option value="' . $key . '"' . $selected . '>' . $text . '</option>';
+			}
+			${'s_sort_' . $sort_option . '_key'} .= '</select>';
 
-					'S_CHANGE_CENSORS'		=> $_CLASS['forums_auth']->acl_get('u_chgcensors'), 
+			${'s_sort_' . $sort_option . '_dir'} = '<select name="' . $sort_option . '_sd">';
+			foreach ($sort_dir_text as $key => $value)
+			{
+				$selected = (${$sort_option . '_sd'} == $key) ? ' selected="selected"' : '';
+				${'s_sort_' . $sort_option . '_dir'} .= '<option value="' . $key . '"' . $selected . '>' . $value . '</option>';
+			}
+			${'s_sort_' . $sort_option . '_dir'} .= '</select>';
+		}
 
-					'S_TOPIC_SORT_DAYS'		=> $s_limit_topic_days,
-					'S_TOPIC_SORT_KEY'		=> $s_sort_topic_key,
-					'S_TOPIC_SORT_DIR'		=> $s_sort_topic_dir,
-					'S_POST_SORT_DAYS'		=> $s_limit_post_days,
-					'S_POST_SORT_KEY'		=> $s_sort_post_key,
-					'S_POST_SORT_DIR'		=> $s_sort_post_dir
-				));
-			break;
+		$images 	= $_CLASS['core_user']->user_data_get('viewimg');
+		$flash		= $_CLASS['core_user']->user_data_get('viewflash');
+		$smilies	= $_CLASS['core_user']->user_data_get('viewsmilies');
+		$sigs		= $_CLASS['core_user']->user_data_get('viewsigs');
+		$avatars	= $_CLASS['core_user']->user_data_get('viewavatars');
+		$wordcensor = $_CLASS['core_user']->user_data_get('viewcensors');
 
-			case 'post':
-				if ($submit)
-				{
-					$bbcode 	= (bool) get_variable('bbcode', 'REQUEST', true, 'interger');
-					$html		= (bool) get_variable('html', 'REQUEST', false, 'interger');
-					$smilies	= (bool) get_variable('smilies', 'REQUEST', true, 'interger');
-					$sig		= (bool) get_variable('sig', 'REQUEST', true, 'interger');
-					$notify		= (bool) get_variable('notify', 'REQUEST', false, 'interger');
+		$images_yes = ($images) ? ' checked="checked"' : '';
+		$images_no = (!$images) ? ' checked="checked"' : '';
+		$flash_yes = ($flash) ? ' checked="checked"' : '';
+		$flash_no = (!$flash) ? ' checked="checked"' : '';
+		$smilies_yes = ($smilies) ? ' checked="checked"' : '';
+		$smilies_no = (!$smilies) ? ' checked="checked"' : '';
+		$sigs_yes = ($sigs) ? ' checked="checked"' : '';
+		$sigs_no = (!$sigs) ? ' checked="checked"' : '';
+		$avatars_yes = ($avatars) ? ' checked="checked"' : '';
+		$avatars_no = (!$avatars) ? ' checked="checked"' : '';
+		$wordcensor_yes = ($wordcensor) ? ' checked="checked"' : '';
+		$wordcensor_no = (!$wordcensor) ? ' checked="checked"' : '';
 
-					$_CLASS['core_user']->optionset('bbcode', $bbcode);
-					$_CLASS['core_user']->optionset('html', $html);
-					$_CLASS['core_user']->optionset('smilies', $smilies);
-					$_CLASS['core_user']->optionset('attachsig', $sig);
+		$_CLASS['core_template']->assign_array(array( 
+			'ERROR'				=> empty($error) ? '' : implode('<br />', $error),
+			
+			'VIEW_IMAGES_YES'		=> $images_yes, 
+			'VIEW_IMAGES_NO'		=> $images_no, 
+			'VIEW_FLASH_YES'		=> $flash_yes, 
+			'VIEW_FLASH_NO'			=> $flash_no, 
+			'VIEW_SMILIES_YES'		=> $smilies_yes, 
+			'VIEW_SMILIES_NO'		=> $smilies_no, 
+			'VIEW_SIGS_YES'			=> $sigs_yes, 
+			'VIEW_SIGS_NO'			=> $sigs_no, 
+			'VIEW_AVATARS_YES'		=> $avatars_yes, 
+			'VIEW_AVATARS_NO'		=> $avatars_no,
+			'DISABLE_CENSORS_YES'	=> $wordcensor_yes, 
+			'DISABLE_CENSORS_NO'	=> $wordcensor_no,
 
-					$sql_ary = array(
-						'user_data'		=> serialize($_CLASS['core_user']->data['user_data']),
-						'user_notify'	=> $notify,
-					);
+			'S_CHANGE_CENSORS'		=> $_CLASS['forums_auth']->acl_get('u_chgcensors'), 
 
-					$sql = 'UPDATE ' . USERS_TABLE . ' SET ' . $_CLASS['core_db']->sql_build_array('UPDATE', $sql_ary) . '
-								WHERE user_id = ' . $_CLASS['core_user']->data['user_id'];
-					$_CLASS['core_db']->sql_query($sql);
+			'S_TOPIC_SORT_DAYS'		=> $s_limit_topic_days,
+			'S_TOPIC_SORT_KEY'		=> $s_sort_topic_key,
+			'S_TOPIC_SORT_DIR'		=> $s_sort_topic_dir,
+			'S_POST_SORT_DAYS'		=> $s_limit_post_days,
+			'S_POST_SORT_KEY'		=> $s_sort_post_key,
+			'S_POST_SORT_DIR'		=> $s_sort_post_dir
+		));
+	break;
 
-					$_CLASS['core_display']->meta_refresh(3, generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"));
-					$message = $_CLASS['core_user']->lang['PREFERENCES_UPDATED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_UCP'], '<a href="'.generate_link("Control_Panel&amp;i=$id&amp;mode=$mode").'">', '</a>');
-					trigger_error($message);
-				}
+	case 'post':
+		if ($submit)
+		{
+			$bbcode 	= (bool) get_variable('bbcode', 'REQUEST', true, 'interger');
+			$html		= (bool) get_variable('html', 'REQUEST', false, 'interger');
+			$smilies	= (bool) get_variable('smilies', 'REQUEST', true, 'interger');
+			$sig		= (bool) get_variable('sig', 'REQUEST', true, 'interger');
+			$notify		= (bool) get_variable('notify', 'REQUEST', false, 'interger');
 
-				$bbcode = $_CLASS['core_user']->optionget('bbcode');
-				$html = $_CLASS['core_user']->optionget('html');
-				$smilies = $_CLASS['core_user']->optionget('smilies');
-				$notify = $_CLASS['core_user']->data['user_notify'];
+			$_CLASS['core_user']->user_data_set('bbcode', $bbcode);
+			$_CLASS['core_user']->user_data_set('html', $html);
+			$_CLASS['core_user']->user_data_set('smilies', $smilies);
+			$_CLASS['core_user']->user_data_set('attachsig', $sig);
 
-				$bbcode_yes = ($bbcode) ? ' checked="checked"' : '';
-				$bbcode_no = (!$bbcode) ? ' checked="checked"' : '';		
-				$html_yes = ($html) ? ' checked="checked"' : '';
-				$html_no = (!$html) ? ' checked="checked"' : '';
-				$smilies_yes = ($smilies) ? ' checked="checked"' : '';
-				$smilies_no = (!$smilies) ? ' checked="checked"' : '';
-				$sig = $_CLASS['core_user']->optionget('attachsig');
-				$sig_yes = ($sig) ? ' checked="checked"' : '';
-				$sig_no = (!$sig) ? ' checked="checked"' : '';
-				$notify_yes = ($notify) ? ' checked="checked"' : '';
-				$notify_no = (!$notify) ? ' checked="checked"' : '';
+			$sql_ary = array(
+				'user_data'		=> serialize($_CLASS['core_user']->data['user_data']),
+				'user_notify'	=> $notify,
+			);
 
-				$_CLASS['core_template']->assign_array(array(
-					'ERROR'				=> empty($error) ? '' :  implode('<br />', $error),
+			$sql = 'UPDATE ' . CORE_USERS_TABLE . ' SET ' . $_CLASS['core_db']->sql_build_array('UPDATE', $sql_ary) . '
+						WHERE user_id = ' . $_CLASS['core_user']->data['user_id'];
+			$_CLASS['core_db']->sql_query($sql);
 
-					'DEFAULT_BBCODE_YES'	=> $bbcode_yes, 
-					'DEFAULT_BBCODE_NO'		=> $bbcode_no, 
-					'DEFAULT_HTML_YES'		=> $html_yes, 
-					'DEFAULT_HTML_NO'		=> $html_no, 
-					'DEFAULT_SMILIES_YES'	=> $smilies_yes, 
-					'DEFAULT_SMILIES_NO'	=> $smilies_no, 
-					'DEFAULT_SIG_YES'		=> $sig_yes, 
-					'DEFAULT_SIG_NO'		=> $sig_no, 
-					'DEFAULT_NOTIFY_YES'	=> $notify_yes, 
-					'DEFAULT_NOTIFY_NO'		=> $notify_no,
-				));
-			break;
-			
-			default:
-				die;
-			break;
+			$_CLASS['core_display']->meta_refresh(3, generate_link("Control_Panel&amp;i=$id&amp;mode=$mode"));
+			$message = $_CLASS['core_user']->lang['PREFERENCES_UPDATED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_UCP'], '<a href="'.generate_link("Control_Panel&amp;i=$id&amp;mode=$mode").'">', '</a>');
+			trigger_error($message);
 		}
 
-		$_CLASS['core_template']->assign_array(array( 
-			'L_TITLE'			=> $_CLASS['core_user']->lang['UCP_PREFS_' . strtoupper($mode)],
-			'S_HIDDEN_FIELDS'	=> $s_hidden_fields,
-			'S_UCP_ACTION'		=> generate_link("Control_Panel&amp;i=$id&amp;mode=$mode")
-		));
+		$bbcode = $_CLASS['core_user']->user_data_get('bbcode');
+		$html = $_CLASS['core_user']->user_data_get('html');
+		$smilies = $_CLASS['core_user']->user_data_get('smilies');
+		$notify = $_CLASS['core_user']->data['user_notify'];
 
-		$this->display($_CLASS['core_user']->lang['UCP_PROFILE'], 'ucp_prefs_' . $mode . '.html');
-	}
+		$bbcode_yes = ($bbcode) ? ' checked="checked"' : '';
+		$bbcode_no = (!$bbcode) ? ' checked="checked"' : '';		
+		$html_yes = ($html) ? ' checked="checked"' : '';
+		$html_no = (!$html) ? ' checked="checked"' : '';
+		$smilies_yes = ($smilies) ? ' checked="checked"' : '';
+		$smilies_no = (!$smilies) ? ' checked="checked"' : '';
+		$sig = $_CLASS['core_user']->user_data_get('attachsig');
+		$sig_yes = ($sig) ? ' checked="checked"' : '';
+		$sig_no = (!$sig) ? ' checked="checked"' : '';
+		$notify_yes = ($notify) ? ' checked="checked"' : '';
+		$notify_no = (!$notify) ? ' checked="checked"' : '';
+
+		$_CLASS['core_template']->assign_array(array(
+			'ERROR'				=> empty($error) ? '' :  implode('<br />', $error),
+
+			'DEFAULT_BBCODE_YES'	=> $bbcode_yes, 
+			'DEFAULT_BBCODE_NO'		=> $bbcode_no, 
+			'DEFAULT_HTML_YES'		=> $html_yes, 
+			'DEFAULT_HTML_NO'		=> $html_no, 
+			'DEFAULT_SMILIES_YES'	=> $smilies_yes, 
+			'DEFAULT_SMILIES_NO'	=> $smilies_no, 
+			'DEFAULT_SIG_YES'		=> $sig_yes, 
+			'DEFAULT_SIG_NO'		=> $sig_no, 
+			'DEFAULT_NOTIFY_YES'	=> $notify_yes, 
+			'DEFAULT_NOTIFY_NO'		=> $notify_no,
+		));
+	break;
+	
+	default:
+		die;
+	break;
 }
 
+$_CLASS['core_template']->assign_array(array( 
+	'L_TITLE'			=> $_CLASS['core_user']->lang['UCP_PREFS_' . strtoupper($mode)],
+	'S_HIDDEN_FIELDS'	=> $s_hidden_fields,
+	'S_UCP_ACTION'		=> generate_link("Control_Panel&amp;i=$id&amp;mode=$mode")
+));
+
+$_CLASS['core_display']->display($_CLASS['core_user']->lang['UCP_PROFILE'], 'modules/control_panel/ucp_prefs_' . $mode . '.html');
+
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/control_panel/modules/ucp_zebra.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_zebra.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/control_panel/modules/ucp_zebra.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -163,16 +163,6 @@
 
 unset($username_options);
 
-/*
-$result = $_CLASS['core_db']->query('SHOW COLLATION');
-$result = $_CLASS['core_db']->query('SHOW CHARACTER SET');
-
-while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
-{
-	print_r($row );echo '<br/>'; die;
-}
-*/
-
 $_CLASS['core_display']->display($_CLASS['core_user']->get_lang('UCP_ZEBRA'), 'modules/control_panel/ucp_zebra_' . $this->mode . '.html');
 
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/members_list/index.php
===================================================================
--- cms/trunk/modules/members_list/index.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/members_list/index.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -339,9 +339,8 @@
 		$num_real_posts = $_CLASS['core_user']->data['user_posts'];
 
 		// Do the relevant calculations
-		$memberdays = max(1, round(($_CLASS['core_user']->time - $member['user_reg_date']) / 86400));
-		$posts_per_day = $member['user_posts'] / $memberdays;
-		$percentage = ($config['num_posts']) ? min(100, ($num_real_posts / $config['num_posts']) * 100) : 0;
+		$member_days = max(1, round(($_CLASS['core_user']->time - $member['user_reg_date']) / 86400));
+		$posts_per_day = $member['user_posts'] / $member_days;
 
 		$active_f_name = $active_f_id = $active_f_count = $active_f_pct = '';
 
@@ -441,7 +440,7 @@
 		
 		$_CLASS['core_template']->assign_array(array(
 			'POSTS_DAY'			=> sprintf($_CLASS['core_user']->lang['POST_DAY'], $posts_per_day),
-			'POSTS_PCT'			=> sprintf($_CLASS['core_user']->lang['POST_PCT'], $percentage),
+			'POSTS_PCT'			=> 0,
 			'ACTIVE_FORUM'		=> $active_f_name,
 			'ACTIVE_FORUM_POSTS'=> ($active_f_count == 1) ? sprintf($_CLASS['core_user']->lang['USER_POST'], 1) : sprintf($_CLASS['core_user']->lang['USER_POSTS'], $active_f_count),
 			'ACTIVE_FORUM_PCT'	=> sprintf($_CLASS['core_user']->lang['POST_PCT'], $active_f_pct),

Modified: cms/trunk/modules/quick_message/ajax.php
===================================================================
--- cms/trunk/modules/quick_message/ajax.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/quick_message/ajax.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -26,7 +26,7 @@
     die;
 }
 
-global $_CORE_CONFIG, $_CLASS;
+global $_CLASS, $_CORE_CONFIG;
 
 if (!defined('QUICK_MESSAGE_TABLE'))
 {

Modified: cms/trunk/modules/quick_message/configurator.php
===================================================================
--- cms/trunk/modules/quick_message/configurator.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/quick_message/configurator.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -35,6 +35,9 @@
 
 class Quick_Message_configurator
 {
+	var $error = array();
+	var $admin = false;
+
 	function install()
 	{
 		global $_CLASS;

Modified: cms/trunk/modules/quick_message/index.php
===================================================================
--- cms/trunk/modules/quick_message/index.php	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/modules/quick_message/index.php	2006-07-24 01:47:19 UTC (rev 175)
@@ -188,9 +188,9 @@
 if (!$row)
 {
 	$_CLASS['core_template']->assign_array(array(
-		'Q_MESSAGE_PAGINATION'	=> generate_pagination('Quick_Message', $row['total'], $limit, $start, false, 'Q_MESSAGE_'),
-		'Q_PAGE_NUMBER'			=> on_page($row['total'], $limit, $start),
-		'Q_TOTAL_MESSAGES'		=> $row['total']
+		'Q_MESSAGE_PAGINATION'	=> false,
+		'Q_PAGE_NUMBER'			=> false,
+		'Q_TOTAL_MESSAGES'		=> false
 	));
 
 	$_CLASS['core_display']->display(false, 'modules/Quick_Message/index.html');
@@ -267,8 +267,8 @@
 $_CLASS['core_template']->assign_array(array(
 	'Q_MESSAGE_PAGINATION'			=> $pagination['formated'],
 	'Q_MESSAGE_PAGINATION_ARRAY'	=> $pagination['array'],
-	'Q_PAGE_NUMBER'					=> on_page($row['total'], $limit, $start),
-	'Q_TOTAL_MESSAGES'				=> $row['total']
+	'Q_MESSAGE_PAGE_NUMBER'			=> on_page($row['total'], $limit, $start),
+	'Q_MESSAGE_TOTAL_MESSAGES'		=> $row['total']
 ));
 
 $_CLASS['core_display']->display(false, 'modules/Quick_Message/index.html');

Modified: cms/trunk/themes/viperal/template/footer.html
===================================================================
--- cms/trunk/themes/viperal/template/footer.html	2005-10-31 18:57:04 UTC (rev 174)
+++ cms/trunk/themes/viperal/template/footer.html	2006-07-24 01:47:19 UTC (rev 175)
@@ -1,10 +1,10 @@
 	<!-- IF isset({ $block_bottom }) -->
 		{section name=block_bottom_loop loop=$block_bottom}
 		<div class="centerblock">
-			<div class="title">{$block_bottom[block_bottom_loop].TITLE}</div>
+			<div class="title">{$block_bottom[block_bottom_loop].title}</div>
 				<div class="OpenTable"><div class="outer">
 					<div class="inner">
-						<div class="blockcontent">{$block_bottom[block_bottom_loop].CONTENT}</div>
+						<div class="blockcontent">{$block_bottom[block_bottom_loop].content}</div>
 					</div>
 				</div>
 			</div>
@@ -13,23 +13,24 @@
 	<!-- ENDIF $block_bottom -->
 	
 	<!-- IF isset({ $message_block_bottom }) -->
-	<div class="messageblock">
-	<!-- LOOP $message_block_bottom -->
-		<div class="title" onclick="switch_collapse('block_{ $message_block_bottom:id }');" style="cursor:pointer">{ $message_block_bottom:title }
-		<!-- IF { $message_block_bottom:edit_link } -->[ <!-- IF { $message_block_bottom:expires } -->{ $message_block_bottom:expires } | <!-- ENDIF -->
-		<a href="{ $message_block_bottom:edit_link }" >{ $L_EDIT }</a> ]<!-- ENDIF --></div>
-		<div <!-- IF { $message_block_bottom:collapsed } -->style="display: none;"<!-- ENDIF --> class="content" id="block_{ $message_block_bottom:id }">{ $message_block_bottom:content }</div>
+	<br/>
+		<div class="messageblock">
+		<!-- LOOP $message_block_bottom -->
+			<div class="title" onclick="switch_collapse('block_{ $message_block_bottom:id }');" style="cursor:pointer">{ $message_block_bottom:title }
+			<!-- IF { $message_block_bottom:edit_link } -->[ <!-- IF { $message_block_bottom:expires } -->{ $message_block_bottom:expires } | <!-- ENDIF -->
+			<a href="{ $message_block_bottom:edit_link }" >{ $L_EDIT }</a> ]<!-- ENDIF --></div>
+			<div class="content" <!-- IF { $message_block_bottom:collapsed } --> style="display: none;"<!-- ENDIF -->  id="block_{ $message_block_bottom:id }">{ $message_block_bottom:content }</div>
+		<br />
+		<!-- ENDLOOP $message_block_bottom -->
+	
+		</div>
 	<br />
-	<!-- ENDLOOP $message_block_bottom -->
-	</div>
-	<br />
 	<!-- ENDIF -->
-
 	</div>
 	</div>
 	
 	<!-- INCLUDE blockright.html -->
-	{ $FOOTER_CONTENT }
+
 	<div class="footer">
 		<br />
 		<div align="center" class="footmsg">{ $THEME_FOOTER }</div>



From viperal at mail.berlios.de  Tue Jul 25 19:04:43 2006
From: viperal at mail.berlios.de (viperal at BerliOS)
Date: Tue, 25 Jul 2006 19:04:43 +0200
Subject: [Viperals-svncheckins] r176 -
	cms/trunk/themes/viperal/images/modules
Message-ID: <200607251704.k6PH4h08027811@sheep.berlios.de>

Author: viperal
Date: 2006-07-25 19:04:38 +0200 (Tue, 25 Jul 2006)
New Revision: 176

Added:
   cms/trunk/themes/viperal/images/modules/Forums_tmp/
Removed:
   cms/trunk/themes/viperal/images/modules/Forums/
Log:


Copied: cms/trunk/themes/viperal/images/modules/Forums_tmp (from rev 174, cms/trunk/themes/viperal/images/modules/Forums)



From viperal at mail.berlios.de  Tue Jul 25 19:05:48 2006
From: viperal at mail.berlios.de (viperal at BerliOS)
Date: Tue, 25 Jul 2006 19:05:48 +0200
Subject: [Viperals-svncheckins] r177 -
	cms/trunk/themes/viperal/images/modules
Message-ID: <200607251705.k6PH5mJi027987@sheep.berlios.de>

Author: viperal
Date: 2006-07-25 19:05:43 +0200 (Tue, 25 Jul 2006)
New Revision: 177

Added:
   cms/trunk/themes/viperal/images/modules/forums/
Removed:
   cms/trunk/themes/viperal/images/modules/Forums_tmp/
Log:


Copied: cms/trunk/themes/viperal/images/modules/forums (from rev 176, cms/trunk/themes/viperal/images/modules/Forums_tmp)



From viperal at mail.berlios.de  Tue Jul 25 19:08:45 2006
From: viperal at mail.berlios.de (viperal at BerliOS)
Date: Tue, 25 Jul 2006 19:08:45 +0200
Subject: [Viperals-svncheckins] r178 - in cms/trunk: . blocks includes
	includes/forums includes/forums/admin
	includes/templates/admin/modules
	includes/templates/modules/control_panel
	includes/templates/modules/forums
	includes/templates/modules/members_list javascript
	javascript/forums modules/control_panel
	modules/control_panel/modules modules/forums
	modules/members_list modules/quick_message
	themes/viperal/images/modules/forums
Message-ID: <200607251708.k6PH8jHO028228@sheep.berlios.de>

Author: viperal
Date: 2006-07-25 19:08:28 +0200 (Tue, 25 Jul 2006)
New Revision: 178

Added:
   cms/trunk/includes/templates/admin/modules/search.html
Modified:
   cms/trunk/blocks/block-Admin_Forums.php
   cms/trunk/blocks/block-Control_Panel.php
   cms/trunk/blocks/block-Quick_Message.php
   cms/trunk/blocks/block-User.php
   cms/trunk/feed.php
   cms/trunk/includes/forums/admin/admin_attachments.php
   cms/trunk/includes/forums/admin/admin_board.php
   cms/trunk/includes/forums/admin/admin_forums.php
   cms/trunk/includes/forums/admin/admin_permissions.php
   cms/trunk/includes/forums/admin/links.php
   cms/trunk/includes/forums/admin/main.php
   cms/trunk/includes/forums/functions.php
   cms/trunk/includes/forums/functions_admin.php
   cms/trunk/includes/forums/functions_display.php
   cms/trunk/includes/forums/functions_posting.php
   cms/trunk/includes/functions.php
   cms/trunk/includes/templates/modules/control_panel/ucp_agreement.html
   cms/trunk/includes/templates/modules/control_panel/ucp_attachments.html
   cms/trunk/includes/templates/modules/control_panel/ucp_calender_add.html
   cms/trunk/includes/templates/modules/control_panel/ucp_calender_day.html
   cms/trunk/includes/templates/modules/control_panel/ucp_calender_main.html
   cms/trunk/includes/templates/modules/control_panel/ucp_groups_membership.html
   cms/trunk/includes/templates/modules/control_panel/ucp_main_bookmarks.html
   cms/trunk/includes/templates/modules/control_panel/ucp_main_drafts.html
   cms/trunk/includes/templates/modules/control_panel/ucp_main_front.html
   cms/trunk/includes/templates/modules/control_panel/ucp_main_subscribed.html
   cms/trunk/includes/templates/modules/control_panel/ucp_pm_options.html
   cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewfolder.html
   cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html
   cms/trunk/includes/templates/modules/control_panel/ucp_posting_body.html
   cms/trunk/includes/templates/modules/control_panel/ucp_prefs_personal.html
   cms/trunk/includes/templates/modules/control_panel/ucp_prefs_post.html
   cms/trunk/includes/templates/modules/control_panel/ucp_prefs_view.html
   cms/trunk/includes/templates/modules/control_panel/ucp_profile_avatar.html
   cms/trunk/includes/templates/modules/control_panel/ucp_profile_profile_info.html
   cms/trunk/includes/templates/modules/control_panel/ucp_profile_reg_details.html
   cms/trunk/includes/templates/modules/control_panel/ucp_profile_signature.html
   cms/trunk/includes/templates/modules/control_panel/ucp_register.html
   cms/trunk/includes/templates/modules/control_panel/ucp_remind.html
   cms/trunk/includes/templates/modules/control_panel/ucp_resend.html
   cms/trunk/includes/templates/modules/control_panel/ucp_zebra_foes.html
   cms/trunk/includes/templates/modules/control_panel/ucp_zebra_friends.html
   cms/trunk/includes/templates/modules/forums/confirm_body.html
   cms/trunk/includes/templates/modules/forums/faq_body.html
   cms/trunk/includes/templates/modules/forums/index_body.html
   cms/trunk/includes/templates/modules/forums/mcp_footer.html
   cms/trunk/includes/templates/modules/forums/mcp_forum.html
   cms/trunk/includes/templates/modules/forums/mcp_front.html
   cms/trunk/includes/templates/modules/forums/mcp_header.html
   cms/trunk/includes/templates/modules/forums/mcp_message.html
   cms/trunk/includes/templates/modules/forums/mcp_move.html
   cms/trunk/includes/templates/modules/forums/mcp_post.html
   cms/trunk/includes/templates/modules/forums/mcp_topic.html
   cms/trunk/includes/templates/modules/forums/posting_body.html
   cms/trunk/includes/templates/modules/forums/posting_smilies.html
   cms/trunk/includes/templates/modules/forums/report_body.html
   cms/trunk/includes/templates/modules/forums/search_body.html
   cms/trunk/includes/templates/modules/forums/search_results.html
   cms/trunk/includes/templates/modules/forums/simple_header.html
   cms/trunk/includes/templates/modules/forums/viewforum_body.html
   cms/trunk/includes/templates/modules/forums/viewforum_subforum.html
   cms/trunk/includes/templates/modules/forums/viewtopic_body.html
   cms/trunk/includes/templates/modules/members_list/memberlist_body.html
   cms/trunk/includes/templates/modules/members_list/memberlist_forum_moderators.html
   cms/trunk/includes/templates/modules/members_list/memberlist_view.html
   cms/trunk/javascript/forums/forum_view.js
   cms/trunk/javascript/quick_messages.js
   cms/trunk/modules/control_panel/index.php
   cms/trunk/modules/control_panel/modules/ucp_pm.php
   cms/trunk/modules/control_panel/modules/ucp_prefs.php
   cms/trunk/modules/forums/ajax.php
   cms/trunk/modules/forums/faq.php
   cms/trunk/modules/forums/main.php
   cms/trunk/modules/forums/posting.php
   cms/trunk/modules/forums/viewforum.php
   cms/trunk/modules/forums/viewtopic.php
   cms/trunk/modules/members_list/index.php
   cms/trunk/modules/quick_message/ajax.php
   cms/trunk/modules/quick_message/index.php
   cms/trunk/themes/viperal/images/modules/forums/index.php
Log:


Modified: cms/trunk/blocks/block-Admin_Forums.php
===================================================================
--- cms/trunk/blocks/block-Admin_Forums.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/blocks/block-Admin_Forums.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -28,10 +28,10 @@
 				<th class="forummenu" height="25">&#0187; '.$_CLASS['core_user']->lang['RETURN_TO'].'</th>
 			</tr>
 			<tr>
-				<td class="row1"><a class="genmed" href="'.generate_link('Forums', array('admin' => true)).'">'.$_CLASS['core_user']->lang['FORUM_INDEX'].'</a></td>
+				<td class="row1"><a class="genmed" href="'.generate_link('forums', array('admin' => true)).'">'.$_CLASS['core_user']->lang['FORUM_INDEX'].'</a></td>
 			</tr>
 			<tr>
-				<td class="row1"><a class="genmed" href="'.generate_link('Forums').'">'.$_CLASS['core_user']->lang['FORUM_INDEX'].'</a></td>
+				<td class="row1"><a class="genmed" href="'.generate_link('forums', array('admin' => true)).'">'.$_CLASS['core_user']->lang['FORUM_INDEX'].'</a></td>
 			</tr>';
 
 

Modified: cms/trunk/blocks/block-Control_Panel.php
===================================================================
--- cms/trunk/blocks/block-Control_Panel.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/blocks/block-Control_Panel.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -34,6 +34,6 @@
 	return;
 }
 
-$this->content = $_CLASS['core_template']->display('modules/Control_Panel/ucp_sideblock.html', true);
+$this->content = $_CLASS['core_template']->display('modules/control_panel/ucp_sideblock.html', true);
 
 ?>
\ No newline at end of file

Modified: cms/trunk/blocks/block-Quick_Message.php
===================================================================
--- cms/trunk/blocks/block-Quick_Message.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/blocks/block-Quick_Message.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -35,7 +35,7 @@
 }
 */
 
-require_once($site_file_root.'modules/Quick_Message/functions.php');
+require_once($site_file_root.'modules/quick_message/functions.php');
 
 $this->content = '<div id="qm_block">'.qm_block_content().'</div>';
 

Modified: cms/trunk/blocks/block-User.php
===================================================================
--- cms/trunk/blocks/block-User.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/blocks/block-User.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -54,7 +54,7 @@
 	}
 	
 	$this->content .= '<br />'.$_CLASS['core_user']->lang['WELCOME'].'<br />' . $_CLASS['core_user']->data['username'].'<br /><hr /></div><b>Your Info</b><br /><br />
-	<div style="margin-left: 12px;"><a href="'.generate_link('control_panel&amp;i=2').'">'.$_CLASS['core_user']->lang['PRIVATE_MESSAGE'].'</a><hr />'.sprintf($_CLASS['core_user']->lang['NEW_PMS'], $_CLASS['core_user']->data['user_new_privmsg']) . '<br />
+	<div style="margin-left: 12px;"><a href="'.generate_link('control_panel&amp;i=pm').'">'.$_CLASS['core_user']->lang['PRIVATE_MESSAGE'].'</a><hr />'.sprintf($_CLASS['core_user']->lang['NEW_PMS'], $_CLASS['core_user']->data['user_new_privmsg']) . '<br />
 	'.sprintf($_CLASS['core_user']->lang['UNREAD_PM'], $_CLASS['core_user']->data['user_unread_privmsg']) . '<br /><br />
 	<a href="'.generate_link('control_panel').'">Control Panel</a><br />
 	<a href="'.generate_link('control_panel&amp;mode=logout').'">'.$_CLASS['core_user']->lang['LOGOUT'].'</a><br /></div>';

Modified: cms/trunk/feed.php
===================================================================
--- cms/trunk/feed.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/feed.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -23,7 +23,7 @@
 
 define('VIPERAL', 'FEED');
 
-error_reporting(0);
+//error_reporting(0);
 
 /* require(SITE_FILE_ROOT.'core.php'); */
 require_once 'core.php';

Modified: cms/trunk/includes/forums/admin/admin_attachments.php
===================================================================
--- cms/trunk/includes/forums/admin/admin_attachments.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/admin/admin_attachments.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -22,7 +22,7 @@
 
 require($site_file_root.'includes/forums/functions_posting.php');
 
-$_CLASS['core_user']->add_lang(array('posting', 'viewtopic'), 'Forums');
+$_CLASS['core_user']->add_lang(array('posting', 'viewtopic'), 'forums');
 
 $mode = request_var('mode', '');
 $submit = (isset($_POST['submit'])) ? true : false;

Modified: cms/trunk/includes/forums/admin/admin_board.php
===================================================================
--- cms/trunk/includes/forums/admin/admin_board.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/admin/admin_board.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -166,7 +166,7 @@
 
 if (isset($display_vars['lang']))
 {
-	$_CLASS['core_user']->add_lang($display_vars['lang'], 'Forums');
+	$_CLASS['core_user']->add_lang($display_vars['lang'], 'forums');
 }
 
 $new = $config;

Modified: cms/trunk/includes/forums/admin/admin_forums.php
===================================================================
--- cms/trunk/includes/forums/admin/admin_forums.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/admin/admin_forums.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -146,7 +146,7 @@
 
 			// Redirect to permissions
 			$message = ($mode === 'add') ? $_CLASS['core_user']->lang['FORUM_CREATED'] : $_CLASS['core_user']->lang['FORUM_UPDATED'];
-			$message .= '<br /><br />' . sprintf($_CLASS['core_user']->lang['REDIRECT_ACL'], '<a href="'.generate_link('Forums&amp;file=admin_permissions&amp;mode=forum&amp;submit_usergroups=true&amp;ug_type=forum&amp;action=usergroups&amp;f[forum][]=' . $forum_data['forum_id'], array('admin' => true)) . '">', '</a>');
+			$message .= '<br /><br />' . sprintf($_CLASS['core_user']->lang['REDIRECT_ACL'], '<a href="'.generate_link('forums&amp;file=admin_permissions&amp;mode=forum&amp;submit_usergroups=true&amp;ug_type=forum&amp;action=usergroups&amp;f[forum][]=' . $forum_data['forum_id'], array('admin' => true)) . '">', '</a>');
 			$show_prev_info = ($mode == 'edit') ? true : false;
 
 			trigger_error($message);
@@ -296,12 +296,12 @@
 		$forum_link_track_yes = ($forum_flags & 1) ? ' checked="checked"' : '';
 		$forum_link_track_no = (!($forum_flags & 1)) ? ' checked="checked"' : '';
 
-		$navigation = '<a href="'.generate_link('Forums&amp;file=admin_forums', array('admin' => true)) . '">' . $_CLASS['core_user']->lang['FORUM_INDEX'] . '</a>';
+		$navigation = '<a href="'.generate_link('forums&amp;file=admin_forums', array('admin' => true)) . '">' . $_CLASS['core_user']->lang['FORUM_INDEX'] . '</a>';
 
 		$forums_nav = get_forum_branch($forum_id, 'parents', 'descending');
 		foreach ($forums_nav as $row)
 		{
-			$navigation .= ($row['forum_id'] == $forum_id) ? ' -&gt; ' . $row['forum_name'] : ' -&gt; <a href="'.generate_link('Forums&amp;file=admin_forums&amp;parent_id=' . $row['forum_id'], array('admin' => true)) . '">' . $row['forum_name'] . '</a>';
+			$navigation .= ($row['forum_id'] == $forum_id) ? ' -&gt; ' . $row['forum_name'] : ' -&gt; <a href="'.generate_link('forums&amp;file=admin_forums&amp;parent_id=' . $row['forum_id'], array('admin' => true)) . '">' . $row['forum_name'] . '</a>';
 		}
 
 		adm_page_header($l_title);
@@ -314,7 +314,7 @@
 
 <p><?php echo $_CLASS['core_user']->lang['FORUM_EDIT_EXPLAIN'] ?></p>
 
-<form method="post" name="edit" action="<?php echo generate_link('Forums&amp;file=admin_forums&amp;mode='.$mode . (($forum_id) ? "&amp;f=$forum_id" : ''), array('admin' => true)); ?>"><table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
+<form method="post" name="edit" action="<?php echo generate_link('forums&amp;file=admin_forums&amp;mode='.$mode . (($forum_id) ? "&amp;f=$forum_id" : ''), array('admin' => true)); ?>"><table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
 	<tr>
 		<td class="nav"><?php echo $navigation ?></td>
 	</tr>
@@ -560,7 +560,7 @@
 
 <p><?php echo $_CLASS['core_user']->lang['FORUM_DELETE_EXPLAIN'] ?></p>
 
-<form action="<?php echo generate_link('Forums&amp;file=admin_forums', array('admin' => true)) ?>&mode=delete&amp;f=<?php echo $forum_id ?>" method="post"><table class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
+<form action="<?php echo generate_link('forums&amp;file=admin_forums', array('admin' => true)) ?>&mode=delete&amp;f=<?php echo $forum_id ?>" method="post"><table class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
 	<tr>
 		<th colspan="2"><?php echo $_CLASS['core_user']->lang['FORUM_DELETE'] ?></th>
 	</tr>
@@ -762,7 +762,7 @@
 }
 else
 {
-	$navigation = '<a href="'.generate_link('Forums&amp;file=admin_forums', array('admin' => true)) . '">' . $_CLASS['core_user']->lang['FORUM_INDEX'] . '</a>';
+	$navigation = '<a href="'.generate_link('forums&amp;file=admin_forums', array('admin' => true)) . '">' . $_CLASS['core_user']->lang['FORUM_INDEX'] . '</a>';
 
 	$forums_nav = get_forum_branch($parent_id, 'parents', 'descending');
 	foreach ($forums_nav as $row)
@@ -773,7 +773,7 @@
 		}
 		else
 		{
-			$navigation .= ' -&gt; <a href="'.generate_link('Forums&amp;file=admin_forums&amp;parent_id=' . $row['forum_id'], array('admin' => true)) . '">' . $row['forum_name'] . '</a>';
+			$navigation .= ' -&gt; <a href="'.generate_link('forums&amp;file=admin_forums&amp;parent_id=' . $row['forum_id'], array('admin' => true)) . '">' . $row['forum_name'] . '</a>';
 		}
 	}
 }
@@ -795,7 +795,7 @@
 	echo '<br /><div class="gen" align="center"><b>' . $_CLASS['core_user']->lang['FORUM_RESYNCED'] . '</b></div>';
 }
 
-?><form method="post" action="<?php echo generate_link('Forums&amp;file=admin_forums&amp;parent_id='.$parent_id, array('admin' => true)) ?>"><table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
+?><form method="post" action="<?php echo generate_link('forums&amp;file=admin_forums&amp;parent_id='.$parent_id, array('admin' => true)) ?>"><table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
 	<tr>
 		<td class="nav"><?php echo $navigation ?></td>
 	</tr>
@@ -834,10 +834,10 @@
 		}
 	}
 
-	$forum_title = ($forum_type != FORUM_LINK) ? '<a href="'.generate_link('Forums&amp;file=admin_forums&amp;parent_id=' . $row['forum_id'], array('admin' => true)) . '">' : '';
+	$forum_title = ($forum_type != FORUM_LINK) ? '<a href="'.generate_link('forums&amp;file=admin_forums&amp;parent_id=' . $row['forum_id'], array('admin' => true)) . '">' : '';
 	$forum_title .= $row['forum_name'];
 	$forum_title .= ($forum_type != FORUM_LINK) ? '</a>' : '';
-	$url = "Forums&amp;file=admin_forums&amp;parent_id=$parent_id&amp;f=" . $row['forum_id'];
+	$url = "forums&amp;file=admin_forums&amp;parent_id=$parent_id&amp;f=" . $row['forum_id'];
 
 ?>
 	<tr>
@@ -892,7 +892,7 @@
 	</tr>
 </table></form>
 
-<form method="post" action="<?php echo generate_link('Forums&amp;file=admin_forums', array('admin' => true)) ?>"><table width="100%" cellpadding="1" cellspacing="1" border="0">
+<form method="post" action="<?php echo generate_link('forums&amp;file=admin_forums', array('admin' => true)) ?>"><table width="100%" cellpadding="1" cellspacing="1" border="0">
 	<tr>
 		<td align="right"><?php echo $_CLASS['core_user']->lang['SELECT_FORUM']; ?>: <select name="parent_id" onchange="if(this.options[this.selectedIndex].value != -1){ this.form.submit(); }"><?php echo $forum_box; ?></select> <input class="btnlite" type="submit" value="<?php echo $_CLASS['core_user']->lang['GO']; ?>" /><input type="hidden" name="sid" value="<?php echo $_CLASS['core_user']->session_id; ?>" /></td>
 	</tr>
@@ -1252,7 +1252,7 @@
 
 	if ($action_subforums == 'delete')
 	{
-		$log_action_forums = 'FORUMS';
+		$log_action_forums = 'forums';
 
 		$forum_ids = array($forum_id);
 		$rows = get_forum_branch($forum_id, 'children', 'descending', FALSE);

Modified: cms/trunk/includes/forums/admin/admin_permissions.php
===================================================================
--- cms/trunk/includes/forums/admin/admin_permissions.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/admin/admin_permissions.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -223,7 +223,7 @@
 			}
 
 			// Logging ... first grab user or groupnames ...
-			$sql = ($ug_type == 'group') ? 'SELECT group_name as name, group_type FROM ' . GROUPS_TABLE . ' WHERE group_id' : 'SELECT username as name FROM ' . USERS_TABLE . ' WHERE user_id';
+			$sql = ($ug_type == 'group') ? 'SELECT group_name as name, group_type FROM ' . CORE_GROUPS_TABLE . ' WHERE group_id' : 'SELECT username as name FROM ' . CORE_USERS_TABLE . ' WHERE user_id';
 			$sql .=  ' IN (' . implode(', ', array_map('intval', $ug_data)) . ')';
 			$result = $_CLASS['core_db']->query($sql);
 
@@ -299,7 +299,7 @@
 		}
 
 		// Logging ... first grab user or groupnames ...
-		$sql = ($ug_type == 'group') ? 'SELECT group_name as name, group_type FROM ' . GROUPS_TABLE . ' WHERE group_id' : 'SELECT username as name FROM ' . USERS_TABLE . ' WHERE user_id';
+		$sql = ($ug_type == 'group') ? 'SELECT group_name as name, group_type FROM ' . CORE_GROUPS_TABLE . ' WHERE group_id' : 'SELECT username as name FROM ' . CORE_USERS_TABLE . ' WHERE user_id';
 		$sql .=  ' IN (' . implode(', ', array_map('intval', $ug_data)) . ')';
 		$result = $_CLASS['core_db']->query($sql);
 
@@ -421,7 +421,7 @@
 
 <p><?php echo $l_title_explain ?></p>
 
-<form method="post" action="<?php echo generate_link('Forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
+<form method="post" action="<?php echo generate_link('forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
 <?php
 
 	// Mode specific markup
@@ -475,7 +475,7 @@
 		<td class="row1" align="center" valign="middle">&nbsp;<select style="width:280px" name="ug_data[]" multiple="true" size="7"><?php 
 
 			$sql = "SELECT group_id, group_name, group_type   
-				FROM " . GROUPS_TABLE . " 
+				FROM " . CORE_GROUPS_TABLE . " 
 				ORDER BY group_type DESC";
 			$result = $_CLASS['core_db']->query($sql);
 
@@ -523,7 +523,7 @@
 
 <table width="100%" cellspacing="0" cellpadding="0" border="0">
 	<tr>
-		<td><form method="post" action="<?php echo generate_link('Forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
+		<td><form method="post" action="<?php echo generate_link('forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
 			<tr>
 				<th><?php echo $_CLASS['core_user']->lang['MANAGE_USERS']; ?></th>
 			</tr>
@@ -531,7 +531,7 @@
 				<td class="row1" align="center"><select style="width:280px" name="ug_data[]" multiple="multiple" size="5"><?php
 			
 	$sql = "SELECT u.user_id, u.username
-		FROM " . USERS_TABLE . " u, " . FORUMS_ACL_TABLE . " a, " . FORUMS_ACL_OPTIONS_TABLE . " o
+		FROM " . CORE_USERS_TABLE . " u, " . FORUMS_ACL_TABLE . " a, " . FORUMS_ACL_OPTIONS_TABLE . " o
 		WHERE o.auth_option LIKE '" . $sql_option_mode . "_%'
 			AND a.auth_option_id = o.auth_option_id
 			AND a.forum_id IN ($sql_forum_id)
@@ -553,7 +553,7 @@
 			</tr>
 		</table></form></td>
 
-		<td align="center"><form method="post" name="admingroups" action="<?php echo generate_link('Forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
+		<td align="center"><form method="post" name="admingroups" action="<?php echo generate_link('forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
 		<tr>
 			<th><?php echo $_CLASS['core_user']->lang['MANAGE_GROUPS']; ?></th>
 		</tr>
@@ -561,7 +561,7 @@
 			<td class="row1" align="center"><select style="width:280px" name="ug_data[]" multiple="multiple" size="5"><?php 
 	
 	$sql = "SELECT DISTINCT g.group_id, g.group_name, g.group_type 
-		FROM " . GROUPS_TABLE . " g, " . FORUMS_ACL_TABLE . " a, " . FORUMS_ACL_OPTIONS_TABLE . " o
+		FROM " . CORE_GROUPS_TABLE . " g, " . FORUMS_ACL_TABLE . " a, " . FORUMS_ACL_OPTIONS_TABLE . " o
 		WHERE o.auth_option LIKE '" . $sql_option_mode . "_%'
 			AND a.forum_id IN ($sql_forum_id)
 			AND a.auth_option_id = o.auth_option_id
@@ -586,7 +586,7 @@
 	</tr>
 	<tr>
 
-		<td><form method="post" action="<?php echo generate_link('Forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table class="tablebg" width="100%" cellspacing="1" cellpadding="4" border="0" align="center">
+		<td><form method="post" action="<?php echo generate_link('forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table class="tablebg" width="100%" cellspacing="1" cellpadding="4" border="0" align="center">
 			<tr>
 				<th><?php echo $_CLASS['core_user']->lang['ADD_USERS']; ?></th>
 			</tr>
@@ -598,7 +598,7 @@
 			</tr>
 		</table></form></td>
 
-		<td><form method="post" action="<?php echo generate_link('Forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
+		<td><form method="post" action="<?php echo generate_link('forums&amp;file=admin_permissions&amp;mode='.$mode, array('admin' => true)); ?>"><table width="100%" class="tablebg" cellspacing="1" cellpadding="4" border="0" align="center">
 			<tr>
 				<th><?php echo $_CLASS['core_user']->lang['ADD_GROUPS']; ?></th>
 			</tr>
@@ -606,7 +606,7 @@
 				<td class="row1" style="height: 100%" align="center"><select style="width:280px" name="ug_data[]" multiple="multiple"  size="5"><?php 
 			
 	$sql = "SELECT group_id, group_name, group_type 
-		FROM " . GROUPS_TABLE . "
+		FROM " . CORE_GROUPS_TABLE . "
 		ORDER BY group_type DESC, group_name";
 	$result = $_CLASS['core_db']->query($sql);
 
@@ -686,7 +686,7 @@
 		case 'user':
 			$l_no_error = $_CLASS['core_user']->lang['NO_USER'];
 			$sql = 'SELECT user_id AS id, username AS name 
-				FROM ' . USERS_TABLE . ' 
+				FROM ' . CORE_USERS_TABLE . ' 
 				WHERE ';
 			$sql .= ($submit == 'add_options') ? " username IN ('" . implode("', '", $_CLASS['core_db']->escape_array(array_unique(explode("\n", modify_lines($ug_data[0], "\n"))))) . "')" : ' user_id ' . ((is_array($ug_data)) ? 'IN (' . implode(', ', array_map('intval', $ug_data)) . ')' : '= ' . (int) $ug_data);
 		break;
@@ -694,7 +694,7 @@
 		case 'group':
 			$l_no_error = $_CLASS['core_user']->lang['NO_GROUP'];
 			$sql = 'SELECT group_id AS id, group_name AS name, group_type  
-				FROM ' . GROUPS_TABLE . '
+				FROM ' . CORE_GROUPS_TABLE . '
 				WHERE group_id';
 			$sql .= (is_array($ug_data)) ? ' IN (' . implode(', ', array_map('intval', $ug_data)) . ')' : ' = ' . (int) $ug_data;
 		break;
@@ -1018,7 +1018,7 @@
 
 ?>
 
-<form method="post" name="acl" action="<?php echo generate_link('Forums&amp;file=admin_permissions&amp;mode='.$mode.'&amp;submode='.$submode, array('admin' => true)); ?>"><table cellspacing="2" cellpadding="0" border="0" align="center">
+<form method="post" name="acl" action="<?php echo generate_link('forums&amp;file=admin_permissions&amp;mode='.$mode.'&amp;submode='.$submode, array('admin' => true)); ?>"><table cellspacing="2" cellpadding="0" border="0" align="center">
 <?php
 
 	// This is the main listing of options

Modified: cms/trunk/includes/forums/admin/links.php
===================================================================
--- cms/trunk/includes/forums/admin/links.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/admin/links.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -7,44 +7,44 @@
 //Need to be in the admin menu look into making a new one or using this one :-)
 /*if ($_CLASS['auth']->acl_get('a_ban'))
 {
-	$module['USER']['BAN_USERS'] = generate_link('Forums&amp;file=admin_ban'..'&amp;mode=user');
-	$module['USER']['BAN_EMAILS'] = generate_link('Forums&amp;file=admin_ban'..'&amp;mode=email');
-	$module['USER']['BAN_IPS'] = generate_link('Forums&amp;file=admin_ban'..'&amp;mode=ip');
+	$module['USER']['BAN_USERS'] = generate_link('forums&amp;file=admin_ban'..'&amp;mode=user');
+	$module['USER']['BAN_EMAILS'] = generate_link('forums&amp;file=admin_ban'..'&amp;mode=email');
+	$module['USER']['BAN_IPS'] = generate_link('forums&amp;file=admin_ban'..'&amp;mode=ip');
 }*/
 
-$module['LOG']['ADMIN_LOGS']			 =  ($_CLASS['auth']->acl_get('a_')) ? generate_link('Forums&amp;file=admin_viewlogs&amp;mode=admin', array('admin' => true)) : false;
-$module['LOG']['MOD_LOGS']				 = ($_CLASS['auth']->acl_get('a_')) ? generate_link('Forums&amp;file=admin_viewlogs&amp;mode=mod', array('admin' => true)) : false;
-$module['LOG']['CRITICAL_LOGS']			 = ($_CLASS['auth']->acl_get('a_')) ? generate_link('Forums&amp;file=admin_viewlogs&amp;mode=critical', array('admin' => true)) : false;
+$module['LOG']['ADMIN_LOGS']			 =  ($_CLASS['auth']->acl_get('a_')) ? generate_link('forums&amp;file=admin_viewlogs&amp;mode=admin', array('admin' => true)) : false;
+$module['LOG']['MOD_LOGS']				 = ($_CLASS['auth']->acl_get('a_')) ? generate_link('forums&amp;file=admin_viewlogs&amp;mode=mod', array('admin' => true)) : false;
+$module['LOG']['CRITICAL_LOGS']			 = ($_CLASS['auth']->acl_get('a_')) ? generate_link('forums&amp;file=admin_viewlogs&amp;mode=critical', array('admin' => true)) : false;
 	
-$module['DB']['SEARCH_INDEX'] 				= ($_CLASS['auth']->acl_get('a_search')) ? generate_link('Forums&amp;file=admin_search', array('admin' => true)) : false;
+$module['DB']['SEARCH_INDEX'] 				= ($_CLASS['auth']->acl_get('a_search')) ? generate_link('forums&amp;file=admin_search', array('admin' => true)) : false;
 
-$module['USER']['RANKS']					= ($_CLASS['auth']->acl_get('a_ranks')) ? generate_link('Forums&amp;file=admin_ranks', array('admin' => true)) : '';
-$module['USER']['DISALLOW']					= ($_CLASS['auth']->acl_get('a_names')) ? generate_link('Forums&amp;file=admin_disallow', array('admin' => true)) : '';
+$module['USER']['RANKS']					= ($_CLASS['auth']->acl_get('a_ranks')) ? generate_link('forums&amp;file=admin_ranks', array('admin' => true)) : '';
+$module['USER']['DISALLOW']					= ($_CLASS['auth']->acl_get('a_names')) ? generate_link('forums&amp;file=admin_disallow', array('admin' => true)) : '';
 
-$module['FORUM']['MANAGE']					= ($_CLASS['auth']->acl_gets('a_forum', 'a_forumadd', 'a_forumdel')) ? generate_link('Forums&amp;file=admin_forums', array('admin' => true)) : false;
-$module['FORUM']['PRUNE']   				= ($_CLASS['auth']->acl_get('a_prune')) ? generate_link('Forums&amp;file=admin_prune&amp;mode=forums', array('admin' => true)) : false;
+$module['FORUM']['MANAGE']					= ($_CLASS['auth']->acl_gets('a_forum', 'a_forumadd', 'a_forumdel')) ? generate_link('forums&amp;file=admin_forums', array('admin' => true)) : false;
+$module['FORUM']['PRUNE']   				= ($_CLASS['auth']->acl_get('a_prune')) ? generate_link('forums&amp;file=admin_prune&amp;mode=forums', array('admin' => true)) : false;
 
-$module['PERM']['PERMISSIONS']				= ($_CLASS['auth']->acl_get('a_auth')) ? generate_link('Forums&amp;file=admin_permissions&amp;mode=forum', array('admin' => true)) : '';
-$module['PERM']['MODERATORS'] 				= ($_CLASS['auth']->acl_get('a_authmods')) ? generate_link('Forums&amp;file=admin_permissions&amp;mode=mod', array('admin' => true)) : '';
-$module['PERM']['SUPER_MODERATORS']			= ($_CLASS['auth']->acl_get('a_authmods')) ? generate_link('Forums&amp;file=admin_permissions&amp;mode=supermod', array('admin' => true)) : '';
-$module['PERM']['ADMINISTRATORS']			= ($_CLASS['auth']->acl_get('a_authadmins')) ? generate_link('Forums&amp;file=admin_permissions&amp;mode=admin', array('admin' => true)) : '';
-$module['PERM']['USER_PERMS']				= ($_CLASS['auth']->acl_get('a_authusers')) ? generate_link('Forums&amp;file=admin_permissions&amp;mode=user', array('admin' => true)) : '';
-$module['PERM']['GROUP_PERMS']				= ($_CLASS['auth']->acl_get('a_authgroups')) ? generate_link('Forums&amp;file=admin_permissions&amp;mode=group', array('admin' => true)) : '';
+$module['PERM']['PERMISSIONS']				= ($_CLASS['auth']->acl_get('a_auth')) ? generate_link('forums&amp;file=admin_permissions&amp;mode=forum', array('admin' => true)) : '';
+$module['PERM']['MODERATORS'] 				= ($_CLASS['auth']->acl_get('a_authmods')) ? generate_link('forums&amp;file=admin_permissions&amp;mode=mod', array('admin' => true)) : '';
+$module['PERM']['SUPER_MODERATORS']			= ($_CLASS['auth']->acl_get('a_authmods')) ? generate_link('forums&amp;file=admin_permissions&amp;mode=supermod', array('admin' => true)) : '';
+$module['PERM']['ADMINISTRATORS']			= ($_CLASS['auth']->acl_get('a_authadmins')) ? generate_link('forums&amp;file=admin_permissions&amp;mode=admin', array('admin' => true)) : '';
+$module['PERM']['USER_PERMS']				= ($_CLASS['auth']->acl_get('a_authusers')) ? generate_link('forums&amp;file=admin_permissions&amp;mode=user', array('admin' => true)) : '';
+$module['PERM']['GROUP_PERMS']				= ($_CLASS['auth']->acl_get('a_authgroups')) ? generate_link('forums&amp;file=admin_permissions&amp;mode=group', array('admin' => true)) : '';
 
-$module['GENERAL']['AVATAR_SETTINGS']		= ($_CLASS['auth']->acl_get('a_board')) ? generate_link('Forums&amp;file=admin_board&amp;mode=avatar', array('admin' => true)) : '';
-$module['GENERAL']['BOARD_DEFAULTS']		= ($_CLASS['auth']->acl_get('a_defaults')) ? generate_link('Forums&amp;file=admin_board&amp;mode=default', array('admin' => true)) : '';
-$module['GENERAL']['BOARD_SETTINGS']		= ($_CLASS['auth']->acl_get('a_board')) ? generate_link('Forums&amp;file=admin_board&amp;mode=setting', array('admin' => true)) : '';
-$module['GENERAL']['EMAIL_SETTINGS']		= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('Forums&amp;file=admin_board&amp;mode=email', array('admin' => true)) : '';
-$module['GENERAL']['LOAD_SETTINGS']			= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('Forums&amp;file=admin_board&amp;mode=load', array('admin' => true)) : '';
-$module['GENERAL']['SERVER_SETTINGS']		= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('Forums&amp;file=admin_board&amp;mode=server', array('admin' => true)) : '';
-$module['GENERAL']['MESSAGE_SETTINGS']		= ($_CLASS['auth']->acl_get('a_defaults')) ? generate_link('Forums&amp;file=admin_board&amp;mode=message', array('admin' => true)) : '';
-$module['GENERAL']['ATTACHMENT_SETTINGS'] 	= ($_CLASS['auth']->acl_get('a_attach')) ? generate_link('Forums&amp;file=admin_attachments&amp;mode=attach', array('admin' => true)) : '';
-$module['GENERAL']['IM'] 					= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('Forums&amp;file=admin_jabber', array('admin' => true)) : '';
-$module['GENERAL']['PHP_INFO'] 				= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('Forums&amp;file=admin_phpinfo', array('admin' => true)) : '';
-$module['GENERAL']['MASS_EMAIL']			= ($_CLASS['auth']->acl_get('a_email')) ? generate_link('Forums&amp;file=admin_email', array('admin' => true)) : '';
+$module['GENERAL']['AVATAR_SETTINGS']		= ($_CLASS['auth']->acl_get('a_board')) ? generate_link('forums&amp;file=admin_board&amp;mode=avatar', array('admin' => true)) : '';
+$module['GENERAL']['BOARD_DEFAULTS']		= ($_CLASS['auth']->acl_get('a_defaults')) ? generate_link('forums&amp;file=admin_board&amp;mode=default', array('admin' => true)) : '';
+$module['GENERAL']['BOARD_SETTINGS']		= ($_CLASS['auth']->acl_get('a_board')) ? generate_link('forums&amp;file=admin_board&amp;mode=setting', array('admin' => true)) : '';
+$module['GENERAL']['EMAIL_SETTINGS']		= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('forums&amp;file=admin_board&amp;mode=email', array('admin' => true)) : '';
+$module['GENERAL']['LOAD_SETTINGS']			= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('forums&amp;file=admin_board&amp;mode=load', array('admin' => true)) : '';
+$module['GENERAL']['SERVER_SETTINGS']		= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('forums&amp;file=admin_board&amp;mode=server', array('admin' => true)) : '';
+$module['GENERAL']['MESSAGE_SETTINGS']		= ($_CLASS['auth']->acl_get('a_defaults')) ? generate_link('forums&amp;file=admin_board&amp;mode=message', array('admin' => true)) : '';
+$module['GENERAL']['ATTACHMENT_SETTINGS'] 	= ($_CLASS['auth']->acl_get('a_attach')) ? generate_link('forums&amp;file=admin_attachments&amp;mode=attach', array('admin' => true)) : '';
+$module['GENERAL']['IM'] 					= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('forums&amp;file=admin_jabber', array('admin' => true)) : '';
+$module['GENERAL']['PHP_INFO'] 				= ($_CLASS['auth']->acl_get('a_server')) ? generate_link('forums&amp;file=admin_phpinfo', array('admin' => true)) : '';
+$module['GENERAL']['MASS_EMAIL']			= ($_CLASS['auth']->acl_get('a_email')) ? generate_link('forums&amp;file=admin_email', array('admin' => true)) : '';
 
-$module['POST']['ATTACHMENTS'] 				= ($_CLASS['auth']->acl_get('a_attach')) ? generate_link('Forums&amp;file=admin_attachments&amp;mode=ext_groups', array('admin' => true)) : '';
-$module['POST']['BBCODES']					= ($_CLASS['auth']->acl_get('a_bbcode')) ? generate_link('Forums&amp;file=admin_bbcodes', array('admin' => true)) : '';
-$module['POST']['ICONS']					= ($_CLASS['auth']->acl_get('a_icons')) ? generate_link('Forums&amp;file=admin_icons&amp;mode=icons', array('admin' => true)) : '';
+$module['POST']['ATTACHMENTS'] 				= ($_CLASS['auth']->acl_get('a_attach')) ? generate_link('forums&amp;file=admin_attachments&amp;mode=ext_groups', array('admin' => true)) : '';
+$module['POST']['BBCODES']					= ($_CLASS['auth']->acl_get('a_bbcode')) ? generate_link('forums&amp;file=admin_bbcodes', array('admin' => true)) : '';
+$module['POST']['ICONS']					= ($_CLASS['auth']->acl_get('a_icons')) ? generate_link('forums&amp;file=admin_icons&amp;mode=icons', array('admin' => true)) : '';
 
 ?>
\ No newline at end of file

Modified: cms/trunk/includes/forums/admin/main.php
===================================================================
--- cms/trunk/includes/forums/admin/main.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/admin/main.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -113,12 +113,12 @@
 // Get forum statistics
 $total_posts = $config['num_posts'];
 $total_topics = $config['num_topics'];
-$total_users = $config['num_users'];
+$total_users = $_CORE_CONFIG['user']['total_users'];
 $total_files = $config['num_files'];
 
-$start_date = $_CLASS['core_user']->format_date($config['board_startdate']);
+$start_date = $_CLASS['core_user']->format_date($config['board_start_date']);
 
-$boarddays = (gmtime() - $config['board_startdate']) / 86400;
+$boarddays = (gmtime() - $config['board_start_date']) / 86400;
 
 $posts_per_day = sprintf('%.2f', $total_posts / $boarddays);
 $topics_per_day = sprintf('%.2f', $total_topics / $boarddays);

Modified: cms/trunk/includes/forums/functions.php
===================================================================
--- cms/trunk/includes/forums/functions.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/functions.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -27,7 +27,7 @@
 $config_error = '<center>There is currently a problem with the site<br/>';
 $config_error .= 'Please try again later<br /><br />Error Code: DB3</center>';
 
-global $config;
+global $_CLASS, $config;
 
 if (is_null($config = $_CLASS['core_cache']->get('config')))
 {
@@ -333,14 +333,14 @@
 // User authorisation levels output
 function gen_forum_auth_level($mode, $forum_id)
 {
-	global $_CLASS;
+	global $_CLASS, $config;
 
 	$rules = array(
 		($_CLASS['forums_auth']->acl_get('f_post', $forum_id)) ? $_CLASS['core_user']->lang['RULES_POST_CAN'] : $_CLASS['core_user']->lang['RULES_POST_CANNOT'],
 		($_CLASS['forums_auth']->acl_get('f_reply', $forum_id)) ? $_CLASS['core_user']->lang['RULES_REPLY_CAN'] : $_CLASS['core_user']->lang['RULES_REPLY_CANNOT'],
 		($_CLASS['forums_auth']->acl_gets(array('f_edit', 'm_edit'), $forum_id)) ? $_CLASS['core_user']->lang['RULES_EDIT_CAN'] : $_CLASS['core_user']->lang['RULES_EDIT_CANNOT'],
 		($_CLASS['forums_auth']->acl_gets(array('f_delete', 'm_delete'), $forum_id)) ? $_CLASS['core_user']->lang['RULES_DELETE_CAN'] : $_CLASS['core_user']->lang['RULES_DELETE_CANNOT'],
-		($_CLASS['forums_auth']->acl_get('f_attach', $forum_id) && $_CLASS['forums_auth']->acl_get('u_attach', $forum_id)) ? $_CLASS['core_user']->lang['RULES_ATTACH_CAN'] : $_CLASS['core_user']->lang['RULES_ATTACH_CANNOT']
+		($config['allow_attachments'] && $_CLASS['forums_auth']->acl_get('f_attach', $forum_id) && $_CLASS['forums_auth']->acl_get('u_attach', $forum_id)) ? $_CLASS['core_user']->lang['RULES_ATTACH_CAN'] : $_CLASS['core_user']->lang['RULES_ATTACH_CANNOT']
 	);
 
 	foreach ($rules as $rule)
@@ -976,7 +976,7 @@
 
 	page_header();
 
-	$_CLASS['core_template']->display('modules/Forums/login_forum.html');
+	$_CLASS['core_template']->display('modules/forums/login_forum.html');
 
 	script_close();
 }
@@ -1103,12 +1103,12 @@
 	// Generate logged in/logged out status
 	if ($_CLASS['core_user']->is_user)
 	{
-		$u_login_logout = generate_link('Control_Panel&amp;mode=logout');
+		$u_login_logout = generate_link('control_panel&amp;mode=logout');
 		$l_login_logout = sprintf($_CLASS['core_user']->lang['LOGOUT_USER'], $_CLASS['core_user']->data['username']);
 	}
 	elseif (!$_CLASS['core_user']->is_bot)
 	{
-		$u_login_logout = generate_link('Control_Panel&amp;mode=login');
+		$u_login_logout = generate_link('control_panel&amp;mode=login');
 		$l_login_logout = $_CLASS['core_user']->lang['LOGIN'];
 	}
 
@@ -1282,23 +1282,23 @@
 		'L_REGISTER' 			=> $_CLASS['core_user']->lang['REGISTER'],
 		'L_INDEX' 				=> $_CLASS['core_user']->lang['FORUM_INDEX'], 
 		'L_ONLINE_EXPLAIN'		=> $l_online_time, 
-		'U_PRIVATEMSGS'			=> generate_link('Control_Panel&amp;i=pm&amp;mode=' . (($_CLASS['core_user']->data['user_new_privmsg'] || $l_privmsgs_text_unread) ? 'unread' : 'view_messages')),
-		'U_RETURN_INBOX'		=> generate_link("Control_Panel&amp;i=pm&amp;folder=inbox"),
-		'U_MEMBERLIST' 			=> generate_link('Members_List'),
-		'U_VIEWONLINE' 			=> generate_link('View_Online'),
-		'U_MEMBERSLIST'			=> generate_link('Members_List'),
+		'U_PRIVATEMSGS'			=> generate_link('control_panel&amp;i=pm&amp;mode=' . (($_CLASS['core_user']->data['user_new_privmsg'] || $l_privmsgs_text_unread) ? 'unread' : 'view_messages')),
+		'U_RETURN_INBOX'		=> generate_link("control_panel&amp;i=pm&amp;folder=inbox"),
+		'U_MEMBERLIST' 			=> generate_link('members_list'),
+		'U_VIEWONLINE' 			=> generate_link('view_online'),
+		'U_MEMBERSLIST'			=> generate_link('members_list'),
 		'U_LOGIN_LOGOUT'		=> $u_login_logout,
-		'U_INDEX' 				=> generate_link('Forums'),
-		'U_SEARCH' 				=> generate_link('Forums&amp;file=search'),
-		'U_REGISTER' 			=> generate_link('Control_Panel&amp;mode=register'),
-		'U_PROFILE' 			=> generate_link('Control_Panel'),
-		'U_MODCP' 				=> generate_link('Forums&amp;file=mcp'),
-		'U_FAQ' 				=> generate_link('Forums&amp;file=faq'),
-		'U_SEARCH_SELF'			=> generate_link('Forums&amp;file=search&amp;search_id=egosearch'),
-		'U_SEARCH_NEW' 			=> generate_link('Forums&amp;file=search&amp;search_id=newposts'),
-		'U_SEARCH_UNANSWERED'	=> generate_link('Forums&amp;file=search&amp;search_id=unanswered'),
-		'U_SEARCH_ACTIVE_TOPICS'=> generate_link('Forums&amp;file=search&amp;search_id=active_topics'),
-		'U_DELETE_COOKIES'		=> generate_link('Control_Panel&amp;mode=delete_cookies'),
+		'U_INDEX' 				=> generate_link('forums'),
+		'U_SEARCH' 				=> generate_link('forums&amp;file=search'),
+		'U_REGISTER' 			=> generate_link('control_panel&amp;mode=register'),
+		'U_PROFILE' 			=> generate_link('control_panel'),
+		'U_MODCP' 				=> generate_link('forums&amp;file=mcp'),
+		'U_FAQ' 				=> generate_link('forums&amp;file=faq'),
+		'U_SEARCH_SELF'			=> generate_link('forums&amp;file=search&amp;search_id=egosearch'),
+		'U_SEARCH_NEW' 			=> generate_link('forums&amp;file=search&amp;search_id=newposts'),
+		'U_SEARCH_UNANSWERED'	=> generate_link('forums&amp;file=search&amp;search_id=unanswered'),
+		'U_SEARCH_ACTIVE_TOPICS'=> generate_link('forums&amp;file=search&amp;search_id=active_topics'),
+		'U_DELETE_COOKIES'		=> generate_link('p&amp;mode=delete_cookies'),
 
 		'S_USER_LOGGED_IN' 		=> ($_CLASS['core_user']->data['user_id'] != ANONYMOUS) ? true : false,
 		'S_REGISTERED_USER'		=> $_CLASS['core_user']->is_user,

Modified: cms/trunk/includes/forums/functions_admin.php
===================================================================
--- cms/trunk/includes/forums/functions_admin.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/functions_admin.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -1106,7 +1106,7 @@
 			if (!empty($post_ids))
 			{
 				$sql = 'SELECT p.post_id, p.poster_id, p.post_time, p.post_username, u.username
-					FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+					FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u
 					WHERE p.post_id IN (' . implode(', ', $post_ids) . ')
 						AND p.poster_id = u.user_id';
 				$result = $_CLASS['core_db']->query($sql);
@@ -1272,7 +1272,7 @@
 			}
 
 			$sql = 'SELECT p.post_id, p.topic_id, p.post_approved, p.poster_id, p.post_username, p.post_time, u.username
-				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u
 				WHERE p.post_id IN (' . implode(',', $post_ids) . ')
 					AND u.user_id = p.poster_id';
 			$result = $_CLASS['core_db']->query($sql);
@@ -1617,7 +1617,7 @@
 	$user_id_sql = '';
 
 	$sql = 'SELECT a.forum_id, u.user_id, u.username
-		FROM  ' . FORUMS_ACL_OPTIONS_TABLE . '  o, ' . FORUMS_ACL_TABLE . ' a,  ' . USERS_TABLE . "  u
+		FROM  ' . FORUMS_ACL_OPTIONS_TABLE . '  o, ' . FORUMS_ACL_TABLE . ' a,  ' . CORE_USERS_TABLE . "  u
 		WHERE o.auth_option = 'm_'
 			AND a.auth_option_id = o.auth_option_id
 			AND a.auth_setting = " . ACL_YES . '
@@ -1632,7 +1632,7 @@
 	$_CLASS['core_db']->free_result($result);
 
 	$sql = 'SELECT a.forum_id, g.group_name, g.group_id
-		FROM  ' . FORUMS_ACL_OPTIONS_TABLE . '  o, ' . FORUMS_ACL_TABLE . ' a,  ' . GROUPS_TABLE . "  g
+		FROM  ' . FORUMS_ACL_OPTIONS_TABLE . '  o, ' . FORUMS_ACL_TABLE . ' a,  ' . CORE_GROUPS_TABLE . "  g
 		WHERE o.auth_option = 'm_'
 			AND a.auth_option_id = o.auth_option_id
 			AND a.auth_setting = " . ACL_YES . '
@@ -1768,7 +1768,7 @@
 	}
 
 	$sql = "SELECT l.*, u.username
-		FROM " . FORUMS_LOG_TABLE . " l, " . USERS_TABLE . " u
+		FROM " . FORUMS_LOG_TABLE . " l, " . CORE_USERS_TABLE . " u
 		WHERE l.log_type = $log_type
 			AND u.user_id = l.user_id
 			" . (($limit_days) ? "AND l.log_time >= $limit_days" : '') . "
@@ -2224,7 +2224,7 @@
 	if (!empty($last_post_ids))
 	{
 		$sql = 'SELECT p.' . $type . '_id, p.post_id, p.post_time, p.poster_id, p.post_username, u.user_id, u.username
-			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u
 			WHERE p.poster_id = u.user_id
 				AND p.post_id IN (' . implode(', ', $last_post_ids) . ')';
 		$result = $_CLASS['core_db']->query($sql);

Modified: cms/trunk/includes/forums/functions_display.php
===================================================================
--- cms/trunk/includes/forums/functions_display.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/functions_display.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -32,7 +32,7 @@
 // 
 // -------------------------------------------------------------
 
-function display_forums($root_data = '', $display_moderators = true)
+function display_forums($root_data = '', $display_moderators = true, $return_moderators = false)
 {
 	global $config, $_CLASS, $_CORE_CONFIG;
 
@@ -104,9 +104,7 @@
 			continue;
 		}
 
-		$forum_id = $row['forum_id'];
-
-		if (!$_CLASS['auth']->acl_get('f_list', $forum_id))
+		if (!$_CLASS['auth']->acl_get('f_list', $row['forum_id']))
 		{
 			// if the user does not have permissions to list this forum, skip everything until next branch
 			$right_id = $row['right_id'];
@@ -114,33 +112,37 @@
 		}
 
 		// Display active topics from this forum?
-		if ($show_active && $row['forum_type'] == FORUM_POST && $_CLASS['auth']->acl_get('f_read', $forum_id) && ($row['forum_flags'] & 16))
+		if ($show_active && $row['forum_type'] == FORUM_POST && $_CLASS['auth']->acl_get('f_read', $row['forum_id']) && ($row['forum_flags'] & 16))
 		{
-			$active_forum_ary['forum_id'][]		= $forum_id;
+			$active_forum_ary['forum_id'][]		= $row['forum_id'];
 			$active_forum_ary['enable_icons'][] = $row['enable_icons'];
-			$active_forum_ary['forum_topics']	+= ($_CLASS['auth']->acl_get('m_approve', $forum_id)) ? $row['forum_topics_real'] : $row['forum_topics'];
+			$active_forum_ary['forum_topics']	+= ($_CLASS['auth']->acl_get('m_approve', $row['forum_id'])) ? $row['forum_topics_real'] : $row['forum_topics'];
 			$active_forum_ary['forum_posts']	+= $row['forum_posts'];
 		}
 
 		if ($row['parent_id'] == $root_data['forum_id'] || $row['parent_id'] == $branch_root_id)
 		{
+			if ($row['forum_type'] != FORUM_CAT)
+			{
+				$forum_ids_moderator[] = $row['forum_id'];
+			}
+
 			// Direct child
-			$parent_id = $forum_id;
-			$forum_rows[$forum_id] = $row;
-			$forum_ids[] = $forum_id;
+			$parent_id = $row['forum_id'];
+			$forum_rows[$row['forum_id']] = $row;
 
 			if (!$row['parent_id'] && $row['forum_type'] == FORUM_CAT && $row['parent_id'] == $root_data['forum_id'])
 			{
-				$branch_root_id = $forum_id;
+				$branch_root_id = $row['forum_id'];
 			}
 			$forum_rows[$parent_id]['forum_id_last_post'] = $row['forum_id'];
 		}
 		elseif ($row['forum_type'] != FORUM_CAT)
 		{
-			$subforums[$parent_id]['display'] = ($row['display_on_index']) ? true : false;;
-			$subforums[$parent_id]['name'][$forum_id] = $row['forum_name'];
+			$subforums[$parent_id][$row['forum_id']]['display'] = ($row['display_on_index']) ? true : false;
+			$subforums[$parent_id][$row['forum_id']]['name'] = $row['forum_name'];
 
-			$forum_rows[$parent_id]['forum_topics'] += ($_CLASS['auth']->acl_get('m_approve', $forum_id)) ? $row['forum_topics_real'] : $row['forum_topics'];
+			$forum_rows[$parent_id]['forum_topics'] += ($_CLASS['auth']->acl_get('m_approve', $row['forum_id'])) ? $row['forum_topics_real'] : $row['forum_topics'];
 			
 			// Do not list redirects in LINK Forums as Posts.
 			if ($row['forum_type'] != FORUM_LINK)
@@ -154,17 +156,17 @@
 				$forum_rows[$parent_id]['forum_last_post_time'] = $row['forum_last_post_time'];
 				$forum_rows[$parent_id]['forum_last_poster_id'] = $row['forum_last_poster_id'];
 				$forum_rows[$parent_id]['forum_last_poster_name'] = $row['forum_last_poster_name'];
-				$forum_rows[$parent_id]['forum_id_last_post'] = $forum_id;
+				$forum_rows[$parent_id]['forum_id_last_post'] = $row['forum_id'];
 			}
 			else
 			{
-				$forum_rows[$parent_id]['forum_id_last_post'] = $forum_id;
+				$forum_rows[$parent_id]['forum_id_last_post'] = $row['forum_id'];
 			}
 		}
 
 		if (!$_CLASS['core_user']->is_user || !$config['load_db_lastread'])
 		{
-			$forum_id36 = base_convert($forum_id, 10, 36);
+			$forum_id36 = base_convert($row['forum_id'], 10, 36);
 			$row['mark_time'] = isset($tracking_topics[$forum_id36][0]) ? (int) base_convert($tracking_topics[$forum_id36][0], 36, 10) : 0;
 		}
 
@@ -191,38 +193,31 @@
 	// Grab moderators ... if necessary
 	if ($display_moderators)
 	{
-		$forum_moderators = get_moderators($forum_ids);
+		if ($return_moderators)
+		{
+			$forum_ids_moderator[] = $root_data['forum_id'];
+		}
+		$forum_moderators = get_moderators($forum_ids_moderator);
 	}
 
 	// Loop through the forums
-	$root_id = $root_data['forum_id'];
-
 	foreach ($forum_rows as $row)
 	{
-		if ($row['parent_id'] == $root_id && !$row['parent_id'])
+		// Empty category
+		if ($row['parent_id'] == $root_data['forum_id'] && $row['forum_type'] == FORUM_CAT)
 		{
-			if ($row['forum_type'] == FORUM_CAT)
-			{
-				$hold = $row;
-				continue;
-			}
-			else
-			{
-				unset($hold);
-			}
-		}
-		else if (!empty($hold))
-		{
 			$_CLASS['core_template']->assign_vars_array('forumrow', array(
-				'S_IS_CAT'			=>	TRUE,
-				'FORUM_ID'			=>	$hold['forum_id'],
-				'FORUM_NAME'		=>	$hold['forum_name'],
-				'FORUM_DESC'		=>	$hold['forum_desc'],
-				'U_VIEWFORUM'		=>	generate_link('Forums&amp;file=viewforum&amp;f=' . $hold['forum_id']))
+				'S_IS_CAT'			=>	true,
+				'FORUM_ID'			=>	$row['forum_id'],
+				'FORUM_NAME'		=>	$row['forum_name'],
+				'FORUM_DESC'		=>	$row['forum_desc'],
+				'U_VIEWFORUM'		=>	generate_link('forums&amp;file=viewforum&amp;f=' . $row['forum_id']))
 			);
-			unset($hold);
+			
+			continue;
 		}
 
+
 		$visible_forums++;
 		$forum_id = $row['forum_id'];
 
@@ -231,22 +226,23 @@
 		// Generate list of subforums if we need to
 		if (isset($subforums[$forum_id]))
 		{
-			if ($subforums[$forum_id]['display'])
+			foreach ($subforums[$forum_id] as $subforum_id => $subforum_row)
 			{
 				$links = array();
 
-				foreach ($subforums[$forum_id]['name'] as $subforum_id => $subforum_name)
+				if ($subforum_row['display'] && $subforum_row['name'])
 				{
-					if (!empty($subforum_name))
-					{
-						$links[] = '<a href="' .generate_link('Forums&amp;file=viewforum&amp;f='.$subforum_id).'">' . $subforum_name . '</a>';
-					}
+					$links[] = '<a href="' .generate_link('forums&amp;file=viewforum&amp;f='.$subforum_id).'">' .  $subforum_row['name'] . '</a>';
 				}
+				else
+				{
+					unset($subforums[$forum_id][$subforum_id]);
+				}
 
 				if (!empty($links))
 				{
 					$subforums_list = implode(', ', $links);
-					$l_subforums = (count($subforums[$forum_id]) == 1) ? $_CLASS['core_user']->lang['SUBFORUM'] . ': ' : $_CLASS['core_user']->lang['SUBFORUMS'] . ': ';
+					$l_subforums = (count($subforums[$forum_id]) === 1) ? $_CLASS['core_user']->lang['SUBFORUM'] . ': ' : $_CLASS['core_user']->lang['SUBFORUMS'] . ': ';
 				}
 
 				unset($links);
@@ -260,11 +256,11 @@
 			{
 				case FORUM_POST:
 					$folder_image = (!empty($forum_unread[$forum_id])) ? 'forum_new' : 'forum';
-					break;
+				break;
 
 				case FORUM_LINK:
 					$folder_image = 'forum_link';
-					break;
+				break;
 			}
 		}
 
@@ -289,7 +285,7 @@
 			$last_poster = ($row['forum_last_poster_name'] != '') ? $row['forum_last_poster_name'] : $_CLASS['core_user']->lang['GUEST'];
 			$last_poster_url = ($row['forum_last_poster_id'] == ANONYMOUS) ? '' : generate_link('Members_List&amp;mode=viewprofile&amp;u='  . $row['forum_last_poster_id']);
 			
-			$last_post_url = generate_link('Forums&amp;file=viewtopic&amp;f='.$row['forum_id_last_post'].'&amp;p='.$row['forum_last_post_id'].'#'.$row['forum_last_post_id'], false, false, false);
+			$last_post_url = generate_link('forums&amp;file=viewtopic&amp;f='.$row['forum_id_last_post'].'&amp;p='.$row['forum_last_post_id'].'#'.$row['forum_last_post_id'], false, false, false);
 		}
 		else
 		{
@@ -335,13 +331,13 @@
 			
 			'U_LAST_POSTER'		=> $last_poster_url, 
 			'U_LAST_POST'		=> $last_post_url, 
-			'U_VIEWFORUM'		=> ($row['forum_type'] != FORUM_LINK || $row['forum_flags'] & 1) ? generate_link('Forums&amp;file=viewforum&amp;f=' . $row['forum_id']) : $row['forum_link'])
+			'U_VIEWFORUM'		=> ($row['forum_type'] != FORUM_LINK || $row['forum_flags'] & 1) ? generate_link('forums&amp;file=viewforum&amp;f=' . $row['forum_id']) : $row['forum_link'])
 		);
 	}
 
 	$_CLASS['core_template']->assign_array(array(
 		'MODIFY_FORUM'		=> $_CLASS['auth']->acl_get('a_forum'),
-		'U_MARK_FORUMS'		=> generate_link('Forums&amp;file=viewforum&amp;f=' . $root_data['forum_id'] . '&amp;mark=Forums'), 
+		'U_MARK_FORUMS'		=> generate_link('forums&amp;file=viewforum&amp;f=' . $root_data['forum_id'] . '&amp;mark=Forums'), 
 		'S_HAS_SUBFORUM'	=> ($visible_forums) ? true : false,
 		'L_SUBFORUM'		=> ($visible_forums == 1) ? $_CLASS['core_user']->lang['SUBFORUM'] : $_CLASS['core_user']->lang['SUBFORUMS']
 	));
@@ -484,7 +480,7 @@
 					$data['category'] = 'THUMBNAIL';
 	
 					$data['image_src'] = $thumbnail_filename;
-					$data['link'] = (!$force_physical) ? generate_link('Forums&amp;file=download&amp;id=' . $attachment['attach_id']) : $filename;
+					$data['link'] = (!$force_physical) ? generate_link('forums&amp;file=download&amp;id=' . $attachment['attach_id']) : $filename;
 				break;
 	
 				// Windows Media Streams
@@ -509,7 +505,7 @@
 	
 				default:
 					$data['category'] = 'FILE';
-					$data['link'] = (!$force_physical) ? generate_link('Forums&amp;file=download&amp;id=' . $attachment['attach_id']) : $filename;
+					$data['link'] = (!$force_physical) ? generate_link('forums&amp;file=download&amp;id=' . $attachment['attach_id']) : $filename;
 				break;
 			}
 			
@@ -524,7 +520,7 @@
 		if ($parse)
 		{
 			$_CLASS['core_template']->assign_vars_array('attachments', $data);
-			$datas[] = $_CLASS['core_template']->display('modules/Forums/attachments.html', true);
+			$datas[] = $_CLASS['core_template']->display('modules/forums/attachments.html', true);
 		}
 		else
 		{

Modified: cms/trunk/includes/forums/functions_posting.php
===================================================================
--- cms/trunk/includes/forums/functions_posting.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/forums/functions_posting.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -111,7 +111,7 @@
 	if ((int) $row['last_post_id'])
 	{
 		$sql = 'SELECT p.post_id, p.poster_id, p.post_time, u.username, p.post_username
-			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u
+			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u
 			WHERE p.poster_id = u.user_id
 				AND p.post_id = ' . $row['last_post_id'];
 		$result = $_CLASS['core_db']->query($sql);
@@ -733,7 +733,7 @@
 
 	// Go ahead and pull all data for this topic
 	$sql = 'SELECT u.username, u.user_id, p.post_id, p.post_username, p.post_subject, p.post_text, p.enable_smilies, p.bbcode_uid, p.bbcode_bitfield, p.post_time
-		FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . " u
+		FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . " u
 		WHERE p.topic_id = $topic_id
 			AND p.poster_id = u.user_id
 			" . ((!$_CLASS['auth']->acl_get('m_approve', $forum_id)) ? 'AND p.post_approved = 1' : '') . '
@@ -845,7 +845,7 @@
 
 	// Lets get all the users that are set to be notified
 	$sql = 'SELECT w.notify_type, w.forum_id, u.user_id, u.username, u.user_email, u.user_lang
-		FROM '.FORUMS_WATCH_TABLE.' w, ' . USERS_TABLE . " u
+		FROM '.FORUMS_WATCH_TABLE.' w, ' . CORE_USERS_TABLE . " u
 		WHERE $where
 			AND w.notify_status = 0
 			AND u.user_status = ". STATUS_ACTIVE . '

Modified: cms/trunk/includes/functions.php
===================================================================
--- cms/trunk/includes/functions.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/functions.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -142,7 +142,7 @@
 
 	$load = 0;
 
-	if (file_exists('/proc/loadavg'))
+	if (@file_exists('/proc/loadavg'))
 	{
 		if ($file = file_get_contents('/proc/loadavg'))
 		{

Added: cms/trunk/includes/templates/admin/modules/search.html
===================================================================
--- cms/trunk/includes/templates/admin/modules/search.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/admin/modules/search.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -0,0 +1,39 @@
+<!-- DISPLAY_HEADER -->
+
+{ $THEME_TABLE_OPEN }
+
+<table class="tablebg" cellpadding="4" cellspacing="1" width="100%">
+    <tbody>
+		<tr>
+			<th></th>
+			<th width="70%" align="center"><b>{ $L_TITLE }</b></th>
+			<th colspan="2" align="center"><b>{ $L_FUNCTIONS }</b></th>
+		</tr>
+		<tr>
+			<td class="spacer" colspan="4" height="7"></td>
+		</tr>
+		<!-- LOOP $modules_search -->
+		<tr>
+			<td height="24" class="row1">
+				<input name="mark_id[]" value="9" type="checkbox">
+			</td>
+			<td height="24" class="row1">
+				{ $modules_search:TITLE }
+			</td>
+			<td align="center" class="row2" onmouseover="this.className='row1'" onmouseout="this.className='row2'" onclick="location.href='{ $modules_search:LINK_ADD }'; return false;">
+				<a href="{ $modules_search:LINK_ADD }">{ $L_ADD_AND_DEACTIVE }</a>
+			</td>
+			<td align="center" class="row2" onmouseover="this.className='row1'" onmouseout="this.className='row2'" onclick="location.href='{ $modules_search:LINK_INSTALL }'; return false;">
+				<a href="{ $modules_search:LINK_INSTALL }">{ $L_ADD_AND_INSTALL }</a>
+			</td>
+		</tr>
+		<tr>
+			<td class="spacer" colspan="4" height="7"></td>
+		</tr>
+		<!-- ENDLOOP -->
+	</tbody>
+</table>
+
+{ $THEME_TABLE_CLOSE }
+
+<!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_agreement.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_agreement.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_agreement.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form method="post" action="{ $S_UCP_ACTION }">
 
@@ -28,6 +28,6 @@
 </table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_attachments.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_attachments.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_attachments.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <!-- IF { $S_ATTACHMENT_ROWS } -->
 
@@ -74,4 +74,4 @@
 <!-- ENDIF -->
 <br />
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_calender_add.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_calender_add.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_calender_add.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <style type="text/css">@import url(javascript/jscalendar/skins/aqua/theme.css);</style>
 <script type="text/javascript" src="javascript/jscalendar/calendar.js"></script>
@@ -129,6 +129,6 @@
   );
 </script>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_calender_day.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_calender_day.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_calender_day.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <table class="tablebg" width="100%" cellpadding="5" cellspacing="1">
 	<tr class="row2">
@@ -79,6 +79,6 @@
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_calender_main.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_calender_main.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_calender_main.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <table class="tablebg" width="100%" cellpadding="5" cellspacing="1px">
 	<tr class="row2">
@@ -49,6 +49,6 @@
 
 </table>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_groups_membership.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_groups_membership.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_groups_membership.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -66,4 +66,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_main_bookmarks.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_main_bookmarks.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_main_bookmarks.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <script language="javascript" type="text/javascript">
 
@@ -102,6 +102,6 @@
 <!-- IF !{ $S_BOOKMARKS } --><div class="gensmall" style="float: right; padding-top: 2px;"><b><a href="javascript:marklist('ucp', true);">{ $L_MARK_ALL }</a> :: <a  href="javascript:marklist('ucp', false);">{ $L_UNMARK_ALL }</a></b></div><!-- ENDIF -->
 <br />
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_main_drafts.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_main_drafts.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_main_drafts.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <table class="tablebg" width="100%" cellspacing="1">
 	<tr>
@@ -108,6 +108,6 @@
 <!-- ENDIF -->
 </table>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_main_front.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_main_front.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_main_front.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <table class="tablebg" width="100%" cellspacing="1">
 	<tr>
@@ -73,6 +73,6 @@
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_main_subscribed.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_main_subscribed.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_main_subscribed.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <script language="javascript" type="text/javascript">
 <!--
@@ -101,6 +101,6 @@
 
 <div class="gensmall" style="float: right; padding-top: 2px;"><b><a href="javascript:marklist('ucp', true);">{ $L_MARK_ALL }</a> :: <a  href="javascript:marklist('ucp', false);">{ $L_UNMARK_ALL }</a></b></div>
 <br/>
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_pm_options.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_pm_options.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_pm_options.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <!-- IF { $ERROR_MESSAGE } || { $NOTIFICATION_MESSAGE } -->
 	<table border="0" cellspacing="0" cellpadding="0" width="100%">
@@ -185,6 +185,6 @@
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewfolder.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewfolder.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewfolder.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_pm_message_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_pm_message_header.html -->
 
 	<div style="padding: 2px;"></div>
 
@@ -84,7 +84,7 @@
 </table>
 
 <div style="padding: 2px;"></div>
-<!-- INCLUDE modules/Control_Panel/ucp_pm_message_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_pm_message_footer.html -->
 <br clear="all" />
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_pm_viewmessage.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_pm_message_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_pm_message_header.html -->
 <div style="padding: 2px;"></div>
 
 <table class="tablebg" width="100%" cellspacing="1" cellpadding="4">
@@ -145,11 +145,11 @@
 
 <div style="padding: 2px;"></div>
 
-<!-- INCLUDE modules/Control_Panel/ucp_pm_message_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_pm_message_footer.html -->
 
 <!-- IF { $S_DISPLAY_HISTORY } -->
 	<br clear="all" />
-	<!-- INCLUDE modules/Control_Panel/ucp_pm_history.html -->
+	<!-- INCLUDE modules/control_panel/ucp_pm_history.html -->
 <!-- ENDIF -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_posting_body.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_posting_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_posting_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 <script language="javascript" type="text/javascript">
 <!--
 
@@ -292,4 +292,4 @@
 </table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_prefs_personal.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_prefs_personal.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_prefs_personal.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -72,4 +72,4 @@
 		</tr>
 	</table>
 </form>
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_prefs_post.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_prefs_post.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_prefs_post.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -36,4 +36,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_prefs_view.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_prefs_view.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_prefs_view.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -72,4 +72,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_profile_avatar.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_profile_avatar.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_profile_avatar.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }" <!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -67,4 +67,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_profile_profile_info.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_profile_profile_info.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_profile_profile_info.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }" <!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -59,4 +59,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_profile_reg_details.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_profile_reg_details.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_profile_reg_details.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -46,4 +46,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_profile_signature.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_profile_signature.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_profile_signature.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <script language="javascript" type="text/javascript">
 <!--
@@ -174,4 +174,4 @@
 		</tr>
 	</table>
 </form>
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_register.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_register.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_register.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <script language="Javascript" type="text/javascript">
 <!--
@@ -84,6 +84,6 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_remind.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_remind.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_remind.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form action="{ $S_PROFILE_ACTION }" method="post">
 
@@ -26,6 +26,6 @@
 
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_resend.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_resend.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_resend.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form action="{ $S_PROFILE_ACTION }" method="post">
 
@@ -25,6 +25,6 @@
 </table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_zebra_foes.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_zebra_foes.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_zebra_foes.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -27,4 +27,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/control_panel/ucp_zebra_friends.html
===================================================================
--- cms/trunk/includes/templates/modules/control_panel/ucp_zebra_friends.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/control_panel/ucp_zebra_friends.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Control_Panel/ucp_header.html -->
+<!-- INCLUDE modules/control_panel/ucp_header.html -->
 
 <form name="ucp" method="post" action="{ $S_UCP_ACTION }"<!-- IF isset({ $S_FORM_ENCTYPE }) -->{ $S_FORM_ENCTYPE }<!-- ENDIF --> >
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -27,4 +27,4 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Control_Panel/ucp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/control_panel/ucp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/confirm_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/confirm_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/confirm_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,8 +1,8 @@
-{ $A_TABLE_OPEN }
+{ $THEME_TABLE_OPEN }
 <div align="center"><b>{ $MESSAGE_TITLE } </b></div>
 
-{ $A_TABLE_CLOSE }
-{ $A_TABLE_OPEN }
+{ $THEME_TABLE_CLOSE }
+{ $THEME_TABLE_OPEN }
 
 <form name="confirm" action="{ $S_CONFIRM_ACTION }" method="post">
 	<table width="100%">
@@ -12,4 +12,4 @@
 	</table>
 </form>
 
-{ $A_TABLE_CLOSE }
\ No newline at end of file
+{ $THEME_TABLE_CLOSE }
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/faq_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/faq_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/faq_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,8 +1,8 @@
 <!-- IF { $DISPLAY_STYLESHEET_LINK } -->
-<!-- INCLUDE modules/Forums/simple_header.html -->
+<!-- INCLUDE modules/forums/simple_header.html -->
 <!-- ELSE -->
 <!-- DISPLAY_HEADER -->
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 <!-- ENDIF -->
 
 <a name="Top"></a>
@@ -73,7 +73,7 @@
 
 <br clear="all" />
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
 

Modified: cms/trunk/includes/templates/modules/forums/index_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/index_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/index_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,7 +1,9 @@
 <!-- DISPLAY_HEADER -->
+
 <script type="text/javascript" src="javascript/forums/forum_view.js"></script>
+<script type="text/javascript" src="javascript/message.js"></script>
 
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <table class="tablebg" cellspacing="1" width="100%">
 	<tr>
@@ -184,6 +186,6 @@
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_footer.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_footer.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_footer.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -27,4 +27,4 @@
 
 	<br clear="all" />
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/forums/overall_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_forum.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_forum.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_forum.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/mcp_header.html -->
+<!-- INCLUDE modules/forums/mcp_header.html -->
 
 <form method="post" name="mcp" action="{ $S_MCP_ACTION }"><table class="tablebg" width="100%" cellspacing="1">
 	<tr>
@@ -65,6 +65,6 @@
 </table>
 </form>
 
-<!-- INCLUDE modules/Forums/mcp_footer.html -->
+<!-- INCLUDE modules/forums/mcp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_front.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_front.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_front.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/mcp_header.html -->
+<!-- INCLUDE modules/forums/mcp_header.html -->
 
 <!-- IF { $S_SHOW_UNAPPROVED } -->
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -103,6 +103,6 @@
 <br clear="all" />
 <!-- ENDIF -->
 
-<!-- INCLUDE modules/Forums/mcp_footer.html -->
+<!-- INCLUDE modules/forums/mcp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_header.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_header.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_header.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <script language="javascript" type="text/javascript" defer="defer">
 <!--

Modified: cms/trunk/includes/templates/modules/forums/mcp_message.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_message.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_message.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Forums/mcp_header.html -->
+<!-- INCLUDE modules/forums/mcp_header.html -->
 
 <table class="tablebg" width="100%" cellspacing="1" cellpadding="4" border="0" align="center">
 	<tr>
@@ -11,4 +11,4 @@
 
 <br clear="all" />
 
-<!-- INCLUDE modules/Forums/mcp_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/forums/mcp_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_move.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_move.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_move.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/mcp_header.html -->
+<!-- INCLUDE modules/forums/mcp_header.html -->
 
 <form name="confirm" action="{ $CONFIRM_ACTION }" method="post">
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -24,6 +24,6 @@
 	</table>
 </form>
 	
-<!-- INCLUDE modules/Forums/mcp_footer.html -->
+<!-- INCLUDE modules/forums/mcp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_post.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_post.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_post.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/mcp_header.html -->
+<!-- INCLUDE modules/forums/mcp_header.html -->
 
 <table width="100%" cellpadding="3" cellspacing="1" border="0" class="tablebg"><form method="post" name="mcp" action="{ $U_APPROVE_ACTION }">
 <tr>
@@ -188,6 +188,6 @@
 	<!-- ENDIF -->
 <!-- ENDIF -->
 
-<!-- INCLUDE modules/Forums/mcp_footer.html -->
+<!-- INCLUDE modules/forums/mcp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/mcp_topic.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/mcp_topic.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/mcp_topic.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/mcp_header.html -->
+<!-- INCLUDE modules/forums/mcp_header.html -->
 
 <form name="mcp" method="post" action="{ $S_MCP_ACTION }">
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -138,6 +138,6 @@
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Forums/mcp_footer.html -->
+<!-- INCLUDE modules/forums/mcp_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/posting_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/posting_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/posting_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <script language="javascript" type="text/javascript">
 <!--
@@ -117,8 +117,8 @@
 <!-- ENDIF -->
 
 
-<!-- IF { $S_POST_REVIEW } --><!-- INCLUDE modules/Forums/posting_review.html --><!-- ENDIF -->
-<!-- IF { $S_DISPLAY_PREVIEW } --><!-- INCLUDE modules/Forums/posting_preview.html --><!-- ENDIF -->
+<!-- IF { $S_POST_REVIEW } --><!-- INCLUDE modules/forums/posting_review.html --><!-- ENDIF -->
+<!-- IF { $S_DISPLAY_PREVIEW } --><!-- INCLUDE modules/forums/posting_preview.html --><!-- ENDIF -->
 
 
 <!-- IF { $S_UNGLOBALISE } -->
@@ -338,8 +338,8 @@
 	</tr>
 	<!-- ENDIF -->
 	
-	<!-- IF { $S_SHOW_ATTACH_BOX } --><!-- INCLUDE modules/Forums/posting_attach_body.html --><!-- ENDIF -->
-	<!-- IF { $S_SHOW_POLL_BOX } --><!-- INCLUDE modules/Forums/posting_poll_body.html --><!-- ELSEIF { $S_POLL_DELETE } -->
+	<!-- IF { $S_SHOW_ATTACH_BOX } --><!-- INCLUDE modules/forums/posting_attach_body.html --><!-- ENDIF -->
+	<!-- IF { $S_SHOW_POLL_BOX } --><!-- INCLUDE modules/forums/posting_poll_body.html --><!-- ELSEIF { $S_POLL_DELETE } -->
 		<tr>
 			<td class="row1"><span class="genmed"><b>{ $L_POLL_DELETE }:</b></span></td>
 			<td class="row2"><input type="checkbox" name="poll_delete" /></td>
@@ -352,7 +352,7 @@
 
 <br clear="all" />
 
-<!-- IF { $S_DISPLAY_REVIEW } --><!-- INCLUDE modules/Forums/posting_topic_review.html --><!-- ENDIF -->
+<!-- IF { $S_DISPLAY_REVIEW } --><!-- INCLUDE modules/forums/posting_topic_review.html --><!-- ENDIF -->
 <table class="tablebg" width="100%" cellspacing="1">
 	<tr>
 		<td class="row1"><div class="nav" style="float:left"><a href="{ $U_INDEX }">{ $L_INDEX }</a><!-- LOOP $navlinks --> &#187; <a href="{ $navlinks:U_VIEW_FORUM }">{ $navlinks:FORUM_NAME }</a><!-- ENDLOOP --></div><div class="gensmall" style="float:right">{ $S_TIMEZONE }</div></td>
@@ -377,11 +377,11 @@
 
 <table width="100%" cellspacing="1">
 	<tr>
-		<td align="right"><!-- INCLUDE modules/Forums/jumpbox.html --></td>
+		<td align="right"><!-- INCLUDE modules/forums/jumpbox.html --></td>
 	</tr>
 </table>
 <!-- ENDIF -->
 	
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/posting_smilies.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/posting_smilies.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/posting_smilies.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Forums/simple_header.html -->
+<!-- INCLUDE modules/forums/simple_header.html -->
 
 <script language="javascript" type="text/javascript">
 <!--
@@ -39,4 +39,4 @@
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Forums/simple_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/forums/simple_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/report_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/report_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/report_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,4 @@
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <form method="post" action="{ $S_REPORT_ACTION }" name="report">
 <table class="tablebg" width="100%" cellspacing="1">
@@ -29,4 +29,4 @@
 </table>
 </form>
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
\ No newline at end of file
+<!-- INCLUDE modules/forums/overall_footer.html -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/search_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/search_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/search_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <form method="post" action="{ $S_SEARCH_ACTION }">
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -82,12 +82,12 @@
 <br clear="all" />
 <!-- IF { $S_DISPLAY_JUMPBOX } -->
 <div style="float:right">
-<!-- INCLUDE modules/Forums/jumpbox.html -->
+<!-- INCLUDE modules/forums/jumpbox.html -->
 </div>
 <!-- ENDIF -->
 
 <br clear="all" />
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/search_results.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/search_results.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/search_results.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <form method="post" action="{ $S_SEARCH_ACTION }">
 
@@ -130,8 +130,8 @@
 
 <br clear="all" />
 
-<div style="float:right"><!-- IF { $S_DISPLAY_JUMPBOX } --><!-- INCLUDE modules/Forums/jumpbox.html --><!-- ENDIF --></div>
+<div style="float:right"><!-- IF { $S_DISPLAY_JUMPBOX } --><!-- INCLUDE modules/forums/jumpbox.html --><!-- ENDIF --></div>
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/simple_header.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/simple_header.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/simple_header.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,7 +1,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <meta http-equiv="content-Type" content="text/html; charset={ $SITE_CHARSET }" />
 <head>
-<link rel="stylesheet" href="{ $A_STYLESHEET }" type="text/css" />
+<link rel="stylesheet" href="{ $THEME_STYLESHEET }" type="text/css" />
 </head>
 <html>
 <body>
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/viewforum_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/viewforum_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/viewforum_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,7 +1,9 @@
 <!-- DISPLAY_HEADER -->
+
 <script type="text/javascript" src="javascript/forums/forum_view.js"></script>
+<script type="text/javascript" src="javascript/message.js"></script>
 
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 <!-- IF { $S_FORUM_RULES } -->
 <div class="forumrules">
@@ -323,11 +325,11 @@
 
 <table width="100%" cellspacing="0">
 	<tr>
-		<td><!-- IF { $S_DISPLAY_SEARCHBOX } --><!-- INCLUDE modules/Forums/searchbox.html --><!-- ENDIF --></td>
-		<td align="right"><!-- IF { $S_DISPLAY_JUMPBOX } --><!-- INCLUDE modules/Forums/jumpbox.html --><!-- ENDIF --></td>
+		<td><!-- IF { $S_DISPLAY_SEARCHBOX } --><!-- INCLUDE modules/forums/searchbox.html --><!-- ENDIF --></td>
+		<td align="right"><!-- IF { $S_DISPLAY_JUMPBOX } --><!-- INCLUDE modules/forums/jumpbox.html --><!-- ENDIF --></td>
 	</tr>
 </table>
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/forums/viewforum_subforum.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/viewforum_subforum.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/viewforum_subforum.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,4 +1,5 @@
 <script type="text/javascript" src="javascript/forums/forum_view.js"></script>
+<script type="text/javascript" src="javascript/message.js"></script>
 
 <table class="tablebg" width="100%" cellspacing="1">
 	<tr>

Modified: cms/trunk/includes/templates/modules/forums/viewtopic_body.html
===================================================================
--- cms/trunk/includes/templates/modules/forums/viewtopic_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/forums/viewtopic_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Forums/overall_header.html -->
+<!-- INCLUDE modules/forums/overall_header.html -->
 
 	<!-- IF { $S_FORUM_RULES } -->
 	<div class="forumrules">
@@ -334,11 +334,11 @@
 
 	<table width="100%" cellspacing="0">
 		<tr>
-			<td><!-- IF { $S_DISPLAY_SEARCHBOX } --><!-- INCLUDE modules/Forums/searchbox.html --><!-- ENDIF --></td>
-			<td align="right"><!-- IF { $S_DISPLAY_JUMPBOX } --><!-- INCLUDE modules/Forums/jumpbox.html --><!-- ENDIF --></td>
+			<td><!-- IF { $S_DISPLAY_SEARCHBOX } --><!-- INCLUDE modules/forums/searchbox.html --><!-- ENDIF --></td>
+			<td align="right"><!-- IF { $S_DISPLAY_JUMPBOX } --><!-- INCLUDE modules/forums/jumpbox.html --><!-- ENDIF --></td>
 		</tr>
 	</table>
 
-<!-- INCLUDE modules/Forums/overall_footer.html -->
+<!-- INCLUDE modules/forums/overall_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/members_list/memberlist_body.html
===================================================================
--- cms/trunk/includes/templates/modules/members_list/memberlist_body.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/members_list/memberlist_body.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,8 +1,8 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Members_List/memberlist_header.html -->
+<!-- INCLUDE modules/members_list/memberlist_header.html -->
 
-<!-- IF { $S_SEARCH_USER } --><!-- INCLUDE modules/Members_List/memberlist_search.html --><!-- ENDIF -->
+<!-- IF { $S_SEARCH_USER } --><!-- INCLUDE modules/members_list/memberlist_search.html --><!-- ENDIF -->
 
 <!-- IF { $S_SHOW_GROUP } -->
 <table class="tablebg" width="100%" cellspacing="1">
@@ -132,6 +132,6 @@
 
 <br clear="all" />
 
-<!-- INCLUDE modules/Members_List/memberlist_footer.html -->
+<!-- INCLUDE modules/members_list/memberlist_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/members_list/memberlist_forum_moderators.html
===================================================================
--- cms/trunk/includes/templates/modules/members_list/memberlist_forum_moderators.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/members_list/memberlist_forum_moderators.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Members_List/memberlist_header.html -->
+<!-- INCLUDE modules/members_list/memberlist_header.html -->
 
 <form method="post" action="{ $S_MODE_ACTION }">
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -40,6 +40,6 @@
 
 <br clear="all" />
 
-<!-- INCLUDE modules/Members_List/memberlist_footer.html -->
+<!-- INCLUDE modules/members_list/memberlist_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/includes/templates/modules/members_list/memberlist_view.html
===================================================================
--- cms/trunk/includes/templates/modules/members_list/memberlist_view.html	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/includes/templates/modules/members_list/memberlist_view.html	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,6 +1,6 @@
 <!-- DISPLAY_HEADER -->
 
-<!-- INCLUDE modules/Members_List/memberlist_header.html -->
+<!-- INCLUDE modules/members_list/memberlist_header.html -->
 
 <form method="post" action="{ $S_PROFILE_ACTION }">
 	<table class="tablebg" width="100%" cellspacing="1">
@@ -167,6 +167,6 @@
 	</table>
 </form>
 
-<!-- INCLUDE modules/Members_List/memberlist_footer.html -->
+<!-- INCLUDE modules/members_list/memberlist_footer.html -->
 
 <!-- DISPLAY_FOOTER -->
\ No newline at end of file

Modified: cms/trunk/javascript/forums/forum_view.js
===================================================================
--- cms/trunk/javascript/forums/forum_view.js	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/javascript/forums/forum_view.js	2006-07-25 17:08:28 UTC (rev 178)
@@ -29,15 +29,21 @@
 	{
 		if (ajax.state_ready() && ajax.responseText())
 		{
+			var title = document.getElementById(mode + '_name_' + id);
+
 			if (ajax.responseText() == 'unlock')
 			{ 
 				var new_status = 0;
 				var status = document.getElementById(mode +'_unlocked_status');
+
+				system_message_init('forums', '<b>' + title.innerHTML + ' unlocked</b>');
 			}
 			else
 			{
 				var new_status = 1;
 				var status = document.getElementById(mode +'_locked_status');
+
+				system_message_init('forums', '<b>' + title.innerHTML + ' locked</b>');
 			}
 
 			area.innerHTML = status.innerHTML;
@@ -50,7 +56,7 @@
 
 	ajax.onreadystatechange(onreadystatechange);
 
-	ajax.send('ajax.php?mod=Forums', '&mode=' + mode + '_lock_unlock&lock=' + lock + '&id=' + id);
+	ajax.send('ajax.php?mod=forums', '&mode=' + mode + '_lock_unlock&lock=' + lock + '&id=' + id);
 }
 
 function tite_edit_init(id, mode)
@@ -99,20 +105,31 @@
 			case 13:
 			{
 				ajax = new core_ajax();
+	
 
+
 				var onreadystatechange = function()
 				{
+					if (input.value == title.innerHTML)
+					{
+						tite_edit_remove(id, mode);
+				
+						return;
+					}
+
 					if (ajax.state_ready() && ajax.responseText())
 					{
 						title.innerHTML = ajax.responseText();
+						
+						system_message_init('forums', '<b>Name Changed</b> <br /><br /><b>From:</b> ' + input.value + '<br /><b>To:</b> ' + title.innerHTML);
 					}
 				}
-				
+
 				ajax.onreadystatechange(onreadystatechange);
 
 				var input = document.getElementById(mode + '_input_' + id);
 
-				ajax.send('ajax.php?mod=Forums', '&mode=' + mode + '_edit_title&title=' + input.value + '&id=' + id);
+				ajax.send('ajax.php?mod=forums', '&mode=' + mode + '_edit_title&title=' + input.value + '&id=' + id);
 
 				tite_edit_remove(id, mode);
 			}
@@ -172,6 +189,8 @@
 		if (ajax.state_ready() && ajax.responseText())
 		{
 			title.innerHTML = ajax.responseText();
+
+			system_message_init('forums', '<b>Name Changed</b> <br /><br /><b>From:</b> ' + input.value + '<br /><b>To:</b> ' + title.innerHTML);
 		}
 	}
 	
@@ -179,7 +198,7 @@
 
 	var input = document.getElementById(mode + '_input_' + id);
 
-	ajax.send('ajax.php?mod=Forums', '&mode=' + mode + '_edit_title&title=' + input.value + '&id=' + id);
+	ajax.send('ajax.php?mod=forums', '&mode=' + mode + '_edit_title&title=' + input.value + '&id=' + id);
 
 	tite_edit_remove(id, mode);
 }
\ No newline at end of file

Modified: cms/trunk/javascript/quick_messages.js
===================================================================
--- cms/trunk/javascript/quick_messages.js	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/javascript/quick_messages.js	2006-07-25 17:08:28 UTC (rev 178)
@@ -20,6 +20,8 @@
 			area.innerHTML = ajax.responseText();
 
 			message.value = '';
+
+			system_message_init('quickmessage', 'Quick Message Posted');
 		}
 	}
 
@@ -28,7 +30,6 @@
 	poster_name = (poster_name) ? 'poster_name=' + poster_name.value : '';
 
 	ajax.send('ajax.php?mod=quick_message&mode=ajax_add', poster_name + '&message=' + message.value);
-	system_message_init('quickmessage', 'Quick Message Posted');
 
 	return false;
 }
@@ -43,12 +44,12 @@
 		{
 			var area = document.getElementById('qm_block');
 			area.innerHTML = ajax.responseText();
+			
+			system_message_init('quickmessage', 'Quick Message Refresh Complete');
 		}
 	}
 
 	ajax.onreadystatechange(onreadystatechange);
 
 	ajax.send('ajax.php?mod=quick_message&mode=ajax_refresh', null);
-
-	system_message_init('quickmessage', 'Quick Message Refresh Complete');
 }
\ No newline at end of file

Modified: cms/trunk/modules/control_panel/index.php
===================================================================
--- cms/trunk/modules/control_panel/index.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/control_panel/index.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -60,7 +60,7 @@
 			$module_info = $_CLASS['core_db']->fetch_row_assoc($result);
 		}
 
-		if (!$this->module || !$module_info || !file_exists(SITE_FILE_ROOT.'modules/Control_Panel/modules/ucp_' . $this->module . '.php'))
+		if (!$this->module || !$module_info || !file_exists(SITE_FILE_ROOT.'modules/control_panel/modules/ucp_' . $this->module . '.php'))
 		{
 			$this->module = 'main';
 			$this->mode = ($this->module) ? false : $this->mode;

Modified: cms/trunk/modules/control_panel/modules/ucp_pm.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_pm.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/control_panel/modules/ucp_pm.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -60,7 +60,7 @@
 
 // This is loaded 2x with drafts
 $_CLASS['core_user']->add_lang();
-$_CLASS['core_user']->add_lang('posting', 'Forums');
+$_CLASS['core_user']->add_lang('posting', 'forums');
 
 $_CLASS['core_template']->assign('S_PRIVMSGS', true);
 

Modified: cms/trunk/modules/control_panel/modules/ucp_prefs.php
===================================================================
--- cms/trunk/modules/control_panel/modules/ucp_prefs.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/control_panel/modules/ucp_prefs.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -309,7 +309,7 @@
 			'DISABLE_CENSORS_YES'	=> $wordcensor_yes, 
 			'DISABLE_CENSORS_NO'	=> $wordcensor_no,
 
-			'S_CHANGE_CENSORS'		=> $_CLASS['forums_auth']->acl_get('u_chgcensors'), 
+			'S_CHANGE_CENSORS'		=> true, 
 
 			'S_TOPIC_SORT_DAYS'		=> $s_limit_topic_days,
 			'S_TOPIC_SORT_KEY'		=> $s_sort_topic_key,

Modified: cms/trunk/modules/forums/ajax.php
===================================================================
--- cms/trunk/modules/forums/ajax.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/forums/ajax.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -28,7 +28,7 @@
 
 header('Content-Type: text/html');
 
-require_once(SITE_FILE_ROOT.'includes/forums/functions.php');
+require_once SITE_FILE_ROOT.'includes/forums/functions.php';
 load_class(SITE_FILE_ROOT.'includes/forums/auth.php', 'forums_auth');
 
 $_CLASS['forums_auth']->acl($_CLASS['core_user']->data);

Modified: cms/trunk/modules/forums/faq.php
===================================================================
--- cms/trunk/modules/forums/faq.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/forums/faq.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -28,21 +28,21 @@
 
 if (isset($_REQUEST['mode']) && $_REQUEST['mode'] == 'bbcode')
 {
-	$_CLASS['core_user']->add_lang('help_bbcode','Forums');
+	$_CLASS['core_user']->add_lang('help_bbcode','forums');
 	$l_title = $_CLASS['core_user']->get_lang('BBCODE_GUIDE');
 	$link = '&amp;mode=bbcode';
 	$mode = 'bbcode';
 }
 else
 {
-	$_CLASS['core_user']->add_lang('help_faq','Forums');
+	$_CLASS['core_user']->add_lang('help_faq','forums');
 	$l_title = $_CLASS['core_user']->get_lang('FAQ');
 	$link = $mode = '';
 }
 
 $_CLASS['core_template']->assign_array(array(
 	'L_FAQ_TITLE'	=> $l_title,
-	'S_BACK_TO_TOP'	=> generate_link('Forums&amp;file=faq'.$link.'#Top')
+	'S_BACK_TO_TOP'	=> generate_link('forums&amp;file=faq'.$link.'#Top')
 ));
 
 $id = 0;
@@ -83,7 +83,7 @@
 
 		$faq_row_link[] = array(
 			'FAQ_LINK' 			=> $_CLASS['core_user']->lang['help'][$i][0],
-			'U_FAQ_LINK'		=> generate_link('Forums&amp;file=faq'.$link.'#' . $id)
+			'U_FAQ_LINK'		=> generate_link('forums&amp;file=faq'.$link.'#' . $id)
 		);
 	}
 }
@@ -105,6 +105,6 @@
 
 page_header();
 
-$_CLASS['core_template']->display('modules/Forums/faq_body.html');
+$_CLASS['core_template']->display('modules/forums/faq_body.html');
 
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/forums/main.php
===================================================================
--- cms/trunk/modules/forums/main.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/forums/main.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -53,7 +53,7 @@
 $legend = array();
 while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
 {
-	$legend[] .= '<a style="color:#' . $row['group_colour'] . '" href="'.generate_link('Members_List&amp;mode=group&amp;g=' . $row['group_id']) . '">' . (isset($_CLASS['core_user']->lang['G_' . $row['group_name']]) ? $_CLASS['core_user']->lang['G_' . $row['group_name']] : $row['group_name']) . '</a>';
+	$legend[] .= '<a style="color:#' . $row['group_colour'] . '" href="'.generate_link('members_list&amp;mode=group&amp;g=' . $row['group_id']) . '">' . (isset($_CLASS['core_user']->lang['G_' . $row['group_name']]) ? $_CLASS['core_user']->lang['G_' . $row['group_name']] : $row['group_name']) . '</a>';
 }
 $_CLASS['core_db']->free_result($result);
 
@@ -63,19 +63,18 @@
 $birthday_list = '';
 if ($config['load_birthdays'])
 {
-	$now = getdate();
-	$now = explode(':', gmdate('j:m'));
-
+	$now = explode(':', gmdate('d:m'));
+
 	$sql = 'SELECT user_id, username, user_colour, user_birthday 
 		FROM ' . CORE_USERS_TABLE . " 
-		WHERE user_birthday LIKE '" . sprintf('%2d-%2d-', $now[0], $now[1]) . "%'
+		WHERE user_birthday LIKE '" . $_CLASS['core_db']->escape("{$now[0]}-{$now[1]}-") . "%'
 			AND user_type = ".USER_NORMAL;
 	$result = $_CLASS['core_db']->query($sql);
 
 	while ($row = $_CLASS['core_db']->fetch_row_assoc($result))
 	{
 		$user_colour = ($row['user_colour']) ? ' style="color:#' . $row['user_colour'] .'"' : '';
-		$birthday_list .= (($birthday_list != '') ? ', ' : '') . '<a' . $user_colour . ' href="' . generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['user_id']) . '">' . $row['username'] . '</a>';
+		$birthday_list .= (($birthday_list != '') ? ', ' : '') . '<a' . $user_colour . ' href="' . generate_link('members_list&amp;mode=viewprofile&amp;u=' . $row['user_id']) . '">' . $row['username'] . '</a>';
 		
 		if ($age = (int) substr($row['user_birthday'], -4))
 		{
@@ -104,17 +103,17 @@
 	'FORUM_NEW_IMG'		=>	$_CLASS['core_user']->img('forum_new', 'NEW_POSTS'),
 	'FORUM_LOCKED_IMG'	=>	$_CLASS['core_user']->img('forum_locked', 'NO_NEW_POSTS_LOCKED'),
 
-	'S_LOGIN_ACTION'			=> generate_link('Control_Panel&amp;mode=login'), 
+	'S_LOGIN_ACTION'			=> generate_link('control_panel&amp;mode=login'), 
 	'S_DISPLAY_BIRTHDAY_LIST'	=> ($config['load_birthdays']), 
 
-	'U_MARK_FORUMS'	=> generate_link('Forums&amp;mark=forums')
+	'U_MARK_FORUMS'	=> generate_link('forums&amp;mark=forums')
 ));
 unset($birthday_list, $legend);
 
 page_header();
 
-$_CLASS['core_display']->footer .= $_CLASS['core_template']->display('modules/Forums/menus.html', true);
+$_CLASS['core_display']->footer .= $_CLASS['core_template']->display('modules/forums/menus.html', true);
 
-$_CLASS['core_display']->display(false, 'modules/Forums/index_body.html');
+$_CLASS['core_display']->display(false, 'modules/forums/index_body.html');
 
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/forums/posting.php
===================================================================
--- cms/trunk/modules/forums/posting.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/forums/posting.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -61,7 +61,7 @@
 // Was cancel pressed? If so then redirect to the appropriate page
 if ($_CLASS['core_user']->is_bot || isset($_POST['cancel']))
 {
-	$redirect = ($post_id) ? "Forums&amp;file=viewtopic&p=$post_id#$post_id" : (($topic_id) ? 'Forums&amp;file=viewtopic&t='.$topic_id : (($forum_id) ? 'Forums&amp;file=viewforum&f='.$forum_id : 'Forums'));
+	$redirect = ($post_id) ? "forums&amp;file=viewtopic&p=$post_id#$post_id" : (($topic_id) ? 'Forums&amp;file=viewtopic&t='.$topic_id : (($forum_id) ? 'Forums&amp;file=viewforum&f='.$forum_id : 'Forums'));
 	redirect(generate_link($redirect,  array('full' => true)));
 }
 
@@ -99,7 +99,7 @@
 		}
 
 		$sql = 'SELECT f.*, t.*, p.*, u.username, u.user_sig, u.user_sig_bbcode_uid, u.user_sig_bbcode_bitfield
-			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . ' u , ' . FORUMS_TOPICS_TABLE . ' t
+			FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . ' u , ' . FORUMS_TOPICS_TABLE . ' t
 			LEFT JOIN ' . FORUMS_FORUMS_TABLE . " f ON (f.forum_id = t.forum_id)
 			WHERE p.post_id = $post_id
 				AND t.topic_id = p.topic_id
@@ -426,7 +426,7 @@
 		SET ' . implode(', ', update_last_post_information('forum', $forum_id)) . "
 		WHERE forum_id = $forum_id");
 
-	$_CLASS['core_db']->query('UPDATE ' . USERS_TABLE . "
+	$_CLASS['core_db']->query('UPDATE ' . CORE_USERS_TABLE . "
 		SET user_last_post_time = $current_time
 		WHERE user_id = " . $_CLASS['core_user']->data['user_id']);
 
@@ -1054,7 +1054,7 @@
 $lock_post_checked	= isset($post_lock) ? $post_lock : $posting_data['post_edit_locked'];
 
 // Page title & action URL, include session_id for security purpose
-$s_action = "Forums&amp;file=posting&amp;mode=$mode&amp;f=$forum_id";
+$s_action = "forums&amp;file=posting&amp;mode=$mode&amp;f=$forum_id";
 $s_action .= ($topic_id) ? "&amp;t=$topic_id" : '';
 $s_action .= ($post_id) ? "&amp;p=$post_id" : '';
 $s_action = generate_link($s_action);
@@ -1207,9 +1207,9 @@
 	}
 }
 
-make_jumpbox(generate_link('Forums&amp;file=viewforum'));
+make_jumpbox(generate_link('forums&amp;file=viewforum'));
 
-$_CLASS['core_template']->display('modules/Forums/posting_body.html');
+$_CLASS['core_template']->display('modules/forums/posting_body.html');
 
 // ---------
 // FUNCTIONS
@@ -1264,7 +1264,7 @@
 
 		case 'delete_first_post':
 			$sql = 'SELECT p.post_id, p.poster_id, p.post_username, u.username 
-				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . USERS_TABLE . " u
+				FROM ' . FORUMS_POSTS_TABLE . ' p, ' . CORE_USERS_TABLE . " u
 				WHERE p.topic_id = $topic_id 
 					AND p.poster_id = u.user_id 
 				ORDER BY p.post_time ASC";
@@ -1336,12 +1336,12 @@
 		break;
 	}
 				
-	$sql_data[USERS_TABLE] = ($_CLASS['auth']->acl_get('f_postcount', $forum_id)) ? 'user_posts = user_posts - 1' : '';
+	$sql_data[CORE_USERS_TABLE] = ($_CLASS['auth']->acl_get('f_postcount', $forum_id)) ? 'user_posts = user_posts - 1' : '';
 	set_config('num_posts', $config['num_posts'] - 1, true);
 
 	$_CLASS['core_db']->transaction();
 
-	$where_sql = array(FORUMS_FORUMS_TABLE => "forum_id = $forum_id", FORUMS_TOPICS_TABLE => "topic_id = $topic_id", USERS_TABLE => 'user_id = ' . $data['poster_id']);
+	$where_sql = array(FORUMS_FORUMS_TABLE => "forum_id = $forum_id", FORUMS_TOPICS_TABLE => "topic_id = $topic_id", CORE_USERS_TABLE => 'user_id = ' . $data['poster_id']);
 
 	foreach ($sql_data as $table => $update_sql)
 	{
@@ -1507,7 +1507,7 @@
 				);
 			}
 
-			$sql_data[USERS_TABLE]['stat'][] = "user_last_post_time = $current_time" . (($_CLASS['auth']->acl_get('f_postcount', $data['forum_id'])) ? ', user_posts = user_posts + 1' : '');
+			$sql_data[CORE_USERS_TABLE]['stat'][] = "user_last_post_time = $current_time" . (($_CLASS['auth']->acl_get('f_postcount', $data['forum_id'])) ? ', user_posts = user_posts + 1' : '');
 
 			if ($topic_type != POST_GLOBAL)
 			{
@@ -1521,7 +1521,7 @@
 
 		case 'reply':
 			$sql_data[FORUMS_TOPICS_TABLE]['stat'][] = 'topic_replies_real = topic_replies_real + 1, topic_bumped = 0, topic_bumper = 0' . ((!$_CLASS['auth']->acl_get('f_moderate', $data['forum_id']) || $_CLASS['auth']->acl_get('m_approve')) ? ', topic_replies = topic_replies + 1' : '');
-			$sql_data[USERS_TABLE]['stat'][] = "user_last_post_time = $current_time" . (($_CLASS['auth']->acl_get('f_postcount', $data['forum_id'])) ? ', user_posts = user_posts + 1' : '');
+			$sql_data[CORE_USERS_TABLE]['stat'][] = "user_last_post_time = $current_time" . (($_CLASS['auth']->acl_get('f_postcount', $data['forum_id'])) ? ', user_posts = user_posts + 1' : '');
 			
 			if ((!$_CLASS['auth']->acl_get('f_moderate', $data['forum_id']) || $_CLASS['auth']->acl_get('m_approve')) && $topic_type != POST_GLOBAL)
 			{
@@ -1820,7 +1820,7 @@
 	// Update forum stats
 	$_CLASS['core_db']->transaction();
 
-	$where_sql = array(FORUMS_POSTS_TABLE => 'post_id = ' . $data['post_id'], FORUMS_TOPICS_TABLE => 'topic_id = ' . $data['topic_id'], FORUMS_FORUMS_TABLE => 'forum_id = ' . $data['forum_id'], USERS_TABLE => 'user_id = ' . $_CLASS['core_user']->data['user_id']);
+	$where_sql = array(FORUMS_POSTS_TABLE => 'post_id = ' . $data['post_id'], FORUMS_TOPICS_TABLE => 'topic_id = ' . $data['topic_id'], FORUMS_FORUMS_TABLE => 'forum_id = ' . $data['forum_id'], CORE_USERS_TABLE => 'user_id = ' . $_CLASS['core_user']->data['user_id']);
 
 	foreach ($sql_data as $table => $update_ary)
 	{

Modified: cms/trunk/modules/forums/viewforum.php
===================================================================
--- cms/trunk/modules/forums/viewforum.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/forums/viewforum.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -121,6 +121,13 @@
 	login_box(array('explain' => $_CLASS['core_user']->lang['LOGIN_NOTIFY_FORUM']));
 }
 
+// Forum is passworded ... check whether access has been granted to this
+// user this session, if not show login box
+if ($forum_data['forum_password'])
+{
+	login_forum_box($forum_data);
+}
+
 // Are we a forum link, then redirect
 if ($forum_data['forum_link'])
 {
@@ -139,13 +146,8 @@
 // Add Images
 $_CLASS['core_user']->add_img();
 
-// Forum is passworded ... check whether access has been granted to this
-// user this session, if not show login box
-if ($forum_data['forum_password'])
-{
-	login_forum_box($forum_data);
-}
 
+
 // Build navigation links
 generate_forum_nav($forum_data);
 
@@ -164,7 +166,8 @@
 	$_CLASS['core_template']->assign('S_HAS_SUBFORUM', false);
 }
 
-if ($forum_data['forum_type'] != FORUM_POST && !($forum_data['forum_flags'] & 16))
+// Not postable forum or showing active topics?
+if (!($forum_data['forum_type'] == FORUM_POST || (($forum_data['forum_flags'] & 16) && $forum_data['forum_type'] == FORUM_CAT)))
 {
 	$_CLASS['core_template']->assign_array(array(
 		'S_IS_POSTABLE'			=> false,
@@ -175,9 +178,9 @@
 
 	page_header();
 	
-	make_jumpbox(generate_link('Forums&amp;file=viewforum'), $forum_id);
+	make_jumpbox(generate_link('forums&amp;file=viewforum'), $forum_id);
 	
-	$_CLASS['core_template']->display('modules/Forums/viewforum_body.html');
+	$_CLASS['core_template']->display('modules/forums/viewforum_body.html');
 }
 
 $moderators = get_moderators($forum_id);
@@ -187,7 +190,7 @@
 {
 	markread('forum', $forum_id);
 	
-	$_CLASS['core_display']->meta_refresh(3, generate_link('Forums&amp;file=viewforum&amp;f='.$forum_id));
+	$_CLASS['core_display']->meta_refresh(3, generate_link('forums&amp;file=viewforum&amp;f='.$forum_id));
 
 	$message = $_CLASS['core_user']->lang['TOPICS_MARKED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_FORUM'], '<a href="' . generate_link('Forums&amp;file=viewforum&amp;f='.$forum_id) . '">', '</a> ');
 	trigger_error($message);
@@ -250,17 +253,18 @@
 	$sql = 'SELECT COUNT(topic_id) AS num_topics
 		FROM ' . FORUMS_TOPICS_TABLE . "
 		WHERE forum_id = $forum_id
-			AND topic_type <> " . POST_ANNOUNCE . " 
+			AND topic_type NOT IN (" . POST_ANNOUNCE . ', ' . POST_GLOBAL . ")
 			AND topic_last_post_time >= $min_post_time
 		" . (($_CLASS['auth']->acl_get('m_approve', $forum_id)) ? '' : 'AND topic_approved = 1');
 	$result = $_CLASS['core_db']->query($sql);
+	$topics_count = ($row = $_CLASS['core_db']->fetch_row_assoc($result)) ? (int) $row['num_topics'] : 0;
+	$_CLASS['core_db']->free_result($result);
 
 	if (isset($_POST['sort']))
 	{
 		$start = 0;
 	}
 
-	$topics_count = ($row = $_CLASS['core_db']->fetch_row_assoc($result)) ? $row['num_topics'] : 0;
 	$sql_limit_time = "AND t.topic_last_post_time >= $min_post_time";
 }
 else
@@ -279,13 +283,15 @@
 
 // Basic pagewide vars
 $post_alt = ($forum_data['forum_status'] == ITEM_LOCKED) ? $_CLASS['core_user']->lang['FORUM_LOCKED'] : $_CLASS['core_user']->lang['POST_NEW_TOPIC'];
-$pagination = generate_pagination("Forums&amp;file=viewforum&amp;f=$forum_id&amp;$u_sort_param", $topics_count, $config['topics_per_page'], $start);
+$pagination = generate_pagination("forums&amp;file=viewforum&amp;f=$forum_id&amp;$u_sort_param", $topics_count, $config['topics_per_page'], $start);
 
+$s_display_active = ($forum_data['forum_type'] == FORUM_CAT && ($forum_data['forum_flags'] & 16)) ? true : false;
+
 $_CLASS['core_template']->assign_array(array(
 	'PAGINATION'		=> $pagination['formated'],
 	'PAGINATION_ARRAY'	=> $pagination['array'],
 	'PAGE_NUMBER'		=> on_page($topics_count, $config['topics_per_page'], $start),
-	'TOTAL_TOPICS'		=> ($forum_data['forum_flags'] & 16) ? false : (($topics_count == 1) ? $_CLASS['core_user']->lang['VIEW_FORUM_TOPIC'] : sprintf($_CLASS['core_user']->lang['VIEW_FORUM_TOPICS'], $topics_count)),
+	'TOTAL_TOPICS'		=> ($s_display_active) ? false : (($topics_count == 1) ? $_CLASS['core_user']->lang['VIEW_FORUM_TOPIC'] : sprintf($_CLASS['core_user']->lang['VIEW_FORUM_TOPICS'], $topics_count)),
 	'MODERATORS'		=> empty($moderators[$forum_id]) ? '' : implode(', ', $moderators[$forum_id]),
 
 	'POST_IMG' 			=> ($forum_data['forum_status'] == ITEM_LOCKED) ? $_CLASS['core_user']->img('btn_locked', $post_alt) : $_CLASS['core_user']->img('btn_post', $post_alt),
@@ -312,24 +318,25 @@
 	'REPORTED_IMG'			=> $_CLASS['core_user']->img('icon_reported', 'TOPIC_REPORTED'),
 	'UNAPPROVED_IMG'		=> $_CLASS['core_user']->img('icon_unapproved', 'TOPIC_UNAPPROVED'),
 	'GOTO_PAGE_IMG'			=> $_CLASS['core_user']->img('icon_post', 'GOTO_PAGE'),
+
 	'L_NO_TOPICS' 			=> ($forum_data['forum_status'] == ITEM_LOCKED) ? $_CLASS['core_user']->lang['POST_FORUM_LOCKED'] : $_CLASS['core_user']->lang['NO_TOPICS'],
 
 	'S_IS_POSTABLE'			=> ($forum_data['forum_type'] == FORUM_POST) ? true : false,
-	'S_DISPLAY_ACTIVE'		=> ($forum_data['forum_type'] == FORUM_CAT && $forum_data['forum_flags'] & 16) ? true : false, 
+	'S_DISPLAY_ACTIVE'		=> $s_display_active, 
 	'S_SELECT_SORT_DIR'		=> $s_sort_dir,
 	'S_SELECT_SORT_KEY'		=> $s_sort_key,
 	'S_SELECT_SORT_DAYS'	=> $s_limit_days,
-	'S_TOPIC_ICONS'			=> ($forum_data['forum_type'] == FORUM_CAT && $forum_data['forum_flags'] & 16) ? max($active_forum_ary['enable_icons']) : (($forum_data['enable_icons']) ? true : false), 
+	'S_TOPIC_ICONS'			=> ($s_display_active) ? max($active_forum_ary['enable_icons']) : (($forum_data['enable_icons']) ? true : false), 
 	'S_WATCH_FORUM_LINK'	=> $s_watching_forum['link'],
 	'S_WATCH_FORUM_TITLE'	=> $s_watching_forum['title'],
-	'S_FORUM_ACTION' 		=> generate_link("Forums&amp;file=viewforum&amp;f=$forum_id&amp;start=$start"),
+	'S_FORUM_ACTION' 		=> generate_link("forums&amp;file=viewforum&amp;f=$forum_id&amp;start=$start"),
 	'S_DISPLAY_SEARCHBOX'	=> ($_CLASS['auth']->acl_get('f_search', $forum_id)) ? true : false, 
-	'S_SEARCHBOX_ACTION'	=> generate_link('Forums&amp;file=search&amp;search_forum[]='.$forum_id), 
+	'S_SEARCHBOX_ACTION'	=> generate_link('forums&amp;file=search&amp;search_forum[]='.$forum_id), 
 
-	'U_MCP' 			=> ($_CLASS['auth']->acl_get('m_', $forum_id)) ? generate_link("Forums&amp;file=mcp&amp;f=$forum_id&amp;mode=forum_view") : '', 
-	'U_POST_NEW_TOPIC'	=> generate_link('Forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id), 
-	'U_VIEW_FORUM'		=> generate_link("Forums&amp;file=viewforum&amp;f=$forum_id&amp;$u_sort_param&amp;start=$start"), 
-	'U_MARK_TOPICS' 	=> generate_link("Forums&amp;file=viewforum&amp;f=$forum_id&amp;mark=topics"))
+	'U_MCP' 			=> ($_CLASS['auth']->acl_get('m_', $forum_id)) ? generate_link("forums&amp;file=mcp&amp;f=$forum_id&amp;mode=forum_view") : '', 
+	'U_POST_NEW_TOPIC'	=> generate_link('forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id), 
+	'U_VIEW_FORUM'		=> generate_link("forums&amp;file=viewforum&amp;f=$forum_id&amp;$u_sort_param&amp;start=$start"), 
+	'U_MARK_TOPICS' 	=> generate_link("forums&amp;file=viewforum&amp;f=$forum_id&amp;mark=topics"))
 );
 
 // Grab icons
@@ -484,12 +491,12 @@
 	//	$status = topic_status($row, $replies, $mark_time, $unread_topic, $folder_img, $folder_alt, $topic_type);
 		topic_status($row, $replies, $mark_time, $unread_topic, $folder_img, $folder_alt, $topic_type);
 
-		$newest_post_img = ($unread_topic) ? '<a href="' . generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=unread#unread") . '">' . $_CLASS['core_user']->img('icon_post_newest', 'VIEW_NEWEST_POST') . '</a> ' : '';
+		$newest_post_img = ($unread_topic) ? '<a href="' . generate_link("forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=unread#unread") . '">' . $_CLASS['core_user']->img('icon_post_newest', 'VIEW_NEWEST_POST') . '</a> ' : '';
 
 		// Generate all the URIs ...
-		$view_topic_url = 'Forums&amp;file=viewtopic&amp;t='.$topic_id;
+		$view_topic_url = 'forums&amp;file=viewtopic&amp;t='.$topic_id;
 
-		$pagination = generate_pagination('Forums&amp;file=viewtopic&amp;&amp;t='.$topic_id, $replies, $config['posts_per_page']);
+		$pagination = generate_pagination('forums&amp;file=viewtopic&amp;&amp;t='.$topic_id, $replies, $config['posts_per_page']);
 
 		// Send vars to template
 		$_CLASS['core_template']->assign_vars_array('topicrow', array(
@@ -497,7 +504,7 @@
 			'TOPIC_ID' 			=> $topic_id,
 
 			'AUTHOR' 			=> ($row['topic_poster'] == ANONYMOUS) ? (($row['topic_first_poster_name']) ? $row['topic_first_poster_name'] : $_CLASS['core_user']->get_lang('GUEST')) : $row['topic_first_poster_name'],
-			'LINK_AUTHOR' 		=> ($row['topic_poster'] == ANONYMOUS) ? '' : generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['topic_poster']),
+			'LINK_AUTHOR' 		=> ($row['topic_poster'] == ANONYMOUS) ? '' : generate_link('members_list&amp;mode=viewprofile&amp;u=' . $row['topic_poster']),
 
 			'FIRST_POST_TIME' 	=> $_CLASS['core_user']->format_date($row['topic_time']),
 			'LAST_POST_TIME'	=> $_CLASS['core_user']->format_date($row['topic_last_post_time']),
@@ -532,11 +539,11 @@
 			'S_TOPIC_UNAPPROVED'	=> (!$row['topic_approved'] && $_CLASS['auth']->acl_get('m_approve', $forum_id)),
 
 			'U_LAST_POST'       => generate_link($view_topic_url . '&amp;p=' . $row['topic_last_post_id'] . '#' . $row['topic_last_post_id']),	
-			'U_LAST_POST_AUTHOR'=> ($row['topic_last_poster_id']) ? generate_link('Members_List&amp;mode=viewprofile&amp;u='.$row['topic_last_poster_id']) : '',
+			'U_LAST_POST_AUTHOR'=> ($row['topic_last_poster_id']) ? generate_link('members_list&amp;mode=viewprofile&amp;u='.$row['topic_last_poster_id']) : '',
 			'U_VIEW_TOPIC'		=> generate_link($view_topic_url),
 
-			'U_MCP_REPORT'		=> generate_link('Forums&amp;file=mcp&amp;mode=reports&amp;t='.$topic_id),
-			'U_MCP_QUEUE'       => generate_link('Forums&amp;file=mcp&amp;i=queue&amp;mode=approve_details&amp;t='.$topic_id),
+			'U_MCP_REPORT'		=> generate_link('forums&amp;file=mcp&amp;mode=reports&amp;t='.$topic_id),
+			'U_MCP_QUEUE'       => generate_link('forums&amp;file=mcp&amp;i=queue&amp;mode=approve_details&amp;t='.$topic_id),
 
 			'S_TOPIC_TYPE_SWITCH'=> ($s_type_switch == $s_type_switch_test) ? -1 : $s_type_switch_test)
 		);
@@ -558,10 +565,10 @@
 
 page_header();
 
-make_jumpbox(generate_link('Forums&amp;file=viewforum'), $forum_id);
+make_jumpbox(generate_link('forums&amp;file=viewforum'), $forum_id);
 
-$_CLASS['core_display']->footer .= $_CLASS['core_template']->display('modules/Forums/menus.html', true);
+$_CLASS['core_display']->footer .= $_CLASS['core_template']->display('modules/forums/menus.html', true);
 
-$_CLASS['core_display']->display(false, 'modules/Forums/viewforum_body.html');
+$_CLASS['core_display']->display(false, 'modules/forums/viewforum_body.html');
 
 ?>
\ No newline at end of file

Modified: cms/trunk/modules/forums/viewtopic.php
===================================================================
--- cms/trunk/modules/forums/viewtopic.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/forums/viewtopic.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -325,7 +325,7 @@
 	{
 		if (trim($word))
 		{
-			$highlight_match .= (($highlight_match != '') ? '|' : '') . str_replace('\*', '\w*?', preg_quote(urlencode($word), '#'));
+			$highlight_match .= (($highlight_match != '') ? '|' : '') . str_replace('*', '\w*?', preg_quote($word, '#'));
 		}
 	}
 
@@ -333,7 +333,7 @@
 }
 
 // General Viewtopic URL for return links
-$viewtopic_url = "Forums&amp;file=viewtopic&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param" . (($highlight_match) ? "&amp;hilit=$highlight" : '');
+$viewtopic_url = "forums&amp;file=viewtopic&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param" . (($highlight_match) ? "&amp;hilit=$highlight" : '');
 
 // Grab ranks
 $ranks = obtain_ranks();
@@ -408,7 +408,7 @@
 	{
 		if (empty($voted_id) || !empty($voted_id) > $poll_max_options)
 		{
-			$_CLASS['core_display']->meta_refresh(5, generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id"));
+			$_CLASS['core_display']->meta_refresh(5, generate_link("forums&amp;file=viewtopic&amp;t=$topic_id"));
 
 			$message = empty($voted_id) ? 'NO_VOTE_OPTION' : 'TOO_MANY_VOTE_OPTIONS';
 			$message = $_CLASS['core_user']->lang[$message] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_TOPIC'], '<a href="'.generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id").'">', '</a>');
@@ -468,7 +468,7 @@
 			//, topic_last_post_time = ' . time() . " -- for bumping topics with new votes, ignore for now
 		$_CLASS['core_db']->query($sql);
 
-		$_CLASS['core_display']->meta_refresh(5, generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id"));
+		$_CLASS['core_display']->meta_refresh(5, generate_link("forums&amp;file=viewtopic&amp;t=$topic_id"));
 
 		$message = $_CLASS['core_user']->lang['VOTE_SUBMITTED'] . '<br /><br />' . sprintf($_CLASS['core_user']->lang['RETURN_TOPIC'], '<a href="'.generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id").'">', '</a>');
 		trigger_error($message);
@@ -726,13 +726,13 @@
 				'avatar'				=> '',
 				'online'				=> false,
 
-				'profile'		=> generate_link("Members_List&amp;mode=viewprofile&amp;u=$poster_id"),
+				'profile'		=> generate_link("members_list&amp;mode=viewprofile&amp;u=$poster_id"),
 				'www'			=> $row['user_website'],
-				'aim'			=> ($row['user_aim']) ? generate_link('Members_List&amp;mode=contact&amp;action=aim&amp;u='.$poster_id) : '',
-				'msn'			=> ($row['user_msnm']) ? generate_link('Members_List&amp;mode=contact&amp;action=msnm&amp;u='.$poster_id) : '',
+				'aim'			=> ($row['user_aim']) ? generate_link('members_list&amp;mode=contact&amp;action=aim&amp;u='.$poster_id) : '',
+				'msn'			=> ($row['user_msnm']) ? generate_link('members_list&amp;mode=contact&amp;action=msnm&amp;u='.$poster_id) : '',
 				'yim'			=> ($row['user_yim']) ? 'http://edit.yahoo.com/config/send_webmesg?.target=' . $row['user_yim'] . '&.src=pg' : '',
-				'jabber'		=> ($row['user_jabber']) ? generate_link('Members_List&amp;mode=contact&amp;action=jabber&amp;u='.$poster_id) : '',
-				'search'		=> ($_CLASS['auth']->acl_get('u_search')) ? generate_link('Forums&amp;file=search&amp;search_author=' . urlencode($row['username']) .'&amp;showresults=posts') : '',
+				'jabber'		=> ($row['user_jabber']) ? generate_link('members_list&amp;mode=contact&amp;action=jabber&amp;u='.$poster_id) : '',
+				'search'		=> ($_CLASS['auth']->acl_get('u_search')) ? generate_link('forums&amp;file=search&amp;search_author=' . urlencode($row['username']) .'&amp;showresults=posts') : '',
 				'username'		=> ($row['user_colour']) ? '<span style="color:#' . $row['user_colour'] . '">' . $poster . '</span>' : $poster
 			);
 
@@ -764,8 +764,7 @@
 				$user_cache[$poster_id]['rank_image'] = '';
 				
 				/*
-				We do this on posting no need to un-needed stuff
-
+				Well we kind of do need this
 				if (isset($ranks['normal']) && !empty($ranks['normal']))
 				{
 					foreach ($ranks['normal'] as $rank)
@@ -793,7 +792,7 @@
 
 			if (!empty($row['user_icq']))
 			{
-				$user_cache[$poster_id]['icq'] =  generate_link('Members_List&amp;mode=contact&amp;action=icq&amp;u='.$poster_id);
+				$user_cache[$poster_id]['icq'] =  generate_link('members_list&amp;mode=contact&amp;action=icq&amp;u='.$poster_id);
 				$user_cache[$poster_id]['icq_status_img'] = '<img src="http://web.icq.com/whitepages/online?icq=' . $row['user_icq'] . '&amp;img=5" width="18" height="18" border="0" />';
 			}
 			else
@@ -1135,7 +1134,7 @@
 $topic_mod .= ($_CLASS['auth']->acl_get('f_announce', $forum_id) && $topic_data['topic_type'] != POST_GLOBAL) ? '<option value="make_global">' . $_CLASS['core_user']->lang['MAKE_GLOBAL'] . '</option>' : '';
 $topic_mod .= ($_CLASS['auth']->acl_get('m_', $forum_id)) ? '<option value="viewlogs">' . $_CLASS['core_user']->lang['VIEW_TOPIC_LOGS'] . '</option>' : '';
 
-$pagination = generate_pagination("Forums&amp;file=viewtopic&amp;t=$topic_id&amp;$u_sort_param" . (($highlight_match) ? "&amp;hilit=$highlight" : ''), $total_posts, $config['posts_per_page'], $start);
+$pagination = generate_pagination("forums&amp;file=viewtopic&amp;t=$topic_id&amp;$u_sort_param" . (($highlight_match) ? "&amp;hilit=$highlight" : ''), $total_posts, $config['posts_per_page'], $start);
 $topic_data['topic_title'] = censor_text($topic_data['topic_title']);
 
 // Send vars to template
@@ -1149,7 +1148,7 @@
 	'PAGINATION_ARRAY'	=> $pagination['array'],
 	'PAGE_NUMBER' 		=> on_page($total_posts, $config['posts_per_page'], $start),
 	'TOTAL_POSTS'		=> ($total_posts == 1) ? $_CLASS['core_user']->lang['VIEW_TOPIC_POST'] : sprintf($_CLASS['core_user']->lang['VIEW_TOPIC_POSTS'], $total_posts), 
-	'U_MCP' 			=> ($_CLASS['auth']->acl_get('m_', $forum_id)) ? generate_link("Forums&amp;file=mcp&amp;mode=topic_view&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param", false, false) : '',
+	'U_MCP' 			=> ($_CLASS['auth']->acl_get('m_', $forum_id)) ? generate_link("forums&amp;file=mcp&amp;mode=topic_view&amp;t=$topic_id&amp;start=$start&amp;$u_sort_param", false, false) : '',
 
 	'MODERATORS'	=> (isset($forum_moderators[$forum_id]) && !empty($forum_moderators[$forum_id])) ? implode(', ', $forum_moderators[$forum_id]) : '',
 
@@ -1176,19 +1175,19 @@
 	'S_SELECT_SORT_DIR' 	=> $s_sort_dir,
 	'S_SELECT_SORT_KEY' 	=> $s_sort_key,
 	'S_SELECT_SORT_DAYS' 	=> $s_limit_days,
-	'S_TOPIC_ACTION' 		=> generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id&amp;start=$start"),
+	'S_TOPIC_ACTION' 		=> generate_link("forums&amp;file=viewtopic&amp;t=$topic_id&amp;start=$start"),
 	'S_TOPIC_MOD' 			=> ($topic_mod) ? '<select name="mode">' . $topic_mod . '</select>' : '',
-	'S_MOD_ACTION' 			=> generate_link("Forums&amp;file=mcp&amp;t=$topic_id&amp;quickmod=1", false, false), 
+	'S_MOD_ACTION' 			=> generate_link("forums&amp;file=mcp&amp;t=$topic_id&amp;quickmod=1", false, false), 
 
 	'S_DISPLAY_SEARCHBOX'	=> ($_CLASS['auth']->acl_get('f_search', $forum_id)) ? true : false, 
-	'S_SEARCHBOX_ACTION'	=> generate_link('Forums&amp;file=search&amp;search_forum[]='.$forum_id), 
+	'S_SEARCHBOX_ACTION'	=> generate_link('forums&amp;file=search&amp;search_forum[]='.$forum_id), 
 
-	'U_TOPIC'				=> ($view == 'print') ? generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id, array('full' => true)) : generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id),
-	'U_VIEW_UNREAD_POST'	=> ($first_unread_makred) ? generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id#unread") : false,
+	'U_TOPIC'				=> ($view == 'print') ? generate_link('forums&amp;file=viewtopic&amp;t='.$topic_id, array('full' => true)) : generate_link('Forums&amp;file=viewtopic&amp;t='.$topic_id),
+	'U_VIEW_UNREAD_POST'	=> ($first_unread_makred) ? generate_link("forums&amp;file=viewtopic&amp;t=$topic_id#unread") : false,
 	'U_VIEW_TOPIC' 			=> generate_link($viewtopic_url),
-	'U_VIEW_FORUM' 			=> generate_link('Forums&amp;file=viewforum&amp;f='.$forum_id),
-	'U_VIEW_OLDER_TOPIC'	=> generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=previous"),
-	'U_VIEW_NEWER_TOPIC'	=> generate_link("Forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=next"),
+	'U_VIEW_FORUM' 			=> generate_link('forums&amp;file=viewforum&amp;f='.$forum_id),
+	'U_VIEW_OLDER_TOPIC'	=> generate_link("forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=previous"),
+	'U_VIEW_NEWER_TOPIC'	=> generate_link("forums&amp;file=viewtopic&amp;t=$topic_id&amp;view=next"),
 	'U_PRINT_TOPIC'			=> ($_CLASS['auth']->acl_get('f_print', $forum_id)) ? generate_link($viewtopic_url . '&amp;view=print') : '',
 	'U_EMAIL_TOPIC'			=> ($_CLASS['auth']->acl_get('f_email', $forum_id) && $_CORE_CONFIG['email']['email_enable']) ? generate_link('Members_List&amp;mode=email&amp;t='.$topic_id) : '', 
 
@@ -1199,8 +1198,8 @@
 	'U_BOOKMARK_TOPIC'		=> ($_CLASS['core_user']->is_user && $config['allow_bookmarks']) ? generate_link($viewtopic_url . '&amp;bookmark=1') : '',
 	'L_BOOKMARK_TOPIC'		=> ($_CLASS['core_user']->is_user && $config['allow_bookmarks'] && $topic_data['bookmarked']) ? $_CLASS['core_user']->lang['BOOKMARK_TOPIC_REMOVE'] : $_CLASS['core_user']->lang['BOOKMARK_TOPIC'],
 	
-	'U_POST_NEW_TOPIC' 		=> generate_link('Forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id),
-	'U_POST_REPLY_TOPIC' 	=> generate_link("Forums&amp;file=posting&amp;mode=reply&amp;t=$topic_id"),
+	'U_POST_NEW_TOPIC' 		=> generate_link('forums&amp;file=posting&amp;mode=post&amp;f='.$forum_id),
+	'U_POST_REPLY_TOPIC' 	=> generate_link("forums&amp;file=posting&amp;mode=reply&amp;t=$topic_id"),
 	'U_BUMP_TOPIC'			=> bump_topic_allowed($forum_id, $topic_data['topic_bumped'], $topic_data['topic_last_post_time'], $topic_data['topic_poster'], $topic_data['topic_last_poster_id']) ? generate_link("Forums&amp;file=posting&amp;mode=bump&amp;t=$topic_id") : '')
 );
 
@@ -1308,14 +1307,14 @@
 
 if ($view == 'print')
 {
-	$_CLASS['core_display']->display(false, 'modules/Forums/viewtopic_print.html');
+	$_CLASS['core_display']->display(false, 'modules/forums/viewtopic_print.html');
 }
 
 page_header();
 
-make_jumpbox(generate_link('Forums&amp;file=viewforum'), $forum_id);
+make_jumpbox(generate_link('forums&amp;file=viewforum'), $forum_id);
 
-$_CLASS['core_display']->display(array($_CLASS['core_user']->get_lang('VIEWING_TOPIC'), $topic_data['topic_title']), 'modules/Forums/viewtopic_body.html');
+$_CLASS['core_display']->display(array($_CLASS['core_user']->get_lang('VIEWING_TOPIC'), $topic_data['topic_title']), 'modules/forums/viewtopic_body.html');
 
 //Move if we can
 function topic_last_read($topic_id, $forum_id)

Modified: cms/trunk/modules/members_list/index.php
===================================================================
--- cms/trunk/modules/members_list/index.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/members_list/index.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -31,7 +31,7 @@
 
 $_CLASS['core_user']->user_setup();
 $_CLASS['core_user']->add_lang();
-$_CLASS['core_user']->add_img(false, 'Forums');
+$_CLASS['core_user']->add_img(false, 'forums');
 
 $_CLASS['core_template']->assign_array(array(
 	'S_SEARCH_USER'	=> false,
@@ -715,21 +715,21 @@
 		{
 			$field	= get_variable('field', 'REQUEST', 'username');
 
-			$username	= request_var('username', '');
-			$email		= request_var('email', '');
-			$icq		= request_var('icq', '');
-			$aim		= request_var('aim', '');
-			$yahoo		= request_var('yahoo', '');
-			$msn		= request_var('msn', '');
-			$jabber		= request_var('jabber', '');
+			$username	= get_variable('username', 'REQUEST', '');
+			$email		= get_variable('email', 'REQUEST', '');
+			$icq		= get_variable('icq', 'REQUEST', '');
+			$aim		= get_variable('aim', 'REQUEST', '');
+			$yahoo		= get_variable('yahoo', 'REQUEST', '');
+			$msn		= get_variable('msn', 'REQUEST', '');
+			$jabber		= get_variable('jabber', 'REQUEST', '');
 
-			$joined_select	= request_var('joined_select', 'lt');
-			$active_select	= request_var('active_select', 'lt');
-			$count_select	= request_var('count_select', 'eq');
-			$joined			= explode('-', request_var('joined', ''));
-			$active			= explode('-', request_var('active', ''));
-			$count			= (request_var('count', '')) ? request_var('count', 0) : '';
-			$ipdomain		= request_var('ip', '');
+			$joined_select	= get_variable('joined_select', 'REQUEST', 'lt');
+			$active_select	= get_variable('active_select', 'REQUEST', 'lt');
+			$count_select	= get_variable('count_select', 'REQUEST', 'eq');
+			$joined			= explode('-', get_variable('joined', 'REQUEST', ''));
+			$active			= explode('-', get_variable('active', 'REQUEST', ''));
+			$count			= (get_variable('count', 'REQUEST', '')) ? get_variable('count', 'REQUEST', 0) : '';
+			$ipdomain		= get_variable('ip', 'REQUEST', '');
 
 			$find_key_match = array('lt' => '<', 'gt' => '>', 'eq' => '=');
 

Modified: cms/trunk/modules/quick_message/ajax.php
===================================================================
--- cms/trunk/modules/quick_message/ajax.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/quick_message/ajax.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -41,7 +41,7 @@
 switch ($mode)
 {
 	case 'ajax_refresh':
-		require_once(SITE_FILE_ROOT.'modules/Quick_Message/functions.php');
+		require_once SITE_FILE_ROOT.'modules/quick_message/functions.php';
 
 		echo qm_block_content();
 
@@ -69,7 +69,7 @@
 		}
 
 	// use limit
-		$result = $_CLASS['core_db']->query('SELECT COUNT(*) as count FROM '.QUICK_MESSAGE_TABLE." WHERE message_text='".$_CLASS['core_db']->escape($message)."' AND message_time >= ".($_CLASS['core_user']->time - $_CORE_CONFIG['quick_message']['last_post_check']));
+		$result = $_CLASS['core_db']->query('SELECT COUNT(*) as count FROM '. QUICK_MESSAGE_TABLE . " WHERE message_text='".$_CLASS['core_db']->escape($message)."' AND message_time >= ".($_CLASS['core_user']->time - $_CORE_CONFIG['quick_message']['last_post_check']));
 		$count = $_CLASS['core_db']->fetch_row_assoc($result);
 		$_CLASS['core_db']->free_result($result);
 
@@ -112,7 +112,7 @@
 					die;
 				}
 
-				require(SITE_FILE_ROOT.'includes/functions_user.php');
+				require_once SITE_FILE_ROOT.'includes/functions_user.php';
 				$status = validate_username($user_name);
 
 				if ($status !== true)
@@ -132,7 +132,7 @@
 
 		$_CLASS['core_db']->query($sql);
 
-		require_once(SITE_FILE_ROOT.'modules/Quick_Message/functions.php');
+		require_once SITE_FILE_ROOT.'modules/quick_message/functions.php';
 
 		echo qm_block_content();
 

Modified: cms/trunk/modules/quick_message/index.php
===================================================================
--- cms/trunk/modules/quick_message/index.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/modules/quick_message/index.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -105,7 +105,7 @@
 						trigger_error('LONG_NAME');
 					}
 	
-					require(SITE_FILE_ROOT.'includes/functions_user.php');
+					require_once SITE_FILE_ROOT.'includes/functions_user.php';
 					$status = validate_username($user_name);
 
 					if ($status !== true)
@@ -182,7 +182,7 @@
 $limit = 20;
 
 //$sql = 'SELECT s.*, u.user_avatar, u.user_avatar_type, u.user_avatar_width, u.user_avatar_height FROM '.$prefix.'quick_message s LEFT JOIN ' . USERS_TABLE . ' u  ON (u.user_id = s.user_id) ORDER BY time DESC';
-$result = $_CLASS['core_db']->query_limit('SELECT * FROM '.QUICK_MESSAGE_TABLE.' ORDER BY message_time DESC', $limit, $start);
+$result = $_CLASS['core_db']->query_limit('SELECT * FROM ' . QUICK_MESSAGE_TABLE . ' ORDER BY message_time DESC', $limit, $start);
 $row = $_CLASS['core_db']->fetch_row_assoc($result);
 
 if (!$row)
@@ -193,7 +193,7 @@
 		'Q_TOTAL_MESSAGES'		=> false
 	));
 
-	$_CLASS['core_display']->display(false, 'modules/Quick_Message/index.html');
+	$_CLASS['core_display']->display(false, 'modules/quick_message/index.html');
 }
 
 $delete_link = '';
@@ -202,7 +202,7 @@
 {
 	if (($row['poster_id'] && $row['poster_id'] == $_CLASS['core_user']->data['user_id']) || (!$row['poster_id'] && $row['poster_ip'] == $_CLASS['core_user']->ip))
 	{
-		$delete_link = generate_link('Quick_Message&amp;mode=delete&amp;id='.$row['message_id']);
+		$delete_link = generate_link('quick_message&amp;mode=delete&amp;id='.$row['message_id']);
 	}
 }
 
@@ -211,7 +211,7 @@
 	if ($row['poster_name'])
 	{
 		$user_name = htmlentities($row['poster_name'], ENT_QUOTES, 'UTF-8');
-		$userlink = ($row['poster_id']) ? generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['poster_id']) : false;
+		$userlink = ($row['poster_id']) ? generate_link('members_list&amp;mode=viewprofile&amp;u=' . $row['poster_id']) : false;
 	}
 	else
 	{
@@ -251,18 +251,18 @@
 		'MESSAGE'		=> modify_lines(htmlentities($row['message_text'], ENT_QUOTES, 'UTF-8'), '<br />'),
 		'TIME'			=> $_CLASS['core_user']->format_date($row['message_time']),
 		'POSTER_AVATAR' => $avatar,
-		'U_PROFILE' 	=> ($row['poster_id']) ? generate_link('Members_List&amp;mode=viewprofile&amp;u='.$row['poster_id']) : false,
+		'U_PROFILE' 	=> ($row['poster_id']) ? generate_link('members_list&amp;mode=viewprofile&amp;u='.$row['poster_id']) : false,
 	));
 	
 	$delete_link = '';
 }
 while ($row = $_CLASS['core_db']->fetch_row_assoc($result));
 
-$result = $_CLASS['core_db']->query('SELECT COUNT(*) AS total from '.QUICK_MESSAGE_TABLE);
+$result = $_CLASS['core_db']->query('SELECT COUNT(*) AS total from '. QUICK_MESSAGE_TABLE);
 $row = $_CLASS['core_db']->fetch_row_assoc($result);
 $_CLASS['core_db']->free_result($result);	
 
-$pagination = generate_pagination('Quick_Message', $row['total'], $limit, $start);
+$pagination = generate_pagination('quick_message', $row['total'], $limit, $start);
 
 $_CLASS['core_template']->assign_array(array(
 	'Q_MESSAGE_PAGINATION'			=> $pagination['formated'],
@@ -271,6 +271,6 @@
 	'Q_MESSAGE_TOTAL_MESSAGES'		=> $row['total']
 ));
 
-$_CLASS['core_display']->display(false, 'modules/Quick_Message/index.html');
+$_CLASS['core_display']->display(false, 'modules/quick_message/index.html');
 
 ?>
\ No newline at end of file

Modified: cms/trunk/themes/viperal/images/modules/forums/index.php
===================================================================
--- cms/trunk/themes/viperal/images/modules/forums/index.php	2006-07-25 17:05:43 UTC (rev 177)
+++ cms/trunk/themes/viperal/images/modules/forums/index.php	2006-07-25 17:08:28 UTC (rev 178)
@@ -1,77 +1,77 @@
 <?php
 $this->img = array(
 	'bbcode_bitfield' => '6913',
-    'btn_post' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_post.gif*27*97',
-    'btn_post_pm' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_post_pm.gif*27*97',
-    'btn_reply' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_reply.gif*27*97',
-    'btn_reply_pm' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_reply_pm.gif*20*90',
-    'btn_locked' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_locked.gif*27*97',
-    'btn_profile' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_profile.gif*20*72',
-    'btn_pm' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_pm.gif*20*72',
-    'btn_delete' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_delete.gif*20*20',
-    'btn_info' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_info.gif*20*20',
-    'btn_quote' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_quote.gif*20*90',
-    'btn_search' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_search.gif*20*72',
-    'btn_edit' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_edit.gif*20*90',
-    'btn_report' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_report.gif*20*20',
-    'btn_email' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_email.gif*20*72',
-    'btn_www' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_www.gif*20*72',
-    'btn_icq' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_icq.gif*20*72',
-    'btn_aim' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_aim.gif*20*72',
-    'btn_yim' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_yim.gif*20*72',
-    'btn_msnm' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_msnm.gif*20*72',
-    'btn_jabber' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_jabber.gif*20*72',
-    'btn_online' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_online.gif*20*72',
-    'btn_offline' => 'themes/viperal/template/modules/Forums/images/{LANG}/btn_offline.gif*20*72',
+    'btn_post' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_post.gif*27*97',
+    'btn_post_pm' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_post_pm.gif*27*97',
+    'btn_reply' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_reply.gif*27*97',
+    'btn_reply_pm' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_reply_pm.gif*20*90',
+    'btn_locked' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_locked.gif*27*97',
+    'btn_profile' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_profile.gif*20*72',
+    'btn_pm' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_pm.gif*20*72',
+    'btn_delete' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_delete.gif*20*20',
+    'btn_info' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_info.gif*20*20',
+    'btn_quote' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_quote.gif*20*90',
+    'btn_search' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_search.gif*20*72',
+    'btn_edit' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_edit.gif*20*90',
+    'btn_report' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_report.gif*20*20',
+    'btn_email' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_email.gif*20*72',
+    'btn_www' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_www.gif*20*72',
+    'btn_icq' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_icq.gif*20*72',
+    'btn_aim' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_aim.gif*20*72',
+    'btn_yim' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_yim.gif*20*72',
+    'btn_msnm' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_msnm.gif*20*72',
+    'btn_jabber' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_jabber.gif*20*72',
+    'btn_online' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_online.gif*20*72',
+    'btn_offline' => 'themes/viperal/template/modules/forums/images/{LANG}/btn_offline.gif*20*72',
     'btn_friend' => '',
     'btn_foe' => '',
-    'icon_unapproved' => 'themes/viperal/template/modules/Forums/images/icon_unapproved.gif*18*19',
-    'icon_reported' => 'themes/viperal/template/modules/Forums/images/icon_reported.gif*18*19',
-    'icon_attach' => 'themes/viperal/template/modules/Forums/images/icon_attach.gif*18*14',
-    'icon_post' => 'themes/viperal/template/modules/Forums/images/icon_minipost.gif*9*12',
-    'icon_post_new' => 'themes/viperal/template/modules/Forums/images/icon_minipost_new.gif*9*12',
-    'icon_post_latest' => 'themes/viperal/template/modules/Forums/images/icon_latest_reply.gif*9*18',
-    'icon_post_newest' => 'themes/viperal/template/modules/Forums/images/icon_newest_reply.gif*9*18',
-    'forum' => 'themes/viperal/template/modules/Forums/images/folder_big.gif*25*46',
-    'forum_new' => 'themes/viperal/template/modules/Forums/images/folder_new_big.gif*25*46',
-    'forum_locked' => 'themes/viperal/template/modules/Forums/images/folder_locked_big.gif*25*46',
-    'forum_link' => 'themes/viperal/template/modules/Forums/images/folder_link_big.gif*25*46',
-    'sub_forum' => 'themes/viperal/template/modules/Forums/images/subfolder_big.gif*25*46',
-    'sub_forum_new' => 'themes/viperal/template/modules/Forums/images/subfolder_new_big.gif*25*46',
-    'folder' => 'themes/viperal/template/modules/Forums/images/folder.gif*18*19',
-    'folder_moved' => 'themes/viperal/template/modules/Forums/images/folder_moved.gif*18*19',
-    'folder_posted' => 'themes/viperal/template/modules/Forums/images/folder_posted.gif*18*19',
-    'folder_new' => 'themes/viperal/template/modules/Forums/images/folder_new.gif*18*19',
-    'folder_new_posted' => 'themes/viperal/template/modules/Forums/images/folder_new_posted.gif*18*19',
-    'folder_hot' => 'themes/viperal/template/modules/Forums/images/folder_hot.gif*18*19',
-    'folder_hot_posted' => 'themes/viperal/template/modules/Forums/images/folder_hot_posted.gif*18*19',
-    'folder_hot_new' => 'themes/viperal/template/modules/Forums/images/folder_new_hot.gif*18*19',
-    'folder_hot_new_posted' => 'themes/viperal/template/modules/Forums/images/folder_new_hot_posted.gif*18*19',
-    'folder_locked' => 'themes/viperal/template/modules/Forums/images/folder_lock.gif*18*19',
-    'folder_locked_posted' => 'themes/viperal/template/modules/Forums/images/folder_lock_posted.gif*18*19',
-    'folder_locked_new' => 'themes/viperal/template/modules/Forums/images/folder_lock_new.gif*18*19',
-    'folder_locked_new_posted' => 'themes/viperal/template/modules/Forums/images/folder_lock_new_posted.gif*18*19',
-    'folder_sticky' => 'themes/viperal/template/modules/Forums/images/folder_sticky.gif*18*19',
-    'folder_sticky_posted' => 'themes/viperal/template/modules/Forums/images/folder_sticky_posted.gif*18*19',
-    'folder_sticky_new' => 'themes/viperal/template/modules/Forums/images/folder_sticky_new.gif*18*19',
-    'folder_sticky_new_posted' => 'themes/viperal/template/modules/Forums/images/folder_sticky_new_posted.gif*18*19',
-    'folder_announce' => 'themes/viperal/template/modules/Forums/images/folder_announce.gif*18*19',
-    'folder_announce_posted' => 'themes/viperal/template/modules/Forums/images/folder_announce_posted.gif*18*19',
-    'folder_announce_new' => 'themes/viperal/template/modules/Forums/images/folder_announce_new.gif*18*19',
-    'folder_announce_new_posted' => 'themes/viperal/template/modules/Forums/images/folder_announce_new_posted.gif*18*19',
+    'icon_unapproved' => 'themes/viperal/template/modules/forums/images/icon_unapproved.gif*18*19',
+    'icon_reported' => 'themes/viperal/template/modules/forums/images/icon_reported.gif*18*19',
+    'icon_attach' => 'themes/viperal/template/modules/forums/images/icon_attach.gif*18*14',
+    'icon_post' => 'themes/viperal/template/modules/forums/images/icon_minipost.gif*9*12',
+    'icon_post_new' => 'themes/viperal/template/modules/forums/images/icon_minipost_new.gif*9*12',
+    'icon_post_latest' => 'themes/viperal/template/modules/forums/images/icon_latest_reply.gif*9*18',
+    'icon_post_newest' => 'themes/viperal/template/modules/forums/images/icon_newest_reply.gif*9*18',
+    'forum' => 'themes/viperal/template/modules/forums/images/folder_big.gif*25*46',
+    'forum_new' => 'themes/viperal/template/modules/forums/images/folder_new_big.gif*25*46',
+    'forum_locked' => 'themes/viperal/template/modules/forums/images/folder_locked_big.gif*25*46',
+    'forum_link' => 'themes/viperal/template/modules/forums/images/folder_link_big.gif*25*46',
+    'sub_forum' => 'themes/viperal/template/modules/forums/images/subfolder_big.gif*25*46',
+    'sub_forum_new' => 'themes/viperal/template/modules/forums/images/subfolder_new_big.gif*25*46',
+    'folder' => 'themes/viperal/template/modules/forums/images/folder.gif*18*19',
+    'folder_moved' => 'themes/viperal/template/modules/forums/images/folder_moved.gif*18*19',
+    'folder_posted' => 'themes/viperal/template/modules/forums/images/folder_posted.gif*18*19',
+    'folder_new' => 'themes/viperal/template/modules/forums/images/folder_new.gif*18*19',
+    'folder_new_posted' => 'themes/viperal/template/modules/forums/images/folder_new_posted.gif*18*19',
+    'folder_hot' => 'themes/viperal/template/modules/forums/images/folder_hot.gif*18*19',
+    'folder_hot_posted' => 'themes/viperal/template/modules/forums/images/folder_hot_posted.gif*18*19',
+    'folder_hot_new' => 'themes/viperal/template/modules/forums/images/folder_new_hot.gif*18*19',
+    'folder_hot_new_posted' => 'themes/viperal/template/modules/forums/images/folder_new_hot_posted.gif*18*19',
+    'folder_locked' => 'themes/viperal/template/modules/forums/images/folder_lock.gif*18*19',
+    'folder_locked_posted' => 'themes/viperal/template/modules/forums/images/folder_lock_posted.gif*18*19',
+    'folder_locked_new' => 'themes/viperal/template/modules/forums/images/folder_lock_new.gif*18*19',
+    'folder_locked_new_posted' => 'themes/viperal/template/modules/forums/images/folder_lock_new_posted.gif*18*19',
+    'folder_sticky' => 'themes/viperal/template/modules/forums/images/folder_sticky.gif*18*19',
+    'folder_sticky_posted' => 'themes/viperal/template/modules/forums/images/folder_sticky_posted.gif*18*19',
+    'folder_sticky_new' => 'themes/viperal/template/modules/forums/images/folder_sticky_new.gif*18*19',
+    'folder_sticky_new_posted' => 'themes/viperal/template/modules/forums/images/folder_sticky_new_posted.gif*18*19',
+    'folder_announce' => 'themes/viperal/template/modules/forums/images/folder_announce.gif*18*19',
+    'folder_announce_posted' => 'themes/viperal/template/modules/forums/images/folder_announce_posted.gif*18*19',
+    'folder_announce_new' => 'themes/viperal/template/modules/forums/images/folder_announce_new.gif*18*19',
+    'folder_announce_new_posted' => 'themes/viperal/template/modules/forums/images/folder_announce_new_posted.gif*18*19',
     'folder_global' => '',
     'folder_global_posted' => '',
     'folder_global_new' => '',
     'folder_global_new_posted' => '',
-    'poll_left'		=> 'themes/viperal/template/modules/Forums/images/vote_lcap.gif*12*4',
-    'poll_center'	=> 'themes/viperal/template/modules/Forums/images/voting_bar.gif*12*4',
-    'poll_right'	=> 'themes/viperal/template/modules/Forums/images/vote_rcap.gif*12*4',
-    'attach_progress_bar' => 'themes/viperal/template/modules/Forums/images/progress_bar.gif*16*280',
+    'poll_left'		=> 'themes/viperal/template/modules/forums/images/vote_lcap.gif*12*4',
+    'poll_center'	=> 'themes/viperal/template/modules/forums/images/voting_bar.gif*12*4',
+    'poll_right'	=> 'themes/viperal/template/modules/forums/images/vote_rcap.gif*12*4',
+    'attach_progress_bar' => 'themes/viperal/template/modules/forums/images/progress_bar.gif*16*280',
     'karma_left' => '',
-    'karma_center' => 'themes/viperal/template/modules/Forums/images/karma/karma{SUFFIX}.gif*6*69',
+    'karma_center' => 'themes/viperal/template/modules/forums/images/karma/karma{SUFFIX}.gif*6*69',
     'karma_right' => '',
     'pagination_sep' => ', ',
-    'image_register' => 'themes/viperal/template/modules/Forums/images/icon_mini_register.gif',
+    'image_register' => 'themes/viperal/template/modules/forums/images/icon_mini_register.gif',
     'user_icon1' => '',
     'user_icon2' => '',
     'user_icon3' => '',



