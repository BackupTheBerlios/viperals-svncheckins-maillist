<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Viperals-svncheckins] r166 - in cms/trunk: includes/templates/modules modules modules/quick_message modules/quick_message/quick_message2
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/viperals-svncheckins/2005-October/index.html" >
   <LINK REL="made" HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r166%20-%20in%20cms/trunk%3A%20includes/templates/modules%20modules%20modules/quick_message%20modules/quick_message/quick_message2&In-Reply-To=%3C200510261929.j9QJTB9M003879%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000085.html">
   <LINK REL="Next"  HREF="000087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Viperals-svncheckins] r166 - in cms/trunk: includes/templates/modules modules modules/quick_message modules/quick_message/quick_message2</H1>
    <B>Ryan Marshall at BerliOS</B> 
    <A HREF="mailto:viperals-svncheckins%40lists.berlios.de?Subject=Re%3A%20%5BViperals-svncheckins%5D%20r166%20-%20in%20cms/trunk%3A%20includes/templates/modules%20modules%20modules/quick_message%20modules/quick_message/quick_message2&In-Reply-To=%3C200510261929.j9QJTB9M003879%40sheep.berlios.de%3E"
       TITLE="[Viperals-svncheckins] r166 - in cms/trunk: includes/templates/modules modules modules/quick_message modules/quick_message/quick_message2">viperal at berlios.de
       </A><BR>
    <I>Wed Oct 26 21:29:11 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000085.html">[Viperals-svncheckins] r165 - in cms/trunk: includes/templates/modules includes/templates/modules/control_panel2 includes/templates/modules/control_panel2/Control_Panel includes/templates/modules/quick_message2 includes/templates/modules/quick_message2/Quick_Message modules
</A></li>
        <LI>Next message: <A HREF="000087.html">[Viperals-svncheckins] r167 - in cms/trunk/modules: articles contact control_panel forums members_list quick_message/quick_message2 quick_message/quick_message2/language
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86">[ date ]</a>
              <a href="thread.html#86">[ thread ]</a>
              <a href="subject.html#86">[ subject ]</a>
              <a href="author.html#86">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: viperal
Date: 2005-10-26 21:29:09 +0200 (Wed, 26 Oct 2005)
New Revision: 166

Added:
   cms/trunk/includes/templates/modules/calender/
   cms/trunk/includes/templates/modules/contact/
   cms/trunk/includes/templates/modules/control_panel/
   cms/trunk/includes/templates/modules/forums/
   cms/trunk/includes/templates/modules/members_list/
   cms/trunk/includes/templates/modules/quick_message/
   cms/trunk/modules/contact/
   cms/trunk/modules/control_panel/
   cms/trunk/modules/forums/
   cms/trunk/modules/members_list/
   cms/trunk/modules/quick_message/
   cms/trunk/modules/quick_message/quick_message2/
Removed:
   cms/trunk/includes/templates/modules/calender2/
   cms/trunk/includes/templates/modules/contact2/
   cms/trunk/includes/templates/modules/control_panel2/
   cms/trunk/includes/templates/modules/forums2/
   cms/trunk/includes/templates/modules/members_list2/
   cms/trunk/includes/templates/modules/quick_message2/
   cms/trunk/modules/contact2/
   cms/trunk/modules/control_panel2/
   cms/trunk/modules/forums2/
   cms/trunk/modules/members_list2/
   cms/trunk/modules/quick_message/quick_message2/ajax.php
   cms/trunk/modules/quick_message/quick_message2/configurator.php
   cms/trunk/modules/quick_message/quick_message2/functions.php
   cms/trunk/modules/quick_message/quick_message2/index.php
   cms/trunk/modules/quick_message/quick_message2/language/
   cms/trunk/modules/quick_message2/
Log:
Change module cases to all lowercase ( Completed )

Copied: cms/trunk/includes/templates/modules/calender (from rev 165, cms/trunk/includes/templates/modules/calender2)

Copied: cms/trunk/includes/templates/modules/contact (from rev 165, cms/trunk/includes/templates/modules/contact2)

Copied: cms/trunk/includes/templates/modules/control_panel (from rev 165, cms/trunk/includes/templates/modules/control_panel2)

Copied: cms/trunk/includes/templates/modules/forums (from rev 165, cms/trunk/includes/templates/modules/forums2)

Copied: cms/trunk/includes/templates/modules/members_list (from rev 165, cms/trunk/includes/templates/modules/members_list2)

Copied: cms/trunk/includes/templates/modules/quick_message (from rev 165, cms/trunk/includes/templates/modules/quick_message2)

Copied: cms/trunk/modules/contact (from rev 165, cms/trunk/modules/contact2)

Copied: cms/trunk/modules/control_panel (from rev 165, cms/trunk/modules/control_panel2)

Copied: cms/trunk/modules/forums (from rev 165, cms/trunk/modules/forums2)

Copied: cms/trunk/modules/members_list (from rev 165, cms/trunk/modules/members_list2)

Copied: cms/trunk/modules/quick_message (from rev 165, cms/trunk/modules/quick_message2)

Copied: cms/trunk/modules/quick_message/quick_message2 (from rev 165, cms/trunk/modules/quick_message2)

Deleted: cms/trunk/modules/quick_message/quick_message2/ajax.php
===================================================================
--- cms/trunk/modules/quick_message2/ajax.php	2005-10-26 19:21:18 UTC (rev 165)
+++ cms/trunk/modules/quick_message/quick_message2/ajax.php	2005-10-26 19:29:09 UTC (rev 166)
@@ -1,188 +0,0 @@
-&lt;?php
-/*
-||**************************************************************||
-||  Viperal CMS &#169; :												||
-||**************************************************************||
-||																||
-||	Copyright (C) 2004, 2005									||
-||  By Ryan Marshall ( Viperal )								||
-||																||
-||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
-||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
-||																||
-||**************************************************************||
-||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
-||**************************************************************||
-||  Viperal CMS is released under the terms and conditions		||
-||  of the GNU General Public License version 2					||
-||																||
-||**************************************************************||
-
-$Id$
-*/
-
-if (!defined('VIPERAL'))
-{
-    die;
-}
-
-global $_CORE_CONFIG, $_CLASS;
-
-if (!defined('QUICK_MESSAGE_TABLE'))
-{
-	global $table_prefix;
-		
-	define('QUICK_MESSAGE_TABLE', $table_prefix.'quick_message');
-}
-
-$_CLASS['core_user']-&gt;user_setup();
-$mode = get_variable('mode', 'REQUEST', false);
-
-switch ($mode)
-{
-	case 'ajax_refresh':
-		require_once(SITE_FILE_ROOT.'modules/Quick_Message/functions.php');
-
-		echo qm_block_content();
-
-		script_close();
-	break;
-
-	case 'ajax_add':
-		if ($_CLASS['core_user']-&gt;is_bot)
-		{
-			die;
-		}
-
-		$message = trim(get_variable('message', 'POST', ''));
-
-		if (!$message)
-		{
-			die;
-		}
-
-		$length = mb_strlen($message);
-
-		if ($length &gt; $_CORE_CONFIG['quick_message']['length_max'])
-		{ 
-			die;
-		}
-
-	// use limit
-		$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM '.QUICK_MESSAGE_TABLE.&quot; WHERE message_text='&quot;.$_CLASS['core_db']-&gt;escape($message).&quot;' AND message_time &gt;= &quot;.($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['last_post_check']));
-		$count = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-		$_CLASS['core_db']-&gt;free_result($result);
-
-	// add a count check here so it admin ajustable
-		if ($count['count'] &gt; 0)
-		{
-			die;
-		}
-
-		$_CLASS['core_db']-&gt;free_result($result);
-
-		if ($_CLASS['core_user']-&gt;is_user)
-		{
-			$user_id =  $_CLASS['core_user']-&gt;data['user_id'];
-			$user_name = $_CLASS['core_user']-&gt;data['username'];
-		}
-		else
-		{
-			$user_id = 0;
-			$user_name = get_variable('poster_name', 'POST', false);
-
-			if (!$user_name)
-			{
-				if ($_CORE_CONFIG['quick_message']['anonymous_posting'] != '2')
-				{
-					die;
-				}
-			}
-			else
-			{
-				$length = mb_strlen($user_name);
-
-				if ($length &lt; 2)
-				{
-					die;
-				}
-
-				if ($length &gt; 10)
-				{
-					die;
-				}
-
-				require(SITE_FILE_ROOT.'includes/functions_user.php');
-				$status = validate_username($user_name);
-
-				if ($status !== true)
-				{
-					die;
-				}
-			}
-		}
-
-		$sql = 'INSERT INTO '.QUICK_MESSAGE_TABLE.' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
-			'poster_name'	=&gt; (string) $user_name,
-			'poster_id'		=&gt; (int) $user_id,
-			'poster_ip'		=&gt; (string) $_CLASS['core_user']-&gt;ip,
-			'message_text'	=&gt; (string) $message,
-			'message_time'	=&gt; (int) $_CLASS['core_user']-&gt;time,
-		));
-
-		$_CLASS['core_db']-&gt;query($sql);
-
-		require_once(SITE_FILE_ROOT.'modules/Quick_Message/functions.php');
-
-		echo qm_block_content();
-
-		script_close();
-
-	break;
-
-	case 'delete':
-		$id = get_variable('id', 'GET', false, 'integer');
-
-		if (!$id)
-		{
-			die;
-		}
-
-		$result = $_CLASS['core_db']-&gt;query_limit('SELECT message_id, poster_id, poster_name, poster_ip, message_time FROM '.QUICK_MESSAGE_TABLE.' ORDER BY message_time DESC', 1);
-		$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-		$_CLASS['core_db']-&gt;free_result($result);
-		
-		if (!$row)
-		{
-			trigger_error('NO_MESSAGE');
-		}
-
-		$return = true;
-
-		if ($row['message_id'] == $id)
-		{
-			if ($row['message_time'] &gt; ($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['delete_time']))
-			{
-				if (($row['poster_id'] &amp;&amp; $row['poster_id'] == $_CLASS['core_user']-&gt;data['user_id']) || (!$row['poster_id'] &amp;&amp; $row['poster_ip'] == $_CLASS['core_user']-&gt;ip))
-				{
-					$return = false;
-				}
-			}
-		}
-
-		if ($return)
-		{
-			trigger_error('MESSAGE_NOT_DELETABLE');
-		}
-
-		$sql = 'DELETE FROM ' . QUICK_MESSAGE_TABLE . ' WHERE message_id = '.$id;
-		$_CLASS['core_db']-&gt;query($sql);
-
-		//trigger_error('MESSAGE_DELETED');
-		redirect(($_CLASS['core_user']-&gt;data['session_url']) ? generate_link($_CLASS['core_user']-&gt;data['session_url'], array('full' =&gt; true)) : '');
-	break;
-}
-
-script_close(false);
-
-?&gt;
\ No newline at end of file

Deleted: cms/trunk/modules/quick_message/quick_message2/configurator.php
===================================================================
--- cms/trunk/modules/quick_message2/configurator.php	2005-10-26 19:21:18 UTC (rev 165)
+++ cms/trunk/modules/quick_message/quick_message2/configurator.php	2005-10-26 19:29:09 UTC (rev 166)
@@ -1,93 +0,0 @@
-&lt;?php
-/*
-||**************************************************************||
-||  Viperal CMS &#169; :												||
-||**************************************************************||
-||																||
-||	Copyright (C) 2004, 2005									||
-||  By Ryan Marshall ( Viperal )								||
-||																||
-||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
-||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
-||																||
-||**************************************************************||
-||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
-||**************************************************************||
-||  Viperal CMS is released under the terms and conditions		||
-||  of the GNU General Public License version 2					||
-||																||
-||**************************************************************||
-
-$Id$
-*/
-
-if (!defined('VIPERAL'))
-{
-    die;
-}
-
-global $table_prefix;
-
-if (!defined('QUICK_MESSAGE_TABLE'))
-{
-	define('QUICK_MESSAGE_TABLE', $table_prefix.'quick_message');
-}
-
-class Quick_Message_configurator
-{
-	function install()
-	{
-		global $_CLASS;
-
-		$_CLASS['core_db']-&gt;table_create('start', QUICK_MESSAGE_TABLE);
-		
-		$_CLASS['core_db']-&gt;add_table_field_int('message_id', array('max' =&gt; 16000000, 'auto_increment' =&gt; true));
-		$_CLASS['core_db']-&gt;add_table_field_text('message_text', 200);
-		$_CLASS['core_db']-&gt;add_table_field_int('message_time', array('max' =&gt; 200000000));
-		$_CLASS['core_db']-&gt;add_table_field_int('poster_id', array('max' =&gt; 16000000));
-		$_CLASS['core_db']-&gt;add_table_field_char('poster_name', 80);
-		$_CLASS['core_db']-&gt;add_table_field_char('poster_ip', 18);
-		
-		$_CLASS['core_db']-&gt;add_table_index('message_id', 'primary');
-		$_CLASS['core_db']-&gt;add_table_index('message_time');
-		
-		$_CLASS['core_db']-&gt;table_create('commit');
-		
-		// use set config ?
-		set_core_config('quick_message', 'anonymous_posting', 2, false, true, 'int');
-		set_core_config('quick_message', 'delete_time', 300, false, true, 'int');
-		set_core_config('quick_message', 'height', 200, false, true, 'int');
-		set_core_config('quick_message', 'last_post_check', 150, false, true, 'int');
-		set_core_config('quick_message', 'length_max', 150, false, true, 'int');
-
-		$_CLASS['core_cache']-&gt;destroy('core_config');
-
-		$array = array(
-			'message_text'	=&gt; 'Lets do this !',
-			'message_time'	=&gt; (int) $_CLASS['core_user']-&gt;time,
-			'poster_id'		=&gt; 0,
-			'poster_name'	=&gt; (string) '',
-			'poster_ip'		=&gt; (string) ''
-		);
-
-		$_CLASS['core_db']-&gt;query('INSERT INTO ' . QUICK_MESSAGE_TABLE . ' '. $_CLASS['core_db']-&gt;sql_build_array('INSERT', $array));
-
-		return true;
-	}
-
-	function uninstall()
-	{
-		global $_CLASS;
-
-		$_CLASS['core_db']-&gt;report_error(false);
-
-		$_CLASS['core_db']-&gt;query('DROP TABLE ' . QUICK_MESSAGE_TABLE);
-		$_CLASS['core_db']-&gt;query('DELETE FROM ' . CORE_CONFIG_TABLE . &quot; WHERE config_section = 'quick_message'&quot;);
-
-		$_CLASS['core_db']-&gt;report_error(true);
-		
-		return true;
-	}
-}
-
-?&gt;
\ No newline at end of file

Deleted: cms/trunk/modules/quick_message/quick_message2/functions.php
===================================================================
--- cms/trunk/modules/quick_message2/functions.php	2005-10-26 19:21:18 UTC (rev 165)
+++ cms/trunk/modules/quick_message/quick_message2/functions.php	2005-10-26 19:29:09 UTC (rev 166)
@@ -1,101 +0,0 @@
-&lt;?php
-/*
-||**************************************************************||
-||  Viperal CMS &#169; :												||
-||**************************************************************||
-||																||
-||	Copyright (C) 2004, 2005									||
-||  By Ryan Marshall ( Viperal )								||
-||																||
-||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
-||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
-||																||
-||**************************************************************||
-||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
-||**************************************************************||
-||  Viperal CMS is released under the terms and conditions		||
-||  of the GNU General Public License version 2					||
-||																||
-||**************************************************************||
-
-$Id$
-*/
-
-if (!defined('VIPERAL'))
-{
-    die;
-}
-
-global $table_prefix;
-
-if (!defined('QUICK_MESSAGE_TABLE'))
-{
-	define('QUICK_MESSAGE_TABLE', $table_prefix.'quick_message');
-}
-
-function qm_block_content()
-{
-	global $_CLASS, $_CORE_CONFIG;
-	
-	$content = '&lt;div style=&quot;width: 100%; height: '.$_CORE_CONFIG['quick_message']['height'].'px; overflow: auto;&quot;&gt;';
-	
-	$result = $_CLASS['core_db']-&gt;query_limit('SELECT * from '.QUICK_MESSAGE_TABLE.' ORDER BY message_time DESC', 10);
-	
-	while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result))
-	{
-		$words_array = explode(' ', $row['message_text']);
-	
-		$row['message_text'] = '';
-	
-		foreach($words_array as $words)
-		{
-			if (substr($words, 0, 4) != '[url')
-			{
-				$row['message_text'] .= ' '.wordwrap($words, 18, &quot;\n&quot;, 1);
-			}
-			else
-			{
-				$row['message_text'] .= $words;
-			}
-		}
-	
-		$row['message_text'] = htmlentities($row['message_text'], ENT_QUOTES, 'UTF-8');
-	
-		unset($words_array, $words);
-		
-		$content .= '&lt;div style=&quot;padding: 4px;&quot;&gt;';
-		
-		if ($row['poster_name'])
-		{
-			$row['poster_name'] = htmlentities($row['poster_name'], ENT_QUOTES, 'UTF-8');
-	
-			if ($row['poster_id']) 
-			{
-				$content .= '&lt;a href=&quot;'.generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['poster_id']).'&quot;&gt;&lt;b&gt;' . $row['poster_name'] . ': &lt;/b&gt;&lt;/a&gt;';
-			}
-			else
-			{
-				$content .= '&lt;b&gt;' . $row['poster_name'] . ': &lt;/b&gt;'; 
-			}
-		}
-		else
-		{
-			$content .= '&lt;b&gt;' . $_CLASS['core_user']-&gt;lang['ANONYMOUS'] . ': &lt;/b&gt;';
-		}
-	
-		if ($row['poster_id'])
-		{
-			$row['message_text'] = preg_replace('#\[url=([^\[]+?)\](.*?)\[/url\]#s', '&lt;a href=&quot;$1&quot; target=&quot;_blank&quot;&gt;$2&lt;/a&gt;', $row['message_text']);
-		}
-	
-		$content .= $row['message_text'].'&lt;br /&gt;'. $_CLASS['core_user']-&gt;format_date($row['message_time']) .'&lt;/div&gt;&lt;hr/&gt;';
-	}
-	
-	$_CLASS['core_db']-&gt;free_result($result);
-	
-	$content .= '&lt;/div&gt;';
-
-	return $content;
-}
-
-?&gt;
\ No newline at end of file

Deleted: cms/trunk/modules/quick_message/quick_message2/index.php
===================================================================
--- cms/trunk/modules/quick_message2/index.php	2005-10-26 19:21:18 UTC (rev 165)
+++ cms/trunk/modules/quick_message/quick_message2/index.php	2005-10-26 19:29:09 UTC (rev 166)
@@ -1,276 +0,0 @@
-&lt;?php
-/*
-||**************************************************************||
-||  Viperal CMS &#169; :												||
-||**************************************************************||
-||																||
-||	Copyright (C) 2004, 2005									||
-||  By Ryan Marshall ( Viperal )								||
-||																||
-||  Email: <A HREF="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">viperal1 at gmail.com</A>									||
-||  Site: <A HREF="http://www.viperal.com">http://www.viperal.com</A>								||
-||																||
-||**************************************************************||
-||	LICENSE: ( <A HREF="http://www.gnu.org/licenses/gpl.txt">http://www.gnu.org/licenses/gpl.txt</A> )			||
-||**************************************************************||
-||  Viperal CMS is released under the terms and conditions		||
-||  of the GNU General Public License version 2					||
-||																||
-||**************************************************************||
-
-$Id$
-*/
-
-if (!defined('VIPERAL'))
-{
-    die;
-}
-
-global $_CLASS, $_CORE_CONFIG;
-
-if (!defined('QUICK_MESSAGE_TABLE'))
-{
-	global $table_prefix;
-
-	define('QUICK_MESSAGE_TABLE', $table_prefix.'quick_message');
-}
-
-$_CLASS['core_user']-&gt;user_setup();
-$_CLASS['core_user']-&gt;add_lang();
-if ($mode = get_variable('mode', 'REQUEST', false))
-{
-	switch ($mode)
-	{
-		case 'add':
-			if ($_CLASS['core_user']-&gt;is_bot)
-			{
-				redirect(generate_link($_CLASS['core_user']-&gt;data['session_url'], array('full' =&gt; true)));
-			}
-	
-			$message = trim(get_variable('message', 'POST', false));
-	
-			if (!$message)
-			{
-				trigger_error('NO_MESSAGE');
-			}
-	
-			$length = mb_strlen($message);
-	
-			if ($length &gt; $_CORE_CONFIG['quick_message']['length_max'])
-			{ 
-				trigger_error('LONG_MESSAGE');
-			}
-	
-		// use limit
-			$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) as count FROM '.QUICK_MESSAGE_TABLE.&quot; WHERE message_text='&quot;.$_CLASS['core_db']-&gt;escape($message).&quot;' AND message_time &gt;= &quot;.($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['last_post_check']));
-			$count = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-			$_CLASS['core_db']-&gt;free_result($result);
-	
-		// add a count check here so it admin ajustable
-			if ($count['count'] &gt; 0)
-			{
-				trigger_error(sprintf($_CLASS['core_user']-&gt;lang['SAME_MESSAGE'], $_CORE_CONFIG['quick_message']['last_post_check'] / 60));
-			}
-	
-			$_CLASS['core_db']-&gt;free_result($result);
-	
-			if ($_CLASS['core_user']-&gt;is_user)
-			{
-				$user_id =  $_CLASS['core_user']-&gt;data['user_id'];
-				$user_name = $_CLASS['core_user']-&gt;data['username'];
-			}
-			else
-			{
-				$user_id = 0;
-				$user_name = get_variable('poster_name', 'POST', false);
-	
-				if (!$user_name)
-				{
-					if ($_CORE_CONFIG['quick_message']['anonymous_posting'] != '2')
-					{
-						trigger_error('NO_NAME');
-					}
-				}
-				else
-				{
-					$length = mb_strlen($user_name);
-	
-					if ($length &lt; 2)
-					{
-						trigger_error('SHORT_NAME');
-					}
-	
-					if ($length &gt; 10)
-					{
-						trigger_error('LONG_NAME');
-					}
-	
-					require(SITE_FILE_ROOT.'includes/functions_user.php');
-					$status = validate_username($user_name);
-
-					if ($status !== true)
-					{
-						trigger_error($error);
-					}
-				}
-			}
-	
-			$sql = 'INSERT INTO '.QUICK_MESSAGE_TABLE.' ' . $_CLASS['core_db']-&gt;sql_build_array('INSERT', array(
-				'poster_name'	=&gt; (string) $user_name,
-				'poster_id'		=&gt; (int) $user_id,
-				'poster_ip'		=&gt; (string) $_CLASS['core_user']-&gt;ip,
-				'message_text'	=&gt; (string) $message,
-				'message_time'	=&gt; (int) $_CLASS['core_user']-&gt;time,
-			));
-	
-			$_CLASS['core_db']-&gt;query($sql);
-
-			redirect(generate_link($_CLASS['core_user']-&gt;data['session_url'], array('full' =&gt; true)));
-		break;
-	
-		case 'delete':
-			global $_CORE_CONFIG, $_CLASS;
-	
-			$id = get_variable('id', 'GET', false, 'integer');
-	
-			if (!$id)
-			{
-				die;
-			}
-	
-			$result = $_CLASS['core_db']-&gt;query_limit('SELECT message_id, poster_id, poster_name, poster_ip, message_time FROM '.QUICK_MESSAGE_TABLE.' ORDER BY message_time DESC', 1);
-			$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-			$_CLASS['core_db']-&gt;free_result($result);
-			
-			if (!$row)
-			{
-				trigger_error('NO_MESSAGE');
-			}
-	
-			$return = true;
-	
-			if ($row['message_id'] == $id)
-			{
-				if ($row['message_time'] &gt; ($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['delete_time']))
-				{
-					if (($row['poster_id'] &amp;&amp; $row['poster_id'] == $_CLASS['core_user']-&gt;data['user_id']) || (!$row['poster_id'] &amp;&amp; $row['poster_ip'] == $_CLASS['core_user']-&gt;ip))
-					{
-						$return = false;
-					}
-				}
-			}
-	
-			if ($return)
-			{
-				trigger_error('MESSAGE_NOT_DELETABLE');
-			}
-	
-			$sql = 'DELETE FROM ' . QUICK_MESSAGE_TABLE . ' WHERE message_id = '.$id;
-			$_CLASS['core_db']-&gt;query($sql);
-	
-			//trigger_error('MESSAGE_DELETED');
-			redirect(($_CLASS['core_user']-&gt;data['session_url']) ? generate_link($_CLASS['core_user']-&gt;data['session_url'], array('full' =&gt; true)) : '');
-		break;
-		
-		default:
-			script_close();
-		break;
-	}
-}
-
-$start = get_variable('start', 'GET', 0, 'integer');
-$limit = 20;
-
-//$sql = 'SELECT s.*, u.user_avatar, u.user_avatar_type, u.user_avatar_width, u.user_avatar_height FROM '.$prefix.'quick_message s LEFT JOIN ' . USERS_TABLE . ' u  ON (u.user_id = s.user_id) ORDER BY time DESC';
-$result = $_CLASS['core_db']-&gt;query_limit('SELECT * FROM '.QUICK_MESSAGE_TABLE.' ORDER BY message_time DESC', $limit, $start);
-$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-
-if (!$row)
-{
-	$_CLASS['core_template']-&gt;assign_array(array(
-		'Q_MESSAGE_PAGINATION'	=&gt; generate_pagination('Quick_Message', $row['total'], $limit, $start, false, 'Q_MESSAGE_'),
-		'Q_PAGE_NUMBER'			=&gt; on_page($row['total'], $limit, $start),
-		'Q_TOTAL_MESSAGES'		=&gt; $row['total']
-	));
-
-	$_CLASS['core_display']-&gt;display(false, 'modules/Quick_Message/index.html');
-}
-
-$delete_link = '';
-
-if ($row['message_time'] &gt; ($_CLASS['core_user']-&gt;time - $_CORE_CONFIG['quick_message']['delete_time']))
-{
-	if (($row['poster_id'] &amp;&amp; $row['poster_id'] == $_CLASS['core_user']-&gt;data['user_id']) || (!$row['poster_id'] &amp;&amp; $row['poster_ip'] == $_CLASS['core_user']-&gt;ip))
-	{
-		$delete_link = generate_link('Quick_Message&amp;mode=delete&amp;id='.$row['message_id']);
-	}
-}
-
-do
-{
-	if ($row['poster_name'])
-	{
-		$user_name = htmlentities($row['poster_name'], ENT_QUOTES, 'UTF-8');
-		$userlink = ($row['poster_id']) ? generate_link('Members_List&amp;mode=viewprofile&amp;u=' . $row['poster_id']) : false;
-	}
-	else
-	{
-		$user_name = $_CLASS['core_user']-&gt;lang['ANONYMOUS'];
-		$userlink = false;
-	}
-
-	$avatar = false;
-	/*if ($row['user_avatar'] &amp;&amp; $_CLASS['core_user']-&gt;optionget('viewavatars'))
-	{
-		$avatar_img = '';
-		
-		switch ($row['user_avatar_type'])
-		{
-			case AVATAR_UPLOAD:
-				$avatar_img = $config['avatar_path'] . '/';
-				break;
-			case AVATAR_GALLERY:
-				$avatar_img = $config['avatar_gallery_path'] . '/';
-				break;
-		}
-		
-		$avatar_img .= $row['user_avatar'];
-		$avatar = '&lt;img src=&quot;' . $avatar_img . '&quot; width=&quot;' . $row['user_avatar_width'] . '&quot; height=&quot;' . $row['user_avatar_height'] . '&quot; border=&quot;0&quot; alt=&quot;&quot; /&gt;';
-		
-	}*/
-
-	if ($row['poster_id'])
-	{
-		$row['message'] = preg_replace('#\[url=([^\[]+?)\](.*?)\[/url\]#s', '&lt;a href=&quot;$1&quot; target=&quot;_blank&quot;&gt;$2&lt;/a&gt;', $row['message_text']);
-	}
-	
-	$_CLASS['core_template']-&gt;assign_vars_array('quick_message', array(
-		'USER_NAME'		=&gt; $user_name,
-		'USER_LINK'		=&gt; $userlink,
-		'DELETE_LINK'	=&gt; $delete_link,
-		'MESSAGE'		=&gt; modify_lines(htmlentities($row['message_text'], ENT_QUOTES, 'UTF-8'), '&lt;br /&gt;'),
-		'TIME'			=&gt; $_CLASS['core_user']-&gt;format_date($row['message_time']),
-		'POSTER_AVATAR' =&gt; $avatar,
-		'U_PROFILE' 	=&gt; ($row['poster_id']) ? generate_link('Members_List&amp;mode=viewprofile&amp;u='.$row['poster_id']) : false,
-	));
-	
-	$delete_link = '';
-}
-while ($row = $_CLASS['core_db']-&gt;fetch_row_assoc($result));
-
-$result = $_CLASS['core_db']-&gt;query('SELECT COUNT(*) AS total from '.QUICK_MESSAGE_TABLE);
-$row = $_CLASS['core_db']-&gt;fetch_row_assoc($result);
-$_CLASS['core_db']-&gt;free_result($result);	
-
-$pagination = generate_pagination('Quick_Message', $row['total'], $limit, $start);
-
-$_CLASS['core_template']-&gt;assign_array(array(
-	'Q_MESSAGE_PAGINATION'			=&gt; $pagination['formated'],
-	'Q_MESSAGE_PAGINATION_ARRAY'	=&gt; $pagination['array'],
-	'Q_PAGE_NUMBER'					=&gt; on_page($row['total'], $limit, $start),
-	'Q_TOTAL_MESSAGES'				=&gt; $row['total']
-));
-
-$_CLASS['core_display']-&gt;display(false, 'modules/Quick_Message/index.html');
-
-?&gt;
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000085.html">[Viperals-svncheckins] r165 - in cms/trunk: includes/templates/modules includes/templates/modules/control_panel2 includes/templates/modules/control_panel2/Control_Panel includes/templates/modules/quick_message2 includes/templates/modules/quick_message2/Quick_Message modules
</A></li>
	<LI>Next message: <A HREF="000087.html">[Viperals-svncheckins] r167 - in cms/trunk/modules: articles contact control_panel forums members_list quick_message/quick_message2 quick_message/quick_message2/language
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86">[ date ]</a>
              <a href="thread.html#86">[ thread ]</a>
              <a href="subject.html#86">[ subject ]</a>
              <a href="author.html#86">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/viperals-svncheckins">More information about the Viperals-svncheckins
mailing list</a><br>
</body></html>
